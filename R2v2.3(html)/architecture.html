<!DOCTYPE html>  
<html lang="en" xml:lang="en">
<head>
<title>overwritten</title>
	<script src='js/respec.js' class='remove'></script>
	<script class='remove'>				
		
		var respecConfig = {
					 
          // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
          specStatus:           "OIPF-FINAL",
		  
		  OIPFrelease: "2",	
		  OIPFversion: "2.3",
		  OIPFvolume: "",
          
          
          // the specification's short name, as in http://www.w3.org/TR/short-name/
          shortName:            "architecture",

          // if your specification has a subtitle that goes below the main
          // formal title, define it here
		  title: "Functional Architecture",
          subtitle   :  "",

          // if you wish the publication date to be other than today, set this
          publishDate:  "2014-01-24",

          // if the specification's copyright date is a range of years, specify
          // the start date here:
          //copyrightStart: "2005",
		
		  //additionalCopyrightHolders: "",
		  
		  overrideCopyright: " ",
		  
		  
          // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
          // and its maturity status
          // previousPublishDate:  "1977-03-15",
          // previousMaturity:  "WD",

          // if there a publicly available Editor's Draft, this is the link
          edDraftURI:           "",

          // if this is a LCWD, uncomment and set the end of its review period
          // lcEnd: "2009-08-05",



          // editors, add as many as you like
          // only "name" is required
          editors:  [
              { name: "Editor", url: "contact@oipf.tv",
                company: "Open IPTV Forum", companyURL: "http://www.oipf.tv/" },
          ],
		  
          // authors, add as many as you like. 
          // This is optional, uncomment if you have authors as well as editors.
          // only "name" is required. Same format as editors.

          //authors:  [
          //    { name: "Your Name", url: "http://example.org/",
          //      company: "Your Company", companyURL: "http://example.com/" },
          //],
          
          // name of the WG
          wg:           "OIPF Architecture WG",
          
          // URI of the public WG page
          wgURI:        "http://www.oipf.tv",
          
          // name (with the @w3c.org) of the public mailing to which comments are due
          wgPublicList: "contact@oipf.tv",
          
          // URI of the patent status for this WG, for Rec-track documents
          // !!!! IMPORTANT !!!!
          // This is important for Rec-track documents, do not copy a patent URI from a random
          // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
          // Team Contact.
          wgPatentURI:  "",
          		  
		  maxTocLevel:	3,
		  
				
		  localBiblio: {
			"Ref-1":"Broadband Forum, TR-069, \"CPE WAN Management Protocol\"",
			"Ref-2":"DLNA, Networked Device Interoperability Guidelines, October 2006<br/>Note: The above reference will be updated to the next release of the DLNA Networked Device Interoperability Guidelines when these are published.",
			"Ref-3":"CEA, CEA-2014, \"Web-based Protocol and Framework for Remote User Interface on UPnP&trade; Networks and the Internet (Web4CE)\"",
			"Ref-4":"ETSI, TS 102 034, \"Transport of MPEG-2 TS Based Services over IP Based Networks\"",
			"Ref-5":"IEEE, Std. 802.1Q-2003, \"Ethernet Priority, Virtual Bridged Local Area Networks\"",
			"Ref-6":"IETF, RFC 2475, \"An Architecture for Differentiated Services\"",
			"Ref-7":"IEEE, 802.11, \"Wireless Local Area Networks\"",
			"Ref-8":"IETF, RFC 4541, \"Considerations for Internet Group Management Protocol (IGMP) and Multicast Listener Discovery (MLD) Snooping Switches\", May 2006",
			"Ref-9":"IETF, RFC 4605, \"Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding (IGMP/MLD Proxying)\"",
			"Ref-10":"IETF, RFC 3376, \"Internet Group Management Protocol, Version 3\", October 2002",
			"Ref-11":"IETF, RFC 4608, \"Source-Specific Protocol Independent Multicast in 232/8\", August 2006",
			"Ref-12":"ETSI, ES 282 003, \"Resource and Admission Control Subsystem (RACS)\"",
			"Ref-13":"ETSI, TS 102 539, \"Carriage of Broadband Content Guide (BCG) information over Internet Protocol (IP)\"",
			"Ref-14":"IETF, RFC 3550, \"RTP: A Transport Protocol for Real-Time Applications\"",
			"Ref-15":"3GPP, TS 23.228, \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; IP Multimedia Subsystem (IMS); Stage 2\"",
			"Ref-16":"IETF, RFC 2617, \"HTTP Authentication: Basic and Digest Access Authentication\"",
			"Ref-17":"3GPP, TS 33.203, \"3G security; Access security for IP-based services\"",
			"Ref-18":"3GPP, TS 24.229, \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP)\"",
			"Ref-19":"IETF, RFC 2326, \"Real Time Streaming Protocol (RTSP)\"",
			"Ref-20":"ITU-T, Recommendation E.164, \"The international public telecommunication numbering plan\"",
			"Ref-21":"IETF, RFC 3261, \"SIP: Session Initiation Protocol\"",
			"Ref-22":"Open Mobile Alliance, \"Instant Messaging using SIMPLE\" (OMA-ERP-SIMPLE_IM-V1_0-20070816-C)",
			"Ref-23":"ECMA-262, \"ECMAScript Language Specification\", 3rd edition, December 1999.",
			"Ref-24":"Open Mobile Alliance, \"Presence SIMPLE Specification\" (OMA-ERP-Presence_SIMPLE-V1_0_1-20061128-A) ",
			"Ref-25":"3GPP, TS 33.220, \"Generic Authentication Architecture (GAA); Generic bootstrapping architecture\"",
			"Ref-26":"3GPP, TS 29.228, \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces; Signalling flows and message contents\"",
			"Ref-27":"3GPP, TS 32.225, \"Telecommunication management; Charging management; Diameter charging applications\"",
			"Ref-28":"UPnP Forum, \"UPnP Device Architecture Version 1.0\", June 13, 2000.",
			"Ref-29":"Broadband Forum, TR-104, \"DSLHomeTM Provisioning Parameters for VoIP CPE\"",
			"Ref-30":"Broadband Forum, TR-135, \"Data Model for a TR-069-enabled STB\"",
			"Ref-31":"Broadband Forum, TR-140, \"TR-069 Data Model for Storage Service Enabled Devices\"",
			"Ref-32":"IEC, 62455, \"Internet protocol (IP) and transport stream (TS) based service access\"",
			"Ref-33":"Broadband Forum, TR-098, \"Internet Gateway Device Version 1.1, Data Model for TR-069\"",
			"Ref-34":"Java Community Process, Java Specification Request 218 \"Connected Device Configuration (CDC) 1.1\"",
			"Ref-35":"IETF, RFC 5246, \"The Transport Layer Security (TLS) Protocol, Version 1.2\"",
			"Ref-36":"3GPP, TS 23.237 \"Multimedia Subsystem (IMS) Service Continuity - stage 2;\"",
			"Ref-37":"3GPP, TS 24.237 \"Multimedia Subsystem (IMS) Service Continuity - stage 3;\"",
			"Ref-38":"IETF, RFC 4235, \"An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP)\"",
			"Ref-39":"3GPP, TS 24.173, \"IMS multimedia telephony communication service and supplementary services\"",
			"Ref-40":"ETSI, EN 300 468 V1.9.1 (2008-11), \"Digital Video Broadcasting (DVB); Specification for Service Information (SI) in DVB systems\"",
			"Ref-41":"SMS Forum, \"Short Message Peer to Peer Protocol Specification v3.4\", 12-Oct-1999 Issue 1.2",
			"Ref-42":"UPnP Forum,  \"UPnP Device Management Version 1.0\"",
			"Ref-43":"Broadband Forum, PD-174, \"Remote Management of Non TR-069 Devices [work in progress]\"",
			"Ref-45":"Open IPTV Forum, Release 2 Version 2.3 Specifications. See <a hre=\"http://www.oipf.tv/specifications\" class=\"reference-link\">http://www.oipf.tv/specifications</a>. ",
			"Ref-47":"IETF, RFC 6086, \"Session Initiation Protocol (SIP) INFO method and Package Framework\"",
			"Ref-48":"IETF, RFC 4301, \"Security Architecture for the Internet Protocol\"",
			"Ref-50":"OASIS, \"Profiles for the OASIS Security Assertion Markup Language (SAML) V2.0\"",
			"Ref-51":"3GPP, TS 26.237, \"IP Multimedia Subsystem (IMS) based Packet Switch Streaming (PSS) and Multimedia Broadcast/Multicast Service (MBMS) User Service; Protocols (Release 8)\"",
			"Ref-52":"3GPP2, Technical Specification A.S0019-0, \"Interoperability Specification (IOS) for Broadcast Multicast Services (BCMCS)\", Version 1.0, November 2004",
			"Ref-53":"3GPP2, Technical Specification X.S0022, \"Broadcast and multicast service in cdma2000 wireless IP network\"",
			"Ref-54":"\"WiMAX System Requirements, Network Protocols and Architecture for Multi-cast Broad-cast Services (MCBCS Subteams Common Sections) - Part of Network Release 1.5, Version 1.0.0\"",
			"Ref-55":"UPnP Forum, \"UPnP Remote Access Version 1.0\"",
			"DVB_FUS":"ETSI, TS 102 084, \"Digital Video Broadcasting (DVB); Remote Management and Firmware Update System for DVB IPTV Services (Phase 2)\"",
		  },
      };
	</script>
<link rel="stylesheet" href="styles/oipf-arch-spec.css" type="text/css" />

</head>
<body>

<section id="abstract" hidden></section>

<!--<section id='sotd'></section>-->

<section id="scope">
<h1>Scope</h1>
<p>The Open IPTV Forum has developed an end-to-end solution to allow any consumer end-device, compliant to the Open IPTV Forum specifications, to access enriched and personalized IPTV services either in a managed or a non-managed network.</p>
<p>To that end, the Open IPTV Forum focuses on standardizing the user-to-network interface (UNI) both for a managed and a non-managed network, as depicted in Figure <a href="#oipf-scope" class="figureRef">1-1</a>.</p> 
<figure id="oipf-scope">
<figcaption>Figure #-####: Open IPTV Forum scope</figcaption>
<img src="images/oipf-scope-arch.png" alt="figure 1-1"/>
</figure>
<p>Throughout this document, the terms &ldquo;Open Internet&rdquo; and &ldquo;Unmanaged Network&rdquo; are used interchangeably, to refer to the ability to access any Service Provider using any Access Network Provider without any quality of service guarantees. </p>
<p>This document also includes any errata identified in previous versions of this specification.</p>
<p style="display:none;">[[!Ref-5]][[!Ref-14]][[!Ref-17]][[!Ref-36]]</p>
</section>

<section id='references'>
<h1>References</h1>
</section>

<section id="terminology-and-conventions">
<h1>Terminology and Conventions</h1>
<section id="conventions">
<h2>Conventions</h2>
All sections and appendixes, except &ldquo;Scope&rdquo; and &ldquo;Introduction&rdquo;, are normative, unless they are explicitly indicated to be informative.
</section>
<section id="definitions">
<h2>Definitions</h2>
<table class="definitions">
<tr><th>Term</th><th>Definition</th></tr>
<tr><td>Access Network</td><td>The network infrastructure used to deliver IPTV services to the Consumer.<p>
The Access Network infrastructure (which may include the Internet) is used for the delivery of the content and may include quality of service management to ensure that appropriate network resources are available for the delivery of the content.</p></td></tr>
<tr><td>Application</td><td>Collection of assets and logic that together provide a Service to the User. Assets and logic may reside either in an application Server or in the ITF or both.</td></tr>
<tr><td>Audience Research</td><td>A system to collect audience data, under the explicit consent of the user. This system can be managed by the IPTV Service Platform Provider, which collects audience data across networks, platforms, different types of services and service providers.</td></tr>
<tr><td>Audience Research Data</td><td>Data on IPTV audience viewing metrics i.e., the set of parameters and procedures that quantitatively and qualitatively measure the consumed content (e.g. scheduled content, CoD, PVR content), access and navigation (e.g. Content Guide, subtitling), interactive applications (e.g. games, rating).</td></tr>
<tr><td>Consumer domain</td><td>The domain where the IPTV services are consumed. A consumer domain can consist of a single terminal or a network of terminals and related devices for service consumption.</td></tr>
<tr><td>Consumer Network</td><td>The local area network in which the IPTV Terminal Function is located. Consumer Networks include residential networks, hot spots, hotel networks etc.</td></tr>
<tr><td>Consumer(s)</td><td>See End User(s).</td></tr>
<tr><td>Content</td><td>An instance of audio, video, audio-video information, or data.</td></tr>
<tr><td>Content Guide</td><td>An on-screen guide to Scheduled Content and Content on Demand, allowing a User to navigate, select, and discover content by time, title, channel, genre, etc.</td></tr>
<tr><td>Content on Demand (CoD)</td><td>A Content on Demand service is a service where a user can select the individual content items he or she wants to watch out of the list of available content. Consumption of the content is started on user request.</td></tr>
<tr><td>Content Protection</td><td>Means to protect content from unauthorized usage such as re-distribution, recording, playback, duplication etc</td></tr>
<tr><td>Content Provider</td><td>Entity that provides Content and associated usage rights to the IPTV Service Provider.</td></tr>
<tr><td>End User(s)</td><td>The individual(s) (e.g., members of the same family) who actually use the IPTV Services.</td></tr>
<tr><td>Internet</td><td>The Internet is the worldwide, publicly accessible network of interconnected computer networks that transmit data by packet switching using the standard Internet Protocol (IP).</td></tr>
<tr><td>ITF Remote Control Function</td><td>Function that allows the control of an ITF from a mobile or portable device.</td></tr>
<tr><td>IPTV Service Provider</td><td>Entity that offers IPTV Services and which has a contractual relationship with the Subscriber.</td></tr>
<tr><td>IPTV Solution</td><td>The specifications published by the Open IPTV Forum.</td></tr>
<tr><td>IPTV Terminal Function (ITF)</td><td>The functionality within the Consumer Network that is responsible for terminating the media and control for an IPTV Service.</td></tr>
<tr><td>IPTV User Profile</td><td>Information (e.g., viewing preferences) associated with a specific User who is a part of a subscription.</td></tr>
<tr><td>Local Storage</td><td>Content storage within the administrative realm of the IPTV Service Provider, but not in their physical environment (for example, local storage could be a partition of storage located in the residential network and allocated to the IPTV Service Provider to pre-load CoD).</td></tr>
<tr><td>Locally-controlled Local Personal Video Recorder (uLPVR)</td><td>Provision of PVR functionality whereby the content is stored in the consumer domain. No Service Provider intervention or permission is involved to record content apart from content protection. This is referred to in TISPAN as &ldquo;Local PVR (lPVR).&rdquo;</td></tr>
<tr><td>Service Provider-controlled Local Personal Video Recorder (sLPVR)</td><td>Provision of PVR functionality whereby the content is stored in the consumer domain but the content is recorded under Service Provider control. This is referred to in TISPAN as &ldquo;Client PVR (cPVR).&rdquo;</td></tr>
<tr><td>Network Personal Video Recorder (nPVR)</td><td>Provision of PVR functionality whereby the content is stored in the IPTV Service Provider domain. The nPVR allows a user to schedule recording of scheduled content programs. The user can later select the content they want to watch from the recorded content.</td></tr>
<tr><td>Pay-per-View</td><td>The user is charged per selected and/or consumed content item. Can apply to both CoD and Scheduled Content Service.</td></tr>
<tr><td>Personalised Channel (PCh)</td><td>A particular list of programs that is scheduled on the basis of the user's preferences, viewing habits or service provider recommendations, where each program is selected from the Content Guide, e.g. BC services, CoD content. An overlap or break may occur between the programs in a Personalised Channel content guide.</td></tr>
<tr><td>Portal</td><td>A function of a Service Platform that provides an entry point to individual IPTV Services to Users via a GUI.</td></tr>
<tr><td>Program</td><td>A segment of Scheduled Content with a defined beginning and end.</td></tr>
<tr><td>Program Guide</td><td>See Content Guide.</td></tr>
<tr><td>Push CoD</td><td>A type of Content on Demand where the content is pre-loaded to the ITF local storage by the IPTV Service Provider. The user has no direct control of what content is downloaded; however the IPTV Service Provider may make the choice based on user preferences and habits. Content is available for direct consumption after the user selection is confirmed.</td></tr>
<tr><td>Residential Network</td><td>Residential consumer network.</td></tr>
<tr><td>Scheduled Content</td><td>An IPTV service where the playout schedule is fixed by an entity other than the User. The content is delivered to the user for immediate consumption.</td></tr>
<tr><td>Service</td><td>Content and applications provided by Service Platform Providers and IPTV Service Providers.</td></tr>
<tr><td>Service Access Protection</td><td>Means to protect IPTV Services from unauthorized usage/access, such as - Access from unauthorized users - DOS attack</td></tr>
<tr><td>Service Platform Provider</td><td>Entity which, based on a contractual relationship with IPTV Service Providers, provides the supporting functions for the delivery of IPTV Services, such as charging, access control and other functions which are not part of the IPTV Service, but required for managing its delivery.</td></tr>
<tr><td>Service Protection</td><td>Means to protect contents (files or streams) during its delivery.</td></tr>
<tr><td>Session Portability</td><td>Ability of a given service/application to be switched from one device to another for a continuation of a session in real time.</td></tr>
<tr><td>Subscriber</td><td>The individual that makes the contract (subscription) with a Service Provider for the consumption of certain services.</td></tr>
<tr><td>Subscription Profile</td><td>Information associated with a subscription.</td></tr>
<tr><td>Trick Mode</td><td>Facility to allow the User to control the playback of Content, such as pause, fast and slow playback, reverse playback, instant access, replay, forward and reverse skipping.</td></tr>
<tr><td>User(s)</td><td>See End User(s).</td></tr>
</table>
</section>
<section id="abbreviations">
<h2>Abbreviations</h2>
<table class="definitions">
<tr><th>Abbreviation</th><th>Definition</th></tr>
<tr><td>ADSL</td><td>Asymmetric Digital Subscriber Line</td></tr>
<tr><td>AG</td><td>Application Gateway</td></tr>
<tr><td>AKA</td><td>Authentication and Key Agreement</td></tr>
<tr><td>AP</td><td>Access Point and Authentication Proxy</td></tr>
<tr><td>API</td><td>Application Programming Interface</td></tr>
<tr><td>A-RACF</td><td>Access Resource Admission Control Function</td></tr>
<tr><td>AS</td><td>Application Server</td></tr>
<tr><td>ASM</td><td>Authentication and Session Management</td></tr>
<tr><td>AV</td><td>Authentication Vector</td></tr>
<tr><td>A/V</td><td>Audio and Video</td></tr>
<tr><td>BCG</td><td>Broadband Content Guide defined by DVB</td></tr>
<tr><td>BTF</td><td>Basic Transport Function</td></tr>
<tr><td>CAC</td><td>Connectivity Admission Control</td></tr>
<tr><td>CAS</td><td>Conditional Access System</td></tr>
<tr><td>CC</td><td>Cluster Controller</td></tr>
<tr><td>CD</td><td>Content Delivery</td></tr>
<tr><td>CDC</td><td>Connected Device Configuration</td></tr>
<tr><td>CDF</td><td>Content Delivery Function</td></tr>
<tr><td>CDN</td><td>Content Delivery Network</td></tr>
<tr><td>CDNC</td><td>CDN Controller</td></tr>
<tr><td>CE</td><td>Consumer Equipment</td></tr>
<tr><td>CG</td><td>Content Guide</td></tr>
<tr><td>CK</td><td>Ciphering Key</td></tr>
<tr><td>CoD</td><td>Content on Demand</td></tr>
<tr><td>CPE</td><td>Customer Premise Equipment</td></tr>
<tr><td>CPI</td><td>Content Provider Interface</td></tr>
<tr><td>CSP</td><td>Content and Service Protection</td></tr>
<tr><td>CSPG</td><td>Content and Service Protection Gateway</td></tr>
<tr><td>DAE</td><td>Declarative Application Environment</td></tr>
<tr><td>DLNA</td><td>Digital Living Network Alliance</td></tr>
<tr><td>DLNA DMS</td><td>DLNA Digital Media Server</td></tr>
<tr><td>DLNA DMP</td><td>DLNA Digital Media Player</td></tr>
<tr><td>DOS</td><td>Denial of Service</td></tr>
<tr><td>DRM</td><td>Digital Rights Management</td></tr>
<tr><td>DSCP</td><td>DIFFServ Code Point</td></tr>
<tr><td>DTCP-IP</td><td>Digital Transmission Content Protection over Internet Protocol</td></tr>
<tr><td>DTT</td><td>Digital Terrestrial Television</td></tr>
<tr><td>DVB-IP</td><td>Digital Video Broadcasting Internet Protocol</td></tr>
<tr><td>ECM</td><td>Entitlement Control Message</td></tr>
<tr><td>ECMA</td><td>European Computer Manufacturers Association, ECMA International - European association for standardizing information and communication systems</td></tr>
<tr><td>EIT</td><td>Event Information Table</td></tr>
<tr><td>EPG</td><td>Electronic Program Guide</td></tr>
<tr><td>FCC</td><td>Fast Channel Change</td></tr>
<tr><td>FE</td><td>Functional Entity</td></tr>
<tr><td>GBA</td><td>Generic Bootstrapping Architecture</td></tr>
<tr><td>GENA</td><td>General Event Notification Architecture</td></tr>
<tr><td>GPON</td><td>Gigabit Ethernet Passive Optical Network</td></tr>
<tr><td>GUI</td><td>Graphical User Interface</td></tr>
<tr><td>HD</td><td>High Definition</td></tr>
<tr><td>HDMI</td><td>High Definition Multimedia Interface</td></tr>
<tr><td>HLA</td><td>High Level Architecture</td></tr>
<tr><td>HSS</td><td>Home Subscriber Server</td></tr>
<tr><td>HTTP</td><td>Hypertext Transfer Protocol</td></tr>
<tr><td>IAI</td><td>Internet Access Interface</td></tr>
<tr><td>IG</td><td>IMS Gateway</td></tr>
<tr><td>IGMP</td><td>Internet Group Management Protocol</td></tr>
<tr><td>IMPI</td><td>IMS Private User Identity</td></tr>
<tr><td>IMPU</td><td>IMS Public User identity</td></tr>
<tr><td>IMS</td><td>IP Multimedia Subsystem</td></tr>
<tr><td>IP</td><td>Internet Protocol</td></tr>
<tr><td>IPTV</td><td>Internet Protocol Television</td></tr>
<tr><td>IRCF</td><td>ITF Remote Control Function</td></tr>
<tr><td>ISIM</td><td>IMS Subscriber Identity Module</td></tr>
<tr><td>ISP</td><td>Internet Service Provider</td></tr>
<tr><td>ITF</td><td>IPTV Terminal Function</td></tr>
<tr><td>M/C-U/C</td><td>Multicast to Unicast</td></tr>
<tr><td>LAN</td><td>Local Area Network</td></tr>
<tr><td>MAC</td><td>Message Authentication Code</td></tr>
<tr><td>MCDF</td><td>Multicast Content Delivery Function</td></tr>
<tr><td>MDTF</td><td>Multicast Data Terminating Function</td></tr>
<tr><td>MSRP</td><td>Message Session Relay Protocol</td></tr>
<tr><td>NAT</td><td>Network Address Translation</td></tr>
<tr><td>nPVR</td><td>Network Personal Video Recorder</td></tr>
<tr><td>OIPF</td><td>Open IPTV Forum</td></tr>
<tr><td>OMA</td><td>Open Mobile Alliance</td></tr>
<tr><td>OITF</td><td>Open IPTV Terminal Function</td></tr>
<tr><td>PAE</td><td>Procedural Application Environment</td></tr>
<tr><td>P2P</td><td>Peer-to-Peer</td></tr>
<tr><td>PC</td><td>Personal Computer</td></tr>
<tr><td>PCh</td><td>Personalized Channel</td></tr>
<tr><td>PIM</td><td>Protocol Independent Multicast</td></tr>
<tr><td>PLMN</td><td>Public Land Mobile Network</td></tr>
<tr><td>POTS</td><td>Telephone Service</td></tr>
<tr><td>PPV</td><td>Pay-Per-View</td></tr>
<tr><td>QoS</td><td>Quality of Service</td></tr>
<tr><td>RA</td><td>Remote Access</td></tr>
<tr><td>RAC</td><td>Resource and Admission Control</td></tr>
<tr><td>RAND</td><td>Random Challenge</td></tr>
<tr><td>RCEF</td><td>Resource Control Enforcement Function</td></tr>
<tr><td>RET</td><td>Retransmission (server)</td></tr>
<tr><td>RTP</td><td>Real Time Protocol</td></tr>
<tr><td>RTCP</td><td>Real Time Control Protocol</td></tr>
<tr><td>RTSP</td><td>Real Time Streaming Protocol</td></tr>
<tr><td>RMS</td><td>Remote Management System</td></tr>
<tr><td>RUI</td><td>Remote User Interface</td></tr>
<tr><td>SAA</td><td>Service Access Authentication</td></tr>
<tr><td>SAML</td><td>Security Assertion Markup Language</td></tr>
<tr><td>SCART</td><td>Syndicat des Constructeurs d'Appareils Radior&eacute;cepteurs et T&eacute;l&eacute;viseurs</td></tr>
<tr><td>S-CSCF</td><td>Serving Call Session Control Function</td></tr>
<tr><td>SD</td><td>Standard Definition</td></tr>
<tr><td>SD&amp;S</td><td>DVB Service Discovery and Selection</td></tr>
<tr><td>SDP</td><td>Session Description Protocol</td></tr>
<tr><td>SLA</td><td>Service Level Agreement</td></tr>
<tr><td>SIM</td><td>Subscriber Identity Module</td></tr>
<tr><td>SIP</td><td>Session Initiation Protocol</td></tr>
<tr><td>SMPP</td><td>Short Message Peer-to-Peer</td></tr>
<tr><td>SMS</td><td>Short Message Service</td></tr>
<tr><td>SP</td><td>Service Provider</td></tr>
<tr><td>SPI</td><td>Service Provider Interface</td></tr>
<tr><td>SPDF</td><td>Service-based Policy Decision Function</td></tr>
<tr><td>SPP</td><td>Service Platform Provider</td></tr>
<tr><td>SSO</td><td>Single Sign-on</td></tr>
<tr><td>STB</td><td>Set Top Box</td></tr>
<tr><td>TBD</td><td>To Be Determined</td></tr>
<tr><td>TCI</td><td>Transport and Control Interface</td></tr>
<tr><td>TCP/IP</td><td>Transmission Control Protocol/Internet Protocol</td></tr>
<tr><td>UE</td><td>User Entity</td></tr>
<tr><td>UI</td><td>User Interface</td></tr>
<tr><td>UICC</td><td>Universal Integrated Circuit Card</td></tr>
<tr><td>UNI</td><td>User Network Interface</td></tr>
<tr><td>URI</td><td>Uniform Resource Identifier</td></tr>
<tr><td>URL</td><td>Uniform Resource Locator</td></tr>
<tr><td>USIM</td><td>Universal Subscriber Identity Module</td></tr>
<tr><td>VoD</td><td>Video on Demand</td></tr>
<tr><td>xDSL</td><td>Any DSL</td></tr>
<tr><td>WLAN</td><td>Wireless LAN</td></tr>
<tr><td>WG</td><td>WAN Gateway</td></tr>
<tr><td>WAN</td><td>Wide Area Network</td></tr>
<tr><td>XML</td><td>eXtensible Markup Language</td></tr>
<tr><td>XHTML</td><td>eXtensible Hypertext Markup Language</td></tr>
</table>
</section>
</section>

<section id="introduction"><h1>Introduction</h1>
<section id="iptv-domains"><h2>IPTV Domains</h2>
<p>The Open IPTV Forum recognizes the fact that there are various domains within the end-to-end IPTV value chain that have different administrative control or ownership. Thus, the Open IPTV Forum architecture supports the existence of multiple entities with different regions of administrative control and ownership interests. </p>
<p>Ownership and administrative control are impacted by a variety of factors including the prevailing regulatory regimes, competitive commercial environments, and the commercial strategies of the entities involved.  Ownership and administrative control may be considered arbitrary boundaries within certain deployments.</p>
<p>The following domain framework although typical, does not prevent all or some of these domains from being under a single administrative ownership and control.</p>
<p>The architecture recognizes the following domains:</p><ol>
<li><b>Consumer Domain:</b> the domain where the IPTV services are consumed. A consumer domain can consist of a single terminal or a network of terminals and related devices for service consumption.  The device may also be a mobile end device; in this case, the delivery system of a network provider is a wireless network. This domain is within the scope for the Open IPTV Forum specifications.
<li><b>Network Provider Domain:</b> the domain connecting customers to platform and service providers. The delivery system is typically composed of access networks and core or backbone networks, using a variety of network technologies. The delivery network is transparent to the IPTV content, although there may be timing and packet loss issues relevant for IPTV content streamed on IP. This domain is within the scope of the Open IPTV Forum specifications.
<li><b>Platform Provider Domain:</b> the domain providing common services (e.g., user authentication, charging etc.)  to IPTV Service Providers. Different types of service can be provided to a subscriber including IPTV services, personalized communication services, etc.  This domain is within the scope for the Open IPTV Forum specifications.
<li><b>IPTV Service Provider Domain:</b> the domain providing IPTV services to the Consumer Domain. In the context of television services on IP, the IPTV Service Provider acquires/licenses content from Content Providers and packages this into a service. In this sense the IPTV Service Provider is not transparent to the application and content information flow. This domain is within the scope of the Open IPTV Forum specification
<li><b>Content Provider Domain:</b> the domain that owns or is licensed to sell content or content assets. Although the Service Provider is the primary source for the Consumer Domain, a direct logical information flow may be set up between Content Provider and consumer device e.g. for rights management and protection. This domain is within the scope of the Open IPTV Forum specifications, primarily for the aspect of acquisition of content by the service provider. Specifications related to the content development processes of the content provider are NOT considered in scope at this time.
</ol>
</section>
<section><h2>The IPTV Value Chain</h2>
The Open IPTV Forum was established with the intent to specify common and open architectures for supplying a variety of internet multimedia and IPTV services to retail based consumer equipment.  The two main services are: Scheduled Content services (the IP equivalent to conventional broadcast TV) and content on-demand content services. Both of those services follow the content value chain shown in Figure <a href="#content-value-chain" class="figureRef">4-1</a>.
<figure id="content-value-chain">
<figcaption>Figure #-####: Content Value Chain</figcaption>
<img src="images/Content_Value_Chain.png" alt="figure 4-1"/>
</figure>
<p>The content value chain is composed of the following roles to provide Scheduled Content and CoD services:</p><ul>
<li><b>Content Production:</b> producing and editing the actual content (movies, drama series, sports events, news reports etc.)
<li><b>Content Aggregation:</b> bundling content into catalogue offers and bouquets, ready for delivery
<li><b>Content Delivery:</b> transporting the aggregated contents to the consumer 
<li><b>Content Reconstitution:</b> converting the content into a format suitable for rendering on the end-user device.</ul>
<p>Each role in the value chain has historically been bound to a type of stakeholder or technical role. Content Production, for example, is linked to production firms and to the production teams of TV stations. </p>
<p>IPTV technology introduces a set of technical modifications to the content chain that mainly encompasses content aggregation, delivery and reconstitution. The Open IPTV Forum aims at specifying the technology that delivers those three elements in the technical chain. The aforementioned specifications can be distinguished in two main categories:</p><ul>
<li><b>The Managed Model:</b> concerns access to and delivery of content services delivered over an end-to-end managed network. 
<li><b>The Unmanaged Model:</b> concerns access to and delivery of content services delivered over an unmanaged network (e.g., the Internet) without any quality of service guarantees. </ul>
<section><h3>The Managed Model</h3>
<p>The managed model deals with content services delivered over an end-to-end managed network. The end user can access content that is made available by the operator. The operator plays the &ldquo;Content Aggregation&rdquo; and &ldquo;Content Delivery&rdquo; roles:</p><ul>
<li><b>Content Provider:</b> provides content and associated metadata to be delivered via the managed operator network. It provides the bundled content to the IPTV service provider through the Content Provider Interface (CPI). A content provider normally retains the rights to the audiovisual content (movies, documentaries, TV programs, etc&hellip;). It can be a production company, or a distributor/vendor. 
<li><b>IPTV Service Provider:</b> is a content aggregator that prepares the content provided by the content provider for delivery by providing additional metadata, content encryption, advertising etc. The Service Provider Interface (SPI) links the IPTV Service Provider to the Service Platform Provider. 
<li><b>Service Platform Provider:</b> provides the means to control the access to the service prior to delivery to the end user. The Service Platform Provider (SPP) might offer a set of enablers to enrich the IPTV services, such as handling charging information generation. The Transport and Control Interface (TCI) links the Service Platform Provider to the Network Provider
<li><b>Network Provider:</b>  provides transport resources for delivery of authorized content to the consumer domain. It also provides the communications between the consumer domain and the Service Platform Provider. The User to Network Interface (UNI) links the Network Provider to the consumer domain.</ul>
<p>In a typical Managed model, a stakeholder, such as a Telecom Operator, plays the IPTV Service Provider, Service Platform Provider and Network Provider roles, so that high quality services can be guaranteed to the end user. </p>
<figure id="managed-model-roles">
<figcaption>Figure #-####: Managed Model technical roles and content transfer interfaces</figcaption>
<img src="images/managed-model-roles.png" alt="figure 4-2"/>
</figure>
</section>
<section><h3>Unmanaged Model</h3>
<p>The Unmanaged Model has the same set of technical roles as that of the managed model (See Figure <a href="#unmanaged-model-roles" class="figureRef">4-3</a>), but the roles are typically played by different stakeholders. Note that providing services of equivalent quality to those offered by the managed model cannot be easily guaranteed owing to the inherent lack of quality of service guarantees in Internet delivery.</p>
<p>In an Unmanaged Model the relationship between the Service Platform Provider and the Network Provider is not necessarily defined. The role of the Service Platform Provider could be played by an Internet portal.</p>
<p>The Internet Access Interface (IAI) in the Unmanaged Model replaces the TCI in the managed model.</p>
<figure id="unmanaged-model-roles">
<figcaption>Figure #-####: Unmanaged Model technical roles and content transfer interfaces</figcaption>
<img src="images/unmanaged-model-roles.png" alt="figure 4-3"/>
</figure>
</section>
</section>
</section>  <!-- end of section 4 -->

<section><h1>High Level Architecture</h1>
<p>This section describes the high level architecture for IPTV delivered over both managed and unmanaged networks. To the extent possible, the architecture will be common to both cases. Where this is not the case, the differences will be explicitly highlighted.</p>
<p>The next generation IPTV network must enable services that are distinctly superior to those offered by current IPTV systems. This includes end-user experience, both in terms of user friendliness, as well as personalization, as well as advanced services that adapt to individual usage and lifestyle. Hence, appropriate technologies must be deployed in a flexible architecture that can accommodate new trends and services in a timely fashion. </p>
<p>The high level architecture, described in this section follows a top down approach. </p>
<section><h2>Reference Points Identification</h2>
<p>Figure <a href="#mapping-functional-entities-to-uni" class="figureRef">5-1</a> shows the UNI interface between the Consumer Domain and the Network Provider, the Service Platform Provider and the IPTV Service Provider (collectively called &ldquo;Provider(s) Network&rdquo;) domains, which is one area of standardization within this specification. Additional interfaces in the network provider domain are also described in this architecture. Future releases of this architecture will provide additional material on interfaces to the content provider and other domains.</p>
<p>The UNI interface is expressed as several sub-interfaces, each of which map to the various functional entities required to provide the necessary support for the end-to-end IPTV service. Reference points are assigned to each of these sub-interfaces. The notation used to identify the sub-interfaces of the UNI, as well as a detailed description for all the reference points, is described later.</p>
<figure id="mapping-functional-entities-to-uni">
<figcaption>Figure #-####: Mapping Functional Entities to UNI Reference Points</figcaption>
<img src="images/mapping-functional-entities-to-uni.png" alt="figure 5-1"/>
</figure>
<p>This mapping is useful to verify compliance of the architecture against the requirements and to be able to document the various functionality supported by the various sub-interfaces in order to fulfil the desired features.</p>
</section>
<section id="s5-2"><h2>The Provider(s) Network Architecture</h2>
Figure <a href="#high-level-architecture" class="figureRef">5-2</a> depicts the High Level Architecture (HLA) for the Network Provider, the Service Platform Provider and the IPTV Service Provider domains, both for the managed and unmanaged network models.
<figure id="high-level-architecture">
<figcaption>Figure #-####: High Level Architecture for managed and unmanaged networks</figcaption>
<img src="images/high-level-architecture.png" alt="figure 5-2"/>
</figure>
<p><b>Legend</b></p>
<figure>
<img src="images/high-level-architecture-legend.png" alt="figure 5-2b"/></figure>
<p>The following sections describe the functional entities and reference points depicted in Figure <a href="#high-level-architecture" class="figureRef">5-2</a>.</p>
<section><h3>Network Provider Functional Entities</h3>
<p>The following is a brief description of the functional entities depicted in Figure <a href="#high-level-architecture" class="figureRef">5-2</a>:</p><ul>
<li><b>Service Access Authentication:</b> This functional entity is responsible for service access protection and authentication of users. The user is identified and authenticated by means of some pre-established credentials (such as user name and password or GBA authentication).
<li><b>Authentication and Session Management (Managed Network Model only):</b> This functional entity is responsible for the authentication of the user for service access protection, as well as session management for the purpose of coordinating and managing (service accessibility) users' activities and for charging purposes.  To this end, the session management ensures that a user request for a service is routed to the appropriate Application Server. This entity has access to the Subscription Profile.
<li><b>Authentication Proxy (Managed Network Model only):</b> This functional entity establishes a secure communications channel between a network provider's security domain and the ITF. The Authentication Proxy terminates all signalling and control traffic destined to functions within the control of the network provider, and eliminates the need for separate security associations with individual network elements hosting these functions.
<li><b>GBA Single Sign-on:</b> This functional entity allows Single Sign-on based on the Generic Bootstrapping Architecture. It is used in managed networks, but can also be used in unmanaged networks when a UICC-based IMS authentication is available in the home network.
<li><b>IPTV Service Provider Discovery:</b> provides information necessary for the ITF to select IPTV Service Providers, in both the managed and unmanaged models
<li><b>IPTV Service Discovery:</b> provides information about IPTV services offered by an IPTV service provider, in both the managed and unmanaged models
<li><b>IPTV Control:</b> This is the main control point for the IPTV solution. It controls the delivery of IPTV services to authorized users. In that regard, it inter-works with the Authentication and Session Management functional entity, which routes incoming/outgoing requests from the IPTV Control to the appropriate destination.  This entity has access to the IPTV User and Subscription Profiles. The IPTV Control generates charging related information.
<li><b>IPTV Metadata Control:</b> This functional entity performs aggregation of the metadata coming from content providers or third party sources. The IPTV Metadata Control offers basic metadata related to services such as service description, the whole program guide, details related to each event (e.g. description of the film, actors, etc.), program listings and their schedule, personalized Content Guide (CG). This functional entity enables the user to search, discover and initiate immediate viewing or scheduled viewing of future programs and stored content.  
<li><b>IPTV Applications:</b> These include IPTV related services or application logic such as CoD, Push CoD, Content Download, Network PVR, and Messaging as well as Web push/pull service. The function provides end users with IPTV applications using the Declarative Application Environment (DAE). The function provides Web Server functionality to allow an authorized user to access some IPTV services (e.g., to remotely schedule a recording on a PVR by using a non-OITF enabled device which has a browser.).
<li><b>Provider Specific Applications:</b> This function interacts with the Application Gateway in the consumer domain in order to download generic applications. Provider specific applications run on the AG execution environment.  The download can be via push or pull mechanisms.  For IPTV, this function can provide end users with provider-specific applications that run in the Procedural Application Environment (PAE) which can manipulate media streams and the Content Guide.
<li><b>Person-to-Person Communication Enablers (Managed Network Model only):</b> These include interface to various communication services, such as multimedia telephony, presence, chat, messaging, caller ID notification, etc., for service blending with IPTV related services.  
<li><b>IPTV Service Profile:</b> This functional entity holds the IPTV User Profile that is associated with the user's IPTV subscription with an IPTV Service Provider. The IPTV User Profile is consulted by the IPTV Service Provider when the user requests an IPTV service.  The IPTV User Profile can be updated by the IPTV Service Provider as well as by an authorized end-user, if allowed by the IPTV Service Provider.
<li><b>User Database:</b> The central database of Subscription profiles, managed by the Service Platform Provider. The nature of this may vary between managed and unmanaged systems, and would typically includes data that is not IPTV service specific such as authentication information, communication related information, etc.
<li><b>The Content Delivery Network (CDN):</b> This is a fundamental functionality in an IPTV CoD solution. For CoD, it allows the optimization of the network use through a distribution of the media servers in the physical network, and the optimization of the storage resources through a popularity-based distribution of the content on the media servers. This results in having popular content massively distributed on media servers at the edge of the network (as close as possible to the customer) while less popular content are distributed on a reduced number of media servers. For scheduled content, it enables the support of enhanced services like Personal Channel (PCh) and Network Personal Recording (nPVR).
<li><b>Multicast Content Delivery Function:</b> This entity is responsible for delivery of content and generic data to the OITF by means of multicast, using multicast streams and the multicast data channel respectively. In the content streaming case, this is the so-called head end. In the data case it is the source of the multicast data channel.
<li><b>Fast Channel Change/Retransmission Server:</b>  The functional entity that delivers ancillary data  for multicast streams when triggered by the OITF, in the context of FCC/RET service 
<li><b>Network Attachment:</b> This functional entity includes the functions associated with provisioning of IP addresses, network level user authentication and access network configuration. For the unmanaged model, this function is provided by the user's access network provider.
<li><b>Transport Processing Function:</b> This functional entity includes the functions needed to support real-time multicast and unicast streams, optimizing network usage in the physical network, and enforcing related traffic policies coming from Resource and Admission Control.
<li><b>Resource and Admission Control (Managed Network Model only):</b> In a managed network, Resource and Admission Control provides policy control and resource reservation for the required transport resources, for both unicast and multicast delivery. In this capacity, it interacts with the authentication and session management functional entity and the Transport processing function.
<li><b>Charging:</b> This functional entity includes the charging mechanisms at the platform level available to all the IPTV Service Providers, for all the users managed by the Service Platform Provider.  The charging subsystem collects network and platform related events that can be later used for billing and statistical analysis purposes. The IPTV service providers are free to build their own billing systems that could be based on common charging but also be completely independent (e.g. based on the CSP and CAS). The IPTV service provider's billing mechanisms are out of the scope of this specification.
<li><b>CSP-T Server:</b> This functional entity handles service protection and content protection for the CSP-T client in the OITF. It is used to enable the key management necessary to implement service protection and content protection.
<li><b>CSP-G Server:</b> This functional entity handles service protection and content protection for the Content and Service Protection Gateway (CSPG) in the residential network. The solution for service and content protection is specific to the IPTV service provider. Therefore, network reference points are not specified by this specification and interfaces are defined by the IPTV Service Provider.
<li><b>Remote Management:</b> In a managed network, this entity provides the server-side functionalities to remotely manage the residential network devices, for both provisioning and assurance purposes: the functions provided relates to configuration management (including firmware upgrade), fault management (including troubleshooting and diagnostics), and performance monitoring.
<li><b>Key Management Function:</b> Entity responsible for storing and providing Service, Program, Content Keys and ECM attached information. 
<li><b>Content on Demand Encryption Management Function:</b> Back office Content on Demand function in charge of encrypting Content on Demand. 
<li><b>Notification Services:</b> This is the server that generates notifications for end-users in a form that corresponds to the IPTV end-user preference. The forms currently supported are short message services (SMS), multi media messaging (MMS), and IMS instant messaging. Note that these notifications are not related to the DAE-based notifications on UNIS-6.
<li><b>Emergency Services:</b> This is the node that generates emergency messages destined for IPTV end users. This node is not owned by the platform service provider. Platform service providers just interfaces with it based on applicable standards which are typically regional and local in nature. 
<li><b>Messaging AS:</b> This is the server that supports the generation and delivery of IMS instant messaging to IMS end users. This is a part of the person-to-person communication enabler but has been extracted here for clarity.
<li><b>Other Delivery Networks:</b>  This entity represents existing mobile networks used to deliver MMS and SMS messages to end users. 
<li><b>Audience Research Collector:</b> This entity enables the Service Provider to collect and retrieve Audience Research data by exploiting the Transport Processing Function to intercept requests from users. How the Transport Processing Function supports this is out of scope of this specification.  It also enables the Service Provider to retrieve and collect the Audience Research data from functional entities such as the IPTV Control, Cluster Controller, IPTV Application, etc.,  as well as other functional entities that receive service status information through the (SIP/RTSP) signalling path 
<li><b>Audience Research Agency:</b> This functional entity collects audience research data from different Service Providers, under the explicit consent of the users. It is usually managed by an external certified authority, which collects audience data across networks, platforms, types of services and service providers. It can use the collected Audience Research data for consultation purposes, or statistical analysis, data profiling etc. The behaviour of Audience Research Agency is out of scope of this specification.
<li><b>Content Management Function:</b> This offline entity handles content lifecycle (ingest, encoding, encryption, distribution) and content aggregation into commercial offers for On-Demand Content.
<li><b>Scheduling Function:</b> This offline entity handles content lifecycle (ingest, encoding, encryption, distribution) and content aggregation into commercial offers for Scheduled Content.
<li><b>Scheduled Content Encryption Function:</b> Back office Scheduled Content function in charge of encrypting the Scheduled Content.
<li><b>Recording Function:</b> This function handles the recording of Scheduled Content for later use for catch-up and start-over.
</ul>
<section><h4>Content Delivery Network</h4>
<p>The following section describes the internal functional entities and reference points in the CDN functional entity.</p>
<figure id="cdn-architecture">
<figcaption>Figure #-####: CDN Architecture</figcaption>
<img src="images/CDN-Architecture.png" alt="figure 5-3"/>
</figure>
<p>The following is a brief description of the functional entities that make up the CDN, as depicted in Figure <a href="#cdn-architecture" class="figureRef">5-3</a>.</p>
<p>The Content Delivery Network contains three sub-functions: </p><ul>
<li><b>Content Delivery Network Controller (CDNC):</b> This functional entity performs cluster <mark class="footnote">The term Cluster corresponds to a logical association of one or more "Content Delivery Functions" which share some resources (such as location, storage capacity etc.).</mark>  selection in the CDN, based on the request issued by the IPTV Control functional entity. Many instances of a CDN controller may coexist in the same CDN. They may interact for the purpose of selecting the right cluster.
<li><b>Cluster Controller (CC):</b> This functional entity manages a set of Content Delivery Functions (a cluster of CDFs).<ul>
<li>It terminates IPTV service session setup 
<li>It handles content delivery session setup
<li>It proxies all message exchanges between CDFs and the ITF. 
<li>It maintains the state of the media servers (Content Delivery Functions)</ul>
<li><b>Content Delivery Function (CDF):</b> This functional entity is responsible for media processing, delivery and distribution, under the control of the Cluster Controller.</ul>
<p>The following reference points depicted in Figure <a href="#cdn-architecture" class="figureRef">5-3</a> are internal to the CDN:</p><ul>
<li>NPI-10;
<li>NPI-25;
<li>NPI-26;
</ul>
</section>
</section>
<section><h3>Mapping between HLA and IPTV Domains (informative)</h3>
Table <a href="#t1" class="tableRef">1</a> provides an informative mapping between the functional entities depicted in the HLA and the IPTV domains as defined in section <a href="#iptv-domains" class="sectionRef">4.1</a>. 
<table class="simple" id="t1">
<caption>Table ####: Functional Entity domain assignment</caption>
<tr><th>Functional Entity</th><th>Domain Assignment</th></tr>
<tr><td>Network Attachment</td><td>Network Provider</td></tr>
<tr><td>Authentication and Session Management (Managed Network Model only)</td><td>Service Platform Provider</td></tr>
<tr><td>User Database</td><td>Service Platform Provider</td></tr>
<tr><td>IPTV Control</td><td>Service Platform Provider</td></tr>
<tr><td>Person to Person Communication Enablers (Managed Network Model only)</td><td>Service Platform Provider</td></tr>
<tr><td>IPTV Applications</td><td>IPTV Service Provider</td></tr>
<tr><td>Content Delivery Network Controller</td><td>Network, Platform and IPTV Service Providers</td></tr>
<tr><td>Content Delivery</td><td>Network, Platform and IPTV Service Providers</td></tr>
<tr><td>IPTV Metadata Control</td><td>IPTV Service Provider</td></tr>
<tr><td>IPTV Service Discovery</td><td>Service Platform Provider, IPTV Service Provider</td></tr>
<tr><td>IPTV Service Provider Discovery</td><td>Service Platform Provider</td></tr>
<tr><td>IPTV Service Profile</td><td>IPTV Service Provider</td></tr>
<tr><td>Provider Specific Applications</td><td>IPTV Service Provider</td></tr>
<tr><td>Multicast Content Delivery Function</td><td>Network, Platform and IPTV Service Providers</td></tr>
<tr><td>Metadata Storage</td><td>IPTV Service Provider</td></tr>
<tr><td>Service Access Authentication</td><td>Service Platform Provider</td></tr>
<tr><td>Charging</td><td>Service Platform Provider</td></tr>
<tr><td>Cluster Controller</td><td>Network, Platform and IPTV Service Providers</td></tr>
<tr><td>Resource and Admission Control (Managed Network Model only)</td><td>Network Provider</td></tr>
<tr><td>Transport Processing Function</td><td>Network Provider</td></tr>
<tr><td>Authentication Proxy (Managed Network Model only)</td><td>Service Platform Provider</td></tr>
<tr><td>GBA Single Sign-on</td><td>Service Platform Provider</td></tr>
<tr><td>CSP-T Server</td><td>IPTV Service and Service Platform Provider</td></tr>
<tr><td>CSP-G Server</td><td>IPTV Service and Service Platform Provider</td></tr>
<tr><td>Content and Service Key Management Function</td><td>IPTV Service Provider</td></tr>
<tr><td>Content-on-Demand Encryption Management Function</td><td>IPTV Service Provider</td></tr>
<tr><td>RMS</td><td>Network Provider, Service Platform Providers</td></tr>
<tr><td>Notification Services</td><td>Service Platform Provider</td></tr>
<tr><td>Emergency Services</td><td>Law enforcement agencies</td></tr>
<tr><td>Messaging AS</td><td>Service Platform Provider</td></tr>
<tr><td>Other delivery networks</td><td>Service Platform Provider</td></tr>
</table>
</section>
<section><h3>Reference Points Description</h3>
<section><h4>UNI Reference Points</h4>
<p>The UNI is expressed as several reference points, each of which map to the various functional entities required to provide the necessary support for the end-to-end IPTV service. The notation used to identify the reference points of the UNI, as well as a detailed description for all the reference points, is described later. </p>
<table class="simple" id="t2">
<caption>Table ####: UNI Reference Points</caption>
<tr><th>Reference Point</th><th>Description</th></tr>
<tr><td>UNIP-1</td><td>Reference point for user initiated IPTV User Profile management</td></tr>
<tr><td>UNIP-2</td><td>Reference point for user initiated profile management of Person-to-Person Communication Enablers, such as presence privacy, resource list management, group management, etc.
<p>Note that group management is included to support the management of  pre-defined groups that can be reused for several purposes, such as presence privacy, presence request, messaging, chatting, etc.</p></td></tr>
<tr><td>UNIS-6</td><td>Reference point for user interaction with application logic for transfer of user requests and interactive feedback of user responses (provider specific GUI). HTTP and TCP based application-specific protocols are used to interface between the DAE and the IPTV Application Function.</td></tr>
<tr><td>UNIS-7</td><td>Requests for transport and encoding of content guide metadata. The reference point includes the metadata and the protocols used to deliver the metadata, and shall be based on DVB-IP BCG. [[!Ref-13]]</td></tr>
<tr><td>UNIS-8</td><td>Authentication and session management relying on IMS.</td></tr>
<tr><td>UNIS-9</td><td>Authentication for GBA Single Sign-on</td></tr>
<tr><td>UNIS-11</td><td>Reference point for control of real time streaming (e.g. control for pause, rewind, skip forward). This reference point is optionally secured. The reference point includes content delivery session setup when not relying on IMS.</td></tr>
<tr><td>UNIS-12</td><td>Reference point between the AG (see section <a href="#s5-3-1-3" class="sectionRef">5.3.1.3</a> for details) and the provider specific application functional entity.  Encompasses two functions:<ul>
<li>Signalling and download of applications in a generic format. (Subject to standardization)
<li>Interaction of generic applications with the provider network. (Not subject to standardization)</ul></td></tr>
<tr><td>UNIS-13</td><td>User Stream control for multicast of real time content and data. The protocol used on this interface is IGMP. [[!Ref-10]]</td></tr>
<tr><td>UNIS-14</td><td>Reference point used for authorization of service access.</td></tr>
<tr><td>UNIS-15</td><td>Reference point to the IPTV Service Discovery FE to obtain information about IPTV services offered by an IPTV Service Provider </td></tr>
<tr><td>UNIT-16</td><td>Network attachment functions connected to this reference point include: DHCP Server and Relay.</td></tr>
<tr><td>UNIT-17</td><td>Content stream including content; content encryption (for protected services) and content encoding.  This reference point can be used for both multicast and unicast (UNIT-17M and UNIT-17U, respectively). This could be RTP and HTTP (unicast only). It includes the FCC/RET RTP packets issued by the FCC/RET server. It can also be used for bidirectional RTP-based transfer of voice and real-time video with predefined formats, i.e., media to support conversational multimedia communications.</td></tr>
<tr><td>UNIT-18</td><td>Performance monitoring interface for reporting the performance monitoring results. A possible protocol is RTCP. This interface is also used for RTCP control interaction to and from the FCC/RET server</td></tr>
<tr><td>UNIT-19</td><td>Multicast Data Channel. Used to deliver data of different kinds to the OITF by means of multicast. This reference point can carry discrete data that is carried over unicast through e.g. the interfaces UNIS-6, and UNIS-7. Other uses e.g. UNI-RMS are not excluded.</td></tr>
<tr><td>UNIS-19</td><td>Reference point to the IPTV Service Provider Discovery functional entity to obtain the list of Service Providers, and related information.</td></tr>
<tr><td>UNI-RMS</td><td>Remote Management of end user devices (based on the DSL Forum TR-069 [[!Ref-1]] framework and related extensions based on DVB-IP-RMS specification)</td></tr>
<tr><td>UNIS-CSP-T</td><td>Rights management for protected content &mdash; including key management and rights expression.</td></tr>
<tr><td>UNIS-CSP-G</td><td>Reference point to support a service and content protection solution which is specific to IPTV Service Provider. This interface may be used to obtain licenses for purchased/subscribed content, control content and service protection system and also deliver content.</td></tr>
</table>


</section>
<section><h4>Network Reference Points Description</h4>
<table class="simple" id="t3">
<caption>Table ####: Network Reference Points</caption>
<tr><th>Reference Point</th><th>Description</th></tr>
<tr><td>NPI-1</td><td>Reference point between the Service Access Authentication FE and the User Database.</td></tr>
<tr><td>NPI-2</td><td>An optional reference point allowing interaction between IPTV Applications and the IPTV Control FE. This is not subject to standardization. </td></tr>
<tr><td>NPI-3</td><td>The reference point between Authentication Session Management and Person-to-Person Communication Enablers. (This is the ISC interface defined by 3GPP) [[!Ref-15]]</td></tr>
<tr><td>NPI-4</td><td>Reference point for routing of IPTV service related messages to the IPTV Control Point.  This is the ISC reference point defined by 3GPP [[!Ref-15]]. </td></tr>
<tr><td>NPI-6</td><td>This reference point allows the IPTV Control Point to retrieve the subscriber's IPTV-related service data when a user registers in the IMS network. (Not subject to standardization)</td></tr>
<tr><td>NPI-7</td><td>This reference point allows Person-to-Person Application Enablers to retrieve the subscriber's IMS data from the User Database. This is the Sh interface defined by 3GPP [[!Ref-15]]. </td></tr>
<tr><td>NPI-9</td><td>This reference point allows the IPTV Control Point to retrieve the subscriber's IMS-specific data from the User Database. This is the Sh interface defined by 3GPP [[!Ref-15]].</td></tr>
<tr><td>NPI-10</td><td>An optional reference point for the allocation/de-allocation and control of content for a specific unicast session. This reference point is internal to the CDN.</td></tr>
<tr><td>NPI-11</td><td>A reference point for sending events and charging information. This is the Rf reference point defined by 3GPP [[!Ref-15]]. </td></tr>
<tr><td>NPI-12</td><td>This reference point allows the Authentication and Session Management FE to retrieve the subscriber's IMS data from the User Database as a part of the user's IMS registration. This is the Cx interface defined by 3GPP [[!Ref-15]].</td></tr>
<tr><td>NPI-14</td><td>Same as NPI-11</td></tr>
<tr><td>NPI-15</td><td>This reference point controls the Resources and Admission Control. It is the Gq' interface defined by ETSI TISPAN.  [[!Ref-15]]</td></tr>
<tr><td>NPI-16</td><td>Reference point between the Transport Processing Function and Resource and Admission Control. It is the Re interface (Diameter based) [[!Ref-15]]</td></tr>
<tr><td>NPI-17</td><td>Reference point between the IPTV Applications and the IPTV Service Profile. </td></tr>
<tr><td>NPI-18</td><td>Reference point between the Service Access and Authentication FE and the IPTV Applications. </td></tr>
<tr><td>NPI-19</td><td>This reference point is used for unicast session control between the Authentication and Session Management and the Content Delivery Network Controller</td></tr>
<tr><td>NPI-20</td><td>This optional reference point allows the retrieval of CG data. (Not subject to standardization)</td></tr>
<tr><td>NPI-21</td><td>This reference point allows the GBA Single Sign-on functional entity to validate user credentials</td></tr>
<tr><td>NPI-25</td><td>This reference point allows proxying unicast control messages to locate the appropriate Content Delivery Network Controller FE. This reference point is internal to the CDN.</td></tr>
<tr><td>NPI-26</td><td>The reference point allows the Content Delivery Network Controller to delegate the handling of a unicast session to a specific Cluster Controller. This reference point is internal to the CDN.</td></tr>
<tr><td>NPI-27</td><td>The reference point between the Authentication Proxy and the GBA Single Sign-on node allows the proxy to retrieve a user key for authentication purposes.</td></tr>
<tr><td>NPI-28</td><td>This reference point is used to push the user access capabilities to the Network Attachment and the RAC. This is the e4 interface defined by 3GPP [[!Ref-15]]. </td></tr>
<tr><td>NPI-30</td><td>This reference point supports the IPTV Service Provider Discovery step of the service discovery procedure relying on IMS. This is the ISC interface defined by 3GPP [[!Ref-15]]. </td></tr>
<tr><td>NPI-32</td><td>Reference point between the ASM FE and the IMS messaging AS. (This is the ISC interface defined by 3GPP) [[!Ref-15]]</td></tr>
<tr><td>NPI-33</td><td>Reference point allowing interaction between IPTV Applications and the IPTV Metadata Control FE. This is not subject to standardization. </td></tr>
<tr><td>NPI-34</td><td>The reference point between the IMS messaging server and the notification services. It is based on IMS SIP as defined in 24.229 [[!Ref-18]]</td></tr>
<tr><td>NPI-36</td><td>This reference points allows access to notification services. It is based on Parlay X -API as defined by (http://www.3gpp.org/ftp/Specs/html-info/29-series.htm). 
<p>Parlay X API (<a href="http://www.3gpp.org/ftp/Specs/html-info/29-series.htm">http://www.3gpp.org/ftp/Specs/html-info/29-series.htm</a>).</p></td></tr>
<tr><td>NPI-38</td><td>This reference point between notification services and multicast and delivery control function supports multicast traffic for emergency services and is FFS.</td></tr>
<tr><td>NPI-39</td><td>This reference point between emergency services and the notification services is local and regional specific.</td></tr>
<tr><td>NPI-40</td><td>Content Delivery Function (CDF) Stream control for multicast of real time content. The protocol used on this interface is IGMP [[!Ref-10]]. This interface is optional.</td></tr>
<tr><td>NPI-41</td><td>Content stream including content; content encryption (for protected services) and content encoding.  This reference point is used for multicast delivery. The protocol used on this interface is RTP. This interface is optional.</td></tr>
<tr><td>NPI-42</td><td>This reference point between the IPTV Application and the Multicast Content Delivery Function supports multicast traffic for notification services.</td></tr>
<tr><td>NPI-CSPT1</td><td>Reference point to confirm whether a Marlin content license can be issued for the request received via UNIS CSP-T. </td></tr> 
<tr><td>NPI-CSPG1</td><td>Reference point to allow the CSP-G Server to be provisioned with entitlement information by IPTV Applications.</td></tr>
<tr><td>NPI-CSPG1a</td><td>Reference point to allow the CSP-G Server to be provisioned with entitlement information by the IPTV Service Profile. </td></tr>
<tr><td>NPI-CSPG3</td><td>Reference point for the Key Management Function to exchange content encryption information with CSP-G Server.</td></tr>
<tr><td>NPI-CSPT1a</td><td>Reference point used by the Marlin DRM system to include business information or a reference to business information into a DRM request (e.g. license request) as requested via UNIS-CSP-T, and the subsequent confirmation and retrieval of this business information when the DRM request is consumed.</td></tr>
<tr><td>NPI-CSPT2</td><td>Reference point, used in the managed network model, to retrieve information on the appropriate cluster controller in the Content Delivery Network that will serve a particular request for purchased or subscribed-to content. This chosen cluster controller will be contacted by the CSP-T Server functional entity via NPI-CSP3. This interface is not specified by this version of the specification.</td></tr>
<tr><td>NPI-CSPT3</td><td>Reference point to retrieve the appropriate encryption key needed to prepare a Marlin content license for the chosen content. It is the content encryption key for downloadable content or the key that encodes the Marlin short term key message that contains the key that encodes the streaming media. </td></tr>
<tr><td>NPI-43</td><td>Reference point that provides GBA authentication mechanism to the Service Access Authentication Function.</td></tr>
<tr><td>NPI-44</td><td>Reference point where the encrypted content is stored on the content storage entity for delivery by the Content Delivery Function. This interface is not specified by this version of the specification. This interface has been identified just to illustrate informatively the separation between content encryption, which is part of content preparation, and content delivery.</td></tr>
<tr><td>NPI-45</td><td>Reference point where the content Service, Program and Content Keys and ECM attached information are provided to the CoD Encryption Management Function. </td></tr>
<tr><td>NPI-46</td><td>Reference point where the content Service, Program and Content Keys and content protection related information (e.g. ECM, DRM metadata) are provided to the Scheduled Content Encryption Function. This interface is specified by this version of the specification for the unicast stream encryption case. This interface is not specified by this version of the specification for the multicast stream encryption case.</td></tr> 
<tr><td>NPI-47</td><td>Reference point where the On Demand Content is fetched by the Content Delivery Function for delivery. This interface is not specified by this version of the specification. This interface has been identified just to illustrate informatively the separation between content encryption, which is part of content preparation, and content delivery.</td></tr>
<tr><td>NPI-48</td><td>Reference point for the Key Management Function to provide appropriate information to the IPTV Applications functional entity, e.g. in relation with content access licenses. This interface is not specified by this version of the specification.</td></tr>
<tr><td>NPI-49</td><td>Reference point for the Content Management Function to provide the CoD Encryption Function with content related information. This interface is not specified by this version of the specification.</td></tr>
<tr><td>NPI-50</td><td>Reference point for the Scheduling Function to provide the Recording Function with a record list/schedule for the Catch-up and Start-over use cases. This interface is not specified by this version of the specification.</td></tr>
<tr><td>NPI-51</td><td>Reference point for the Content Management Function to provide appropriate information to the IPTV Applications functional entity. This interface is not specified by this version of the specification.</td></tr>
<tr><td>NPI-52</td><td>Reference point for the Scheduling Function to provide appropriate information to the IPTV Applications functional entity. This interface is not specified by this version of the specification.</td></tr>
<tr><td>NPI-53</td><td>Reference point for the Scheduling Function to provide the Scheduled Content Encryption Function with content related information and schedule. This interface is not specified by this version of the specification.</td></tr>
<tr><td>NPI-AR-01</td><td>Reference point for providing static audience data about users who have opted-in. It includes content metadata and user related information stored in the IPTV Service Profile.</td></tr>
<tr><td>NPI-AR-02 
<p>NPI-AR-02'</p>
<p>NPI-AR-02''</p></td><td>
Reference points for collecting the information intercepted by the Transport Processing Function, the IPTV Control, the Cluster Control or other FEs based on different criteria, e.g. the events triggered by the Audience Research Collector, event detected from other FEs, the deployment done by the service provider etc.
<p>Note: The IPTV Control can retrieve the Audience Research data from the ITF or the Cluster Controller using existing SIP messages such as SIP INFO, MESSAGE, INVITE or PRESENCE.</p></td></tr>
<tr><td>NPI-AR-03</td><td>Reference point used for exposing the Audience Research data to the Audience Research Agency.</td></tr>
</table>
</section>
</section>
</section>
<section id="s5-3"><h2>Residential Network High-Level Architectural Overview</h2>
<p>The architecture of the consumer domain (referred to hereafter as the residential network) is as shown in Figure <a href="#residential-network-architecture" class="figureRef">5-4</a> and composed of 5 functional entities, with well defined interfaces between them, and where each functional entity includes a number of functions. As shown in Figure <a href="#residential-network-architecture" class="figureRef">5-4</a>, the entire collection of these functional entities is called the IPTV Terminal Function (ITF).</p>
<p>The residential network architecture is designed to:</p><ul>
<li>Support multiple deployment scenarios.
<li>Allow non-IPTV applications to co-exist with IPTV services, but be able to execute independently from the IPTV service. </ul>
<p>The architecture chosen to comply with the above is depicted in Figure <a href="#residential-network-architecture" class="figureRef">5-4</a> below. </p>
<p>There are two main interface groups between the Residential Network and the Provider(s) Network domain: the HNI-INI and the HNI-AMNI. The mapping between these key functional groupings and UNI reference points is depicted in Figure <a href="#residential-network-architecture" class="figureRef">5-4</a>.</p>
<p>Note also that, while not shown explicitly in Figure <a href="#high-level-architecture" class="figureRef">5-2</a>, all communications are mediated by the WAN gateway.</p>
<figure id="residential-network-architecture">
<figcaption>Figure #-####: Residential Network Architecture</figcaption>
<img src="images/ResidentialNetworkArchitecture.png" alt="figure 5-3" style="width:90%"/>
</figure>
<p>Below is a brief description of the functional entities in the residential network:</p>
<p class="inline-header">Open IPTV Terminal Functional Entity (OITF)</p>
<p>The OITF includes the functionality required to access IPTV service for both the unmanaged and the managed network models through the HNI-INI and HNI-IGI interfaces. </p><ul>
<li>To access the IPTV services using the unmanaged model, the OITF only needs to use the HNI-INI interface. Thus, the minimum set of functional entities needed to access unmanaged IPTV services are the OITF and the WAN Gateway.
<li>To access IPTV service using the managed network model, the OITF needs to use both the HNI-INI and the HNI-IGI interfaces. Thus, the minimum set of functional entities needed to access the managed IPTV services are the OITF, the IG and the WAN Gateway (as it provides the physical connection between the residential network and the WAN). The HNI-IGI interface requires special protection, as it carries credentials/secrets.</ul>
<p>The OITF has its own direct user interaction (e.g., remote control, keyboard) and audio/video rendering and, optionally, grabbing functionalities (e.g. display, speakers, cameras, microphones) or can be directly connected with other audio/video rendering/grabbing devices without passing through home network communication.  </p>
<p>All Residential Network deployments will have at least one instance of the OITF. </p>
<p>The OITF may include functions to allow Open IPTV Forum defined services to be accessed on DLNA devices [[!Ref-2]].</p>
<p class="inline-header">IMS Gateway Functional Entity (IG)</p>
<p>The IG includes the necessary functionality to allow an OITF device to access managed network services, based on an IMS core network, through the HNI-IGI interface. The IG provides an IPTV end user with access to managed network IPTV services and to blended person-to-person communication services such as Chat, Messaging, Presence, etc. Support for unsolicited notification is also included for such services as Presence, Caller ID, etc. </p>
<p>The IG is able to offer its functionality to the AG via the HNI-AGI interface.</p>
<p>Support for new or enhanced applications can be realized by a firmware upgrade to the IG without any impacts on the OITF functionality. </p>
<p>In a device that implements both the OITF and IG the use of the HNI-IGI interface is optional. </p>
<p class="inline-header">Application Gateway Functional Entity (AG)</p>
<p>The Application Gateway (AG) is an optional gateway function that incorporates a procedural language based application execution environment where applications can be remotely downloaded for execution. This functionality is required by certain service providers that wish to have generic procedural language based applications related or unrelated to IPTV services downloaded for execution in the home environment. Examples of applications related to IPTV services include an EPG generating a remote UI; proxying for signalling protocols when not involving SIP, and when client and server are not in same IP domain; support for proprietary or non-standard content download protocols (where the AG has A/V content storage capability); insertion of personalized advertisements in media stream; and full blended person-to-person communication services (e.g., videoconference using a TV set as a display). An example of an application unrelated to IPTV services is one that collects alarms from home devices.</p>
<p>To interface to the AG, an OITF uses the HNI-INI-AG interface. The HNI-INI-AG is a selection from the reference points in the HNI-INI interface, in addition to the support for discovery of an AG by an OITF.</p>
<p>When present, the AG, through application running in the executable application environment, can perform any of the following functionalities:</p><ul>
<li>Manipulate media streams.
<p>Note that for protected content, this is only addressed when the AG and the CSPG are combined in the same device and that the Release 2 Solution [[!Ref-45]] does not define the routing of media content (for the purposes of media control) via an AG which is not also a CSPG.</p>
<li>Filter Content Guide (CG) data; insert its own CG data.
<p>Note that in the Release 2 Solution [[!Ref-45]], this is only addressed where the resulting content guide is output from the AG to the OITF in the form of a remote UI. The Release 2 Solution does not define how an AG may output CG data in Broadcast Content Guide (BCG) format to an OITF, or how an OITF may discover that BCG format information is available from an AG. </p>
<li>Support proprietary applications through a Remote User Interface (RUI).
<li>Support for proprietary or non-standard content download protocols
<li>Support advanced blended communication services.</ul>
<p>When the AG is deployed in a device with local graphics rendering (e.g. combined with an OITF), applications running in the PAE can offer a wide range of applications and services directly using that local graphics rendering system without using a remote UI.</p>
<p>The AG is able to make use of the services of the IG via the HNI-AGI interface. This interface is not defined in the Release 2 Solution [[!Ref-45]]; however, where an AG and an OITF are combined in the same device, the device may use the HNI-IGI interface for both DAE and PAE applications.</p>
<p class="inline-header">Content and Service Protection (CSP) Gateway Functional Entity (CSPG)</p>
<p>The CSP Gateway (CSPG) is an optional gateway functional entity that provides a conversion from a content and service protection solution in the network to a secure authenticated channel between the CSPG and the OITF.</p>
<p class="inline-header">WAN Gateway Functional Entity (WG)</p>
<p>The WAN Gateway function supports the physical connection between the residential LAN and the Access Network WAN. A WAN gateway functional entity will exist in all deployments although not all its functions will be required in all cases.</p>
<section><h3>Residential Network Functional Entities</h3>
<p>The following is a more detailed description of the various functional entities identified above.</p>
<p>For ease of understanding of the detailed functional description of the residential network, this specification uses a stepwise build up of the residential network functional entities comprising of the following steps: </p><ul>
<li>OITF and WAN Gateway (WG)
<li>OITF, WG and IG
<li>OITF, WG, IG and the optional functional entities AG and CSPG</ul>
<p>Note that this build-up of functions does not imply that these combinations of functions are the only deployment options possible. Each of OITF, IG, AG, CSPG and WAN Gateway functional entities may be deployed as separate physical devices in the residential network or in combinations or may not be deployed at all in the case of the optional entities AG and CSPG as described in section <a href="#s5-3-4" class="sectionRef">5.3.4</a>. </p>
<section id="s5-3-1-1"><h4>Open IPTV Terminal Functional Entity (OITF)</h4>
<figure id="oitf-functions">
<figcaption>Figure #-####: OITF functions and interfaces exposed</figcaption>
<img src="images/OIPF-functions.png" alt="figure 5-5" style="width:90%"/>
</figure>
<p>The OITF functional entity shown in Figure <a href="#oitf-functions" class="figureRef">5-5</a> includes the following functions:</p>
<p><b>User Profile Management:</b>  Manages subscription information associated with a specific User, e.g., viewing preferences. The user profile management functions include the ability to create, fetch, modify, delete, replace user profiles.</p>
<p><b>Stream Session Management and Control:</b>  Initiates and terminates content delivery sessions. Manages content delivery sessions, including trick play control of unicast streams and multicast stream control. It applies to both the unmanaged and the managed models. </p>
<p><b>Stream Transmitter/Receiver:</b> Receives streamed content from the network and includes stream buffering in the case of progressive download. It also transmits real-time audio and video in the case of multimedia telephony. The function applies to both the managed and unmanaged models, although different technologies might be chosen for each case.</p>
<p><b>Codecs:</b> A/V codecs for all streamed and downloaded content. It includes decoding, scaling and rendering functions.</p>
<p><b>CSP:</b> Client side key management for the terminal centric approach to service protection and content protection. Enforces content usage rules in the client. It applies to both the managed and the unmanaged models. See CSP Gateway functional entity for the alternative gateway centric approach to service and content protection.</p>
<p><b>Content Download:</b> Reception of content downloaded to the client in non-real time. Content download might be unicast or multicast. For multicast, the MDTF is used. Local storage is required for content download. It applies to both the managed and the unmanaged models. This function is optional.</p>
<p><b>MDTF (Multicast Data Terminating Function):</b> This function receives generic data sent over multicast. Content types that can be distributed to MDTF include Content Guide data, static DAE content, video content, interactivity information, notifications, software releases and patches.</p>
<p><b>Decrypt:</b> Removes any encryption applied to the content, under the control of the CSP function. This function is not used for unencrypted content. It applies to both the managed and the unmanaged models.</p>
<p><b>Declarative Application Environment (DAE):</b> A declarative language based environment (browser) based on CEA-2014 [[!Ref-3]] for presentation of user interface and including scripting support for interaction with network server-side applications and access to the APIs of the other OITF functions. </p>
<p>The specification of the DAE declarative language environment including the APIs available to the downloaded applications is within the scope of the Forum.</p>
<p>The DAE can also query, internally to the OITF, the Metadata-based Content Guide Client in order to extract any data it may contain.</p>
<p>The downloaded applications that run in the DAE are considered to be Service Provider specific and therefore will not be defined by the Forum's specifications.</p> 
<p><b>Metadata-based Content Guide Client:</b> Client for metadata-based content guides. The user interface including the presentation of metadata-based content guide is OITF vendor dependent and is out of scope of this specification. This function may also make the metadata available to Residential Network devices via the DLNA Functions function. It applies to both the managed and the unmanaged models.</p>
<p><b>Remote Management Client:</b> provides the client-side functions to remotely manage the OITF, for both provisioning and assurance purposes. The functions provided relate to configuration management (including firmware upgrade) and fault management (including troubleshooting and diagnostics). When realized as standard TR-069 client, it uses the UNI-RMS interface (providing also performance monitoring); otherwise, remote management is supported as a DAE application which uses the UNIS-6 interface.</p>
<p><b>IPTV Service Discovery:</b>  Function for discovering IPTV Service Providers and related services. It applies to both the unmanaged and the managed models. Note that different aspects of DVB SD&amp;S [[!Ref-4]] may apply to the different models.</p>
<p><b>Integral Storage System:</b>  Storage for content download and PVR based functions. This function is optional but will be required if Content Download is supported.</p>
<p><b>DLNA Functions:</b> Implements DLNA DMS [[!Ref-2]] functions to expose and distribute content in a DLNA compliant manner through the residential network. The DLNA Functions function may also offer a DLNA DMP [[!Ref-3]] function to locate and select content available from other DMS in the residential network. The selected content can be streamed across the residential network and rendered by the OITF. The DLNA Functions may also support the DLNA RUI Source capability (+RUISRC+) to provide remote UI content to the DLNA RUI Pull controller capability (+RUIPL+), which can be used to support an ITF Remote Control Function (IRCF). This function is optional.</p> 
<p><b>OITF embedded application:</b> This optional function provides embedded applications for IPTV services, e.g. local PVR, using the standardized interfaces which are defined as UNI and HNI-IGI. The user interaction with this function is OITF vendor specific</p>
<p><b>Performance Monitor Client:</b> Client for providing feedback on service quality &mdash; for example, pixilation, frame loss, packet loss and delay (the exact information to be provided is to be specified other specifications). It applies to both the managed and the unmanaged models. </p>
<p><b>Device Management:</b> This function acts as a UPnP Device Management Client [[!Ref-42]] for  remote management operations such as configuration management (including triggering of a software upgrade) and fault management (including troubleshooting and diagnostics). </p>

<p><br/>The WAN Gateway functional entity shown in Figure <a href="#oitf-functions" class="figureRef">5-5</a> contains the following functions:</p>
<p><b>LAN/WAN Gateway:</b> Supports the physical termination of the access network (e.g. xDSL, GPON etc.) and the layer 2, layer 3 and higher services (such as NAT, IGMP proxy-routing) required to support IPTV and other services terminated in the residential network that share the WAN connection. </p>
<p><b>Attachment:</b> Attachment function is responsible for the attachment of the residential network to the Network Provider. </p>
<p><b>RMS3:</b> Depending on the provider model, the WAN Gateway may be remotely monitored and configured by the access service provider. The RMS function supports the interface to the remote manager (i.e. TR 069 CWMP remote management protocol [[!Ref-1]], plus TR 098 device data model [[!Ref-33]] with possible extensions.)</p>
<p><b>QoS:</b>  The QoS function provides classification, marking, re-marking, policing, and queuing of Ethernet and IP traffic that goes between the WAN and LAN interfaces. Marking and re-marking of Ethernet priority and Diffserv code points (DSCP) [[!Ref-6]]  is supported. Classification can occur through a variety of characteristics of IP traffic, including Ethernet priority, DSCP, origination and destination IP address, and application protocol.</p>
<p><b>IGMP Support:</b> Provides the functions for IGMP Proxy and IGMP Snooping. The IGMP Proxy allows multiple in-home devices in the residential network to be able to join the same multicast stream. IGMP Snooping is the process of listening to IGMP traffic to allow, when present, the switch to "listen in" on the IGMP conversation between hosts and routers by processing the layer 3 IGMP packets sent in a multicast network to avoid flooding (see section <a href="#s5-3-3-1" class="sectionRef">5.3.3.1</a>).</p>
<p><b>UN/MC Conv:</b> The WAN Gateway may have this function to avoid some problems due to the low efficiency and unreliability of multicast on wireless networks. This function is not specified in the Release 2 Solution [[!Ref-45]].</p>
<p><b>UPnP Control Point:</b> The UPnP Control Point [[!Ref-28]] interacts with the UPnP Device Management Client [[!Ref-42]] in the OITF for remote management operations. </p>
</section>
<section id="s5-3-1-2"><h4>OITF and IG</h4>
<figure id="oitf-and-ig">
<figcaption>Figure #-####: OITF and IG</figcaption>
<img src="images/OITFandIG.png" alt="figure 5-6" style="width:90%"/>
</figure>
<p>In a device that implements both the OITF and IG, the use of the HNI-IGI interface is optional.</p>
<p>The IG functional entity depicted in Figure <a href="#oitf-and-ig" class="figureRef">5-6</a> includes the following additional functions:</p>
<p class="inline-header">IMS Gateway (IG)</p>
<p><b>Authentication/Session Management Client/Server:</b> Responsible for subscriber authentication and any session management required for managed networks (e.g., managed IPTV services and person-to-person communication services). The authentication performed by this function is (re-)used for Content and Service Protection (CSP) purposes.</p>
<p>The Authentication/Session Management client/server interacts with the network servers through the UNIS-8 interface. This function includes the implicit connectivity admission control (CAC) request for the WAN side. No explicit CAC function is required on the LAN side. </p>
<p><b>IG-OITF Server:</b>  The IG-OITF server exposes authentication and session management client/server functionalities to the OITF for managed IPTV services and blended person-to-person communication application support (e.g., caller id display, messaging etc.) via HTTP and/or other protocols as required. If required, the interaction between the IG-OITF Server and the OITF may result in a UI on the OITF display or the delivery of execution script(s) to the DAE function on the OITF. </p>
<p><b>RMS2:</b> Client application for remote management functions in a managed environment. It provides a standard interface for provisioning and assurance tasks on managed devices with the IG function (i.e. TR 069 CWMP remote management protocol [[!Ref-1]], plus TR 104 [[!Ref-29]] IMS data model with possible extensions). It includes functions for configuration management, firmware upgrade, troubleshooting/diagnostics, performance management and monitoring of IMS/SIP services.</p>
<p><b>Network Discovery:</b> Network discovery function is responsible for the discovery of and attachment to an IMS service provider.</p>
<p><b>DLNA Content Transformation Device (DLNA CTD):</b> This optional function provides media transformation, e.g. transcoding for remote access. The DLNA Content Transformation Device implements the DLNA Media Interoperability Unit (MUI) device class or DLNA devices which implement the DLNA virtual device functionality with content transformation function.</p>
</section>
<section id="s5-3-1-3"><h4>OITF, IG, AG and CSPG</h4>
<figure id="all-residental-functions">
<figcaption>Figure #-####: All Residential Network Functional entities</figcaption>
<img src="images/AllResidentialNetworkFunctions.png" alt="figure 5-7" style="width:90%"/>
</figure>
<p>A residential network with the addition of the optional Application Gateway and the optional CSP Gateway functional entities is depicted in Figure <a href="#all-residental-functions" class="figureRef">5-7</a>. This represents a residential network with all the residential network functional entities. The AG and CSPG are independent optional functional entities that may be required in a specific residential network configuration. The following additional functions are identified.</p>
<p class="inline-header">Application Gateway (AG)</p>
<p><b>Procedural Application Environment (PAE):</b> A local procedural language execution environment based on Java Connected Device Configuration (CDC) [[!Ref-34]] for IPTV Service Provider specific downloaded applications. If required, these applications can present a UI via the CEA-2014 [[!Ref-2]] based Remote UI function on the OITF's DAE. When the PAE is deployed in a device with local graphics rendering (e.g., combined with an OITF), these applications also can also directly access that local graphics system. </p>
<p>The definition of the full capabilities of the PAE is within the scope of the Forum's specifications. The specification of the Service Provider specific applications that are downloaded and executed in the environment are outside of the scope of the Forum's specifications.</p>
<p>The PAE is a multipurpose execution environment capable of supporting many IPTV-specific and general services. These capabilities include support of the following service provider specific applications: </p><ul>
<li><b>Media Control:</b> Enables the Service Provider to locally intercept the media stream (media, control, CSP) for the purpose of adding or inserting content generated or stored in the AG into that media stream.  The operation of Media Control shall be under the control of Applications running in the PAE via defined APIs. 
<p>Note that for protected content, this is only possible when the AG and the CSPG are combined in the same device and that the Release 2 Solution [[!Ref-45]] does not define the routing of media content (for the purposes of media control) via an AG which is not also a CSPG </p>
<li><b>CG:</b> Client with the following functions:<ul>
<li>Discovery and description of available services and content.
<li>At least one of:<ul>
<li>Presentation of an CG on the OITF via the DAE
<li>Passing all or some subset of the metadata to the &ldquo;Metadata CG client&rdquo; on the OITF, depending on the policy of either the Service Platform Provider or the IPTV Service Provider.
<p>Note that this is not addressed in the Release 2 specifications.</p>
<li>When present, this application terminates the UNIS-7 interface in addition to the CG application client in the OITF, which also directly handles the UNIS-7 interface.
</ul></ul>
<li><b>IPTV Service Discovery:</b> Client with the following functions:<ul>
<li>Discovery of available service providers.
<li>Discovery and description of available services and content.</ul>
<li><b>Fully blended communication services:</b> Possibly requiring additional hardware to support advanced applications such as video telephony. The HNI-AGI interface allow applications in the AG implementing advanced communication services to access the Authorization and Session Management functions in the IG.
<li><b>RUI Server:</b> This function enables applications running in the PAE to serve declarative language applications running on the DAE in the OITF.
<li><b>Proprietary or non-standard content download protocols:</b> Implementation of proprietary, non-standard or other service provider-specific protocols in a PAE application.</ul>
<p><b>RMS1:</b> Client application for remote management functions in a managed environment. It provides a standard interface for provisioning and assurance tasks on managed devices with the AG function (i.e. TR 069 CWMP remote management protocol [[!Ref-1]], plus TR 135 [[!Ref-30]]/TR 140 [[!Ref-31]] IPTV/storage data model with possible extensions). It includes functions for configuration management, firmware upgrade, troubleshooting/diagnostics, performance management and monitoring of streaming services.</p>
<p class="inline-header">CSP Gateway (CSPG)</p>
<p>The CSP Gateway is required when a gateway centric approach to service and content protection is deployed as an alternative to the Marlin based CSP functions of the OITF. A secure authenticated channel is used between the CSPG and the OITF.</p>
</section>
</section>
<section><h3>Handling QoS in the Residential Network</h3>
<p>The QoS function in the WAN gateway is responsible for the QoS marking (e.g., DSCP, Ethernet priority) into and out of the residential network. All nodes in the residential network are responsible for marking the appropriate priority of originating traffic. </p>
</section>
<section><h3>Multicast Handling in modem gateway router</h3>
<p>Modem gateway router includes transport related functionality such as LAN handling, IP multicast support, etc. IPTV services require additional functionality to be supported in order to ensure efficiency in the home LAN environment.</p>
<section id="s5-3-3-1"><h4>Multicast and the Home LAN</h4>
<p>It is expected that scheduled content services will use IP multicast technology to deliver A/V streams. Although IP multicast is efficient in the Network Provider domain, it will cause some issues in Residential network environment, such as</p><ul>
<li>Flooding to unnecessary segments
<p>Gateway routers broadcast incoming multicast packets to all ports, resulting in unnecessary packets being delivered to endpoints that are not listeners for that or any multicast stream, and must discard them. This situation is depicted in Figure 5-8.</p>
<figure id="flooding-example">
<figcaption>Figure #-####: Example of flooding issue</figcaption>
<img src="images/FloodingExample.jpg" alt="figure 5-8" style="width:90%"/>
</figure>
<p>IGMP snooping in the switching function of the home gateway router will solve this issue to some extent. But if there is a secondary switch in the residential network which does not support IGMP snooping, the same issue still remains, although its severity has been reduced.</p>
<li>Low efficiency and unreliability of multicast on Wireless networks (802.11 WLAN) [[!Ref-7]]
<p>Multicast frames can not be transmitted at as high a rate as unicast frames. Also, the reliability of multicast is low due to the lack of retransmission mechanisms in Layer 2.</p>
<p>To remedy this problem, it is necessary to perform multicast to unicast conversion at the home entry point.  The conversion will be done at Layer 2 or Layer 3 by snooping IGMP messages [[!Ref-8]] and managing the membership of multicast listeners.</p>
</ul>
<p>In this release of the architecture, support of IGMP snooping and IGMP proxy [[!Ref-9]] is mandatory to avoid flooding of unnecessary segments.</p>
</section>
<section><h4>Local Multicast within the Gateway Router</h4>
<p>It is mandatory for home routers compliant to this architecture to support local multicasting to avoid the consumption of any additional bandwidth in the last mile when multiple end points are watching the same stream. IGMP snooping can solve that issue by dropping IGMP JOINs for streams that are already available, and ensuring that these streams are replicated locally and delivered to these end points.</p>
</section>
</section>
<section id="s5-3-4"><h3>Deployment Options</h3>
<p>This section describes the allowable deployment options in the residential network, and the services supported by each deployment option.</p>
<p>Each of the OITF, IG, AG and WG functional entities may be deployed as separate physical devices in the residential network, or in combinations as described in this section.</p>
<section><h4>Services Available in the Residential Network</h4>
Table <a href="#t4" class="tableRef">4</a> shows the services available the residential network for each combination of functional entities.
<table id="t4" class="simple">
<caption>Table ####: Services from Functional Entities</caption>
<tr><th colspan="4">Functional Entities deployed in<br/>the residential network</th><th rowspan="2">Services available</th></tr>
<tr><th>WG</th><th>OITF</th><th>IG</th><th>AG</th></tr>
<tr><td>X</td><td>X</td><td></td><td></td><td>Unmanaged network services only are available.<br/>DAE applications can be deployed.</td></tr>
<tr><td>X</td><td>X</td><td>X</td><td></td><td>Managed network and unmanaged network services are available.<br/>DAE applications can be deployed.</td></tr>
<tr><td>X</td><td>X</td><td>X</td><td>X</td><td>Managed network and unmanaged network services are available.<br/>DAE and PAE applications can be deployed.</td></tr>
<tr><td>X</td><td>X</td><td></td><td>X</td><td>[This deployment option is not defined by this version of the specification]<br/>Unmanaged network services are available.<br/>DAE and PAE applications can be deployed.</td></tr>
</table>
Note that the CSP Gateway functional entity is not shown in this table. Details of the CSP Gateway deployment can be found in section <a href="#s5-3-4-3" class="sectionRef">5.3.4.3</a>
</section>
<section id="s5-3-4-2"><h4>Deployment Examples</h4>
<section><h5>OITF STB</h5>
<figure><img src="images/arch-example-deployment-01.png" alt="arch-example-deployment-01.png" style="width:90%"/></figure>
<p>This deployment supports the consumption of unmanaged services using a legacy TV. The following devices are deployed.</p><ul>
<li>A WAN Gateway: This is a standard modem/router, providing access to an unmanaged network via an ISP.
<li>OITF STB: A set top box implementing the OITF and connecting to a legacy TV via, for example, HDMI or SCART.
<li>Legacy TV: A television without OITF or DLNA capabilities.</ul>
<p>Optionally, the OITF STB may act as a DLNA DMS to make OIPF-defined services available to DLNA devices. It may also act as a DLNA DMP to access content from other DLNA devices on the residential network.</p>
</section>
<section><h5>OITF TV</h5>
<figure><img src="images/arch-example-deployment-02.png" alt="arch-example-deployment-02.png" style="width:90%"/></figure>
<p>This deployment supports unmanaged services without the need for an additional set top box. The following devices are deployed.</p><ul>
<li>A WAN Gateway: This is a standard modem/router, providing access to an unmanaged network via an ISP.
<li>OITF TV: A television including an OITF.</ul>
<p>Optionally, the OITF TV may act as a DLNA DMS to make OIPF-defined services available to DLNA devices. It may also act as a DLNA DMP to access content from other DLNA devices on the home network.</p>
</section>
<section><h5>Combined IG&mdash;WAN Gateway with OITF TV</h5>
<figure><img src="images/arch-example-deployment-03.png" alt="arch-example-deployment-03.png" style="width:90%"/></figure>
<p>This deployment supports both managed and unmanaged services, with DAE applications. The following devices are deployed:</p><ul>
<li>Combined IG and WAN Gateway: A single physical device including an IG and modem/router functionality.
<li>OITF TV: This is an OITF TV, as described in this document.</ul>
<p>Optionally, the OITF TV may act as a DLNA DMS to make OIPF-defined services available to DLNA devices. It may also act as a DLNA DMP to access content from other DLNA devices on the home network.</p>
</section>
<section><h5>Combined IG&mdash;WAN Gateway with multiple OITF TVs</h5><figure><img src="images/arch-example-deployment-04.png" alt="arch-example-deployment-04.png" style="width:90%"/></figure>
<p>This deployment supports both managed and unmanaged services, with DAE applications. The following devices are deployed:</p><ul>
<li>Combined IG and WAN Gateway: A single physical device including an IG and modem/router functionality.
<li>OITF TVs: These are OITF TVs, as described in this document.</ul>
<p>Optionally, either OITF TV may act as a DLNA DMS to make OIPF-defined services available to DLNA devices. It may also act as a DLNA DMP to access content from other DLNA devices on the home network.</p>
<p>Note that one or both OITFs may be deployed in an STB connected to a legacy TV, as shown below, instead of being embedded in a TV. </p>
<figure><img src="images/arch-example-deployment-04b.png" alt="arch-example-deployment-04b.png" style="width:90%"/></figure>
</section>
<section><h5>Combined IG&mdash;OITF STB and Multiple OITFs</h5><figure><img src="images/arch-example-deployment-05.png" alt="arch-example-deployment-05.png" style="width:90%"/></figure>
<p>This deployment supports both managed and unmanaged services, with DAE applications, presented on an OITF TV and a legacy TV. The following devices are deployed:</p><ul>
<li>A WAN Gateway.
<li>Combined IG and OITF STB: A set top box including IG and OITF functionality that exposes HNI-IGI to other OITFs in the residential network. It connects to the legacy TV using some non-OIPF specified mechanism, such as HDMI or SCART.
<li>OITF TV: This is a TV containing an OITF.</ul>
<p>Optionally, the OITF TV and IG-OITF STB may act as a DLNA DMS to make OIPF-defined services available to DLNA devices. It may also act as a DLNA DMP to access content from other DLNA devices on the home network.</p>
</section>
<section><h5>Combined IG&mdash;OITF TV</h5><figure><img src="images/arch-example-deployment-06.png" alt="arch-example-deployment-06.png" style="width:90%"/></figure>
<p>This deployment supports both managed and unmanaged services, with DAE applications, presented on an OITF TV. The following devices are deployed:</p><ul>
<li>A WAN Gateway.
<li>Combined IG and OITF TV: A TV including both IG and OITF functionality.</ul>
<p>Optionally, the IG-OITF TV may act as a DLNA DMS to make OIPF-defined services available to DLNA devices. It may also act as a DLNA DMP to access content from other DLNA devices on the home network.</p>
<p>Note that the IG inside the TV may be used by external OITFs to access managed services.</p>
</section>
<section><h5>Multiple IG&mdash;OITF STBs</h5><figure><img src="images/arch-example-deployment-07.png" alt="arch-example-deployment-07.png" style="width:90%"/></figure>
<p>This deployment supports both managed and unmanaged services, with DAE applications, presented on multiple legacy TVs. The following devices are deployed:</p><ul>
<li>A WAN Gateway.
<li>Two combined IG-OITF STBs: STBs including both IG and OITF functionality.</ul>
<p>Only one IG can be active in the residential network at any one time. This limitation may be relaxed in a future specification.</p>
<p>Optionally, each IG-OITF TV may act as a DMS to make OIPF-defined services available to DLNA devices. They may also act as a DMP to access content from other DLNA devices on the home network.</p>
</section>
<section><h5>Combined IG&mdash;AG&mdash;OITF STB and OITF TV</h5><figure><img src="images/arch-example-deployment-08.png" alt="arch-example-deployment-08.png" style="width:90%"/></figure>
<p>This deployment supports both managed and unmanaged services, with DAE and PAE applications, presented on an OITF TV and a legacy TV. The following devices are deployed:</p><ul>
<li>A WAN Gateway.
<li>Combined IG, AG and OITF STB: A set top box including IG, AG and OITF functionality, that exposes the HNI-INI-AG interface to other OITFs in the residential network. It connects to the legacy TV using some non-OIPF specified mechanism, such as HDMI or SCART.
<li>OITF TV: This is a TV containing an OITF.</ul>
<p>Optionally, the combined IG-AG-OITF STB or the OITF TV may act as a DLNA DMS to make OIPF-defined services available to DLNA devices. They may also act as a DLNA DMP to access content from other DLNA devices on the home network.</p>
</section>
<section><h5>Combined AG&mdash;IG with multiple OITFs</h5><figure><img src="images/arch-example-deployment-09.png" alt="arch-example-deployment-09.png" style="width:90%"/></figure>
<p>This deployment supports both managed and unmanaged services, with DAE and PAE applications, presented on an OITF TV and a legacy TV. The following devices are deployed:</p><ul>
<li>A WAN Gateway.
<li>Combined AG-IG device: A device including both IG and AG functionality, that exposes the HNI-INI-AG interface to OITFs in the residential network. 
<li>OITF STB: A set top box containing an OITF. It connects to the legacy TV using some non-OIPF specified mechanism, such as HDMI or SCART.
<li>OITF TV: A TV containing an OITF.</ul>
<p>Optionally, the OITF STB or the OITF TV may act as a DLNA DMS to make OIPF-defined services available to DLNA devices. They may also act as a DLNA DMP to access content from other DLNA devices on the home network.</p>
</section>
<section><h5>AG&mdash;IG, OITF&mdash;IG, Multiple OITFs</h5><figure><img src="images/arch-example-deployment-10.png" alt="arch-example-deployment-10.png" style="width:90%"/></figure>
<p>This deployment supports managed and unmanaged services, and DAE and PAE applications. The following devices are deployed:</p><ul>
<li>A WAN Gateway.
<li>Combined AG-IG device: A device including both IG and AG functionality, that exposes the HNI-INI-AG interface to OITFs in the residential network. 
<li>OITF STB: A set top box containing an OITF. It connects to the legacy TV using some non-OIPF specified mechanism, such as HDMI or SCART.
<li>IG-OITF STB: A set top box containing both an IG and an OITF.
<li>OITF TV: A TV containing an OITF.</ul>
<p>In this deployment, there are multiple IGs. Only one IG can be active in the residential network at any point in time. The ISIM application must always be in the AG-IG in this case.</p>
<p>Note: The applicability of Remote Access to this deployment has not been studied.</p>
</section>
<section><h5>Combined OITF&mdash;AG TV and IG&mdash;WAN Gateway</h5><figure><img src="images/arch-example-deployment-11.png" alt="arch-example-deployment-11.png" style="width:90%"/></figure>
<p>This deployment supports managed and unmanaged services, and DAE and PAE applications. The following devices are deployed:</p><ul>
<li>Combined IG-WAN Gateway: A single physical device including an IG and WAN Gateway functionality.
<li>Combined AG-OITF TV: A TV including both an OITF and an AG.</ul>
<p>Optionally, the OITF-AG TV may act as a DLNA DMS to make OIPF-defined services available to DLNA devices. It may also act as a DLNA DMP to access content from other DLNA devices on the home network</p>
</section>
</section>
<section id="s5-3-4-3"><h4>CSP Gateway</h4>
<p>The optional CSP Gateway (CSPG) functional entity implements content and service protection solutions defined outside the OIPF specifications and delivers content to OITFs using a secure authenticated channel between the CSPG and the OITF, or using a device-internal interface when the OITF and the CSPG are combined in the same device. </p>
<p>Some possible deployment scenarios include:</p><ul>
<li>An IG and CSP Gateway combined device.
<li>An AG, IG and CSP Gateway combined device.
<li>An AG and CSP Gateway combined device.
<li>Combined IG, OITF and CSPG TV or STB: A TV or STB including IG, OITF and CSPG functionality.
<li>Combined OITF and CSPG TV or STB: A TV or STB including OITF and CSPG functionality.</ul>
<p>Note that the media control features of the AG are only possible for protected content when the AG and CSP Gateway are combined in one device.</p>
<p>Note that the Release 2 Solution [[!Ref-45]] does not define the routing of media content (for the purposes of media control) via an AG which is not also a CSPG.</p>
</section>
</section>
<section id="s5-3-5"><h3>Residential Network Reference Points</h3>
<ul>
<li>HNI-INI: This is a group of reference points directly connected to the OITF to provide application layer protocols common to both managed and unmanaged models. If an AG function is deployed, the AG may terminate HNI-INI in addition to the OITF as described in section <a href="#s5-3-1-3" class="sectionRef">5.3.1.3</a>. The HNI-INI consists of the following UNI reference points.<ul>
<li>UNIP-1 (to &ldquo;User Profile Management&rdquo;)
<li>UNIP-2 (to &ldquo;Person-to Person-Communication Enablers User Profile management&rdquo;)
<li>UNIS-13 (to &ldquo;Stream Session Management and Control&rdquo;)
<li>UNIS-11 (to &ldquo;Stream Session Management and Control&rdquo;)
<li>UNIS-CSP-T (to &ldquo;CSP&rdquo;)
<li>UNIS-6 (to &ldquo;DAE&rdquo;)
<li>UNIS-7 (to &ldquo;Metadata based Content Guide client&rdquo;)
<li>UNIT-17 (to &ldquo;Stream transmitter/receiver&rdquo;)
<li>UNIS-14 (to &ldquo;Stream Session Management and Control&rdquo;)
<li>UNIS-15 (to &ldquo;Service Discovery&rdquo;)
<li>UNIT-18 (to &ldquo;Performance Monitor Client&rdquo;)</ul>
<li>HNI-INI-AG: This interface is a group of reference points between the OITF and AG which supports the adaptation of the IPTV services to the OITF. Where applicable, this interface uses the same protocols as HNI-INI, as follows: the UNIS-6 reference point always applies between the OITF and AG. The following reference points may apply when the AG includes A/V media storage - UNIS-11, UNIT-17 and UNIT-18. Use of the remaining reference points from HNI-INI between an OITF and an AG is not defined in the Release 2 Solution [[!Ref-45]]. Additionally, the HNI-INI-AG interface includes the device discovery mechanisms.
<li>HNI-IGI: This interface is between the OITF and IG and provides, to the OITF, access to IG functions for the adaptation to IPTV services on managed networks. The HNI-IGI includes device discovery mechanisms.
<li>HNI-AGI: This interface is between the IG and AG and provides. To the AG, access to IG functions for the adaptation to IPTV services in managed networks. The HNI-AGI includes device discovery mechanisms.
<li>HNI-AMNI: This interface is between the IG and the network and includes the reference points that are required in addition to the HNI-INI reference points, to deliver managed services.
<li>HNI-CSP: This interface is between the OITF and the CSPG and allows the OITF to access CSPG functions for the conversion from a content and service protection solution to a secure authenticated channel between the CSPG and the OITF.
<li>HNI-AGC: This interface allows access to encryption keys.
<li>HNI-DM: This is the interface between the WAN Gateway and the OITF to support remote management of the OITF in the home. This reference point uses the UPnP DM protocol [[!Ref-42]]. 
<p>Note: The mapping between UNI-RMS and HNI-DM will be based on [[!Ref-43]].</p>
</ul>
</section>
</section>
<section><h2>QoS Framework Architecture Description</h2>
<p>The QoS framework is responsible for policy-based transport control in the access and core networks, and includes procedures and mechanisms that handle resource reservation and admission control for both unicast and multicast.</p>
<p>The Resource and Admission Control (RAC) [[!Ref-12]] is the building block responsible for these functions.</p>
<p>The RAC is able to interact with the following three main architectural blocks:</p><ul>
<li>Authentication and Session Management: RAC receives resource reservation requests and output notifications  the status of  requests
<li>Transport Processing Functions: RAC enforces policies, receives resource reservation requests and manages the network status
<li>Network Attachment: RAC receives the subscriber access profile and location information</ul>
<p>The RAC supports QoS resource reservation mechanisms triggered in two ways:</p><ul>
<li>&ldquo;Push&rdquo; mode: the RAC pushes traffic policies to the transport processing functions on receipt of a request for resource reservation coming from the Authentication and Session Management
<li>&ldquo;Pull&rdquo; mode: traffic policies are &ldquo;pulled&rdquo; by the transport functions from the RAC on receipt of resource requests coming from  the Transport Processing Function (e.g. in case of IGMP/PIM) [[!Ref-10]] [[!Ref-11]]</ul>
<p>The Push and Pull models and related mechanisms are coordinated by the RAC, to ensure the appropriate policy enforcement for both unicast and multicast services (see Appendix <a href="#RAC-for-multicast" class="sectionRef">E</a> for details).</p>
<section id="s5-4-1"><h3>RAC functional description and deployment options</h3>
<figure id="RAC-architecture">
<figcaption>Figure #-####: Resource and Admission Control Architecture</figcaption>
<img src="images/RAC-Architecture.png" alt="figure 5-9" style="width:90%"/>
</figure>
<p>The RAC functional entities are:</p><ul>
<li>A-RACF (Access Resource Admission Control Function): performs admission control and derives the traffic policies that are installed in the RCEF.
<li>SPDF (Service-based Policy Decision Function):  provides a single point of contact for the Authentication and Session Management FE to receive resource reservation requests and acts as a final Policy Decision Point for Service-Based Policy control.</ul>
<p>The Transport Processing Functions involved in processing unicast and multicast flows are:</p><ul>
<li>BTF (Basic Transport Function): sends and receives IGMP and PIM  messages; and  replicates  multicast flows;
<li>RCEF (Resource Control Enforcement Function): enforces traffic policies and builds and forwards admission control requests to the A-RACF;</ul>
<p>To maximize performance a distributed architecture is possible; in particular, depending on operator policy, the A-RACF may be located in any Transport Processing Function node. All Transport Processing Function Nodes have the following deployment options:</p><ul>
<li>BTF only; in this case policies are not enforced at the Transport Node; 
<li>BTF + RCEF; in this case a centralized resource and admission control approach is used;
<li>BTF + RCEF + A-RACF; in this case a distributed resource and admission control approach is used;</ul>
<p>The interfaces between the functional entities are:</p><ul>
<li>RCEF &mdash; A-RACF:  based on the same protocol as used between the Authentication and Session Management and the Resource and Admission Control Function, i.e. Diameter [[!Ref-27]]. The RCEF - BTF interface can be considered an internal Transport Processing Functions interface.
<li>A-RACF &mdash; A-RACF: Inter A-RACF interface when multiple A-RACFs are present. One A-RACF could delegate the control of a resource to another A-RACF through this interface. </ul>
<p>A more detailed description of the RAC behaviour, with examples of specific deployment scenarios, is provided in Appendix <a href="#RAC-for-multicast" class="sectionRef">E</a>.</p>
</section>
</section>
<section><h2>Handling of mobile terminals</h2>
<p>Mobile phones acting as an OITF and accessing IMS-IPTV services exclusively via the 3GPP mobile access shall be handled via the required procedures defined in 3GPP 26.237 [[!Ref-51]]. </p>
<p>IPTV services received through the 3GPP2 mobile access shall be handled as defined in 3GPP2 A.S0019 [[!Ref-52]] and X.S0022 [[!Ref-53]]. For WiMax access, the corresponding reference is the WiMax Forum's Network Architecture Release 1.5 [[!Ref-54]].</p>
</section>
</section> <!-- end of section 5 -->

<section><h1>High Level Signalling Flows 	(informative)</h1>
Many of the signalling flows in this chapter have specific protocol choices. It should be noted that these are only examples.
<section><h2>Network Attachment</h2>
<p>Network attachment aims at providing IP addresses and configuration information to elements in the Consumer Domain prior to any other action regarding IPTV services. The provision and management of IP addresses has two main aspects.</p>
<p>IP address management within the Consumer Network: This deals with the attachment of the IG, AG and OITF to the WAN Gateway. The WAN Gateway could act as a DHCP Server and a NAT. This type of attachment allows the IG, AG and OITF to communicate with each other within the residential network.</p>
<p>In the unmanaged network model, this allows the OITF to send and receive messages from the Internet. </p>
<p>IP address management for communication with the Provider Network (Managed Network model only): 2 cases can occur</p><ul> 
<li>The WAN Gateway translates the in-home IP address to an IP address recognizable to the provider's addressing plan. In this case a NAT is needed. 
<li>The WAN Gateway assigns an IP address to the IG, AG and OITF from the managed network's IP addressing pool. In this case no NAT is needed. Configuration information (e.g. DNS server) is obtained directly by the OITF, AG and IG.</ul>
<p class="notebox"><b>Note:</b> It is mandatory that the WAN gateway supports the functionality of translating the in-home IP addresses to IP addresses recognizable to the provider's addressing plan. In this case, a NAT is needed.</p>
</section>
<section id="s6-2"><h2>IPTV Service Discovery and Selection</h2>
<p>The IPTV Service Discovery is a mechanism to enable an ITF to discover IPTV Service Providers and IPTV services provided by a specific IPTV Service Provider. The procedures of IPTV Service Discovery consists of the following three steps which are consistent with DVB-IP Service Discovery and the discovery information is based on DVB-IP SD&amp;S records for both managed network and unmanaged network. </p>
<table class="sequence">
<tr><td class="label">Step 1.</td><td><b>Determination of the IPTV Service Provider Discovery entry points.</b><br/>
This procedure is the bootstrap of IPTV Service Discovery, where the ITF finds the entry point(s) of the IPTV Service Provider Discovery functional entity. The mechanisms to determine the entry point(s) can be different between the managed and the unmanaged models. For example, in case of the managed model, the Network Attachment functional entity can provide the IP address to start the IPTV Service Provider Discovery phase. </td></tr>
<tr><td class="label">Step 2.</td><td><b>IPTV Service Provider Discovery.</b><br/>
This is the procedure where the ITF retrieves the information about each IPTV Service Provider. This information is located at the Service Provider Discovery functional entity, addressed by the entry point(s) found as a result of step 1. This information can be provided either as a web page or based on XML data, such as a DVB-IP Service Provider(s) Discovery Record. It includes the names of IPTV Service Provider(s) and related attributes (e.g. a logo image of the IPTV Service Provider, the means to retrieve IPTV Service Discovery information, etc.). This information will be used by the ITF to perform IPTV Service Provider selection. </td></tr>
<tr><td class="label">Step 3.</td><td><b>IPTV Service Discovery.</b><br/>
After selecting one IPTV Service Provider from the list obtained in step 2, this procedure allows the ITF to get information about IPTV Services offered by the selected IPTV Service Provider. This information is located at the Service Discovery functional entity. In this step, the term &ldquo;services&rdquo; includes linear TV, CoD, nPVR, etc. The IPTV Service Discovery information can be provided either as a web page or as an XML record, such as a DVB IP Offering record with needed extensions (including the start-up URL for DAE, entry point for the DVB-IP Broadband Content Guide Record and so on). </td></tr>
</table>
<p>Note that in the case of 1-to-1 relationship between the Service Platform Provider and the IPTV Service Provider, the IPTV Service Provider Discovery phase (Step 2) would return a single record; therefore, in such a deployment, the subscriber does not have to select the Service Provider and Step 1 could directly provide the address of the IPTV Service Discovery functional entity.</p>
<p>Note that step 2 and step 3 can be repeated without necessarily performing step 1.</p>
<p>When the Service Discovery and Selection Information changes, the IPTV Service Provider Discovery FE or IPTV Service Discovery FE should inform the ITF about this change.</p>
<p>The sequence in Figure <a href="#high-level-SDandS" class="figureRef">6-1</a> shows a high level call flow for IPTV Service Discovery followed by call flows for IPTV service access, such as retrieving documents for DAE and retrieving content guide metadata. Each call flow can include an optional authentication step to avoid unauthorized access to the IPTV services.</p>
<figure id="high-level-SDandS">
<figcaption>Figure #-####: High level steps in Service Discovery and Service Access</figcaption>
<img src="images/high-level-sdns.png" alt="figure 6-1" style="width:90%"/>
</figure>
<section><h3>IPTV Service Discovery and IPTV Service Access Procedures for Unmanaged Networks </h3>
<p>This section describes the IPTV Service Discovery and Service Access procedures for unmanaged networks. As described in section <a href="#s5-3" class="sectionRef">5.3</a>, the minimum set of functional entities needed to access unmanaged IPTV services are the OITF and the WAN Gateway; thus, the IPTV Service Discovery and Service Access procedures for unmanaged network are shown hereafter considering only these entities.</p>
<section id="s6-2-1-1"><h4>High Level Procedure</h4>
<figure id="highlevel-sdns-unmanaged">
<figcaption>Figure #-####: High level steps for Service Discovery and Service Access for unmanaged networks</figcaption>
<img src="images/unmanaged-sdns-highlevel.png" alt="figure 6-2" style="width:90%"/>
</figure>
<p>The IPTV Service Discovery and IPTV Service Access procedures for an unmanaged network comprise a number of steps, as shown in Figure <a href="#highlevel-sdns-unmanaged" class="figureRef">6-2</a>:</p>
<table class="sequence">
<tr><td>1.</td><td>Determination of the IPTV Service Provider Discovery entry point</td></tr>
<tr><td>2.</td><td>IPTV Service Provider Discovery </td></tr>
<tr><td>3.</td><td>IPTV Service Discovery </td></tr>
<tr><td>4.</td><td>IPTV Service Access (e.g. Access to the Content Guide &mdash; via metadata or web page)</td></tr>
</table>
<p>These steps are described in detail below.</p>
<table class="sequence">
<tr><td>0.</td><td>Attachment to the network, where the OITF obtains connectivity to the unmanaged network through the WAN Gateway</td></tr>
<tr><td>1.</td><td>Determination of an IPTV Service Provider Discovery entry point. This is an internal process in the OITF.</td></tr>
<tr><td>2.</td><td>The OITF initiates the IPTV Service Provider Discovery using this entry point. In this step, the IPTV Service Provider Discovery functional entity provides the list of IPTV Service Providers and information that is used in the next step (e.g. IPTV Service Provider name, IP address, protocols to be used)</td></tr>
<tr><td>3.</td><td>The OITF initiates the IPTV Service Discovery. In this phase the OITF selects an IPTV Service Provider and obtains the list of IPTV services available from that specific IPTV Service Provider </td></tr>
<tr><td>4.</td><td>The OITF can select and access an IPTV service, e.g. access the Content Guide.</td></tr>
</table>
</section>
<section id="s6-2-1-2"><h4>Determination of the IPTV Service Provider Discovery entry points</h4>
<p>For unmanaged networks, the OITF determines the entry point(s) with the following options. There is no priority order for these options.</p><ul>
<li><b>Manual</b><br/>
The End User manually enters a URL or an IP address/port. The OITF should provide a means to allow users to enter an entry point easily, e.g. bookmark, or default URL and the means by which this is achieved is OITF vendor dependent.
<li><b>Pre-Configured</b><br/>
Optionally, all the necessary information can be pre-configured in the OITF.
<li><b>DHCP Configuration</b><br/>
Optionally, the OITF retrieves provider discovery entry points via DHCP configuration parameters. This would be provided by the ISP to which the residential network connects.
</ul>
</section>
<section><h4>IPTV Service Provider Discovery</h4>
<p>The OITF requests the information on the available IPTV service providers from the IPTV Service Provider Discovery functional entity via HTTP(S).</p>
<figure id="highlevel-spd-unmanaged">
<figcaption>Figure #-####: IPTV Service Provider Discovery for unmanaged networks</figcaption>
<img src="images/unmanaged-spd-highlevel.png" alt="figure 6-3" style="width:90%"/>
</figure>
</section>
<section><h4>IPTV Service Discovery</h4>
<p>The Service Discovery Record can be delivered via HTTP(S) as XML data (DVB-IP SD&amp;S Record) or as a Web Page.</p>
<figure id="highlevel-sd-unmanaged">
<figcaption>Figure #-####: IPTV Service Discovery for unmanaged networks</figcaption>
<img src="images/unmanaged-sd-highlevel.png" alt="figure 6-4" style="width:90%"/>
</figure>
</section>
<section id="s6-2-1-5"><h4>IPTV Service Access</h4>
<p>The following figure shows the call flow for obtaining the Content Guide, which is an example of IPTV service access.</p>
<figure id="highlevel-sa-unmanaged">
<figcaption>Figure #-####: IPTV Service Access for unmanaged networks</figcaption>
<img src="images/unmanaged-sa-highlevel.png" alt="figure 6-5" style="width:90%"/>
</figure>
</section>
</section>
<section><h3>IPTV Service Discovery and IPTV Service Access Procedures for the Managed Model</h3>
<p>This section describes the IPTV Service Discovery and Service Access procedures for managed networks. As described in section <a href="#s5-3" class="sectionRef">5.3</a>, the minimum set of functional entities needed to access the managed IPTV services are the OITF, the IG and the WAN Gateway; moreover, the AG can be introduced as an optional functional entity in some deployment options. </p>
<p>The IPTV Service Discovery and Service Access procedures are shown hereafter, starting from a high-level procedure description and then detailing two cases based on two different deployment options. Section <a href="#s6-2-2-2" class="sectionRef">6.2.2.2</a> shows the case where just the IG is deployed, while section <a href="#s6-2-2-3" class="sectionRef">6.2.2.3</a> describes the case where the AG is also deployed together with the IG.</p>
<p>Although the flows depicted in this section explicitly show the HNI-IGI based communication between the OITF and IG, it must be noted that in the case where a device implements both the OITF and IG, this type of communication may not be required. </p>

<section><h4>High Level Procedure</h4>
<figure id="highlevel-sdns-managed">
<figcaption>Figure #-####: High level steps for Service Discovery and Service Access for managed networks</figcaption>
<img src="images/managed-sdns-highlevel.png" alt="figure 6-6" style="width:90%"/>
</figure>
<p>The managed network Service Provider Discovery comprises a number of steps as shown in Figure <a href="#highlevel-sdns-managed" class="figureRef">6-6</a>:</p><table class="sequence">
<tr><td>0.</td><td>Attachment to the Service Platform provider (SPP)</td></tr>
<tr><td>1.</td><td>Discovery of the IG. The OITF is turned on and obtains the entry point for the IPTV Service Provider Discovery from the IG. The determination of the IPTV Service Provider Discovery entry points can be achieved in a number of ways e.g. pre-configuration of the IG or using a specific event package, the service provider discovery request can be forwarded to the appropriate Service Provider Discovery FE.</td></tr>
<tr><td>2.</td><td>Registration with the SPP (IMS Registration)</td></tr>
<tr><td>3.</td><td>GBA bootstrapping procedure</td></tr>
<tr><td>4a.</td><td>IPTV Service Provider Discovery:  The OITF initiates the IPTV Service Provider Discovery. The Service Provider Discovery FE provides the list of IPTV Service Providers and information used for the next step (e.g. IPTV Service Providers' name, IP address, protocols to be used).</td></tr>
<tr><td>4b.</td><td>IPTV Service Discovery: The OITF initiates the IPTV Service Discovery. In this step, the OITF selects an IPTV Service Provider and obtains from the Service Discovery FE the list of services available from that specific IPTV Service Provider.
<tr><td>5.</td><td>The OITF can select and access an IPTV service, e.g., access the Content Guide, via metadata or a web page. </td></tr>
</table>
<p>In the case where there is a 1-to-1 relationship between the Service Platform Provider and the IPTV Service Provider, the Service Provider Discovery phase will return a single record; therefore, in such a deployment, the subscriber would not select the service provider and the initial response to Service Provider discovery could return the address of the Service Discovery functional entity.</p>
</section>
<section id="s6-2-2-2"><h4>IPTV Service Discovery and Service Access for Residential networks with an IG</h4>
<section><h5>High Level Step 4a &mdash; IPTV Service Provider Discovery</h5>
<figure id="highlevel-spd-managed">
<figcaption>Figure #-####: IPTV Service Provider Discovery for a managed network</figcaption>
<img src="images/managed-spd-highlevel.png" alt="figure 6-7" style="width:90%"/>
</figure>
<p>The call flow in Figure <a href="#highlevel-spd-managed" class="figureRef">6-7</a> shows the case where the OITF requests, via the IG and the ASM, information about the available IPTV Service Providers from the Service Provider Discovery FE</p>
<p>Assumptions for this signal flow are that: </p><ul>
<li>The IG is registered with the SPP.
<li>The SPP has configured the IG. 
<li>The IG knows the service URI of the IPTV Service Provider Discovery FE. This FE's service URI as well as the protocol to use to access it may be well known within the SPP domain.</ul>
<p>In signals 2-7 the IG obtains a list of IPTV Service Providers available via the SPP. The result of this phase (step 10) is the retrieval of the list of IPTV Service Providers and related information (e.g. the IPTV Service Providers' name, IPTV SPs SD Service-URI (address of IPTV Service Discovery entity), protocol to be used for Service Discovery).</p>
<p>It is recommended that a well known Public Service Identifier (PSI) is assigned for the IPTV Service Provider Discovery functional entity. This well known PSI, which is a SIP URI, simplifies the remote configuration of IGs and allows IMS routing to be fully exploited.</p>
<p>The User Database is configured with the originating filter criteria necessary to route the SIP SUBSCRIBE messages from authorized users to the correct FE.  In order to ensure that unauthorized users do not get access to the Service Provider Discovery FE, the PSI should not be configured in the DNS of the Service Platform Provider. </p>
<p>HTTP can optionally be used in this signal flow.</p>
</section>
<section id="s6-2-2-2-2"><h5>High Level Step 4b &mdash; IPTV Service Discovery </h5>
<p>This procedure can be performed via the use of HTTP (case 1), or IGMP/multicast (case 2), depending on the &ldquo;protocol to be used for Service Discovery&rdquo; info obtained in High Level step 4a (see Figure <a href="#highlevel-spd-managed" class="figureRef">6-7</a>). </p>
<p class="inline-header">IPTV Service Discovery &mdash; Case 1 &mdash; Using HTTP</p>
<figure id="highlevel-sd-case1-managed">
<figcaption>Figure #-####: HTTP-based IPTV Service Discovery</figcaption>
<img src="images/managed-sd-case1-highlevel.png" alt="figure 6-8" style="width:90%"/>
</figure>
<p>The IPTV Service Discovery address is obtained in the high level step 4a shown in Figure <a href="#highlevel-sdns-managed" class="figureRef">6-6</a>.</p>
<p>In the flow shown in Figure <a href="#highlevel-sd-case1-managed" class="figureRef">6-8</a>, the OITF receives the address from where it can obtain the Content Guide as well the protocol to be used (via multicast or unicast).</p>
<p>The Service Discovery Record can be delivered to the OITF as XML data (for the metadata client) or a Web Page (for the DAE).</p>
<p class="inline-header">IPTV Service Discovery &mdash; Case 2 &mdash; Using IGMP multicast</p>
<figure id="highlevel-sd-case2-managed">
<figcaption>Figure #-####: Multicast-based IPTV Service Discovery</figcaption>
<img src="images/managed-sd-case2-highlevel.png" alt="figure 6-9" style="width:90%"/>
</figure>
<p>The IPTV Service Discovery multicast address is obtained in the high level step 4a shown in Figure <a href="#highlevel-sdns-managed" class="figureRef">6-6</a>.</p>
<p>In the flow shown in Figure <a href="#highlevel-sd-case2-managed" class="figureRef">6-9</a>, the OITF joins the appropriate address using IGMP to obtain the IPTV service discovery information as XML data (for the metadata client).</p>
</section>
<section><h5>High Level Step 5 &mdash; IPTV Service Access - Obtaining the Content Guide</h5>
<figure id="highlevel-sa-managed">
<figcaption>Figure #-####: Access to Content Guide</figcaption>
<img src="images/managed-sa-highlevel.png" alt="figure 6-10" style="width:90%"/>
</figure>
<p>Three possible flows are shown in Figure <a href="#highlevel-sa-managed" class="figureRef">6-10</a>:</p><ul>
<li>Metadata based Content Guide delivered via multicast.
<li>Metadata based Content Guide delivered via unicast.
<li>Content Guide delivered via unicast in data formats supported by the DAE (e.g., HTML Web Page).</ul>
</section>
</section>
<section id="s6-2-2-3"><h4>IPTV Service Discovery and Service Access for Residential Networks with an IG and an AG</h4>
<section><h5>High Level Step 4a &mdash; IPTV Service Provider Discovery</h5>
<figure id="highlevel-spd-residential">
<figcaption>Figure #-####: Steps in Service Provider Discovery for a residential network with an AG and an IG</figcaption>
<img src="images/residential-spd-highlevel.png" alt="figure 6-11" style="width:90%"/>
</figure>
<p>The call flow in Figure <a href="#highlevel-spd-residential" class="figureRef">6-11</a> is very similar to the IG-only case. The only difference is that the AG intercepts the data, generates a web page and sends its address (URL) to the OITF for retrieval.</p>
<p>The assumptions for this signal flow are that:</p><ul>
<li>The IG is registered with the SPP.
<li>The SPP has configured the AG+IG. 
<li>The AG+IG knows the Service-URI of the IPTV Service Provider Discovery FE. This FE's service-URI as well as the protocol to use to access it may be well known within the SPP domain.
</ul>
<p>In signals 2-7, the AG+IG obtains a list of IPTV Service Providers available at the SPP and converts this information into a suitable format, among those supported by the DAE. This conversion can be required, for example, to change the look & feel of the page listing the Service Providers.</p>
<p>Note that Service Provider Discovery info can be delivered as XML data (for the metadata client) or data formats supported by the DAE (e.g., HTML web page).</p>
<p>Analogous to the case where only the IG is deployed, it is recommended that a well known Public Service Identifier (PSI) is assigned for the IPTV Service Provider Discovery functional entity. This well known PSI, which is a SIP URI, simplifies the remote configuration of IGs, and allows IMS routing to be fully exploited.</p>
<p>The User Database is configured with the originating filter criteria necessary to route the SIP SUBSCRIBE messages from authorized users to the correct FE.  In order to ensure that unauthorized users do not get access to the Service Provider Discovery FE, the PSI is should not be configured in the DNS of the Service Platform Provider.</p>
<p>HTTP can be optionally be used in this signal flow.</p>
</section>
<section><h5>High Level Step 4b &mdash; IPTV Service Discovery </h5>
<p>This procedure can be performed via the use of the IMS either HTTP, or IGMP/multicast, depending on the &ldquo;protocol to be used for Service Discovery&rdquo; information obtained in step 4a of the high level procedures (see Figure <a href="#highlevel-spd-managed" class="figureRef">6-7</a>). For the sake of simplicity, no call flows are shown here as the other cases are very similar to those described in section <a href="#s6-2-2-2-2" class="sectionRef">6.2.2.2.2</a>.</p>
</section>
<section><h5>High Level Step 5 &mdash; IPTV Service Access</h5>
<figure id="highlevel-sa-residential">
<figcaption>Figure #-####: Steps for Service Access in a residential network with an AG and an IG</figcaption>
<img src="images/residential-sa-highlevel.png" alt="figure 6-12" style="width:90%"/>
</figure>
<p>Figure <a href="#highlevel-sa-residential" class="figureRef">6-12</a> shows XML data for creating the Content Guide (CG) being retrieved using HTTP. </p>
</section>
</section>
</section>
<section><h3>Consolidated service discovery of managed and unmanaged services</h3>
<p>For an OITF connected to a managed network, the OITF may present a consolidated view of the services discovered from the managed network, and also whatever is available from the default service discovery mechanisms for unmanaged network based SPs. At this point, if the user is allowed to enter preferences regarding the first screen, this will be seen when the OITF is powered on the next time.</p>
</section>
</section>
<section><h2>User Identification and Authentication</h2>
<p>For IPTV services that require service access authorization, the user is identified and authenticated by means of some pre established credentials (such as user name and password, or IMS Private Identity [[!Ref-15]] and corresponding long-term secret key). This section provides high-level message flows for user identification and authentication &mdash; for the case of unmanaged as well as managed networks.</p>
<p>For managed networks, the following user authentication methods shall be supported: IMS AKA and SIP Digest [[!Ref-18]]. HTTP Digest (RFC 2617) [[!Ref-16]] and SSL/TLS [[!Ref-35]] shall be supported for the case of the unmanaged network model. </p>
<p>For Single Sign-on, 3GPP's Generic Bootstrapping Architecture (GBA) (3GPP TS 33.220) [[!Ref-25]] shall be supported for managed networks, and SAML web browser-based SSO authentication [[!Ref-50]] shall be supported for unmanaged networks. The Single Sign-on mechanisms provided by the Generic Bootstrapping Architecture may also be applicable for the unmanaged network model when UICC-based IMS authentication capability is available in the home.</p>

<section><h3>Unmanaged Networks</h3>
<p>For unmanaged networks, the solution should use HTTP Digest Authentication [RFC 2617] [[!Ref-16]] in order to identify and authorize users for IPTV service access. The HTTP Digest Authentication scheme improves the HTTP Basic Authentication method by transmitting cryptographic hashes of passwords and other relevant data instead of transferring passwords from clients to servers as clear text. Figure <a href="#unmanaged-httpdigest" class="figureRef">6-13</a> depicts the call flow for HTTP Digest Authentication between the relevant functional entities.</p>
<figure id="unmanaged-httpdigest">
<figcaption>Figure #-####: Identification and Authentication using HTTP Digest in the case of unmanaged networks</figcaption>
<img src="images/unmanaged-http-digest.png" alt="figure 6-13" style="width:90%"/>
</figure>
<p>The following is a description of the various messages:</p><table class="sequence">
<tr><td>1.</td><td>OITF to SAA: HTTP GET<br />
The OITF sends an HTTP GET request to the Service Access Authentication (SAA) function. This request indicates the resource desired by the OITF (e.g., &lt;resource&gt; = /supercoolvideos.html) and the name of the server hosting the desired resource (e.g., &lt;server name=www.coolvideos.com).</td></tr>
<tr><td>2.</td><td>SAA to OITF: HTTP 401 Unauthorized<br />
Since access to the requested resource is protected, the SAA sends an HTTP 401 Unauthorized response to the OITF. This message contains a WWW-Authenticate header field which indicates that the OITF has to authenticate using the HTTP Digest method. To this end, this response message also includes a random value called nonce and the realm to which the requested resource belongs (e.g., &lt;realm&gt; = supercoolvideos@coolvideos.com). The Quality of Protection (qop) parameter is optional but if included by the HTTP Server, not only the OITF can be authenticated by the SAA but also vice versa (see step 3 and 4).</td></tr>
<tr><td>3.</td><td>OITF to SAA: HTTP GET<br />
The OITF resends the HTTP GET request to SAA, this time also including an Authorization header field in order to get authenticated by SAA. This header fields contains a user name valid for the realm in question and the response digest that the OITF has calculated based on input of the user name, corresponding password, realm and other data. If the HTTP 401 message in step 2 contained a qop parameter, the OITF challenges the SAA function for authentication by including a client nonce (cnonce). On reception of this HTTP GET message, the SAA compares the response value received from the OITF to the expected response value. (The SAA function obtains, at least partly, this expected response value from the User Database. The interface between the HTTP Server (SAA) and the User Database are out of scope of the Open IPTV Forum specifications.) </td></tr>
<tr><td>4.</td><td>SAA to OITF: HTTP 200 OK<br />
If the response value received from the OITF equals the expected response value (successful case), the SAA sends an HTTP 200 OK response to the OITF containing Authentication-Info header. The OITF can later on use the information in this header to send the HTTP GET request with an Authorization header including this value to authenticate the OITF and gain IPTV service access. In case the SAA included a qop parameter in message 2, this HTTP 200 OK message also contains a response auth digest value (rspauth) calculated using the cnonce value sent to the SAA in step 3. This rspauth value enables the OITF to authenticate the SAA. </td></tr>
</table>
</section>
<section><h3>Managed Networks</h3>
<p>In the managed network case, user identification and authentication is based on either the 3GPP IMS Authentication and Key Agreement (AKA) or on SIP Digest [[!Ref-18]].</p>
<p>User authentication occurs during IMS Registration, which occurs either when:</p><ol type="a">
<li>The IG is powered up, or
<li>The end user explicitly logs on for personalized services</ol>
<section id="s6-3-2-1"><h4>IMS AKA</h4>
<p>To support IMS AKA, a UICC with an ISIM or USIM application must be integrated into the IMS Gateway (IG). From the IMS point of view, the IG thereby takes the role of an IMS Subscriber. The UICC stores a long-term secret key K which is shared between the ISIM or USIM application and a User Database belonging to the network operator that provides the ISIM or the USIM. The following figure shows the high-level message flows for user identification and authentication based on the IMS AKA procedure:</p>
<figure id="managed-ims-aka">
<figcaption>Figure #-####: Identification and Authentication using IMS AKA in the managed case</figcaption>
<img src="images/managed-ims-aka.png" alt="figure 6-14" style="width:90%"/>
</figure>
<p>The following is a description of the message flows shown in Figure <a href="#managed-ims-aka" class="figureRef">6-14</a>:
<table class="sequence">
<tr><td>1.</td><td>OITF to IG: Registration Request
The OITF sends a request for registration to the IMS Gateway (IG), when needed (case b. The end user explicitly logs on for personalized services)</td></tr>
<tr><td>2.</td><td>IG to ASM: SIP REGISTER<br />
This request contains the domain name of the Service Platform Provider (SPP) network as read from the ISIM (referred to as the Home Network Domain Name in the ISIM), the private and public IMS identities &lt;IMPI&gt; and &lt;IMPU&gt; of the IG, as well as IG's IP address (obtained prior to IMS AKA). Besides the IP address, all these data are read from the ISIM.</td></tr>
<tr><td>3.</td><td>ASM to User Database: DIAMETER MULTIMEDIA AUTH REQUEST (MAR)<br />
ASM requests authentication data from the User Database with respect to the IMS subscriber (IG) identified by &lt;IMPI&gt;.</td></tr>
<tr><td>4.</td><td>User Database to ASM: DIAMETER MULTIMEDIA AUTH ANSWER (MAA)<br />
The User Database sends an Authentication Vectors (AV) to the ASM containing the following data: random challenge RAND, answer XRES expected by the IG in step 6, network authentication token AUTN, integrity key IK, and ciphering key CK. The authentication token AUTN contains a message authentication code (MAC) enabling the IG to authenticate the SPP network (see step 5).</td></tr>
<tr><td>5.</td><td>ASM to IG: SIP 401 Unauthorized<br />
At this point in time, the ASM denies the IG authentication. Instead, it sends a SIP Unauthorized message with a WWW-Authenticate header to the IG. This header contains RAND and AUTN. After reception of this message, the IG verifies the message authentication code contained in AUTN thereby authenticating its SPP network. </td></tr>
<tr><td>6.</td><td>IG to ASM: SIP REGISTER<br />
ISIM computes the value RES on input of its version of the secret key K stored on the UICC of the IG. The IG sends a new SIP REGISTER request to the ASM, this time with RES as response to the challenge the ASM initiated in step 5.</td></tr>
<tr><td>7.</td><td>ASM to IG: SIP 200 OK <br />
If RES = XRES (successful case), ASM considers the IG as authenticated, and binds &lt;IMPU&gt; to the IP address &lt;IP address&gt;.</td></tr>
<tr><td>8.</td><td>IG to OITF: Registration Response<br />
The IG informs the OITF about the result of the registration procedure. (when step 1 is needed) 
In case of success, the ISIM of the IG is able, based on its knowledge of the secret key K and the authentication token AUTN, to calculate the same values of the integrity key IK and the ciphering key CK as those that the ASM received in step 4 from the User Database. The IG and the ASM use IK and CK to establish IPSec Security Associations for protecting SIP signalling messages over the IG &mdash; ASM reference point.</td></tr>
</table>
</section>
<section id="s6-3-2-2"><h4>SIP Digest</h4>
<p>SIP Digest follows the 3GPP TS 24.229 specification [[!Ref-18]].</p>
</section>
</section>
<section><h3>Usage for GBA in the Unmanaged Model</h3>
<p>In case where IMS-based authentication capability is supported and available in the home, the GBA Single Sign-on procedure can be used when accessing IPTV Application Servers that trust these IMS-based user credentials for service access. The unmanaged model shall use the same mechanism deployed in the managed model with regard to the usage of GBA. This applies in both the residential network and the SPP network.</p>
</section>
</section>
<section><h2>Unicast Session</h2>
<p>There are a number of IPTV services that use unicast delivery for all or part of their content delivery, such as:</p><ul>
<li>CoD, Content on Demand: End users can order videos through a CoD catalogue and have them streamed directly to the ITF
<li>nPVR, Network-based Personal Video Recorder: Allows recording of programs on the network side, which are delivered as a unicast stream when played back. 
<li>Time Shifting: This allows the end user to pause, rewind and fast forward to the current position a Scheduled Content program. At the pause request, the network starts recording the session so that subsequent user actions (e.g., play, rewind) results in a unicast nPVR session.</ul>
<section id="s6-4-1"><h3>Unicast Session Setup (managed model)</h3>
<p>Figure <a href="#unicast-session-setup-managed" class="figureRef">6-15</a> shows a high level call flow for a unicast session setup based on the above descriptions. The unicast session setup procedure includes the following three call flows:</p><ul> 
<li>Service Session setup. 
<li>Secure Channel setup for the Content Delivery Session (optional).
<li>Content Delivery and Control.</ul>
<p>Each of the above call flows will be described in separate sub-sections.</p>
<figure id="unicast-session-setup-managed">
<figcaption>Figure #-####: Overall Description of the call flows</figcaption>
<img src="images/unicast-session-setup-managed.png" alt="figure 6-15" style="width:90%"/>
</figure>
<section id="s6-4-1-1"><h4>Service Session Setup Description</h4>
<p>The Service Session establishment in the managed network model involves the OITF, the IG, the IPTV Control, the CDNC, the &ldquo;Authentication and Session Management (ASM)&rdquo; and the &ldquo;Resource and Admission Control (RAC)&rdquo; functional entities.</p>
<figure id="unicast-service-session-setup-managed">
<figcaption>Figure #-####: Service Session Setup Call Flow</figcaption>
<img src="images/unicast-service-session-setup-managed.png" alt="figure 6-16" style="width:90%"/>
</figure>
<p>The following is a description of the interactions in the call flow shown in Figure <a href="#unicast-service-session-setup-managed" class="figureRef">6-16</a>:</p>
<table class="sequence">
<tr><td>1.</td><td>The sequence is triggered by an action from the user. The user requests content from the CoD catalogue, or selects some content stored in an nPVR, which results in a unicast session. </td></tr>
<tr><td></td><td>The OITF acquires all the necessary information about the selected content that allows it to make an SDP offer. The SDP offer must include the IP address and port of the OITF, which is the destination address of the stream for the selected content.</td></tr>
<tr><td>2.</td><td>The OITF sends an HTTP session setup request to the IG. The request includes the selected content id and the corresponding SDP offer.
<tr><td>3.</td><td>The IG sends a Service session setup request (SIP INVITE) to the ASM in the IMS core network.
<tr><td></td><td>The ASM uses the services of the &ldquo;Resource and Admission Control&rdquo; functional entity to perform resource reservation.</td></tr>
<tr><td>4.</td><td>The ASM forwards the request to the IPTV Control functional entity.
<tr><td></td><td>The IPTV Control authorizes the request based on the IPTV User Profile. The IPTV Control selects the appropriate CDN Controller.  Optionally, the IPTV Control interacts with another functional entity that performs that task.</td></tr>
<tr><td>5.</td><td>The IPTV Control forwards the request to the ASM for routing to the selected CDN Controller.
<tr><td>6.</td><td>The ASM routes the request to the target Content Delivery Network Controller. The CDN Controller locates the appropriate Cluster Controller that can service the request. 
<tr><td>7.</td><td>The Content Delivery Network Controller forwards the Service session setup request to the chosen Cluster Controller 
<tr><td></td><td>The Cluster Controller analyses the Service session setup request in order to choose the appropriate Content Delivery Function (CDF) based on its status, options and load (e.g. number of outgoing streams). Please refer to Annex C for more information about CDNC/CC/CDF selection.</td></tr>
<tr><td></td><td>The Cluster Controller then sets up the content delivery session (RTSP session) for the requested content, and establishes a binding between the service session and the corresponding content delivery session. </td></tr>
<tr><td>8-11.</td><td>The content delivery session identification is returned, through the Service session setup response, back to the ASM. 
<tr><td></td><td>The &ldquo;Authentication and Session Management&rdquo; FE instructs the &ldquo;Resource and Admission Control&rdquo; FE to commit the reserved resources.</td></tr>
<tr><td>12.</td><td>The ASM forwards the Service session setup response to the IG
<tr><td>13.</td><td>The IG sends an HTTP response to the OITF that includes the content delivery session identifier (RTSP session ID), and all relevant information to allow the OITF and the user to start viewing.
</table>
</section>
<section id="s6-4-1-2"><h4>Securing Content Delivery Session Signalling (optional)</h4>
<p>As shown in the HLA in Figure <a href="#high-level-architecture" class="figureRef">5-2</a>, a secure channel can be optionally established between the OITF and the Cluster Controller prior to any exchange of signalling messages. In particular, this allows the Cluster Controller and the OITF to mutually authenticate each other. This is particularly critical in environments where direct communication without such a secure authenticated channel is not desirable because of potential security risks. </p>
<p>Note that the secure channel can be torn down when there is no signalling to be exchanged between the OITF and the Cluster Controller. Thus, the secure channel can be set up on demand.  </p>
<p>Figure <a href="#securing-content-delivery-signalling" class="figureRef">6-17</a> depicts the actual call flow over such a secure tunnel.</p>
<figure id="securing-content-delivery-signalling">
<figcaption>Figure #-####: Securing the Content Delivery Signalling</figcaption>
<img src="images/securing-content-delivery-signalling.png" alt="figure 6-17" style="width:90%"/>
</figure>
<p>The steps in this call flow are as follows.</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF establishes a TLS channel with the selected CC to serve the user.  Server authentication is performed by the OITF in this step.</td></tr>
<tr><td>2.</td><td>The OITF starts streaming control to start viewing the selected content.</td></tr>
<tr><td></td><td>The CC needs to authenticate the OITF before it proxies the message to the CDF.</td></tr>
<tr><td>3.</td><td>Once mutual authentication is successfully completed, the CC proxies the start stream control message to the CDF.</td></tr>
<tr><td>4-5.</td><td>The successful response from the Content Delivery functional entity is proxied all the way to the OITF.</td></tr>
<tr><td>6.</td><td>Following that, the media streaming starts.</td></tr>
</table>
</section>
<section id="s6-4-1-3"><h4>Content Delivery</h4>
<p>After the service and content delivery sessions are setup, as explained in section <a href="#s6-4-1-1" class="figureRef">6.4.1.1</a>, the OITF uses the content delivery session ID to stream and control the content received from the CDF. A logical binding exists between the service session and the content delivery session. The binding is maintained by the CC, as well as the IPTV Control FE.</p>
<p>The steps in this call flow depicted in Figure <a href="#content-delivery-streaming-control" class="figureRef">6-18</a> are as follows.</p><ul>
<li>Stream Control requests generated by the OITF are targeted to the CC. The CC proxies those requests to the appropriate Content Delivery Function. 
<li>The Content Delivery Function streams the media directly to the OITF.</ul>
<figure id="content-delivery-streaming-control">
<figcaption>Figure #-####: Content Delivery Streaming Control</figcaption>
<img src="images/content-delivery-streaming-control.png" alt="figure 6-18" style="width:90%"/>
</figure>
</section>
</section>
<section id="s6-4-2"><h3>Unicast Session Modification (managed model)</h3>
<p>There are a number of use cases that can lead to the need for session modification. Examples include the need to receive a second stream for &ldquo;picture-in-picture&rdquo;, or simply to view a second channel in a side-by-side window with the original stream.  These features depend on the capabilities of the rendering device. The implication of the above is that there can potentially be a 1:N relationship between a service session and the content delivery session. </p>
<p>Session modification can be initiated from the OITF or from the network side.  The subsequent call flows show examples of both cases.  </p>
<p>It is also important to note that modifying an existing session to include an additional stream is one option, while creating a new unicast session to carry that additional stream is another. Operator policies as well as client design can play a role here.</p>
<section><h4>OITF-initiated session modification call flow </h4>
<p>Figure <a href="#oitf-initiated-unicast-session-modification" class="figureRef">6-19</a> shows a typical call flow for the modification of an existing unicast session to add a new stream. Terminal capabilities must support such a feature in the first place.</p>
<p>It is assumed, that a Service Session and its associated Content Delivery Session(s) have been established prior to any modifications.</p>
<figure id="oitf-initiated-unicast-session-modification">
<figcaption>Figure #-####: OITF-initiated Unicast Session Modification</figcaption>
<img src="images/oitf-initiated-unicast-session-modification.png" alt="figure 6-19" style="width:90%"/>
</figure>
<p>Below is a brief description of the steps that occur in this process:</p>
<table class="sequence">
<tr><td>1.</td><td>The sequence is triggered by an action from the user. The user requests something from the CoD catalogue or selects some content stored in an nPVR. The user can optionally select a new Service Session to be setup for viewing that content or he can reuse an existing Service Session. </td></tr>
<tr><td></td><td>The OITF acquires all the necessary information about the selected content that allows it to make to make an SDP offer. The SDP offer must include the IP address and port of the OITF, which is the destination address of the stream.</td></tr>
<tr><td>2.</td><td>The OITF sends an HTTP session modify request to the IG. The request includes the selected content id, the corresponding SDP offer, and the service session id to be used for that session.</td></tr>
<tr><td>3.</td><td>The IG sends a Service Modify request (SIP Re-INVITE) to the ASM in the IMS core network.</td></tr>
<tr><td></td><td>The ASM uses the services of the &ldquo;Resource and Admission Control&rdquo; functional entity to perform resource reservation.</td></tr>
<tr><td>4.</td><td>The ASM forwards the request to the IPTV Control functional entity.</td></tr>
<tr><td></td><td>The IPTV Control FE authorizes the request based on the IPTV User Profile. The IPTV Control FE selects the appropriate CDN controller.  Optionally the IPTV Control FE interacts with another functional entity that performs that task.</td></tr>
<tr><td>5.</td><td>The IPTV Control FE forwards the request to the ASM for routing to the selected CDN Controller. </td></tr>
<tr><td>6.</td><td>The ASM routes the request to the target Content Delivery Network Controller. The CDN Controller locates the appropriate CC that can service the request. </td></tr>
<tr><td>7.</td><td>The Content Delivery Network Controller forwards the Service modify request to the chosen Cluster Controller. </td></tr>
<tr><td></td><td>The Cluster Controller analyses the Service modify request in order to choose the appropriate Content Delivery Function based on its status, options and load (e.g. number of outgoing streams). Please refer to Appendix C more information about CDNC/CC/CDF selection.</td></tr>
<tr><td></td><td>The Cluster Controller then sets up the content delivery session (RTSP session) for the requested content, and establishes a binding between the Service Session and the corresponding Content Delivery Session. </td></tr>
<tr><td>8-11.</td><td>The Content Delivery Session identification is returned through the Service modify response, back to the ASM. </td></tr>
<tr><td></td><td>The &ldquo;Authentication and Session Management&rdquo; instructs the &ldquo;Resource and Admission Control&rdquo; to commit the reserved resources.</td></tr>
<tr><td>12.</td><td>The ASM forwards the Service modify response to the IG.</td></tr>
<tr><td>13.</td><td>The IG sends an HTTP response to the OITF that includes the Content Delivery Session identifier (RTSP session ID), and all relevant information to allow the OITF and the user to start viewing.</td></tr>
</table>
</section>
<section><h4>Server Initiated Unicast Session</h4>
<p>Figure <a href="#network-initiated-unicast-session-modification" class="figureRef">6-20</a> shows a typical call flow for a new unicast session generated from the network towards a registered user. Below is a brief description of the steps that occur in this process.</p>
<p>The sequence is triggered by an action from a network server.  For example, the server may have learnt somehow that a user is registered and decided to send an advertisement to the target user. (Note that the use of an advertising server in Figure <a href="#network-initiated-unicast-session-modification" class="figureRef">6-20</a> is purely for use in illustrating a network-initiated session modification, and is not intended to show how advertising will work.)</p>
<figure id="network-initiated-unicast-session-modification">
<figcaption>Figure #-####: Network initiated unicast session modification</figcaption>
<img src="images/network-initiated-unicast-session-modification.png" alt="figure 6-20" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>The advertising server (or any other network server) sends a Service session setup request to the Authentication and Session Management functional entity.</td></tr>
<tr><td>2.</td><td>The Authentication and Session Management functional entity, based on the Subscription profile, forwards the request to the IPTV Control for further processing. </td></tr>
<tr><td>3.</td><td>The IPTV Control has the option, based on operator policy, to either initiate a completely new session for the user or modify an existing unicast session for that user. The IPTV Control functional entity is always in the signalling path and retains state information for all ongoing unicast sessions. In this example, the IPTV Control functional entity decides to initiate a new unicast session for the target user. Hence, it initiates a Service session setup request to the ASM.</td></tr>
<tr><td>4-5.</td><td>The Authentication and Session Management functional entity performs admission control for the new session. This step is optional for the managed model.</td></tr>
<tr><td>6.</td><td>The ASM forwards the Service session setup request to the IG.</td></tr>
<tr><td></td><td>The IG performs the necessary RUI procedures to notify the OITF of an incoming session.</td></tr>
<tr><td>7.</td><td>The OITF sends an HTTP POST to the IG to indicate its acceptance of the incoming session.</td></tr>
<tr><td>8.</td><td>The IG sends a Service session setup response back to the ASM.</td></tr>
<tr><td>9-10.</td><td>The ASM commits the reserved resources for the new session. This step is optional for a managed network.</td></tr>
<tr><td>11-13.</td><td>The Service session setup response is forwarded all the way to the network server that initiated the session.</td></tr>
<tr><td>14-17.</td><td>The network acknowledges the receipt of the response. This gets forwarded all the way to the IG.</td></tr>
<tr><td>18.</td><td>The IG sends an HTTP response to the OITF.</td></tr>
</table>
</section>
</section>
<section id="s6-4-3"><h3>Session Teardown (managed model)</h3>
<p>Figure <a href="#service-session-teardown" class="figureRef">6-21</a> shows a typical call flow for a unicast session tear down.</p>
<figure id="service-session-teardown">
<figcaption>Figure #-####: Service Session tear down call flow</figcaption>
<img src="images/service-session-teardown.png" alt="figure 6-21" style="width:90%"/>
</figure>
<p>It is assumed that a Service Session and one or more associated Content Delivery sessions are ongoing before teardown can occur.</p>
<p>The following is a brief description of the steps that occur in this process:</p>
<p>The sequence is triggered by an action from the user, which results in the OITF requesting the termination of an ongoing unicast session which may or may not have an ongoing live stream.</p>
<table class="sequence">
<tr><td>1.</td><td>The end user requests the termination of an ongoing unicast service session.</td></tr>
<tr><td>2.</td><td>The OITF sends an HTTP teardown request to the IG. The request includes the service session id. </td></tr>
<tr><td>3.</td><td>The IG sends a session tear down request to the Authentication and Session Management functional entity. </td></tr>
<tr><td>4.</td><td>The request is forwarded to the IPTV Control functional entity.</td></tr>
<tr><td>5.</td><td>The IPTV Control uses the Authentication & Session Management to route the request to the appropriate CDNC functional entity that should be contacted to handle that request. </td></tr>
<tr><td></td><td>Note that steps 5-10 are repeated for each content delivery session associated with the service session.</td></tr>
<tr><td>6.</td><td>The Authentication & Session Management functional entity forwards the request to the target CDNC functional entity.</td></tr>
<tr><td>7.</td><td>The CDNC locates the appropriate CC.</td></tr>
<tr><td></td><td>The target Cluster Controller function locates the Content Delivery Function for the content delivery session, and sends a request to terminate the streaming session.</td></tr>
<tr><td>8.</td><td>The Content Delivery Function responds successfully to the Session teardown request. </td></tr> 
<tr><td>9-11.</td><td>The Session teardown response is proxied all the way to the Authentication and Session Management functional entity.</td></tr>
<tr><td></td><td>The Authentication & Session Management functional entity requests the release of the resources allocated to the unicast session by communicating with the Resource and Admission Control functional entity.</td></tr>
<tr><td>12.</td><td>The Authentication & Session Management functional entity forwards the Session teardown response to the IG.</td></tr>
<tr><td>13.</td><td>The IG sends an HTTP response back to the OITF.</td></tr>
</table>
</section>
<section><h3>Unicast Session Management (unmanaged model)</h3>
<p>Unicast session management for media streaming in an unmanaged network model differs from the managed network in that no resource management is performed in the network. This means there is no interactive management of the session &mdash; a new content delivery session is created for each unicast stream. This requires setup at the ITF and the content delivery function, but not in the network itself.</p>
<section><h4>Access to Service Providers over unmanaged networks</h4>
<p>This call flow is equivalent to the content guide retrieval described in section <a href="#s6-2-1-5" class="sectionRef">6.2.1.5</a>.</p>
</section>
<section id="s6-4-4-2"><h4>Purchase of content from Service Providers over unmanaged networks</h4>
<p>The call flow in Figure <a href="#unmanaged-content-purchase" class="figureRef">6-22</a> shows the steps used to purchase service or content from an IPTV Service Provider accessed over an unmanaged network.</p>
<figure id="unmanaged-content-purchase">
<figcaption>Figure #-####: Call flow for purchase of content from an IPTV Service Provider over unmanaged networks</figcaption>
<img src="images/unmanaged-content-purchase.png" alt="figure 6-22" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps involved in the process.</p>
<table class="sequence">
<tr><td>1.</td><td>Shows the OITF sending a HTTP GET or POST request to the IPTV Application, to acquire an XHTML page which contains the list of content. [Note: Signal 1 could be substituted by the request to the Metadata Control FE for XML based metadata, to be used by the Metadata-based CG client in the OITF for presentation of a Content Guide to the user].</td></tr>
<tr><td>2-3.</td><td>Involves the IPTV Application retrieving the IPTV User Profile from the IPTV Service Profile functional entity, to customize the HTML page according to the user's profile. These steps are optional.</td></tr>
<tr><td>4.</td><td>Carries a response back to the OITF including the XHTML page which contains the list of content. [Note: Signal 4 could be substituted by the response carrying XML metadata from the Metadata Control FE, to be used by the Metadata-based CG client on OITF for presentation of a Content Guide to the user].</td></tr>
<tr><td>5.</td><td>Shows the OITF sending a HTTP GET or POST request to the IPTV Application, to request the purchase of a specific service or content which the user has selected. </td></tr>
<tr><td>6-7.</td><td>Shows the IPTV Application retrieving the IPTV User Profile from the IPTV Service Profile function to process the purchase request based on data in the user's profile. These steps are optional.</td></tr>
<tr><td>8.</td><td>Carries a response back to the OITF including the XHTML page which contains the result of the purchase request. The actual processing of the purchase request is done before this step, but the exact method is not defined (and is specific to the service provider). This page could also include links for the content acquisition, or an automatic redirection to the content acquisition function.</td></tr>
</table>
</section>
<section><h4>Unmanaged content delivery management</h4>
<p>The call flow in Figure <a href="#unmanaged-unicast-session-management" class="figureRef">6-23</a> shows the steps used to manage a unicast session in the case of an unmanaged network.</p>
<figure id="unmanaged-unicast-session-management">
<figcaption>Figure #-####: Call flow for unicast session management for an unmanaged network</figcaption>
<img src="images/unmanaged-unicast-session-management.png" alt="figure 6-23" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps involved in a unicast content delivery session.</p>
<table class="sequence">
<tr><td>1.</td><td>Shows the OITF sending a setup request to the Cluster Controller, to initiate a content delivery session, using a previously acquired SDP.</td></tr> 
<tr><td></td><td><b>Note:</b> The SDP describing the requested media could be acquired from the content guide or using an RTSP DESCRIBE [[!Ref-19]]. The exact method is left to the detailed protocol specifications.</td></tr>
<tr><td>2-3.</td><td>Involves the Cluster Controller and the Content Delivery functions setting up the necessary resources for content delivery.</td></tr>
<tr><td>4.</td><td>Carries a response back to the OITF. If the request is successful, a session identifier will be returned by the Cluster Controller. Alternatively, the response may redirect the OITF to another Cluster Controller, for example for load balancing reasons. The exact mechanism for achieving this is left to the detailed protocol specifications. In this case, the OITF would repeat the process from signal 1 to re-issue the request to the specified Cluster Controller. </td></tr>
<tr><td>5.</td><td>Requests the Cluster Controller function to start streaming the content to the OITF.</td></tr>
<tr><td>6-7.</td><td>Sets up the start the streaming of the content from the Content Delivery function.</td></tr>
<tr><td>8.</td><td>Returns the status to the OITF.</td></tr>
<tr><td>9.</td><td>Represents the content being streaming from the Content Delivery functional entity to the OITF.</td></tr>
<tr><td>10.</td><td>Occurs at some later time, when the OITF no longer wishes to receive the stream.</td></tr>
<tr><td>11-12.</td><td>Completes the teardown process and signal 13 returns the result to the OITF.</td></tr>
</table>
<p><b>Note:</b> The detailed specifications shall consider methods to prevent DOS attacks on Cluster Controllers, and to prevent session ID hijacking.</p>
</section>
</section>
</section>
<section><h2>Push Content session management procedures (managed model)</h2>
<p>The Push procedure defines a mechanism for supporting IPTV Service Provider initiated IPTV services such as, for example, Push CoD. </p>
<p>The content can be pushed to an OITF, asynchronously, during the period when the user is registered with the IMS domain. The Push Content session management procedure can potentially be used to deliver personalized content or other information to the OITF, in a personalized way, depending on the IPTV User Profile, user preferences or explicit interests. </p>
<p>Figure <a href="#pushed-content-session-management" class="figureRef">6-24</a> depicts an informational flow for the Push procedure, applied to the Push CoD service. </p>
<figure id="pushed-content-session-management">
<figcaption>Figure #-####: Call flow for pushed content session management</figcaption>
<img src="images/pushed-content-session-management.png" alt="figure 6-24" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>1.</td><td>The IPTV Control sends a SIP MESSAGE to the Authentication and Session Management FE; the SIP MESSAGE includes:<ul>
<li>In the <i>Accept-Contact</i> header a specific tag identifying that the MESSAGE is related to a Push procedure;
<li>In the body, the <i>Content-URL</i> of the content to be downloaded by the OITF.</ul></td></tr>
<tr><td>2.</td><td>The SIP MESSAGE is sent to the user IMS Gateway where it is intercepted by the Authentication/Session Management function</td></tr>
<tr><td>3.</td><td>The Authentication/Session Management function invokes the third party notification functionality in the IG-OITF Server function. </td></tr>
<tr><td>4.</td><td>The IG-OITF Server function starts the notification procedure in the OITF using a DAE. 
<p>Two possible solutions for the notification procedure are </p><ul>
<li>&ldquo;Third Party Notification Procedure&rdquo;: In this solution the IG-OITF-Server sends the appropriate CEA 2014 [[!Ref-3]] operations so that the OITF can display the appropriate message. In more detail:<ul>
<li>The IG-OITF Server creates locally the notification message (multicast) and sends it to the OITF. This message contains the reference/link to the &ldquo;notification content&rdquo;.
<li>The OITF receives the notification message and loads, from IG-OITF Server, the content referred to by the &ldquo;notification content&rdquo;. In this case the &ldquo;notification content&rdquo; contains a scripting object (which includes the <i>Content-URI</i>) that triggers, on the OITF, the download of the content from the CDN.
<li>The OITF sends the response to the IG-OITF Server after the &ldquo;notification content&rdquo; has loaded;</ul>
<li>UPnP GENA [[!Ref-28]] </ul></td></tr>
<tr><td>5.</td><td>The IG-OITF Server function reports the Operation Result to the Authentication/Session Management function in the IMS Gateway;</td></tr>
<tr><td>6-7.</td><td>The response to the SIP MESSAGE is forwarded to the IPTV Control via Authentication and Session Management;</td></tr>
<tr><td>8.</td><td>The OITF executes the scripting object (received during the third party notification procedure [step 4]) and starts the downloading of the content from CDN. Note that the OITF UI client must have the &ldquo;notificationscript&rdquo; capabilities active.</td></tr>
</table>
</section>
<section><h2>Scheduled Content Session Management Procedures</h2>
<p>Scheduled content (often referred to as linear TV) is a basic service offered by an IPTV Service Provider. It is associated with IP multicast delivery mechanisms in a managed network, since several users would typically be watching the same channel within the same vicinity, serviced by the same network access node. This allows for considerable bandwidth saving in the access and core network, as a single stream from the source is routed as close as possible to the network access node, and from there on individual streams can be replicated and sent to individual users that want to watch that stream.</p>
<p>Scheduled content service allows a user to watch and zap between channels. When a user zaps to view a new channel, the ITF joins a multicast group that is associated with that channel, while leaving the multicast group associated with the old channel to which the ITF is currently tuned.</p>
<p>In a managed network, it is important to ensure that:</p><ul>
<li>a user is allowed to join a multicast group only if there is enough bandwidth with the right service priority to handle the requested stream within the access network. Otherwise the service can result in a bad user experience and bad picture quality;
<li>the reserved subscriber resources (last mile) are released when conditions for such a release present themselves (the user stops watching scheduled content TV and switches to CoD, the TV is powered off, etc.);
<li>during channel zapping, interaction or handshake between  network entities related to bandwidth, service priority or admission control are optimized.  This saves precious time and contributes to a faster channel zapping speed.</ul>
<section id="s6-6-1"><h3>Scheduled Content session set-up</h3>
<p>Scheduled content session set-up procedures should be established at ITF power up, after successful authentication and identification and content guide retrieval. </p>
<p>Figure <a href="#scheduled-content-session-setup" class="figureRef">6-25</a> shows a call flow for the scheduled content session set-up. </p>
<figure id="scheduled-content-session-setup">
<figcaption>Figure #-####: Call flow for scheduled content session setup</figcaption>
<img src="images/scheduled-content-session-setup.png" alt="figure 6-25" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>1.</td><td>The ITF sends a Service session setup request to the Authentication and Session Management FE, including a media offer for the scheduled content service</td></tr>
<tr><td>2.</td><td>The Authentication and Session Management reserves transport resources according to the media offer</td></tr>
<tr><td>3.</td><td>The response for the reservation request is returned. </td></tr>
<tr><td>4.</td><td>The Authentication and Session Management FE forwards the request to the IPTV Control, which verifies that the user is authorized for the service and verifies that the user has the rights to consume the content.</td></tr>
<tr><td>5.</td><td>The IPTV Control replies to the Authentication and Session Management with the bandwidth required for the specific scheduled content channels and may retrieve other parameters </td></tr>
<tr><td>6.</td><td>(optional) If the media offer has changed or new parameters are received, the Authentication and Session Management requests admission control for the confirmation phase.</td></tr>
<tr><td>7.</td><td>If step 6 is used, the response for the admission control request is returned. </td></tr>
<tr><td>8.</td><td>Finally, the Service session setup response for the Service session setup request is forwarded to the ITF.</td></tr>
<tr><td>9.</td><td>The ITF sends a request to the Transport Processing Functions to view the channel.</td></tr>
<tr><td>10-11.</td><td>(optional) An interaction between the Transport Processing Functions and Resource Admission Control entities occurs in order to guarantee the needed bandwidth for the channel. This may happen in a number of cases, for example when the multicast channel is not present at network access node to which the user is connected, or when the ITF wishes to join a multicast channel with different QoS requirements (e.g. zapping from a SD to a HD channel), </td></tr>
<tr><td>12.</td><td>Following that, the media stream is forwarded to ITF.</td></tr>
<tr><td>13.</td><td>The ITF sends a request to the Transport Processing Functions to change the channel.</td></tr>
<tr><td>14-15.</td><td>The operation is identical to that of step 10-11 </td></tr>
<tr><td>16.</td><td>Following that, the media stream is forwarded to ITF.</td></tr>
</table>
<p>Appendix <a href="#RAC-for-multicast" class="sectionRef">E</a> gives a more detailed description of the Transport Processing Functions and the relation with Resource and Admission Control for an xDSL access network. </p>
</section>
<section id="s6-6-2"><h3>Scheduled Content service session teardown procedure</h3>
<figure id="scheduled-content-session-teardown">
<figcaption>Figure #-####: Scheduled Content service session teardown call flow</figcaption>
<img src="images/scheduled-content-session-teardown.png" alt="figure 6-26" style="width:90%"/>
</figure>
<p>Figure <a href="#scheduled-content-session-teardown" class="figureRef">6-26</a> shows a typical call flow for tearing down a scheduled content session. The following is a brief description of the steps in the flow. The call flow assumes that a pre-condition for clearing a channel has occurred, such as the ITF being powered off, or the user switching to a CoD service, etc.</p>
<table class="sequence">
<tr><td>1.</td><td>The ITF sends a Service teardown request to the Authentication & Session Management Functional Entity (FE).</td></tr>
<tr><td>2.</td><td>The Authentication & Session Management Functional Entity forwards the request to the IPTV Control Functional Entity (FE).</td></tr>
<tr><td>3.</td><td>The IPTV Control FE updates its internal states, if required, and sends a Service teardown response back to the Authentication & Session Management FE.</td></tr>
<tr><td>4.</td><td>If resources have been reserved for the channel, the Authentication & Session Management FE reports the release to the Admission Control FE</td></tr>
<tr><td>5.</td><td>The Admission Control FE responds back to acknowledge the release</td></tr>
<tr><td>6.</td><td>The Session Management FE forwards the response to the ITF</td></tr>
<tr><td>7.</td><td>The ITF sends a request to the Transport Processing Functions to stop streaming;</td></tr>
<tr><td>8-9.</td><td>(optional) Internal to the Transport Processing FE, if the multicast channels are no longer needed at the access node for other users, the Transport Processing FE interacts with Admission Control to release the associated resources.</td></tr>
</table>
</section>
<section><h3>A typical call flow for scheduled content service set-up where FCC/RET service is operational (Enhanced managed model)</h3>
<p>Figure <a href="#scheduled-content-session-setup-with-fcc" class="figureRef">6-27</a> shows a call flow for the scheduled content session set-up where FCC and RET service are deployed. </p>
<figure id="scheduled-content-session-setup-with-fcc">
<figcaption>Figure #-####: Call flow for scheduled content session setup with FCC/RET service</figcaption>
<img src="images/scheduled-content-session-setup-with-fcc.png" alt="figure 6-27" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>1.</td><td>The ITF sends a Service bandwidth session info request to the Authentication and Session Management FE, including a media offer for the scheduled content service.</td></tr>
<tr><td>2.</td><td>The Authentication and Session Management FE forwards the request to the IPTV Control FE which has the missing bandwidth information.</td></tr>
<tr><td>3.</td><td>The IPTV Control FE returns the missing bandwidth information to the  Authentication and Session Management FE. </td></tr>
<tr><td>4.</td><td>The Authentication and Session Management FE  responds to the ITF with the service session set-up response. </td></tr>
<tr><td>5.</td><td>The ITF sends a Service session setup request to the Authentication and Session Management FE, including a media offer for the scheduled content service.</td></tr>
<tr><td>6.</td><td>The Authentication and Session Management FE reserves transport resources according to the media offer.</td></tr>
<tr><td>7.</td><td>The response for the reservation request is returned. </td></tr>
<tr><td>8.</td><td>The Authentication and Session Management FE forwards the request to the IPTV Control FE, which verifies that the user is authorized for the service and verifies that the user has the rights to consume the content.</td></tr>
<tr><td>9.</td><td>The IPTV Control FE replies to the Authentication and Session Management FE with the bandwidth required for the specific scheduled content channels, and may retrieve other parameters </td></tr>
<tr><td>10.</td><td>(optional) If the media offer has changed or new parameters are received, the Authentication and Session Management FE requests the Resource Admission Control FE for the confirmation phase.</td></tr>
<tr><td>11.</td><td>If step 10 is used, the response for the admission control request is returned. </td></tr>
<tr><td>12.</td><td>Finally, the Service session setup response for the Service session setup request is forwarded to the ITF.</td></tr>
<tr><td>13.</td><td>The ITF sends a FCC request to the FCC server to view the channel.</td></tr>
<tr><td>14-15.</td><td>(optional) An interaction between the FCC server and Resource Admission Control functional entities occurs in order to guarantee the needed bandwidth for the requested burst. This may happen for example when the ITF wishes to receive a channel with different QoS requirements (e.g. zapping from a SD to a HD channel). </td></tr>
<tr><td>16.</td><td>Following that, the FCC server responds with a burst of the media stream to the ITF.</td></tr>
<tr><td>17.</td><td>The FCC server triggers the ITF  to send a request for receiving  the channel to the Transport Processing function.</td></tr>
<tr><td>18.</td><td>The  ITF  sends a request to the Transport Processing function to receive the channel.</td></tr>
<tr><td>19-20.</td><td>(optional) An interaction between the Transport Processing function and the Resource Admission Control entities occur in order to guarantee the needed bandwidth for the channel. This may, for example, be when the multicast channel is not present at network access node to which the user needs to be connected,</td></tr>
<tr><td>21.</td><td>Following that, the media stream is forwarded to ITF.</td></tr>
<tr><td>22.</td><td>If the ITF detects a missing packet, it sends a RET request to the FCC/RET server.</td></tr>
<tr><td>23.</td><td>The FCC/RET server responds with the missing packet.</td></tr>
</table>
</section>
</section>
<section><h2>Pay-per-View Scheduled Content Service (managed model)</h2>
<p>Figure <a href="#PPV-Scheduled-Content" class="figureRef">6-28</a> shows a high level procedure for Pay-per-View (PPV) Scheduled Content service. </p>
<figure id="PPV-Scheduled-Content">
<figcaption>Figure #-####: High level Procedure for PPV Scheduled Content service</figcaption>
<img src="images/PPV-Scheduled-Content.png" alt="figure 6-28" style="width:90%"/>
</figure>
<p>The procedure includes the following three sub-procedures: </p><ul>
<li><b>PPV subscription procedure:</b><p>The procedure in section <a href="#s6-4-4-2" class="sectionRef">6.4.4.2</a> can be reused, with the difference that the subscription request (HTTP GET or POST request) to the IPTV Application shall include the user id, the selected BC service ID, the program ID, and the information about the PPV service (e.g. the price, the start time, and the end time of the PPV service). </p>
<li><b>PPV session set-up procedure: </b><p>The user initiates the PPV session when he/she wants to watch the PPV content. The detailed procedure is described in section <a href="#s6-7-1" class="sectionRef">6.7.1</a>.</p>
<li><b>PPV session teardown procedure:</b><p>The PPV session teardown procedure may be triggered by the user's action or the end of the PPV service.  The procedure in section <a href="#s6-6-2" class="sectionRef">6.6.2</a> can be reused.</p>
</ul>
<section id="s6-7-1"><h3>PPV Session Set-up procedure</h3>
<figure id="PPV-Session-Setup">
<figcaption>Figure #-####: PPV Scheduled Content Service Session Set-up procedure</figcaption>
<img src="images/PPV-Session-Setup.png" alt="figure 6-29" style="width:90%"/>
</figure>
<p>The following is a description of the interactions in the flow shown in Figure <a href="#PPV-Session-Setup" class="figureRef">6-29</a>:</p>
<table class="sequence">
<tr><td>1.</td><td>The ITF sends a SIP INVITE to the Authentication and Session Management FE, including the BC service ID, BC program ID and a media offer for the scheduled content service.</td></tr>
<tr><td>2.</td><td>The ASM uses the services of the RAC functional entity to perform resource reservation.</td></tr>
<tr><td>3.</td><td>The ASM forwards the INVITE to the IPTV Control. Using the BC service ID and BC program ID, the IPTV Control verifies that the user has a PPV subscription. The IPTV Control verifies whether the program has started or not. If the program has started and is encrypted, the IPTV Control may interact with CSP functions directly or through the IPTV application to verify the user entitlements, and then performs the following steps. If the program has started and is not encrypted, the IPTV Control performs the following steps. If the program has not started, the IPTV Control refuses the request. </td></tr>
<tr><td>4.</td><td>The IPTV Control sends a 200 OK response to the ASM with the bandwidth required for the specific scheduled content channels and other parameters. </td></tr>
<tr><td>5.</td><td>The ASM instructs the RAC to commit the reserved resources.</td></tr>
<tr><td>6.</td><td>Finally, 200 OK for the session setup request is forwarded to the ITF.</td></tr>
<tr><td>7.</td><td>The ITF issues an IGMP Join request to the transport processing functions to access the multicast channel for the PPV service.</td></tr>
<tr><td>8.</td><td>The media stream is delivered to the ITF.</td></tr>
</table>
</section>
</section>
<section><h2>Network-based Time Shift</h2>
<p>Time shift allows a user to halt a scheduled content service and continue watching the content item later. Network-based Time Shift supports features such as pause, rewind etc. on a scheduled content item by converting the multicast based delivery for scheduled content to a unicast delivery mode for that content item,  which is already pre-recorded in the network. </p>
<p>This allows the user to use trick modes such as pause, resume, fast forward, etc. which are normally reserved for unicast CoD, while watching the pre-recorded scheduled content in the unicast mode. At the end of the time-shifted scheduled content, the user is switched back automatically to regular scheduled content. </p>
<p>Time shift may not be available for all scheduled content programs. The EPG includes the lists of scheduled content programs for which the feature is available.</p>
<section><h3>Scheduled Content Time Shift</h3>
<p>The call flows below in Figure <a href="#scheduled-content-timeshift-part-1" class="figureRef">6-30</a> and Figure <a href="#scheduled-content-timeshift-part-2" class="figureRef">6-31</a> depict the sequence of messages that are exchanged when an end-user, watching a scheduled content item, for which time shift is available, uses trick play modes, which causes a switch to the unicast mode associated with the time-shifted content. </p>
<figure id="scheduled-content-timeshift-part-1">
<figcaption>Figure #-####: Scheduled Content Time Shift &mdash; Part 1</figcaption>
<img src="images/scheduled-content-timeshift-part-1.png" alt="figure 6-30" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in Figure <a href="#scheduled-content-timeshift-part-1" class="figureRef">6-30</a>:</p>
<table class="sequence">
<tr><td>1.</td><td>It is assumed that the user has established a scheduled content session and is watching a content item which is eligible for time shift.
<tr><td>2.</td><td>The end user activates a trick play (e.g., pause, fast backward, etc.) feature for the watched content.
<tr><td>3.</td><td>The OITF sends an HTTP POST to the IG. The request includes an indication to set the time shift service, and the session identity.
<tr><td>4.</td><td>The IG issues a re-INVITE or an UPDATE message to the ASM to convert the session to unicast.
<tr><td>5.</td><td>The ASM performs an initial resource modification to convert the reserved resources from multicast to unicast. There may be a need for additional resources, as indicated by the OITF in step 1, that may be required to account for trick modes.
<tr><td>6.</td><td>Following that, the ASM proxies the re-INVITE or UPDATE message to the IPTV Control FE.
<tr><td>7.</td><td>The IPTV Control FE validates the request, and selects the appropriate CDNC for the requested content
<tr><td>8-9.</td><td>The IPTV Control FE then issues an INVITE to the selected CDNC via the ASM.
<tr><td>10.</td><td>The CDNC selects an appropriate CC and proxies the INVITE to the CC.
<tr><td>11.</td><td>The CC selects an appropriate CDF. It then issues an RTSP SETUP to the CDF.
<tr><td>12.</td><td>The CDF responds with an RTSP 200 OK
<tr><td>13.</td><td>The RTSP 200 OK is sent as a SIP 200 OK to the CDNC. The SIP 200 OK includes the offset, which will be used by the OITF in a subsequent RTSP PLAY operation.
<tr><td>14-15.</td><td>The CDNC proxies the SIP 200 OK, via the ASM, to the IPTV Control FE. The CDNC includes the RTSP session identity that will be used by the OITF for trick modes.
<tr><td>15.</td><td>The ASM proxies the SIP 200 OK to the IPTV Control FE.
<tr><td>16.</td><td>The IPTV Control FE proxies the 200 OK to the ASM.
<tr><td>17.</td><td>The ASM performs final resource modification with the RACS.
<tr><td>18.</td><td>The ASM proxies the 200 OK to the IG.
<tr><td>19.</td><td>The IG returns to the OITF an HTTP 200 OK that includes the RTSP session identity to be used. 
</table>
<p>The remaining steps are shown in Figure <a href="#scheduled-content-timeshift-part-2" class="figureRef">6-31</a>.</p>
<figure id="scheduled-content-timeshift-part-2">
<figcaption>Figure #-####: Scheduled Content Time Shift &mdash; Part 2</figcaption>
<img src="images/scheduled-content-timeshift-part-2.png" alt="figure 6-31" style="width:90%"/>
</figure>
<table class="schedule">
<tr><td>20-24.</td><td>The IG issues an ACK that is proxied all the way to the CC following the same signalling path as the re-INVITE or UPDATE message.</td></tr>
<tr><td>25-26.</td><td>The OITF issues an RTSP play to the CC, which in turn proxies the RTSP play to the CDF.</td></tr>
<tr><td>27-28.</td><td>A 200 OK is returned by the CDF via the CC to the OITF and the content is now streamed to the OITF.</td></tr>
</table>
</section>
<section id="s6-8-2"><h3>User-initiated switch from time-shifted to regular Scheduled Content</h3>
<p>The call flows in Figure <a href="#scheduled-content-timeshift-return-part-1" class="figureRef">6-32</a> and Figure <a href="#scheduled-content-timeshift-return-part-2" class="figureRef">6-33</a> depict the sequence that occurs when an end-user watching a time shifted scheduled content item reverts back to the regular (i.e., not time-shifted) scheduled content. </p>
<figure id="scheduled-content-timeshift-return-part-1">
<figcaption>Figure #-####: Switching from time-shifted to regular Scheduled Content &mdash; Part 1</figcaption>
<img src="images/scheduled-content-timeshift-return-part-1.png" alt="figure 6-32" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="schedule">
<tr><td>1.</td><td>It is assumed that the user is watching a time shifted scheduled content item.</td></tr>
<tr><td>2.</td><td>The end user reverts back to regular scheduled content and activates the appropriate action though a user interface.</td></tr>
<tr><td>3.</td><td>The OITF sends an HTTP POST to the IG. The request includes the scheduled content service, and the session identity.</td></tr>
<tr><td>4.</td><td>The IG issues a re-INVITE or an UPDATE to the ASM to convert the unicast session to multicast delivery.</td></tr>
<tr><td>5.</td><td>The ASM performs an initial resource modification to convert reserved resources from unicast to multicast and to release any additional resources that may have be requested for trick modes.</td></tr>
<tr><td>6.</td><td>Following that, the ASM proxies the re-INVITE or UPDATE to the IPTV Control FE.</td></tr>
<tr><td>7.</td><td>The IPTV Control FE validates the request, and selects the appropriate CDNC for the requested service.</td></tr>
<tr><td>8.</td><td>The IPTV Control FE then terminates the unicast session and issues a SIP BYE to the ASM to terminate the unicast session.  </td></tr>
<tr><td>9.</td><td>The ASM proxies the BYE to the CDNC selected by the IPTV Control FE</td></tr>
<tr><td>10.</td><td>The CDNC proxies the BYE to the appropriate CC. </td></tr>
<tr><td>11.</td><td>The CC sends an RTSP session Tear Down request towards the CDF associated with the session.</td></tr>
<tr><td>12.</td><td>The CDF responds with a 200 OK</td></tr>
<tr><td>13.</td><td>The 200 OK is proxied to the CDNC</td></tr>
<tr><td>14.</td><td>The CDNC proxies the 200 OK to the ASM. </td></tr>
<tr><td>15.</td><td>The ASM proxies the 200 OK to the IPTV Control FE.</td></tr>
<tr><td>16.</td><td>The IPTV Control FE sends a 200 OK to the ASM in response to the received re-INVITE or UPDATE message.</td></tr>
<tr><td>17.</td><td>The ASM performs final resource modification with the RACS.</td></tr>
<tr><td>18.</td><td>The ASM proxies the 200 OK to the IG.</td></tr>
<tr><td>19.</td><td>The IG returns an HTTP 200 OK to the OITF. </td></tr>
</table>
<figure id="scheduled-content-timeshift-return-part-2">
<figcaption>Figure #-####: Switching from time-shifted to regular Scheduled Content &mdash; Part 2</figcaption>
<img src="images/scheduled-content-timeshift-return-part-2.png" alt="figure 6-32" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>20-24.</td><td>The IG issues an ACK that is proxied all the way to the CC.</td></tr>
<tr><td>25.</td><td>The OITF issues an IGMP JOIN to join the multicast group associated with the selected scheduled content item.</td></tr>
</table>
</section>
<section><h3>End of Stream in a Scheduled Content Time Shift</h3>
<p>The call flows shown in Figure <a href="#scheduled-content-timeshift-eos-part-1" class="figureRef">6-34</a> and Figure <a href="#scheduled-content-timeshift-eos-part-2" class="figureRef">6-35</a> depict the sequence that occurs when an end-user watching a time shifted scheduled content reaches the end of the stream. In this case, the OITF automatically reverts to the regular schedule content service without user intervention.  </p>
<p>There are two options for detecting the end of the stream. A CDF may support sending an RTSP ANNOUNCE message reflecting the end of the stream. Optionally, an OITF detecting the starvation of the content buffer over a minimum time of 2 to 3 seconds may treat such an event as the end of the stream. The following is a brief description of the steps:</p>
<figure id="scheduled-content-timeshift-eos-part-1">
<figcaption>Figure #-####: Reaching end of stream in Scheduled Content &mdash; Part 1</figcaption>
<img src="images/scheduled-content-timeshift-eos-part-1.png" alt="figure 6-34" style="width:90%"/>
</figure>
<p>It is assumed that the user is watching a time shifted scheduled content item.</p>
<table class="sequence">
<tr><td>1.</td><td>If the CDF supports sending the RTSP ANNOUNCE message, it sends this message to the CC to indicate the end of stream event.</td></tr>
<tr><td>2.</td><td>The CC proxies the RTSP ANNOUNCE message to the OITF.</td></tr>
<tr><td>3.</td><td>The OITF responds to the CC with a 200 OK acknowledging the reception of the message.</td></tr>
<tr><td>4.</td><td>The CC proxies the 200 OK to the CDF.</td></tr>
</table>
<p>If the CDF does not support the sending of the RTSP ANNOUNCE message, the OITF can interpret the content buffer starvation as an implicit indication for the end of the stream.</p>
<p>The remaining steps in Figure <a href="#scheduled-content-timeshift-eos-part-2" class="figureRef">6-35</a> showing the actual switch from time-shifted scheduled content to regular scheduled content are identical to the steps shown in section <a href="#s6-8-2" class="sectionRef">6.8.2</a> and will not be repeated.</p>
<figure id="scheduled-content-timeshift-eos-part-2">
<figcaption>Figure #-####: Reaching end of stream in Scheduled Content &mdash; Part 2</figcaption>
<img src="images/scheduled-content-timeshift-eos-part-2.png" alt="figure 6-35" style="width:90%"/>
</figure>
</section>
</section>
<section><h2>Forced Play Out Control</h2>
<p>&ldquo;Forced Play Out Control&rdquo; is a feature that allows the network or the OITF to limit play out operations during the consumption of content according to the Forced Play Out control policy of the Content Provider or Service Provider.  </p>
<p>There are two ways to execute the Forced Play Out control:</p><ul>
<li><b>By the OITF:</b> The Forced Play Out control policy is transmitted from the IPTV Control to the OITF, and the OITF executes the forced play out control based upon the received policy.
<li><b>By the CC:</b> The Forced Play Out control policy is transmitted from the IPTV Control to the CC. When the OITF attempts trick play functions, the CC executes the forced play out control based upon the received policy.</ul>
<p>NOTE: The Forced Play Out policy could be dually enforced by sending the policy to both the CC and the OITF and letting each enforce the policy.  This would be achieved by appropriately combining the methods in the sections below.</p>

<section><h3>Forced Play Out controlled by the OITF (managed model)</h3>
<p>The Forced Play Out control can be applied when a user attempts trick play operations while watching either scheduled or CoD content.</p> 
<p>Figure <a href="#OIPF-controlled-forced-playout" class="figureRef">6-36</a> depicts the sequence of messages that are exchanged to restrict the user's capabilities for trick play. For example, when a user attempts to fast forward while watching CoD content, the operation is forbidden by the OITF.</p>
<figure id="OIPF-controlled-forced-playout">
<figcaption>Figure #-####: Forced Play Out controlled by the OITF</figcaption>
<img src="images/OIPF-controlled-forced-playout.png" alt="figure 6-36" style="width:90%"/>
</figure>
<p>Note that the policy can be retrieved through a DAE application, or by other means (e.g., CSP).</p>
<p>The following is a brief description of the steps in the message flow:</p>
<table class="sequence">
<tr><td>1.</td><td>The user selects a CoD content item and the OITF sends an HTTP POST to the IG. The request includes an indication to use the CoD service and the content identity.</td></tr>
<tr><td>2.</td><td>The IG issues a SIP INVITE message to the ASM.</td></tr>
<tr><td>3.</td><td>The ASM uses the services of the RAC to perform resource reservation.</td></tr>
<tr><td>4</td><td>The ASM proxies the INVITE message to the IPTV Control.</td></tr>
<tr><td>5.</td><td>The IPTV Control validates the request and selects the appropriate CDNC for the requested content.</td></tr>
<tr><td>6.</td><td>The IPTV Control interacts with the IPTV Application to acquire the Forced Play Out control policy per the content identity and/or the user's subscription information. The policy details how to control the content. e.g., forbid the fast forward operation during ad insertion. <p>Note: The IPTV Application may fetch or generate the pre-configured Forced Play Out control policy from the content metadata based on the CoD content ID.</p></td></tr>
<tr><td>7.</td><td>The IPTV Control FE issues an INVITE to the ASM.</td></tr>
<tr><td>8.</td><td>The ASM proxies the INVITE to the CDNC selected by the IPTV Control FE.</td></tr>
<tr><td>9.</td><td>The CDNC selects an appropriate CC and proxies the INVITE to the CC.</td></tr>
<tr><td>10.</td><td>The CC selects an appropriate CDF and sends an RTSP SETUP to the CDF.</td></tr>
<tr><td>11.</td><td>The CDF responds with a 200 OK to the CC with the RTSP session identity.</td></tr>
<tr><td>12.</td><td>The CC proxies the 200 OK to the CDNC.</td></tr>
<tr><td>13.</td><td>The CDNC proxies the 200 OK to the ASM. </td></tr>
<tr><td>14.</td><td>The ASM proxies the 200 OK to the IPTV Control FE.</td></tr>
<tr><td>15.</td><td>The IPTV Control FE proxies the 200 OK to the ASM with the RTSP session identity and the Forced Play Out control policy.</td></tr>
<tr><td>16.</td><td>The ASM instructs the RAC to commit the reserved resources.</td></tr>
<tr><td>17.</td><td>Once the resources are committed, the ASM proxies the 200 OK to the IG.</td></tr>
<tr><td>18.</td><td>The IG returns an HTTP 200 OK to the OITF, including the RTSP session identity and the policy to be used. </td></tr>
<tr><td>19.</td><td>The IG replies with an ACK that is proxied all the way to the CC following the same signalling path that the INVITE message took.</td></tr>
<tr><td>20.</td><td>The OITF executes the Forced Play Out control policy disabling the user operations as appropriate.</td></tr>
</table>
<p><b>Note 1:</b> For Forced Play Out control applied when a user attempts trick play operation while watching scheduled content, the above signalling flow can be applied with the following modifications:</p><ol>
<li>The INVITE message will instead be a RE-INVITE or UPDATE message.
<li>The resource reservation and commit steps will instead convert the reserved resources from multicast to unicast.</ol>
<p><b>Note 2:</b> Policies sent to the OITF may need to be secured and handled by a trusted entity within the OITF.  Under the current OITF definition, this would fall to the CSP functions, and so a CSP-based solution may be desirable.</p>
</section>
<section><h3>Forced Play Out controlled by the Cluster Controller (managed model)</h3>
<p>The call flow in Figure <a href="#CC-controlled-forced-playout" class="figureRef">6-37</a> depicts the sequence of messages that are exchanged when a user make trick play operation while watching a scheduled content item with time shift is available or a CoD content item, the fast forward is forbidden by the CC. The following is a brief description of the steps:</p>
<figure id="CC-controlled-forced-playout">
<figcaption>Figure #-####: Forced Play Out controlled by the CC</figcaption>
<img src="images/CC-controlled-forced-playout.png" alt="figure 6-37" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the message flow:</p>
<table class="sequence">
<tr><td>1.</td><td>The user selects a CoD content item, and the OITF sends an HTTP POST to the IG. The request includes an indication to use the CoD service and the content identity.</td></tr>
<tr><td>2.</td><td>The IG issues a SIP INVITE message to the ASM.</td></tr>
<tr><td>3.</td><td>The ASM uses the services of the RAC to perform resource reservation.</td></tr>
<tr><td>4.</td><td>The ASM proxies the INVITE message to the IPTV Control.</td></tr>
<tr><td>5.</td><td>The IPTV Control validates the request and selects the appropriate CDNC for the requested content.</td></tr>
<tr><td>6.</td><td>The IPTV Control interacts with the IPTV Application to acquire the Forced Play Out control policy per the content identity and/or the user's subscription information. The policy details how to control the content. e.g., forbid the fast forward operation during ad insertion. <p>Note: The IPTV Application may fetch or generate the pre-configured Forced Play Out control policy from the content metadata based on the CoD content ID.</p></td></tr>
<tr><td>7.</td><td>The IPTV Control FE issues an INVITE to the ASM with the Forced Play Out control policy.</td></tr>
<tr><td>8.</td><td>The ASM proxies the INVITE to the CDNC selected by the IPTV Control FE.</td></tr>
<tr><td>9.</td><td>The CDNC selects an appropriate CC and proxies the INVITE to the CC.</td></tr>
<tr><td>10.</td><td>The CC stores the Forced Play Out control policy, selects an appropriate CDF and sends an RTSP SETUP to the CDF.</td></tr>
<tr><td>11.</td><td>The CDF responds with a RTSP 200 OK to the CC with the RTSP session identity.</td></tr>
<tr><td>12.</td><td>The CC proxies the SIP 200 OK to the CDNC.</td></tr>
<tr><td>13.</td><td>The CDNC proxies the 200 OK to the ASM. </td></tr>
<tr><td>14.</td><td>The ASM proxies the 200 OK to the IPTV Control FE.</td></tr>
<tr><td>15.</td><td>The IPTV Control FE proxies the 200 OK to the ASM with the RTSP session identity.</td></tr>
<tr><td>16.</td><td>The ASM instructs the RAC to commit the reserved resources.</td></tr>
<tr><td>17.</td><td>Once the resources are committed, the ASM proxies the 200 OK to the IG.</td></tr>
<tr><td>18.</td><td>The IG returns an HTTP 200 OK to the OITF, including the RTSP session identity to be used. </td></tr>
<tr><td>19.</td><td>The IG replies with an ACK that is proxied all the way to the CC following the same signalling path that the INVITE message took.</td></tr>
<tr><td>20.</td><td>The user chooses to fast forward through the content, resulting in the OITF sending an RTSP fast forward play to the CC.</td></tr>
<tr><td>21.</td><td>The CC executes the Forced Play Out control policy disabling the user operations as appropriate.</td></tr>
<tr><td>22.</td><td>If the CC denies the operation, it responds to the OITF with a 403 Forbidden.</td></tr>
</table>
<p><b>Note:</b> For Forced Play Out control applied when a user attempts trick play operation while watching scheduled content, the above signalling flow can be applied with the following modifications:</p><ol>
<li>The INVITE message will instead be a RE-INVITE or UPDATE message.
<li>The resource reservation and commit steps will instead convert the reserved resources from multicast to unicast.
</ol>
</section>
<section><h3>Integration with OITF functions</h3>
<p>In some cases, in addition to controlling which users may access certain content and services, detailed control is required over the play out by a user of a service or content. This is required, for example, when a Service or Content Provider does not want a user to skip over a warning, announcement or advertisement.</p>
<p>As shown in the call flows below, the IPTV Application determines when service/content play-out control must be exercised, and when certain actions are to be disabled. The call flows in this section show how play out control is executed on the OITF. Depending on implementation choices made by the Service/Content Provider, this can be done in different ways. </p>
<section><h4>Use of DAE and CSP for enforcement of OITF-enforced playout control</h4>
<p>Figure <a href="#clientside-enforced-playout" class="figureRef">6-38</a> illustrates the processes involved when play out control over streamed or progressive download content is implemented at the client-side. In this case, the play out logic, such as stringing together content and advertisements, is under the control of the IPTV Application and executed in the OITF by a downloaded DAE application. Note that the &ldquo;player&rdquo; shown in this call flow is the internal media player function within the OITF. It includes the stream receiver, decryption and codecs shown in the model of the OITF from Figure <a href="#oitf-functions" class="figureRef">5-5</a>, and also the internal media player logic of the OITF.</p>
<figure id="clientside-enforced-playout">
<figcaption>Figure #-####: Client-side play out control for streamed and progressive download service</figcaption>
<img src="images/clientside-enforced-playout.jpg" alt="figure 6-38" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>Using the browser, the user chooses an IPTV Application and selects a service or content item, as shown in section <a href="#s6-2" class="sectionRef">6.2</a>.</td></tr>
<tr><td>2.</td><td>Using the browser, the IPTV Application triggers the OITF to acquire rights (and keys) for the service/content.</td></tr>
<tr><td>3.</td><td>Using the browser, the IPTV Application triggers the OITF to acquire the content item from the Transport Processing Function and render it. Steps 3a, b, c and d are part of this process</td></tr>
<tr><td>3a.</td><td>In the case of protected content, the Player function inside the OITF will need the keys to access the content item. These keys are acquired from the CSP-T or CSP-G function and will not be released unless the user has the rights to access the content.</td></tr>
<tr><td>3b.</td><td>During the rendering of the content, the User may (via a DAE application) request the Player to fast-forward or pause the content. These requests are available in the DAE [[.OIPF_DAE2]]. This method can be used for both protected and non-protected content.</td></tr>
<tr><td>3c.</td><td>The IPTV application can use the DAE A/V playback API [[.OIPF_DAE2]] to implement the play-out-policy and instruct the native player to override the user requests and enforce normal play-out. These calls may be handled locally by the DAE application or forwarded to the IPTV Application on the server side.</td></tr>
<tr><td>3d.</td><td>The Player adapts its content requests accordingly. </td></tr>
</table>
</section>
<section><h4>Use of DAE, CSP and CC for network-enforced playout control</h4>
Figure <a href="#networkside-enforced-playout" class="figureRef">6-39</a> illustrates the processes involved when play out control over streamed content is implemented at the server-side. 
<figure id="networkside-enforced-playout">
<figcaption>Figure #-####: Service side play out control</figcaption>
<img src="images/networkside-enforced-playout.jpg" alt="figure 6-39" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>Using the browser, the user chooses an IPTV Application and selects a service or a content item.</td></tr>
<tr><td>2.</td><td>Using the browser, the IPTV Application triggers the OITF to acquire rights (and keys) for the Service/Content.</td></tr>
<tr><td>3.</td><td>Using the browser, the IPTV Application triggers the OITF to acquire the content item from the Transport Processing Function and render it. Steps 3a, b, c and d are part of this process</td></tr>
<tr><td>3a.</td><td>The Player function inside the OITF will need the keys to access the content item. These keys are acquired from the CSP-T or CSP-G function and will not be released unless the user has the rights to access the content.</td></tr>
<tr><td>3b.</td><td>During the rendering of the content item, the User may (via a DAE application) request the Cluster Controller to fast-forward or pause the Content. This method can be used for both protected and non-protected content.</td></tr>
<tr><td>3c.</td><td>The Cluster Controller receives play-out control information from the IPTV Application.</td></tr>
<tr><td>3d.</td><td>Depending on the Play-out policy, the Cluster Controller will honour the user playout requests and instruct the Transport Processing Function to execute them.</td></tr>
</table>
</section>
</section>
</section>
<section id="s6-10"><h2>Personal Video Recorder (PVR) Services</h2>
<section><h3>Overview</h3>
<p>The PVR is a service that permits the IPTV User with appropriate rights to record content available through this offering.</p>
<p>PVR services can be categorized according the type of storage, the involved roles (service provider controlled, user controlled) and the user and service interaction model. The following definitions apply:</p><ul>
<li><b>Local Storage:</b> the recorded content is stored within the consumer domain or ITF (OITF, IG, AG, WG) 
<li><b>Network Storage:</b>  the recorded content is stored in the IPTV service provider domain (Service Provider Network Equipment)
<li><b>Immediate Recording:</b> the user decides to record a scheduled content immediately. The scheduled content must be multicast at that moment.
<li><b>Scheduled Recording:</b> the user decides ahead of time to record a scheduled content.
<li><b>User Controlled recording:</b> no Service Provider intervention or permission is involved to record content, apart from content protection.
<li><b>Network controlled recording:</b> the content is recorded under Service Provider control
</ul>
</section>
<section id="s6-10-2"><h3>Local PVR</h3>
<section id="s6-10-2-1"><h4>Locally Managed Local PVR recording based on a timer</h4>
Figure <a href="#local-pvr-timer" class="figureRef">6-40</a> shows the simple case of a scheduled local PVR recording triggered by a timer in the OITF. Note that recording and play back of the recording may be policed by the CSP function in the OITF.
<figure id="local-pvr-timer">
<figcaption>Figure #-####: Call flow for local PVR function based on a timer in the OITF</figcaption>
<img src="images/local-pvr-timer.png" alt="figure 6-40" style="width:90%"/>
</figure>
<p>First, the user sets up a scheduled content recording, shown in the upper portion of the figure.</p>
<p class="indent">The user selects an item of content from the EPG, and requests that it is recorded.</p>
<p class="indent">The OITF sets up an internal timer based on the start time of the content item. Typically, the timer will be set to trigger shortly before the scheduled start time of the content item, in case it starts early. Similarly, the recording will usually be set to finish some time after the scheduled end time of the programme.</p>
<p class="indent">Note that advanced functions such as the automatic recording of a complete series, or recording based on a recommendation service, are possible, but are not detailed here. The OITF may also attempt to resolve conflicts at this stage, for example if overlapping recordings are scheduled but the OITF can only make one recording at a time. In any case, the outcome of the set up stage is that one or more timer events are set up within the OITF.</p>
<p>At a later time, the OITF performs the recording, shown in the second part of the figure.</p>
<table class="sequence">
<tr><td colspan="2"><p class="indent">The OITF's internal timer triggers at the appropriate time.</p></td></tr>
<tr><td>1.</td><td>The OITF performs any procedures that are necessary before broadcast session set up. Which procedures are necessary depends on the state of the OITF at the time of the trigger. If it is powered down, all procedures including network attachment, IG discovery, user registration and IPTV service discovery must be performed. If the OITF is already active and the user to make the recording is signed in, no action is necessary. Note that conflicts may also occur at this stage, for example if the user is already using a service and there is insufficient bandwidth available to receive the additional service to be recorded. Resolution of any conflicts is assumed to be managed by the OITF.</td></tr>
<tr><td>2.</td><td>The scheduled content session is set up as described in section <a href="#s6-6-1" class="sectionRef">6.6.1</a>. </td></tr>
<tr><td>3.</td><td>The OITF uses IGMP to join the multicast delivery channel of the scheduled content service.</td></tr>
<tr><td>4.</td><td>The service is received by the OITF via a multicast stream.</td></tr>
<tr><td>5.</td><td>The OITF records the received stream to local storage.</td></tr>
<tr><td colspan="2"><p class="indent">At some later time, the internal timer in the OITF triggers again to indicate that the recording should stop.</p></td></tr>
<tr><td>6.</td><td>The OITF stops recording.</td></tr>
<tr><td>7.</td><td>The OITF uses IGMP to stop multicast delivery.</td></tr>
<tr><td>8.</td><td>The scheduled content session is torn down as described in section <a href="#s6-6-2" class="sectionRef">6.6.2</a>.</td></tr>
</table>
</section>
<section id="s6-10-2-2"><h4>Locally Managed Local PVR Accurate Recording based on In-Band Signalling</h4>
<p>Some existing digital and analogue television systems enable accurate recording, meaning that the start and end of the recording are aligned with programme play out, and recordings take place correctly even when a programme is delayed or extended without warning. The call flow below shows how this can be achieved using in band signalling in the form of EIT (Event Information Tables), as defined in ETSI EN 300 468 [[!Ref-40]].</p>
<p>Note that the use of EIT in scheduled content services, and the processing of these tables by the OITF, is optional in the Open IPTV Forum specifications [[!Ref-45]].</p>
<p>Note that recording, and play back of the recording, may be policed by the CSP function in the OITF.</p>
<figure id="local-pvr-accurate">
<figcaption>Figure #-####: Call flow for local PVR function with accurate recording based on in band signalling</figcaption>
<img src="images/local-pvr-accurate.png" alt="figure 6-41" style="width:90%"/>
</figure>
<p>First, the user sets up a scheduled content recording. This is done as in the basic case shown in section <a href="#s6-10-2-1" class="sectionRef">6.10.2.1</a>, except that in addition to setting up the timer, the OITF also stores an identifier for the content. In the case of the EIT-based scheme shown here, the identifier is a combination of the &ldquo;DVB triplet&rdquo; of &lt;original network ID, transport stream ID, service ID&gt;, and the event ID &mdash; together these form a unique identifier for the programme. </p>
<p>At a later time, the OITF performs the recording.</p>
<table class="sequence">
<tr><td colspan="2"><p class="indent">The OITF's internal timer triggers at the appropriate time. This should be some time in advance of the expected start time of the programme, in case the programme runs early, or the OITF's internal clock is not accurate.</p></td></tr>
<tr><td>1.</td><td>The OITF performs any procedures that are necessary before scheduled content session set up. This is as described in section <a href="#s6-10-2-1" class="sectionRef">6.10.2.1</a>.</td></tr>
<tr><td>2.</td><td>The scheduled content session is set up as described in section <a href="#s6-6-1" class="sectionRef">6.6.1</a>. </td></tr>
<tr><td>3.</td><td>The OITF uses IGMP to join the multicast delivery channel of the scheduled content service.</td></tr>
<tr><td>4.</td><td>The service is received by the OITF via a multicast stream.</td></tr>
<tr><td colspan="2"><p class="indent">Instead of starting the recording immediately, the OITF instead monitors the EIT contained in the stream. These can be used to signal the moment that a content item actually starts and ends using the &ldquo;running status&rdquo; flag. Note that this is dependent on the service or content provider accurately provisioning the EIT.</p></td></tr>
<tr><td>5.</td><td>When the running status flag indicates that the content item of interest is starting, the OITF records the received stream to local storage.</td></tr>
<tr><td colspan="2"><p class="indent">Instead of setting a timer to trigger the end of the recording, the OITF instead continues to monitor the EIT.</td></tr>
<tr><td>6.</td><td>When the running status flag indicates the end of the content item, the OITF stops recording.</td></tr>
<tr><td>7.</td><td>The OITF uses IGMP to stop multicast delivery.</td></tr>
<tr><td>8.</td><td>The scheduled content session is torn down as described in section <a href="#s6-6-2" class="sectionRef">6.6.2</a>.</td></tr>
</table>
</section>
<section id="s6-10-2-3"><h4>Local request for Service Provider controlled Local PVR Recording</h4>
<p>Based on the EPG, the user decides to set-up the recording of a program (immediate or scheduled). The recording is performed on Local Storage, under the control of the IPTV Service Provider.</p>
<p>It is also possible to achieve this procedure through a DAE application interacting with an IPTV Application directly, but this is not described in this subsection.</p>
<p>Figure <a href="#local-pvr-session" class="figureRef">6-42</a> shows a call flow for a local PVR recording session.</p>
<figure id="local-pvr-session">
<figcaption>Figure #-####: Call flow for a local PVR recording session</figcaption>
<img src="images/local-pvr-session.png" alt="figure 6-42" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td colspan="2"><p class="indent">The user, based on information provided by the EPG, orders the recording of an available scheduled content item scheduled for future multicast delivery.</p><p class="indent">Note: Immediate recording is analogous to scheduled recording with the timer set to 0.</p></td></tr>
<tr><td>1.</td><td>The OITF makes a request to the IG to capture the particular Scheduled content item selected by the user. During this step, the OITF gives appropriate parameters to the IG to identify the Request Type as &ldquo;SetUpRecordingOrder&rdquo;, the BCService Id, the ProgramId, and relevant timing information as ProgramStartTime, ProgramEndTime, ProgramDuration, etc.  The OITF also indicates the TargetUserID. The TargetUserID identifies the User on behalf of whom the request is made. The request shall include also the storage recording mode (local) and if it is a Scheduled Recording (&ldquo;SR&rdquo; as used in this example, and not an immediate recording request, &ldquo;IR&rdquo;).
<p><b>Note:</b> The Request Type can be of several types: set up a recording order, cancel a recording order, delete a recorded content, edit a recording order, and view a recording order.</td></tr>
<tr><td>2.</td><td>The IG transforms the HTTP POST request from step 1 into a SIP MESSAGE request with appropriate parameters defined by step 1, and sends it to the IPTV Control via the ASM in the IMS core network. The IPTV Control receives the request, acting as a Terminating SIP UA.</td></tr>
<tr><td>3.</td><td>The IPTV Control queries the IPTV Service Profile FE to retrieve the IPTV Service and User Profiles, to fetch the user related PVR settings.</td></tr>
<tr><td>4.</td><td>The IPTV Service Profile FE returns the IPTV User Profile to the IPTV Control.</td></tr>
<tr><td>5.</td><td>The IPTV Control verifies that the user is subscribed to the service. The IPTV Control verifies that there is no active Capture Order for the same Program. The IPTV-Control verifies that the user is allowed to set up a Scheduled Recording order in the Local mode. When the local mode is initiated, the IPTV Control verifies the recording capabilities of the target local PVR and its settings (spare limits in time and volume). </td></tr>
<tr><td>6.</td><td>Then, the IPTV Control confirms the Capture Request to the IG via the ASM.</td></tr>
<tr><td>7.</td><td>The IG transforms the SIP 200 OK into HTTP 200 OK and sends it to OITF.</td></tr>
<tr><td>8.</td><td>The IPTV Control sends a SIP MESSAGE to the IG via the ASM with BC Service Id, the Program Id, and relevant timing information as ProgramStartTime, ProgramEndTime, ProgramDuration, etc.</td></tr>
<tr><td>9.</td><td>A HTTP 200 OK in sent to the OITF in response to the HTTP Pending IG Request.</td></tr>
<tr><td>10.</td><td>A new HTTP Pending IG request is sent by the OITF with a SIP 200 OK response in the HTTP message body. The IG sends the SIP 200 OK, in response to the received SIP MESSAGE, to the IPTV Control via the ASM. </td></tr>
<tr><td>11.</td><td>Upon reception of the confirmation response, the IPTV Control updates the IPTV User Profile status for PVR to &ldquo;Order Captured&rdquo;, meaning that the order is pending execution.</td></tr>
<tr><td>12.</td><td>The IPTV Service Profile FE updates the PVR Status Flag to &ldquo;Order_Captured&rdquo; together with related info: Program and BCServiceId.</td></tr>
<tr><td>13.</td><td>The OITF starts a counting down timer up to the expected time the program is scheduled to start. At the start time of the scheduled program, the OITF sets up a scheduled content session.</td></tr>
<tr><td>14.</td><td>The OITF joins the multicast channel.</td></tr>
<tr><td>15.</td><td>The OITF starts recording when it receives the IP flow.</td></tr>
<tr><td>16.</td><td>When the program is over, the OITF stops the recording. </td></tr>
<tr><td>17.</td><td>When the recording finishes, the OITF leaves the channel and tears down the scheduled content session. Within this tear down process, the OITF reports back to the IPTV Control the result of the recording, together with the &ldquo;spare_limit_in_volume&rdquo; and &ldquo;spare_limit_in_time&rdquo; values for the specific user (the UserID is also provided).</td></tr>
<tr><td>18.</td><td>The IPTV Control updates the metadata records specific for PVR.</td></tr>
<tr><td>19.</td><td>The IPTV Control updates the IPTV User Profile PVR Status Flag to &ldquo;ProgramRecorded&rdquo;, together related info: Program ID and BCId.</td></tr>
<tr><td colspan="2"><p class="indent">At this point, since the content is stored in the OITF, no further interaction is necessary between the OITF and other network entities to either access or play the recorded content</p>
<p class="indent">Note that if the OITF is using a DAE application to talk to the IPTV Application, then steps 8 through 9 can be replaced by a HTTP 200 OK sent in response to a HTTP Pending IG request from the OITF.</p></td></tr>
</table>
</section>
<section><h4>Remote request for Service Provider controlled Local PVR Recording</h4>
<p>Remote requests for recording allow an authorized user to perform PVR requests from an OITF different than the one used for recording.</p>
<p>Figure <a href="#local-pvr-session-remote" class="figureRef">6-43</a> shows a call flow for a remote request for a local PVR recording session.</p>
<figure id="local-pvr-session-remote">
<figcaption>Figure #-####: Call flow for a remote request for a local PVR recording session</figcaption>
<img src="images/local-pvr-session-remote.png" alt="figure 6-43" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td colspan="2"><p class="indent">The user, based on information provided by the EPG, orders, on OITF 2, the recording of an available scheduled content program scheduled for future multicast delivery.</p></td></tr>
<tr><td>1.</td><td>The OITF makes a request to the IG to capture the particular scheduled content item selected by the user. During this step, the OITF gives appropriate parameters to the IG to identify the Request Type as &ldquo;SetUpRecordingOrder&rdquo;, the BCService Id, the ProgramId, and relevant timing information such as ProgramStartTime, ProgramEndTime, ProgramDuration, etc.  The OITF also indicates the TargetUserID. The TargetUserID identifies the User on behalf of whom the request is made, in this case User 2. The request shall include also the storage recording mode (local) and if it is a Scheduled Recording (&ldquo;SR&rdquo;, as in this example, and not an immediate recording request, &ldquo;IR&rdquo;).</td></tr>
<tr><td>2.</td><td>The IG transforms the HTTP POST request from step 1 into a SIP MESSAGE with appropriate parameters defined by step 1, and sends it to the IPTV Control via the ASM in the IMS core network. The IPTV Control receives the request, acting as Terminating SIP UA.</td></tr>
<tr><td>3.</td><td>The IPTV-Control queries the IPTV Service Profile FE to retrieve the IPTV User Profile of User 2, to obtain the user-related PVR settings.</td></tr>
<tr><td>4.</td><td>The IPTV Service Profile FE returns the IPTV User Profile to the IPTV Control.</td></tr>
<tr><td>5.</td><td>The IPTV Control verifies that User 2 is subscribed to the service. The IPTV Control verifies that there is no active Capture Order for the same Program. The IPTV Control verifies that the user is allowed to set up a Scheduled Recording order in the Local mode. When the local mode is initiated, the IPTV Control verifies the recording capabilities of the target local PVR and its settings (spare limits in time and volume). The IPTV Control verifies that User 1 can record on behalf of User 2. </td></tr>
<tr><td>6.</td><td>Then, the IPTV Control confirms the Capture Request to the IG via the ASM.</td></tr>
<tr><td>7.</td><td>The IG transforms the SIP 200 OK into an HTTP 200 OK and sends it to the OITF.</td></tr>
<tr><td>8.</td><td>The IPTV Control sends a SIP MESSAGE to the same or another IG via the ASM, with the TargetUserID, BC Service Id, the Program Id, and relevant timing information such as ProgramStartTime, ProgramEndTime, ProgramDuration, etc . This message includes the storage requirements to be checked by OITF 2.</td></tr>
<tr><td>9.</td><td>A HTTP 200 OK in sent in response to the HTTP Pending IG request.</td></tr>
<tr><td>10.</td><td>A new HTTP Pending IG is sent by OITF 2 with a SIP 200 OK response in the HTTP message body. </td></tr>
<tr><td>11.</td><td>The IG sends the SIP 200 OK to the IPTV Control via the ASM</td></tr>
<tr><td>12.</td><td>Upon reception of a confirmation response, the IPTV Control updates the IPTV User Profile status of User 2 for PVR to &ldquo;Order Captured&rdquo;, meaning that the order is pending execution.</td></tr>
<tr><td>13.</td><td>The IPTV Service Profile FE updates PVR Status Flag to &ldquo;Order_Captured&rdquo; together with related info: Program and BCServiceId.</td></tr>
<tr><td>14.</td><td>OITF 2 starts a counting down timer up to the expected time the program is scheduled to start. At the start of the time of the scheduled program, OITF 2 sets up a scheduled content session. </td></tr>
<tr><td>15.</td><td>OITF2 joins the multicast channel.</td></tr>
<tr><td>16.</td><td>OITF 2 starts recording when it receives the IP flow.</td></tr>
<tr><td>17.</td><td>When the program is over, OITF 2 stops the recording. </td></tr>
<tr><td>18.</td><td>When the recording finishes, OITF 2 leaves the channel and tears down the scheduled content session. Within this tear down procedure, OITF 2 reports back to the IPTV Control the result of the recording, together the &ldquo;spare_limit_in_volume&rdquo; and &ldquo;spare_limit_in_time&rdquo; values for the specific user (the UserID  is also provided).</td></tr>
<tr><td>19.</td><td>The IPTV Control updates the metadata records specific for the PVR.</td></tr>
<tr><td>20.</td><td>The IPTV Service Profile FE updates the PVR Status Flag to &ldquo;ProgramRecorded&rdquo;, together with the related info: Program ID and BCId.</td></tr>
<tr><td colspan="2"><p class="indent">Note that if the OITF is using a DAE application to talk to the IPTV Application, then steps 8 through 9 can be replaced by a HTTP 200 OK sent in response to a HTTP Pending IG request from the OITF.</p></td></tr>
</table>
</section>
<section id="s6-10-2-5"><h4>Remote request from a non-OITF device for Local PVR Recording (managed model)</h4>
<p>Remote request for Local PVR recording allows an authorized user to perform local PVR requests from a non-OITF enabled device using a web browser.</p>
<p>Figure <a href="#local-pvr-session-remote-browser" class="figureRef">6-44</a> shows a call flow for remote local PVR recording session using a web browser.</p>
<figure id="local-pvr-session-remote-browser">
<figcaption>Figure #-####: Call flow for remote local PVR recording session using a web browser</figcaption>
<img src="images/local-pvr-session-remote-browser.png" alt="figure 6-44" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>0.</td><td>As part of the user's subscription to the remote L-PVR recording service, the service provider performs a binding between user's IPTV user identity (IMS IPTV IMPU), and the valid user's credentials depending of the user's device. These credentials could be username and password, as utilized by HTTP DIGEST (see section 6.3), or IMSI, as utilized by EAP AKA and SIM AKA when devices support USIM or SIM cards, respectively. The IPTV Application supports an instance of a Web portal for non-OITF enabled devices. As part of the remote L-PVR recording service, and through the non-OITF Web portal in the IPTV Application functional entity, the service provider grants access to the user's IPTV EPG service according to the user's IPTV Service Profile. Thus, the user, based on information provided by the EPG, orders the recording on its OITF of an available program scheduled for future multicast delivery.
<tr><td>1.</td><td>The device, using a web browser, makes a request to the IPTV Application to capture the particular scheduled content item selected by the user. During this step, the device provides the appropriate parameters to the IPTV Application to identify the Request Type as &ldquo;SetUpRecordingOrder&rdquo;, the BCService ID, the ProgramID, and relevant timing information as ProgramStartTime, ProgramEndTime, ProgramDuration, TargetUserID, etc.
<tr><td>2.</td><td>A specific functional entity in the Service Provider domain or, optionally, the IPTV Application authenticates the user request based on DIGEST or EAP SIM, or EAP AKA, depending of the type of device used. 
<tr><td>3.</td><td>A specific functional entity in the Service Provider domain or, optionally, the IPTV Application obtains the user's IPTV IMS user identity based on the valid identities used on the specific device (user/password, IMSI). 
<tr><td>4.</td><td>The IPTV Application, on behalf of the IPTV User, requests the IPTV Control to capture the record request. The IPTV Application gives some appropriate parameters to the IPTV Control to identify the request, and, in addition, the IPTV IMS User Id.
<tr><td>5.</td><td>The IPTV Control queries the IPTV Service Profile FE to retrieve the IPTV User Profile, to fetch the user related PVR settings.
<tr><td>6.</td><td>The IPTV Service Profile FE returns the profile to the IPTV Control. 
<tr><td>7.</td><td>The IPTV Control verifies that the user is subscribed to the service. The IPTV Control verifies that there is no active Capture Order for the same program. The IPTV Control verifies that the user is allowed to set up a Scheduled Recording order in Local mode. When local mode is initiated, the IPTV Control verifies the recording capabilities of the target local PVR and its settings (spare limits in time and volume). Then, the IPTV Control confirms the Capture Request to the IPTV Application.
<tr><td>8.</td><td>The IPTV Application confirms the Capture Request to the user.
<tr><td>9.</td><td>The IPTV Application sends the result of the Record Request to the Device.
<tr><td>10.</td><td>The IPTV Control sends a SIP MESSAGE to the same or another IG via the ASM with TargetUserID, BC Service Id, the Program Id, and relevant timing information as ProgramStartTime, ProgramEndTime, ProgramDuration, etc. This message includes the storage requirements to be checked by the OITF.
<tr><td>11.</td><td>An HTTP 200 OK containing the SIP MESSAGE in the HTTP body is sent to the Target OITF in response to the HTTP Pending IG request.
<tr><td>12.</td><td>A new HTTP Pending IG request is sent by the Target OITF with a SIP 200 OK response to the received SIP MESSAGE in the HTTP body. The Target OITF sends a response to the IG, to confirm or reject the record request.
<tr><td>13.</td><td>The IG sends the SIP 200 OK with the Record Response to the IPTV Control via the ASM.
<tr><td>14.</td><td>Upon reception of a confirmation response, the IPTV Control updates the IPTV User Profile status of User 2 for PVR to &ldquo;Order Captured&rdquo;, meaning that the order is pending execution.
<tr><td>15.</td><td>The IPTV Service Profile FE updates the PVR Status Flag to &ldquo;Order_Captured&rdquo; together with related info: Program and BCServiceId.
<tr><td>16.</td><td>The Target OITF starts a counting down timer up to the expected time the program is scheduled to start. At the start of the time of the scheduled program, the Target OITF initiates a scheduled content session. 
<tr><td>17.</td><td>The Target OITF joins the multicast channel.
<tr><td>18.</td><td>The Target OITF starts recording when it receives the IP flow.
<tr><td>19.</td><td>When the program is over, the Target OITF stops the recording. 
<tr><td>20.</td><td>When the recording finishes, the Target OITF leaves the channel and tears down the multicast session. Within this tear down, the Target OITF reports back to the IPTV Control the result of the recording, together the &ldquo;spare_limit_in_volume&rdquo; and &ldquo;spare_limit_in_time&rdquo; values for the specific user (the UserID  is also provided).
<tr><td>21.</td><td>The IPTV Control updates the metadata records specific for the PVR.
<tr><td>22.</td><td>The IPTV Service Profile FE updates the PVR Status Flag to &ldquo;ProgramRecorded&rdquo;, together with the related info: Program ID and BCId.
</table>
</section>
</section>
<section id="s6-10-3"><h3>Network PVR</h3>
<section><h4>OITF-initiated nPVR</h4>
<p>OITF-initiated nPVR is a service that allows a user to request the recording of a scheduled content item from an OITF. The recording is done in the network using one of the following methods:</p><ul>
<li>Synchronous recording order<p>The IPTV Control FE establishes and maintains a SIP session with the CDN to set up and control a recording session. Application level context synchronization is maintained for the entire duration of the recording session. In other words, application level <b>context between peers in a recording session is synchronous</b> with the progress of the recording.</p>
<li>Asynchronous recording order<p>The IPTV controller sends an order to the CDN with recording job information using SIP MESSAGE. The CDN informs the IPTV Control FE when the recording starts and ends: Application level context for each recording must be equally maintained in IPTV Control but synchronization is performed at specific points of the recording session, for example, at the end of the recording session or failure etc. Hence, application level context <b>is asynchronous</b> with the progress of the recording during the recording session,</p>
</ul>
<p>In both cases</p><ul>
<li>Only one recording order will be placed in the CDN if distinct users require the same recording.
<li>Note that the exact means of application synchronization for both cases shall be defined.
</ul>
</section>
<section><h4>Applicability of the Synchronous and Asynchronous methods</h4>
<p>The synchronous recording order method is applicable in the following case:</p><ul>
<li><b>Real time feedback of the recording process is required.</b> The IPTV Control, by keeping the SIP session alive, allows the user or any interested entity to have real time information about the recording process. This allows support for real-time end-user features such as the ability to be notified when the recording starts, the ability to stop, in real-time, an ongoing recording, the ability to watch in real-time an ongoing recording, etc.</ul>
<p>The asynchronous recording order method is applicable in the following case:</p><ul>
<li><b>Minimal feedback of the recording process is required.</b> The IPTV Control only maintains the required state information of the recording process (e.g. recording order placed, recording started, recording done). This approach is appropriate in case the CDN is not owned by the IPTV Service Provider but owned by a third party.</ul>
</section>
<section id="s6-10-3-3"><h4>OITF-initiated nPVR Recording &mdash; Synchronous Method</h4>
<p>Based on the EPG, the user decides to set-up the recording of a program (immediate or scheduled). The recording is performed on Network Storage, under the control of the IPTV Service Provider.</p>
<p>Figure <a href="#network-pvr-synchronous" class="figureRef">6-45</a> shows a call flow for the synchronous method of setting up an nPVR recording session.</p>
<figure id="network-pvr-synchronous">
<figcaption>Figure #-####: Call flow for network PVR recording session - Synchronous</figcaption>
<img src="images/network-pvr-synchronous.png" alt="figure 6-45" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>0.</td><td>The user, based on information provided by the EPG, orders the recording of an available Program scheduled for multicast delivery in the future.</td></tr>
<tr><td colspan="2"><b>Note:</b> Immediate recording is analogous to scheduled recording, with the timer set to 0.</td></tr>
<tr><td>1.</td><td>The OITF makes a request to the IG to capture the particular Scheduled Content item selected by the user. During this step, the OITF gives appropriate parameters to the IG to identify the Request Type as &ldquo;SetUpRecordingOrder&rdquo;, the BCService Id, the ProgramId, and relevant timing information such as ProgramStartTime, ProgramEndTime, ProgramDuration, etc.  The request shall include also the storage recording mode (&ldquo;network&rdquo;, in this example) and if it is a Scheduled Recording (&ldquo;SR&rdquo;, in this example, and not an immediate recording request, &ldquo;IR&rdquo;).</td></tr>
<tr><td colspan="2"><b>Note:</b> The Request Type can be of several types: set up recording order, cancel a recording order, delete a recorded content, edit a recording order, and view a recording order.</td></tr>
<tr><td>2.</td><td>The IG transforms the HTTP POST request from step 1 into a SIP MESSAGE request with appropriate parameters defined by step 1 and sends it to the ASM in the IMS core network.</td></tr>
<tr><td>3.</td><td>The IPTV Control receives the request, acting as Terminating SIP UA.</td></tr>
<tr><td>4-5.</td><td>The IPTV Control queries the IPTV Service Profile FE to retrieve the IPTV User Profile, to obtain the user related PVR settings.</td></tr>
<tr><td>6.</td><td>The IPTV Control verifies that the user is subscribed to the service. The IPTV Control verifies that there is no active Capture Order for the same Program for this user. The IPTV Control verifies that the new item to be recorded does not exceed the user's storage quota. The IPTV Control verifies that the signalled Storage mode is according the User settings.  Optionally, based on Service Provider determined criteria, the IPTV Control could override the PVR Storage mode signalled by the OITF.</td></tr>
<tr><td>7.</td><td>The IPTV Control confirms the Capture Request to the OITF via the ASM and the IG, and starts timing management procedures, that would include a timer that counts down to the expected time the program is scheduled to start.</td></tr>
<tr><td>8.</td><td>The IPTV Control updates the IPTV User Profile status for PVR to &ldquo;Order Captured&rdquo;, meaning that a recording order is pending execution.</td></tr>
<tr><td>9.</td><td>The IPTV Service Profile FE updates PVR Status Flag to &ldquo;Order_Captured&rdquo;.</td></tr>
<tr><td>10.</td><td>The IPTV Control answers back to the user with a 200 OK response.</td></tr>
<tr><td>11.</td><td>At the start of the time of the scheduled program (or when the timer to order the recording of a Program on a channel expires), the IPTV Control issues an Order_Record_Request, of type &ldquo;Start&rdquo;, to the selected Content Delivery Network Function. The request includes the appropriate parameters such as BCServiceID, Program ID, etc.</td></tr>
<tr><td colspan="2"><b>Note:</b> Upon reception of more than one request for the same network PVR recording session (BCSeviceID, Program ID), the IPTV Control, based on local policy, may issue only one Order_Record_Request of type &ldquo;Start&rdquo;. In this case, the CRID will be updated for each of the requestor's service profile and metadata.</td></tr>
<tr><td>12.</td><td>The CDNC assigns the CC function that will handle the INVITE for nPVR.</td></tr>
<tr><td>13.</td><td>The CDN selects a CDF with PVR capabilities.</td></tr>
<tr><td>14.</td><td>The CC sends an RTSP ANNOUNCE to deliver relevant transport parameters: IP Multicast for the channel.</td></tr>
<tr><td>15.</td><td>The CDF answers back with an RTSP 200 OK.</td></tr>
<tr><td>16.</td><td>The set up of the RTSP session is performed and an RTSP Session ID is established.</td></tr>
<tr><td>17.</td><td>The CDF joins the Multicast Channel.</td></tr>
<tr><td>18.</td><td>The CDF answers back with a RTSP 200 OK.</td></tr>
<tr><td>19.</td><td>The CDF sends an order record command against the RTSP Session Id.</td></tr>
<tr><td>20.</td><td>The CDF with PVR Recording capabilities starts the recording.</td></tr>
<tr><td>21.</td><td>The confirmation of the recording is sent back, including the Content Reference Identifier (CRID) associated with the content being recorded.</td></tr>
<tr><td>22-23.</td><td>The message, including the CRID, is sent back to the CDNC and then to the IPTV Control, via the ASM.</td></tr>
<tr><td>24.</td><td>The IPTV Control updates the metadata records specific for PVR. One parameter is the new Content Reference Identifier assigned to the new content. A CoD session establishment to start streaming the content could optionally be possible at this point.</td></tr>
<tr><td>25.</td><td>The Metadata Control acknowledges with a 200 OK.</td></tr>
<tr><td>26.</td><td>The IPTV Control updates the IPTV User Profile in IPTV Service Profile FE.</td></tr>
<tr><td>27.</td><td>The PVR Status in the IPTV User Profile is set to &ldquo;Order_Recording&rdquo;.</td></tr>
<tr><td>28.</td><td>The IPTV Service Profile FE acknowledges with a 200 OK.</td></tr>
<tr><td>29.</td><td>When the recording finishes, and before the CDF leaves the channel, the CDF reports back to the IPTV Control the result of the recording (it includes some minimum information like CRID and result code).</td></tr>
<tr><td>30.</td><td>The RTSP ANNOUNCE is sent to the CC.</td></tr>
<tr><td>31.</td><td>The CC updates the information before sending it to the CDNC in a SIP UPDATE message.</td></tr>
<tr><td>32.</td><td>The SIP UPDATE message is progressed to the IPTV Control FE, which uses the Session ID to verify the pending ACK for the recording order.</td></tr>
<tr><td>33.</td><td>The IPTV Control acknowledges the UPDATE message.</td></tr>
<tr><td>34-35.</td><td>The acknowledgement is sent to the CDNC, and then onto the CC.</td></tr>
<tr><td>36.</td><td>The CC sends an acknowledgement of the RTSP ANNOUNCE to the CDF.</td></tr>
<tr><td>37.</td><td>The SIP session is terminated.</td></tr>
<tr><td>38.</td><td>The SIP BYE is progressed to the CC.</td></tr>
<tr><td>39.</td><td>In the CC, the RTSP session is torn down.</td></tr>
<tr><td>40.</td><td>The CDF leaves the channel. </td></tr>
<tr><td>41.</td><td>The IPTV Control updates the metadata records specific for PVR.</td></tr>
<tr><td>42.</td><td>The IPTV User Profile FE updates the PVR Status Flag to &ldquo;ProgramRecorded&rdquo; together with the related info: Program ID and BCId.</td></tr>
<tr><td>43.</td><td>The PVR Status in the IPTV User Profile is set to: &ldquo;Order_Recorded&rdquo;</td></tr>
<tr><td colspan="2"><p class="indent">At this point, in order to play the recorded content, a Content-on-Demand session set-up needs to be initiated by the OITF.</p></td></tr>
</table>
</section>
<section><h4>OITF-initiated nPVR Recording &mdash; Asynchronous method</h4>
<p>Based on the EPG, the user decides to set-up the recording of a program (immediate or scheduled). The recording is performed in the CDN, under the control of the IPTV Service Provider.</p>
<p>Figure <a href="#network-pvr-asynchronous" class="figureRef">6-46</a> shows a call flow for the asynchronous method of setting up a local nPVR recording session.</p>
<figure id="network-pvr-asynchronous">
<figcaption>Figure #-####: Call flow for network PVR recording - Asynchronous</figcaption>
<img src="images/network-pvr-asynchronous.png" alt="figure 6-46" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>0.</td><td>The user, based on information provided by the EPG, orders the recording of an available Program scheduled for future multicast delivery.</td></tr>
<tr><td colspan="2"><p class="indent"><b>Note:</b> Immediate recording is analogous to scheduled recording, with the timer set to 0.</p></td></tr>
<tr><td>1.</td><td>The OITF makes a request to the IG to capture the particular Scheduled Content item selected by the user. During this step, the OITF provides appropriate parameters to the IG to identify the Request Type as &ldquo;SetUpRecordingOrder&rdquo;, the BCService Id, the ProgramId, and relevant timing information such as ProgramStartTime, ProgramEndTime, ProgramDuration, etc.  The OITF also indicates the TargetUserID. The TargetUserID identifies the User on behalf of whom the request is initiated. The request shall also include the storage recording mode (&ldquo;Network&rdquo;) and if it is a Scheduled Recording (&ldquo;SR&rdquo;, and not an immediate recording request, &ldquo;IR&rdquo;).</td></tr>
<tr><td colspan="2"><p class="indent"><b>Note:</b> The Request Type can be of several types: set up recording order, cancel a recording order, delete a recorded content, edit a recording order, and view a recording order.</td></tr>
<tr><td>2.</td><td>The IG transforms the HTTP POST request from step 1 into a SIP MESSAGE with appropriate parameters defined by step 1 and sends it to the ASM in the IMS core network.</td></tr>
<tr><td>3.</td><td>The IPTV Control receives the request, acting as Terminating SIP UA.</td></tr>
<tr><td>4-5.</td><td>The IPTV Control queries the IPTV Service Profile FE to retrieve the IPTV Service and User Profiles, and to obtain the user-related PVR settings.</td></tr>
<tr><td>6a.</td><td>The IPTV Control verifies that the user is subscribed to the service. The IPTV Control verifies that there is no active Capture Order for the same Program. The IPTV Control verifies that the user is allowed to set up a Scheduled Recording order in the &ldquo;Network&rdquo; mode and has enough storage space in the quota allocated to his subscription.</td></tr>
<tr><td>6b.</td><td>The IPTV Control creates a context for the order and registers relevant information to keep track of the order status.</td></tr>
<tr><td colspan="2"><p class="indent"><b>Note:</b> Whether the IPTV Control sets a timer at this stage or immediately forwards the recoding order to the CDN with appropriate information is left to the IPTV Solution specifications.</p></td></tr>
<tr><td>7.</td><td>The IPTV Control sends a SIP MESSAGE to the ASM with the BC Service Id, the Program Id, and relevant timing information such as the ProgramStartTime, ProgramEndTime, ProgramDuration, etc.</td></tr>
<tr><td>8.</td><td>The SIP MESSAGE is progressed to the CDNC, and then to the appropriate CC.</td></tr>
<tr><td>9-11a.</td><td>The CC confirms the recording order with a SIP 200 OK. </td></tr>
<tr><td>11b.</td><td>The IPTV Control updates the context of the order and registers the order status information.</td></tr>
<tr><td>12.</td><td>Upon reception of confirmation response, the IPTV Control updates the IPTV User Profile status for PVR to &ldquo;Order Captured&rdquo;, meaning that the order is pending execution.</td></tr>
<tr><td>13-14.</td><td>The IPTV User Profiles updates PVR Status Flag to &ldquo;Order_Captured&rdquo; together the related info, Program and BCServiceId, and confirms that update to the IPTV Control.</td></tr>
<tr><td>15-16.</td><td>The IPTV Control confirms the Capture Request to the OITF via the ASM and the IG.</td></tr>
<tr><td colspan="2"><p class="indent">The Recording Process between the CC and the CDF is the same as in the synchronous method (see steps 14 to 39 regarding RTSP and IGMP in section <a href="#s6-10-3-3" class="sectionRef">6.10.3.3</a>).</p></td></tr>
<tr><td>17a-g.</td><td>When the recording starts, the CC informs the IPTV Control of that event using a SIP MESSAGE. The IPTV Control acknowledges the message with a 200 OK.</td></tr>
<tr><td>18-23.</td><td>When the recording is completed, the CC sends a SIP MESSAGE to the IPTV Control. The IPTV Control acknowledges with a SIP 200 OK, after updating the context of the order and registering the order status information.</td></tr>
<tr><td>24.</td><td>The IPTV Control updates the metadata records specific for PVR.</td></tr>
<tr><td>25.</td><td>The IPTV User Profile FE updates the PVR Status Flag to &ldquo;ProgramRecorded&rdquo; together related info: Program ID and BCId.</td></tr>
<tr><td>26.</td><td>When the user profile is updated, a notification is sent to the OITF.</td></tr>
</table>
</section>
<section><h4>Remote request from a non-OITF device for a PVR Recording</h4>
<p>For the scheduling of network recordings, the same steps 1 through 9 for order capture as defined in section <a href="#s6-10-2-5" class="sectionRef">6.10.2.5</a> and Figure <a href="#network-pvr-asynchronous" class="figureRef">6-46</a> applies. Recording Control by the IPTV Control will follow steps 7 through 21 as described in section <a href="#s6-10-2-5" class="sectionRef">6.10.2.5</a>.
</section>
</section>
</section>
<section id="s6-11"><h2>Bookmarking</h2>
<section><h3>Bookmarking a CoD item</h3>
<section><h4>IMS-based approach</h4>
<section><h5>Bookmarking Creation and Storage</h5>
<p>The call flow in Figure <a href="#ims-bookmark-creation-and-storage" class="figureRef">6-47</a> depicts the IMS-based sequence for creating a bookmark for a CoD item and storing it in the user's IPTV service profile for later retrieval. </p>
<figure id="ims-bookmark-creation-and-storage">
<figcaption>Figure #-####: IMS-based CoD Bookmark creation and storage</figcaption>
<img src="images/ims-bookmark-creation-and-storage.png" alt="figure 6-47" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF has established a CoD session. At some point in time, the user decides he wants to create a bookmark.  If the OITF does not have the current play out position, it sends an RTSP GET-PARAMETER request to the CC, which sends an RTSP GET-PARAMETER request to the CDF to request the current play out position.</td></tr>
<tr><td>2.</td><td>The CDF returns the response to the RTSP GET-PARAMETER request in an RTSP 200 OK to the CC, which returns the 200 OK to the OITF.</td></tr>
<tr><td>3.</td><td>The OITF issues an HTTP POST request to the IG that includes the SIP INFO message.</td></tr>
<tr><td>4.</td><td>The IG sends to the ASM a SIP INFO Message that includes the info-event CoD-Bookmark package as well as the CoD content id.</td></tr>
<tr><td>5.</td><td>The ASM proxies the SIP INFO Message to the IPTV Control FE.</td></tr>
<tr><td>6.</td><td>The IPTV Control FE issues a Bookmark store request to the IPTV Application handling bookmarks. The request includes the info-event CoD-Bookmark package and the content id</td></tr>
<tr><td>7.</td><td>The IPTV Application issues an XCAP request, on behalf of the user, to update the service profile with the CoD-Bookmark data</td></tr>
<tr><td>8.</td><td>The IPTV Service Profile returns the response to the IPTV Application.</td></tr>
<tr><td>9.</td><td>The IPTV Application returns its own response to the IPTV Control FE.</td></tr>
<tr><td>10.</td><td>The IPTV Control FE returns a SIP 200 OK to the ASM.</td></tr>
<tr><td>11.</td><td>The ASM proxies the SIP 200 OK to the IG.</td></tr>
<tr><td>12.</td><td>The IG returns to the OITF a 200 HTTP OK that includes the SIP response </td></tr>
</table>
</section>
<section><h5>Bookmarking retrieval</h5>
<p>The call flow in Figure <a href="#ims-bookmark-retrieval" class="figureRef">6-48</a> depicts the IMS-based sequence for retrieving a CoD bookmark that is stored in the user's IPTV service profile. </p>
<figure id="ims-bookmark-retrieval">
<figcaption>Figure #-####: IMS-based CoD Bookmark retrieval </figcaption>
<img src="images/ims-bookmark-retrieval.png" alt="figure 6-48" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF issues an XCAP GET request to the IPTV Service Profile to request the bookmark.</td></tr>
<tr><td>2.</td><td>The bookmark is returned in an HTTP 200 OK response.</td></tr>
</table>
</section>
<section><h5>Content-related Bookmark Retrieval</h5>
<p>Content-related retrieval allows a user to retrieve all the bookmarks previously set against the content item the user had chosen for viewing.  For example, the user watches a show, and sets bookmarks on some terrific scenes so that they may be reviewed later. Some time later, when the user wants to review the show, the user requests the content for viewing. At the same time, all the bookmarks for that content item are transferred from the network to the OITF, and the user can watch from any of the bookmarked points.</p>
<figure id="content-related-bookmark-retrieval">
<figcaption>Figure #-####: Content-related Bookmark Retrieval Call Flow</figcaption>
<img src="images/content-related-bookmark-retrieval.png" alt="figure 6-49" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>The ITF sends an INVITE to the IPTV Control via the ASM to set up a CoD session.  The ASM uses the services of the &ldquo;Resource and Admission Control&rdquo; functional entity to perform resource reservation.</td></tr>
<tr><td>2.</td><td>The IPTV Control sends an XCAP GET to retrieve the user's service profile.</td></tr>
<tr><td>3.</td><td>The IPTV Service Profile returns 200 OK to the IPTV Control with the user's service profile, and the IPTV Control FE uses the user's service profile data to check the service rights for the requested service.</td></tr>
<tr><td>4.</td><td>The IPTV Control validates the request, selects the appropriate CDNC for the requested content, and sends the INVITE to the CDNC via the ASM. The CDNC then selects the CC and sends the INVITE to the CC, which selects the CDF and sends the RTSP SETUP to the CDF.</td></tr>
<tr><td>5.</td><td>The CDF returns an RTSP 200 OK to CC, which returns a SIP 2OO OK to CDNC, which returns the 200 OK to the IPTV Control via the ASM.</td></tr>
<tr><td>6.</td><td>The IPTV Control sends an XCAP GET to retrieve the bookmark list from the IPTV Service Profile, with the user ID and content identifier. </td></tr>
<tr><td>7.</td><td>The IPTV Service Profile returns the 200 OK with the bookmark list to the IPTV Control.  Each bookmark in the list should contain at least the content ID and the time reference.</td></tr>
<tr><td colspan="2"><p class="indent"><b>Note:</b> The messages in step 6 and 7 may be embedded in the messages for steps 2 and 3. </p></td></tr>
<tr><td>8.</td><td>The IPTV Control returns the 200 OK to the ITF via the ASM, with the Bookmark list.  The ASM instructs the &ldquo;Resource and Admission Control&rdquo; FE to commit the reserved resources.</td></tr>
<tr><td>9.</td><td>The ITF displays the bookmark list to the user, and the user selects the bookmark from which she wishes to start viewing the content.</td></tr>
</table>
</section>
</section>
<section><h4>DAE-based approach for bookmarking CoD</h4>
<section><h5>Bookmarking Creation and Storage</h5>
The call flow in Figure <a href="#dae-bookmark-creation-and-storage" class="figureRef">6-50</a> depicts the DAE-based sequence for creating a bookmark for a CoD item and storing it in the user's IPTV service profile for later retrieval. 
<figure id="dae-bookmark-creation-and-storage">
<figcaption>Figure #-####: DAE-based CoD bookmark creation and storage</figcaption>
<img src="images/dae-bookmark-creation-and-storage.png" alt="figure 6-50" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF has established a CoD session. At some point in time the user decides he wants to create a bookmark. If the OITF does not have the current play out position, it sends an RTSP GET-PARAMETER request to the CC, which sends an RTSP GET-PARAMETER request to the CDF to request the current playout position.</td></tr>
<tr><td>2.</td><td>The CDF returns the response to the RTSP GET-PARAMETER request in an RTSP 200 OK to the CC, which returns the 200 OK to the OITF.</td></tr>
<tr><td>3.</td><td>The OITF issues an HTTP POST to the IPTV Application for storing the Cod-Bookmark. The request includes the content id.</td></tr>
<tr><td>4.</td><td>The IPTV Application issues an XCAP request, on behalf of the user, to update the IPTV Service Profile with the CoD Bookmark data.</td></tr>
<tr><td>5.</td><td>The IPTV Service Profile returns the response to the IPTV Application.</td></tr>
<tr><td>6.</td><td>The IPTV Application returns an HTTP 200 OK response to the OITF. </td></tr> 
</table>
</section>
<section id="s6-11-1-2-2"><h5>Bookmarking Retrieval </h5>
<p>The call flow in Figure <a href="#dae-bookmark-retrieval" class="figureRef">6-51</a> depicts the DAE-based sequence for retrieving a CoD bookmark that is stored in the user's IPTV service profile. The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF issues an HTTP GET request to the IPTV Application to fetch the requested information.</td></tr> 
<tr><td>2.</td><td>The IPTV Application issues an XCAP GET request to the IPTV Service Profile to request the bookmark information.</td></tr> 
<tr><td>3.</td><td>The bookmark information is returned in an HTTP 200 OK response.</td></tr> 
<tr><td>4.</td><td>The IPTV Application returns an HTTP 200 OK that includes the bookmark information.</td></tr> 
</table>
<figure id="dae-bookmark-retrieval">
<figcaption>Figure #-####: DAE-based CoD bookmark creation and storage</figcaption>
<img src="images/dae-bookmark-retrieval.png" alt="figure 6-51" style="width:90%"/>
</figure>
</section>
</section>
</section>
<section><h3>Bookmarking a Scheduled Content item</h3>
<section><h4>IMS-based approach</h4>
<section><h5>Bookmarking Creation and Storage</h5>
<p>The call flow in Figure <a href="#ims-sc-bookmark-creation-and-storage" class="figureRef">6-52</a> shows the IMS-based procedure for bookmarking a scheduled content item, and storing the bookmark in the user's IPTV service profile for later retrieval.</p>
<figure id="ims-sc-bookmark-creation-and-storage">
<figcaption>Figure #-####: IMS-based Bookmark creation and storage for Scheduled Content</figcaption>
<img src="images/ims-sc-bookmark-creation-and-storage.png" alt="figure 6-52" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF has established a scheduled content session. At some point in time, the user decides he wants to create a bookmark. The OITF issues an HTTP POST request to the IG that includes the SIP INFO message.</td></tr> 
<tr><td>2.</td><td>The IG sends to the ASM a SIP INFO Message that includes the info-event TV-bookmark package. If the bookmark refers to a locally stored content, the request includes the PVR field; otherwise this field is not included. </td></tr> 
<tr><td>3.</td><td>The ASM proxies the SIP INFO Message to the IPTV Control FE.</td></tr> 
<tr><td>4.</td><td>The IPTV Control FE issues a bookmark request to the IPTV Application handling bookmarks. The request includes the TV-Bookmark and the PVR field (if included in the request).</td></tr> 
<tr><td>5.</td><td>If the PVR field is absent, the IPTV application verifies that the selected scheduled content is available for bookmarking. This verification is bypassed if the PVR field is present.  </td></tr> 
<tr><td>6.</td><td>The IPTV Application issues an XCAP request, on behalf of the user, to update the IPTV Service Profile with the TV-Bookmark data, if a bookmark is available for storage</td></tr> 
<tr><td>7.</td><td>The IPTV Service Profile returns the response to the IPTV application.</td></tr> 
<tr><td>8.</td><td>The IPTV Application returns its own response to the IPTV Control FE.</td></tr> 
<tr><td>9.</td><td>The IPTV Control FE returns a SIP 200 OK to the ASM.</td></tr> 
<tr><td>10.</td><td>The ASM proxies the SIP 200 OK to the IG.</td></tr> 
<tr><td>11.</td><td>The IG returns an HTTP 200 OK that includes the SIP response. </td></tr> 
</table>
</section>
</section>
<section><h4>Bookmaring Retrieval</h4>
<p>This procedure is identical to that described in section <a href="#s6-11-1-2-2" class="sectionRef">6.11.1.2.2</a>. Note that if the program is not recorded and no bookmark is created, then step 4 in section <a href="#s6-11-1-2-2" class="sectionRef">6.11.1.2.2</a> is empty.</p>
</section>
<section><h4>DAE approach</h4>
<section><h5>Bookmarking Creation and Storage</h5>
<p>The call flow in Figure <a href="#dae-sc-bookmark-creation-and-storage" class="figureRef">6-53</a> shows the sequence for creating a DAE-based bookmark for Scheduled Content and storing it in the user's IPTV service profile for later retrieval.</p>
<figure id="dae-sc-bookmark-creation-and-storage">
<figcaption>Figure #-####: DAE-based bookmark creation and storage for Scheduled Content</figcaption>
<img src="images/dae-sc-bookmark-creation-and-storage.png" alt="figure 6-53" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF has established a scheduled content session. At some point in time, the user decides he wants to create a bookmark. The OITF issues an HTTP POST to the IPTV Application for storing the TV-Bookmark. If the bookmark refers to a locally stored content, the request includes the PVR field; otherwise this field is not included.</td></tr> 
<tr><td>2.</td><td>If the PVR field is absent, the IPTV application verifies that selected Scheduled Content item is available for bookmarking. This verification is bypassed if the PVR field is present.  </td></tr> 
<tr><td>3.</td><td>The IPTV application issues an XCAP request, on behalf of the user, to update the IPTV Service Profile with the TV-Bookmark data if a bookmark is available for storage</td></tr> 
<tr><td>4.</td><td>The IPTV Service Profile returns the response to the IPTV application.</td></tr> 
<tr><td>5.</td><td>The IPTV Application returns an HTTP 200 OK to the OITF</td></tr> 
</table>
</section>
<section><h5>Bookmarking Retrieval</h5>
<p>This procedure is identical to that in section <a href="#s6-11-1-2-2" class="sectionRef">6.11.1.2.2</a>.</p>
</section>
</section>
<section id="s6-11-2-4"><h4>Network initiated Bookmarking (managed model)</h4>
<p>This procedure is performed when, for example, the IPTV Control FE needs to acquire the offset for the purpose of session transfer or session replication (see section <a href="#s6-17-3-2" class="sectionRef">6.17.3.2</a>). Note that other applications may need this procedure as well.</p> 
<p>Figure <a href="#network-initiated-bookmarking" class="figureRef">6-54</a> shows how the OITF can use the IMS network to return the requested information.</p>
<figure id="network-initiated-bookmarking">
<figcaption>Figure #-####: Network-initiated Bookmarking</figcaption>
<img src="images/network-initiated-bookmarking.png" alt="figure 6-54" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the call flow:</p>
<table class="sequence">
<tr><td>1.</td><td>The IPTV Control FE sends a SIP INFO message to the IG (via the ASM which is not shown for simplicity) requesting the OITF to send to it the missing information.</td></tr>
<tr><td>2.</td><td>The IG sends an HTTP 200 OK response to the OITF that includes the SIP INFO.</td></tr>
<tr><td>3.</td><td>The OITF issues to the IG an HTTP POST that includes the SIP 200 OK response with the requested data.</td></tr>
<tr><td>4.</td><td>The IG returns a SIP 200 OK response to the IPTV Control FE. The IPTV Control FE may scale back a bit the returned position to cater for some time lost. </td></tr>
<tr><td>5.</td><td>The IPTV Control FE then issues a Bookmark request to the IPTV Application responsible for bookmarks.</td></tr>
<tr><td>6.</td><td>The IPTV Application issues an XCAP PUT request to the IPTV Service Profile.</td></tr>
<tr><td>7.</td><td>The IPTV Service Profile returns a 200 OK to the IPTV Application.</td></tr>
<tr><td>8.</td><td>The IPTV Application returns a response to the IPTV Control.</td></tr>
</table>
<p>Note that steps 5 to 8 are needed in case the OITF did not receive the bookmark during the session initiation procedure and has to retrieve it.</p>
</section>
</section>
</section>
<section id="s6-12"><h2>Parental Control</h2>
<section id="s6-12-1"><h3>What is on the TV?</h3>
<p>&ldquo;What is on the TV&rdquo; is a feature that allows users with proper authorization to be informed of the content being watched at an OITF. The description below shows how the OITF reports to the network the content that is being watched.  </p>
<p>There are several modes for this feature, all of which are under the control of service provider, and which are negotiated during the scheduled content session setup, and thereafter. Changes to any of the negotiated modes can occur at any point in time during the lifetime of a scheduled content session using normal session modification procedures. The various modes for the feature shall be aligned with the IETF RFC [[!Ref-47]]. The modes of operation are:</p><ul>
<li>The OITF can be ordered to report at all times the content being displayed after channel zapping
<li>An OITF that continuously reports the content that is being displayed after channel zapping can be ordered to stop such reporting at any time.
<li>An OITF that is ordered to stop reporting the content being displayed can be ordered to resume reporting immediately and until such time when it is ordered to stop reporting</ul>
<p>All of the above modes are under the control of the service provider.   </p>
<section id="s6-12-1-1"><h4>Negotiated content reporting at session initialization</h4>
<p>The call flow in Figure <a href="#content-reporting-at-session-initialization" class="figureRef">6-55</a> depicts the normal sequence that occurs when a scheduled content session setup is augmented with the support for this feature, in which the OITF is ordered to report the content currently being displayed. </p>
<figure id="content-reporting-at-session-initialization">
<figcaption>Figure #-####: Content Reporting at Session initialization</figcaption>
<img src="images/content-reporting-at-session-initialization.png" alt="figure 6-55" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF sends an HTTP POST request to the IG to set up the scheduled content session. The OITF and IPTV Control FE MUST support the info-event package for content reporting. </td></tr>
<tr><td>2.</td><td>The IG sends a SIP INVITE to the ASM. The INVITE includes the headers received by the IG.</td></tr>
<tr><td>3.</td><td>The ASM performs initial resource reservation with the RAC.</td></tr>
<tr><td>4.</td><td>Following that, the ASM proxies the INVITE to the IPTV Control FE.</td></tr>
<tr><td>5.</td><td>The IPTV Control FE validates the INVITE per the normal procedure associated with the scheduled content. The IPTV Control FE then returns a 200 OK to the ASM. The 200 OK MUST include the rec-info header. If the IPTV Control FE does not want any reporting by the OITF it SHALL set the value of rec-info to that effect. If the IPTV Control FE wants the OITF to report content information, it SHALL set the value of rec-info to that effect.  In this call sequence, the value is set such that the OITF is ordered to report the content. The 200 OK may include the send-info header. </td></tr>
<tr><td>6.</td><td>The ASM performs final resource modification with the RAC.</td></tr>
<tr><td>7.</td><td>The ASM proxies the 200 OK to the IG.</td></tr>
<tr><td>8.</td><td>The IG sends an HTTP 200 OK to the OITF.</td></tr>
<tr><td>9-10.</td><td>The IG sends an ACK to the ASM, which proxies it to the IPTV Control FE.</td></tr>
<tr><td>11.</td><td>The OITF issues an IGMP JOIN to the access node to view the selected content item.</td></tr>
<tr><td>12.</td><td>The OITF issues an HTTP POST to the IG to report the content being watched.</td></tr>
<tr><td>13.</td><td>The IG sends a SIP INFO message to the ASM. The SIP INFO includes the info-event for content reporting.</td></tr>
<tr><td>14.</td><td>The ASM proxies the SIP INFO to the IPTV Control FE.</td></tr>
<tr><td>15.</td><td>The IPTV Control FE responds to the ASM with a 200 OK.</td></tr>
<tr><td>16.</td><td>The ASM proxies the 200 OK to the IG.</td></tr>
<tr><td>17.</td><td>The IG sends an HTTP 200 OK to the OITF.</td></tr>
<tr><td>18.</td><td>The OITF performs channel zapping.</td></tr>
<tr><td>19.</td><td>Following channel zapping, it is assumed that the OITF remains tuned to a scheduled content item for a minimum configurable time.</td></tr>
<tr><td>20.</td><td>After that time has elapsed, the OITF issues an HTTP POST to the IG to report the content being displayed. </td></tr>
<tr><td colspan="2"><p class="indent">The remaining steps are identical to the previous reporting and will not be described again.</p></td></tr>
</table>
</section>
<section id="s6-12-1-2"><h4>Mid-Session negotiation for content reporting</h4>
<p>The call flow in Figure <a href="#mid-session-signalling-for-content-reporting" class="figureRef">6-56</a> depicts the sequence that occurs in mid-session when a service provider orders an OITF to stop or resume content reporting depending on the OITF mode. There are no limits on how frequently such an order can be sent. The triggers for such an order can be many. Examples include a service request from an authorized member in the household for the information when it is not available, manual intervention by the service provider, etc.</p>
<figure id="mid-session-signalling-for-content-reporting">
<figcaption>Figure #-####: Mid-session signalling for content reporting</figcaption>
<img src="images/mid-session-signalling-for-content-reporting.png" alt="figure 6-56" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>It is assumed that the OITF is displaying content, and the OITF is reporting the content being displayed. The OITF sends an HTTP PENDING request so that it can receive any information destined to it.</td></tr>
<tr><td>2.</td><td>At some point in time, a trigger requests the IPTV Control FE to order the OITF to stop reporting the watched content. The IPTV Control FE sends a SIP UPDATE to the ASM. The UPDATE includes the rec-info header set to indicate &ldquo;no content reporting&rdquo;.</td></tr>
<tr><td>3.</td><td>The ASM proxies the SIP UPDATE to the IG.</td></tr>
<tr><td>4.</td><td>The IG sends an HTTP 200 OK to the OITF to report the request.</td></tr>
<tr><td>5.</td><td>The OITF sends an HTTP PENDING request to the IG.</td></tr>
<tr><td>6.</td><td>The IG sends back a 200 OK to the ASM in response to the SIP UPDATE.</td></tr>
<tr><td>7.</td><td>The ASM proxies the 200 OK to the IPTV Control FE.</td></tr>
<tr><td>8.</td><td>Later, the user performs channel zapping, and the OITF displays a new content item.</td></tr>
<tr><td>9.</td><td>Channel zapping is stopped for the minimum configurable time but the content displayed is not reported.</td></tr>
<tr><td colspan="2"><p class="indent">At some later point in time, the IPTV Control FE receives a new trigger to order the OITF to report the displayed content.</p></td></tr>
<tr><td>10-15.</td><td>The OITF issues an HTTP POST to the IG to report the content being displayed.  Steps 10-15 are identical to steps 2-7.</td></tr>
<tr><td colspan="2"><p class="indent">Immediately upon receipt of the new order, the OITF reports the content being watched in steps 16-21, which are identical to steps 20-25 described in section <a href="#s6-12-1-1" class="figureRef">6.12.1.1</a>.</p></td></tr>
</table>
</section>
<section id="s6-12-1-3"><h4>Publishing and Subscribing to Content being watched by an OITF</h4>
<p>There are two means by which content being streamed to an OITF can be published:</p><ul>
<li>The end user can have an application on the OITF that can publish to a Presence server what the user is currently watching. This is under user control.
<li>The IPTV Control FE can perform the same task. It is aware of the content being streamed and can publish the data to a Presence server on behalf of the user. This is under the control of the service provider.</ul>
<p>Clearly, the information in the Presence server can be updated by either approach simultaneously. </p>
<p>End users with appropriate authorization can subscribe to receive this information. The service provider performs the necessary verification to ensure that only authorized users can have access to this information.  The service provider also guarantees that the information is accurate.  This feature is essential for parental control purposes.</p>
<section><h5>Publishing watched content at an OITF by the Service Provider</h5>
<p>The call flow in Figure <a href="#watched-contnet-publication-by-service-provider" class="figureRef">6-57</a> depicts the sequence for publishing watched content, by the service provider. </p>
<figure id="watched-contnet-publication-by-service-provider">
<figcaption>Figure #-####: Publication of watched content at an OITF by the Service Provider</figcaption>
<img src="images/watched-contnet-publication-by-service-provider.png" alt="figure 6-57" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The IPTV Control FE has information related to content being watched by a user at OITF1, and sends a SIP PUBLISH to the ASM on behalf of the user.</td></tr>
<tr><td>2.</td><td>The ASM forwards the PUBLISH to the Presence server.</td></tr>
<tr><td>3-4.</td><td>The Presence server returns a 200 OK to the ASM, which forwards it to the IPTV Control FE.</td></tr>
</table>
</section>
<section><h5>Publishing watched content at an OITF by the End User</h5>
<p>The call flow in Figure <a href="#watched-contnet-publication-by-end-user" class="figureRef">6-58</a> shows the sequence of messages for publishing watched content by the end user. </p>
<figure id="watched-contnet-publication-by-end-user">
<figcaption>Figure #-####: Publication of watched content at an OITF by the end user</figcaption>
<img src="images/watched-contnet-publication-by-end-user.png" alt="figure 6-58" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF issues an HTTP POST to the IG. The request includes the SIP PUBLISH.</td></tr>
<tr><td>2.</td><td>The IG forwards a SIP PUBLISH to the ASM.</td></tr>
<tr><td>3.</td><td>The ASM forwards the SIP PUBLISH to the IPTV Control FE or directly to the Presence server.</td></tr>
<tr><td>4.</td><td>The IPTV Control FE forwards the SIP PUBLISH to the Presence server via the ASM.</td></tr>
<tr><td>5.</td><td>The Presence server responds with a SIP 200 OK to the IPTV Control FE via the ASM.</td></tr>
<tr><td>6-7.</td><td>The IPTV Control FE forwards the SIP 200 OK to the ASM, which forwards it to the IG.</td></tr>
<tr><td>8.</td><td>The IG sends an HTTP 200 OK, which includes the SIP 200 OK, to the OITF.</td></tr>
</table>
</section>
<section><h5>Subscribing to receive information on content watched at an OITF</h5>
<p>The call flow in Figure <a href="#subscription-to-receive-watched-content" class="figureRef">6-59</a> shows the sequence of messages for subscribing to receive information on content streamed at an OITF. </p>
<figure id="subscription-to-receive-watched-content">
<figcaption>Figure #-####: Subscription to receive information on watched content at an OITF</figcaption>
<img src="images/subscription-to-receive-watched-content.png" alt="figure 6-59" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF issues an HTTP POST to the IG. The request includes the SIP SUBSCRIBE. </td></tr>
<tr><td>2.</td><td>The IG forwards the SIP SUBSCRIBE to the ASM.</td></tr>
<tr><td>3.</td><td>The ASM forwards the SIP SUBSCRIBE to the IPTV Control FE. Before the IPTV Control FE forwards the SUBSCRIBE message to the Presence server, it can perform the following optional step: The IPTV Control FE can pull the latest watched channel information from the OITF and publish it. It does so if it believes that the information has changed since the last time it was published. The IPTV Control FE can also choose to temporarily request that the OITF retry subscribing later while the IPTV Control performs that task.</td></tr>
<tr><td>4.</td><td>The IPTV Control FE forwards the SIP SUBSCRIBE to the Presence server via the ASM</td></tr>
<tr><td>5-7.</td><td>The Presence server responds with a SIP 200 OK to the IPTV Control FE via the ASM, which, in turn, forwards the 200 OK to the IG via the ASM.</td></tr>
<tr><td>8.</td><td>The IG sends an HTTP 200 OK that includes the SIP 200 OK to the OITF.</td></tr>
<tr><td>9.</td><td>The OITF sends an HTTP POST pending request in anticipation of the reception of a NOTIFY.</td></tr>
<tr><td>10.</td><td>The Presence server sends a NOTIFY including the required information to the IPTV Control FE via the ASM.</td></tr>
<tr><td>11-12.</td><td>The IPTV Control FE forwards the NOITFY to the ASM, which forwards it to the IG.</td></tr>
<tr><td>13.</td><td>The IG sends an HTTP 200 OK that includes the SIP NOITFY to the OITF</td></tr>
<tr><td>14.</td><td>The OITF issues an HTTP POST that includes the SIP 200 OK response to the IG.</td></tr>
<tr><td>15-16.</td><td>The IG forwards the 200 OK to the ASM, which passes it on to the IPTV Control FE.</td></tr>
<tr><td>17.</td><td>The IPTV Control FE forwards the 200 OK to the Presence server.</td></tr>
</table>
</section>
</section>
</section>
<section><h3>Parental Authorization for CoD</h3>
<p>An example of parental control within the context of CoD services, and using communication services, refers to the ability of the IPTV solution to seek, in real-time, parental authorization when an end user engages with the IPTV system for CoD selection and if the IPTV User Profile of that end user indicates such a need.</p>
<p>Section <a href="#s6-12-2-1" class="sectionRef">6.12.2.1</a> provides an example for a call flow to illustrate the roles played by different entities involved in parental control within the context of a CoD service.</p>
<section id="s6-12-2-1"><h4>Browser-Based Portal CoD Application</h4>
<p>This use case is about an end user engaging with the IPTV system for the purpose of selecting a CoD and for whom parental control has been activated in the IPTV Service Profile FE.</p>
<p>The call flow for this use case is shown in Figure <a href="#parental-control-browser-based-cod-application" class="figureRef">6-60</a>.  The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The end user, through the GUI and the OITF, browses the CoD application and makes his choice regarding a CoD.</td></tr>
<tr><td colspan="2"><p class="indent">The CoD application verifies with the IPTV Service Profile FE if parental authorization is required, and determines that it is needed in this case. </p></td></tr>
<tr><td>2.</td><td>The CoD application returns an HTTP response to the OITF to inform the user that parental authorization is currently being sought, before the selected content can be made available for viewing.</td></tr>
<tr><td>3.</td><td>The CoD application sends a request to the IPTV Control FE to request parental authorization for the subject end-user. The CoD application includes all information needed in that regard.</td></tr>
<tr><td colspan="2"><p class="indent">The IPTV Control FE can use various means to obtain the required authorization.  For example, IMS communication services, such as SIP messaging, or SMS can be used to obtain such an authorization. Other means can also be envisaged such as e-mail.</p></td></tr>
<tr><td>4.</td><td>Once the CoD application receives such an authorization, it can send a SIP MESSAGE to the end-user to indicate that parental authorization is granted. </td></tr>
<tr><td colspan="2"><p class="indent">Following that, a normal unicast CoD session is established for the desired content.</p></td></tr>
</table>
<figure id="parental-control-browser-based-cod-application">
<figcaption>Figure #-####: Parental Control for browser-based CoD portal application</figcaption>
<img src="images/parental-control-browser-based-cod-application.png" alt="figure 6-60" style="width:90%"/>
</figure>
</section>
</section>
<section><h3>Parental Control for Scheduled Content (managed model)</h3>
<p>This section describes, at a high-level, the procedure for parental control of scheduled content by which a parent can remotely turn off access to a scheduled content program. It can be used, for example, when a parent (away from home, say) becomes aware that there might be violent pictures from a major accident shown in the news. The parent checks what the children are watching on TV, and, if it is that news program, can temporarily block access to that content.</p>
<p>Figure <a href="#parental-control-sc-high-level" class="figureRef">6-61</a> shows a high-level procedure for allowing a parent to temporarily block access to a scheduled content item. </p>
<figure id="parental-control-sc-high-level">
<figcaption>Figure #-####: High-level Procedure for Parental Control of Scheduled Content</figcaption>
<img src="images/parental-control-sc-high-level.png" alt="figure 6-61" style="width:90%"/>
</figure>
<p>The following is a description of the interactions in the flow:</p>
<table class="simple">
<tr><td>1.</td><td>A child is watching a scheduled content program on TV, for example the news.</td></tr>
<tr><td>2.</td><td>His parent acquires the information on the channel being watched (such as the BC service ID, ratings etc.). The mechanism to perform this is described in section <a href="#s6-12-1" class="sectionRef">6.12.1</a>.</td></tr>
<tr><td>3.</td><td>If the parent decides that the program is unsuitable for the child, he initiates a request which goes to the IPTV Control to block access to the program temporarily, e.g., a request for change channel, or a request to pause the media streaming, or a request for teardown the session.</td></tr>
<tr><td>4.</td><td>The program being watched by the child is blocked. Further actions depend on the service provider.</td></tr>
</table>
<section id="s6-12-3-1"><h4>Detailed Signal Flow for Parental Control of Scheduled Content</h4>
<p>Figure <a href="#parental-control-sc-detailed" class="figureRef">6-62</a> shows a detailed signal flow for the procedures that allow a parent to temporarily block access to scheduled content. </p>
<figure id="parental-control-sc-detailed">
<figcaption>Figure #-####: Detailed procedure for Parental Control of Schedule Content</figcaption>
<img src="images/parental-control-sc-detailed.png" alt="figure 6-62" style="width:90%"/>
</figure>
<p>The following is a description of the interactions between the entities:</p>
<table class="sequence">
<tr><td>1.</td><td>A parent retrieves information on the program watched by the child. The method for doing this is described in section <a href="#s6-12-1" class="sectionRef">6.12.1</a>.</td></tr>
<tr><td>2.</td><td>The parent initiates a request to block access to the program temporarily. This is done by ITF2 sending a SIP MESSAGE to the IPTV Control. The MESSAGE carries some parameters including the following:<ul>
<li>the command for the type of Parental Control requested, e.g., channel change, session termination, etc.
<li>the parent identity.
<li>the child identity.</ul></td></tr>
<tr><td>3.</td><td>The SIP MESSAGE is routed to the IPTV control via the ASM.</td></tr>
<tr><td>4.</td><td>The IPTV Control validates the message, and sends a SIP MESSAGE, including parameters such as the command for the type of Parental Control requested, the parent identity, etc., to ITF1 to block the content. In the example flow shown, the command for the type of parental control requested is to change the channel.  (Other types of parental control, such as session teardown, are also possible, but not shown.).</td></tr>
<tr><td>5.</td><td>The MESSAGE is routed to ITF1 via the ASM.</td></tr>
<tr><td>6-7.</td><td>In the example shown, the parent's request is to change the channel. ITF1 sends an IGMP Leave to leave the channel and a subsequent IGMP Join to join the new channel.</td></tr>
<tr><td>8-11.</td><td>The ITF1 responds with a 200 OK, which is routed back via the ASM to ITF2.</td></tr>
<tr><td colspan="2"><p class="indent"><b>Note:</b> Any subsequent steps are left to the service provider.</p></td></tr>
</table>
</section>
</section>
</section>
<section><h2>User Profile Management</h2>
<p>User profile management refers to the set of operations that allows a user to manage his profile. This includes the ability to create, retrieve, modify, delete, or replace the profile. </p>
<p>Below is an example for a call flow to illustrate the roles played by different entities involved in user profile management.</p>
<section><h3>IPTV User Profile Retrieval - Unmanaged Model</h3>
<p>This use case includes an end user fetching his IPTV User Profile, updating it and then uploading it.  The call flow for this use case is shown in Figure <a href="#unmanaged-user-profile-retrieval" class="figureRef">6-63</a>. </p>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>An end user, through the GUI, selects the profile retrieval option.</td></tr>
<tr><td>2.</td><td>The OITF sends an HTTP GET request to the IPTV Application FE. The request includes the user identity.</td></tr>
<tr><td>3.</td><td>The IPTV Application authenticates the user identity.</td></tr>
<tr><td>4.</td><td>The response is returned.</td></tr>
<tr><td>5.</td><td>The IPTV Application issues an XCAP GET request to the IPTV Service Profile FE.</td></tr>
<tr><td>6.</td><td>The IPTV Service Profile FE verifies the authorization policies associated with the IPTV User Profile against the identity in the incoming request and subsequently returns the IPTV User Profile to the IPTV Application in an HTTP 200 OK.</td></tr>
<tr><td>7.</td><td>The IPTV Application subsequently returns the IPTV user profile to the OITF in an HTTP 200 OK.</td></tr>
<tr><td colspan="2"><p class="indent">The received IPTV User Profile is displayed to the user who performs the desired updates, and is now ready to upload the new IPTV User profile.</p></td></tr>
<tr><td>8.</td><td>The end user, through the GUI, selects the profile update option.</td></tr>
<tr><td>9.</td><td>The OITF sends an HTTP PUT request to the IPTV Application. The request includes the user identity.</td></tr>
<tr><td>10.</td><td>The IPTV Application FE authenticates the user identity.</td></tr>
<tr><td>11.</td><td>The response is returned. </td></tr>
<tr><td>12.</td><td>The IPTV Application issues an XCAP PUT request to the IPTV Service Profile FE.</td></tr>
<tr><td>13.</td><td>The IPTV Service Profile FE verifies the authorization policies associated with the IPTV User Profile against the identity in the incoming request and subsequently returns to the IPTV Application an HTTP 200 OK after updating the profile.</td></tr>
<tr><td>14.</td><td>The IPTV Application subsequently returns the response to the OITF in an HTTP 200 OK.</td></tr>
<tr><td colspan="2"><p class="indent">The GUI displays to the user the received response.</p>
</table>
<figure id="unmanaged-user-profile-retrieval">
<figcaption>Figure #-####: IPTV User Profile retrieval and update in the Unmanaged Model</figcaption>
<img src="images/unmanaged-user-profile-retrieval.png" alt="figure 6-63" style="width:90%"/>
</figure>
</section>
</section>
<section><h2>Service and Content Protection</h2>
<p>For service and content protection, this specification supports two approaches:</p><ol>
<li>a <i>terminal-centric</i> approach that is Marlin-based, that uses OMA file formats (PDCF, DCF) and the Marlin IPMP file format for protection of files, and that supports AES or DVB-CSA encryption, the ECM from IEC 62455 [[!Ref-32]] for MPEG-2 transport stream protection; and
<li>a <i>gateway-centric</i> approach that is based on a secure authenticated channel between the CSPG and the OITF. The CSP Gateway (CSPG) functional entity supports a framework enabling alternatives to the Marlin based content and service protection solution. 
</ol>
<section><h3>Terminal-centric Content and Service Protection</h3>
<p>In the terminal-centric approach, the CSP function in the OITF and the CSP-T Server functional entity on the Provider Network exchange messages related to service and content protection over the UNIS-CSP-T reference point.</p>
</section>
<section><h3>Gateway-centric Content and Service Protection</h3>
<p>In the gateway-centric approach, the CSP Gateway (CSPG) functional entity inside the Residential Network and the CSP-G Server functional entity on the Provider Network exchange messages related to service and content protection over the UNIS-CSP-G reference point. The HNI-CSP reference point between CSPG and OITF(s) allows the OITF to access CSPG functions for the conversion from a content and service protection scheme to a secure authentication channel between the CSPG and the OITF. The HNI AGC reference point provides the connection between the CSPG and the Application Gateway (AG).</p>
<p>The CSPG and OITF functional entities are can be implemented in the same device. In this case the CA/DRM system used for content delivery will be terminated directly at the terminal device. Also, the OITF-CSPG communication is a device-internal interface that does not need to conform to the HNI-CSP interface. This is conceptually equivalent to the implementation of any chosen CAS or DRM solution in the device hosting the OITF.</p>
</section>
<section><h3>Resource Access Entitlement</h3>
<p>Users register with an IPTV Service Provider for subscription to an IPTV Service or to request content rental. Therefore, content and service protection servers (CSP-T and CSP-G Server) need to check with the IPTV Service Provider or against data provided beforehand by the IPTV Service Provider whether a given (set of) OITF(s) or CSP Gateway(s) is (are) entitled to get access to such resources. Content and service protection servers need to do so before they can supply OITFs and CGs with the corresponding resource access data (e.g., licenses, service encryption keys, content encryption keys). </p>
<p>The aforementioned data that the IPTV Service Provider sends to the content and service protection server so that it is able to decide whether or not to supply a (set of) OITF(s) or CG(s) with resource access data is referred to as <i>entitlement information</i>. For example, entitlement information may consist of an identifier for a User, an identifier of an IPTV service, a validity period, and an item such as &ldquo;grant&rdquo; or &ldquo;deny&rdquo;.</p>
<p>In the high-level architecture (see Figure <a href="#high-level-architecture" class="figureRef">5-2</a>), the IPTV Service Profile and/or the IPTV Applications functional entities are responsible for sending entitlement information to the content and service protection servers. In the terminal-centric approach, entitlement information is transferred to the CSP-T Server over the reference point NPI-CSPT1 and/or NPI CSPT1a. In the gateway-centric approach, entitlement information is transferred to the proprietary CSP-G Server over the reference point NPI-CSG1 and/or NPI-CSPG1a.  The CSP specification defines which functional entity (IPTV Service Profile or IPTV Applications) is actually responsible for supplying content and service protection servers with entitlement information.  </p>
<p>There are two different models of how the transfer of entitlement information from the IPTV Service Provider to the content and service protection server is initiated: in the <i>push</i> model, the IPTV Service Provider sends entitlement information to the content and service protection server without being requested by the latter, while in the <i>pull</i> model, the content and service protection server asks the IPTV Service Provider for entitlement information. The following sub-sections show message flows for both models, both for the terminal-centric and the gateway-centric approaches.</p>
<section><h4>Terminal-Centric Approach</h4>
<section><h5>Pull Model</h5>
<p>Figure <a href="#tca-pull-entitlement" class="figureRef">6-64</a> shows a high-level message flow for the pull of entitlement information in the terminal-centric approach.</p>
<figure id="tca-pull-entitlement">
<figcaption>Figure #-####: Pull of Entitlement Information in the TCA</figcaption>
<img src="images/tca-pull-entitlement.png" alt="figure 6-64" style="width:90%"/>
</figure>
<p>A brief description of the steps is as follows:</p>
<table class="sequence">
<tr><td>1.</td><td>The User subscribes to an IPTV service or rents a content item.</td></tr>
<tr><td>2.</td><td>The IPTV Service Provider (IPTV Service Profile / IPTV Applications) stores the result and related data for the subscription or rental transaction executed in step 1.</td></tr>
<tr><td>3.</td><td>The OITF sends a license acquisition request to the CSP-T Server.</td></tr>
<tr><td>4.</td><td>To process the request received in step 3, the CSP-T Server asks the IPTV Service Provider for entitlement information, i.e., it pulls the entitlement information from the IPTV Service Provider.</td></tr>
<tr><td>5.</td><td>The IPTV Service Provider supplies the CSP-T Server with the requested entitlement information.</td></tr>
<tr><td>6.</td><td>In accordance to the entitlement information received in step 5, the CSP-T Server sends a license response message to the OITF.</td></tr>
</table>
</section>
<section><h5>Push Model</h5>
<p>The CSP specification [[.OIPF_CSP2]] describes the push of entitlement information in the terminal-centric approach.</p>
</section>
</section>
<section><h4>Gateway-Centric Approach</h4>
<section><h5>Push Model</h5>
<p>Figure <a href="#gca-push-entitlement" class="figureRef">6-65</a> shows a high-level message flow for the push of entitlement information in the gateway-centric approach.</p>
<figure id="gca-push-entitlement">
<figcaption>Figure #-####: Entitlement Information Message Flow (Push Model)</figcaption>
<img src="images/gca-push-entitlement.png" alt="figure 6-65" style="width:90%"/>
</figure>
<p>A brief description of the steps is as follows:</p>
<table class="sequence">
<tr><td>1.</td><td>The User subscribes to an IPTV service or rents a content item.</td></tr>
<tr><td>2.</td><td>The IPTV Service Provider (IPTV Service Profile / IPTV Applications) stores the result and related data for the subscription or rental transaction executed in step 1.</td></tr>
<tr><td>3.</td><td>The IPTV Service Provider sends entitlement information (e.g., that OITF X has successfully subscribed to a particular IPTV service) to the CSP G Server, i.e., it <i>pushes</i> the entitlement information to the CSP-G Server.</td></tr>
<tr><td>4.</td><td>The OITF requests access to a protected resource. In the CSPG-CI+ case, this request takes place within the OITF. In the CSPG-DTCP case, this request is submitted to the CSPG.</td></tr>
<tr><td>5.</td><td>Based on the entitlement information received by CSP G Server the proprietary solution made of CSPG and CSP-G Server functional entities decides on whether to grant or deny the request initiated by the OITF in step 4. The details of this step are out of scope of OIPF specifications.</td></tr>
</table>
</section>
<section><h5>Pull Model</h5>
<p>The CSP specification [[.OIPF_CSP2]] describes the pull of entitlement information in the gateway-centric approach.</p>
</section>
</section>
</section>
</section>
<section><h2>User Notification Service</h2>
<section><h3>User Notification Service Framework</h3>
<p>User notification allows a user to request a notification be sent to him for specific events, such as a broadcast reminder for the start of a scheduled content. This section defines the necessary framework to support this feature. The framework can be applied against any event. The actual events themselves are outside the scope of this specification. </p>
<p>The notification sent to a user can be in the form of a text message on a mobile phone, an email, or an IMS instant message.</p>
<p>The user configures the preferred method for delivering a notification to him, as well as the information required for the selected delivery method.</p>
<p>The list of services available with user notification is:</p><ul>
<li>Setting a notification service request
<li>Deleting a pending notification service request.
<li>Requesting a list of all pending notification service requests.
<li>Modifying a pending notification service request, which is a combination of a delete operation and setting up a new request.</ul>
<p>Two procedures shall be defined for user notification services, an IMS procedure and a DAE procedure.</p> 
<p>It is important to note that user notification service is independent from instant messaging service, even though both use the same underlying SIP MESSAGE. Hence, the user notification service is not tied to a user's subscription to the instant messaging application, and/or the activation of the instant messaging application by the end user in case of subscription.</p>
<section><h4>IMS procedure for User Notification Services</h4>
<section><h5>Setting up a Notification Service request</h5>
<p>The call flow in Figure <a href="#ims-procedure-setting-up-user-notification" class="figureRef">6-66</a> depicts the sequence for setting up a notification service request. </p>
<figure id="ims-procedure-setting-up-user-notification">
<figcaption>Figure #-####: IMS procedure for setting up a notification service </figcaption>
<img src="images/ims-procedure-setting-up-user-notification.png" alt="figure 6-66" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>Upon user triggering, the OITF issues an HTTP POST to the IG that includes a SIP MESSAGE requesting the setting up of a notification service for a selected event</td></tr>
<tr><td>2.</td><td>The IG sends a SIP MESSAGE to the ASM</td></tr>
<tr><td>3.</td><td>The ASM forwards the SIP MESSAGE to the IPTV Control FE.</td></tr>
<tr><td>4.</td><td>The IPTV Control FE performs user authorization, then forwards the request to the IPTV Application responsible for handling the request.</td></tr>
<tr><td>5.</td><td>If needed, the IPTV Application validates the content of the request with the IPTV Metadata Control</td></tr>
<tr><td>6.</td><td>The IPTV Metadata Control returns the response to the IPTV Application.</td></tr>
<tr><td>7.</td><td>The IPTV Application then forwards the response back to the IPTV Control FE. For a successful request, the IPTV Application includes a notification request identity that is carried all the way to the OITF. The notification request identity shall be carried in all subsequent operations that want to reference the request.</td></tr>
<tr><td>8.</td><td>The IPTV Control FE generates a SIP 200 OK response (that includes the notification request identity)  or any other appropriate response back to the ASM </td></tr>
<tr><td>9.</td><td>The ASM forwards the response to the IG</td></tr>
<tr><td>10.</td><td>The IG sends an HTTP 200 OK to the OITF that includes the SIP response to the SIP MESSAGE</td></tr>
</table>
</section>
<section><h5>Deletion of a Pending Notification Service request </h5>
<p>The call flow in Figure <a href="#ims-procedure-deleting-user-notification" class="figureRef">6-67</a> depicts the sequence for deleting a pending notification service request. </p>
<figure id="ims-procedure-deleting-user-notification">
<figcaption>Figure #-####: IMS procedure for deleting a pending notification service request</figcaption>
<img src="images/ims-procedure-deleting-user-notification.png" alt="figure 6-67" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>Upon user triggering, the OITF issues an HTTP POST to the IG that includes a SIP MESSAGE requesting the deletion of a pending notification service request</td></tr>
<tr><td>2.</td><td>The IG sends a SIP MESSAGE to the ASM. The SIP MESSAGE includes the identity of the notification service request to be deleted.</td></tr>
<tr><td>3.</td><td>The ASM forwards the SIP MESSAGE to the IPTV Control FE.</td></tr>
<tr><td>4.</td><td>The IPTV Control FE performs user authorization, then forwards the request to the IPTV Application responsible for handling the request</td></tr>
<tr><td>5.</td><td>The IPTV Application deletes the pending notification service request, then forwards the response back to the IPTV Control FE</td></tr>
<tr><td>6.</td><td>The IPTV Control FE returns a SIP 200 OK response to the ASM</td></tr>
<tr><td>7.</td><td>The ASM forwards the response to the IG</td></tr>
<tr><td>8.</td><td>The IG sends an HTTP 200 OK to the OITF that includes the SIP 200 OK response.</td></tr>
</table>
</section>
</section>
<section><h4>DAE procedure for User Notification Services</h4>
<p>The call flow in Figure <a href="#dae-procedure-user-notification" class="figureRef">6-68</a> depicts the generic sequence for all DAE-based operations for the user notification services. </p>
<figure id="dae-procedure-user-notification">
<figcaption>Figure #-####: DAE procedure for User Notification Services</figcaption>
<img src="images/dae-procedure-user-notification.png" alt="figure 6-68" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the call flow</p>
<table class="sequence">
<tr><td>1.</td><td>Due to user triggering, the OITF issues an HTTP POST to the IPTV Application. The request includes all the necessary information pertinent to the requested operation.</td></tr>
<tr><td>2.</td><td>If applicable, the IPTV Application validates the content of the request with the IPTV Metadata Control</td></tr>
<tr><td>3.</td><td>The IPTV Metadata Control returns the response to the IPTV Application.</td></tr>
<tr><td>4.</td><td>The IPTV Application then forwards the response back to the OITF in an HTTP 200 OK. If the requested operation is for setting up a notification service request, the response includes a notification request identity.</td></tr>
</table>
</section>
<section><h4>Generation and Delivery of Notifications</h4>
<p>Requested notifications to be delivered to an end user can occur via a text message to a mobile, an IMS instant message, or an email.</p>
<p>The following section depicts some examples for generating and delivering notifications</p>
<section><h5>Notification to an OITF using IMS IM </h5>
<p>The call flow in Figure <a href="#notification-delivery-to-oitf" class="figureRef">6-69</a> depicts the sequence for delivering a text notification to an OITF using IMS instant messaging. </p>
<figure id="notification-delivery-to-oitf">
<figcaption>Figure #-####: Delivery of notification to an OITF </figcaption>
<img src="images/notification-delivery-to-oitf.png" alt="figure 6-69" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the call flow:</p>
<table class="sequence">
<tr><td>1.</td><td>When the IPTV Application is ready to deliver a notification to an end user, it generates an HTTP request to the Notification Services functional entity.  The HTTP request includes the requested notification.</td></tr>
<tr><td>2.</td><td>The Notification Services functional entity generates a SIP MESSAGE for the intended user and delivers it to the IMS AS. </td></tr>
<tr><td>3.</td><td>The IMS AS sends a SIP MESSAGE to the ASM</td></tr>
<tr><td>4.</td><td>The ASM delivers the SIP MESSAGE to the IG</td></tr>
<tr><td>5a.</td><td>The IG returns an HTTP 200 OK response to the OITF that includes the SIP MESSAGE. (It is assumed that the OITF had an HTTP pending request).</td></tr>
<tr><td>5b.</td><td>The OITF generates an HTTP POST message that includes the SIP 200 OK response to the received SIP MESSAGE.</td></tr>
<tr><td>6.</td><td>The IG forwards the SIP 200 OK to the ASM.</td></tr>
<tr><td>7-8.</td><td>The ASM forwards the SIP 200 OK to the Notification Services functional entity.</td></tr>
<tr><td>9.</td><td>The Notification Services functional entity returns an HTTP 200 OK response to the IPTV Application. The HTTP 200 OK response includes the SIP response to the SIP MESSAGE. </td></tr>
</table>
</section>
<section><h5>Notification to a mobile phone</h5>
<p>The call flow in Figure 6 70 depicts the sequence for delivering a text (i.e., SMS) notification to a mobile phone. The following is a brief description of the steps in the call flow</p>
<figure id="notification-delivery-to-mobile-phone">
<figcaption>Figure #-####: Delivery of a notification to a mobile phone</figcaption>
<img src="images/notification-delivery-to-mobile-phone.png" alt="figure 6-69" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>When the IPTV Application is ready to deliver a notification to an end user, it generates an HTTP message that includes the desired notification to the Notification Services functional entity.</td></tr>
<tr><td>2.</td><td>The Notification Services functional entity generates a text message, based on short message peer-to-peer (SMPP) protocol [[!Ref-41]], to the user mobile. The message goes to the Other Delivery Network entity (e.g., SMS centre) associated with the end-user.</td></tr>
<tr><td>3.</td><td>The Other Delivery Network entity (e.g., SMS centre) delivers the message to the user's mobile.</td></tr>
<tr><td>4.</td><td>The Notification Services functional entity returns an HTTP 200 OK response to the IPTV Application. </td></tr>
<tr><td colspan="2"><p class="indent">Note that the notification may in certain cases require the mobile cellular device to make a selection based on the incoming notification and return its selection, via an SMS, to the IPTV Application.</p></td></tr>
</table>
</section>
</section>
<section id="s6-15-1-4"><h4>Provisioning of User preference for Delivery of Notifications</h4>
<p>User preference for delivering a notification and the necessary information to be configured is performed as per <a href="volume4.html#s5-4-4" class="extRef">section 5.4.4</a> entitled &ldquo;Subscription profile management and Usage&rdquo; of [[.OIPF_PROT2]].</p>
</section>
</section>
<section id="s6-15-2"><h3>Emergency notification</h3>
<p>Emergency notification is a type of notification about critical events, which the network initiates and sends to the OITF.  Emergency notifications are discovered and obtained without user intervention.</p>
<p>Figure <a href="#retreiving-emergency-notifications" class="figureRef">6-71</a> shows the call flow for retrieving emergency notification.</p>
<figure id="retreiving-emergency-notifications">
<figcaption>Figure #-####: Retrieving Emergency notifications </figcaption>
<img src="images/retreiving-emergency-notifications.png" alt="figure 6-71" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF discovers the access information (i.e. protocol and IP addresses) of the emergency notification service. This is done in the SP discovery flow.</td></tr>
<tr><td colspan="2"><p class="indent"><b>Note:</b> The discovery typically occurs during the power up procedure.</p></td></tr>
<tr><td>2.</td><td>The OITF joins the multicast channel of the emergency notification service using an IGMP JOIN. This is done by the terminal directly after the SP discovery flow, without user interaction.</td></tr>
<tr><td>3.</td><td>When necessary, the notification service generates an emergency message and sends it to the Multicast Content Delivery Function.</td></tr>
<tr><td colspan="2"><p class="indent">The emergency message shall contain the reason for notification and the notification content.</p></td></tr>
<tr><td colspan="2"><p class="indent">The generation of emergency notification message may be triggered by another entity.</p></td></tr>
<tr><td>4.</td><td>The Multicast Content Delivery Function (MCDF) sends the notification message to the Transport Processing Function.</td></tr>
<tr><td colspan="2"><p class="indent">The Multicast Content Delivery Function delivers the notification to the specific notification multicast group which may be pre-configured on the Multicast Content Delivery Function.</p></td></tr>
<tr><td>5.</td><td>The OITF receives the emergency notification message and processes it properly.</td></tr>
</table>
</section>
<section><h3>Network Generated Notifications associated with a Scheduled Content Service</h3>
<p>Network generated notifications can be provided by the network to the user about events related to a scheduled content service, i.e. the notification service should only be consumed together with the related scheduled content service. To allow the independent purchase of such notifications, the notification service is described as a separate service from the related scheduled content. In this case, an extension to the scheduled content service mechanism, through the inclusion of a &ldquo;Network Generated Notification&rdquo; indicator, is used to identify such a notification service.</p>
<p>A network-generated notification message is a multimedia message consisting of text, picture and/or audio-video clips. Multicast delivery is used for delivering such network-generated notifications to multiple users at the same time.</p> 
<p>To access to the scheduled content as well as the related notification service in one procedure, the scheduled content session initialization procedure defined in section <a href="#s6-6-1" class="sectionRef">6.6.1</a> is extended, as shown in Figure <a href="#procedure-for-network-generated-notifications" class="figureRef">6-72</a>.</p>
<figure id="procedure-for-network-generated-notifications">
<figcaption>Figure #-####: Procedure for network-generated Notifications</figcaption>
<img src="images/procedure-for-network-generated-notifications.png" alt="figure 6-72" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF discovers the scheduled content service related notifications via the service discovery procedure.</td></tr>
<tr><td>2.</td><td>The OITF sends an HTTP POST message to the IG. The serviceID for the Scheduled Content and the related notification service are both included in the SDP.</td></tr>
<tr><td>3.</td><td>The IG issues a SIP INVITE message.</td></tr>
<tr><td>4.</td><td>The ASM uses the services of the RAC to perform resource reservation for both the Scheduled Content and the related Notification service.</td></tr>
<tr><td>5.</td><td>The ASM proxies the SIP INVITE message to the IPTV Control FE.</td></tr>
<tr><td>6.</td><td>The IPTV Control verifies that the user is subscribed to the scheduled content as well as the related notification service, and acknowledges the session setup request with a 200 OK.</td></tr>
<tr><td>7.</td><td>The ASM instructs the RACS to commit the reserved resource.</td></tr>
<tr><td>8.</td><td>The ASM proxies the 200 OK to the IG.</td></tr>
<tr><td>9.</td><td>The IG returns to the OITF an HTTP 200 OK.</td></tr>
<tr><td>10.</td><td>The OITF issues an IGMP JOIN to join the multicast groups for each of the scheduled content and the related notification service.</td></tr>
<tr><td>11.</td><td>The OITF receives the media for the scheduled content. </td></tr>
<tr><td>12-13.</td><td>At some point in time, the IPTV Application sends a notification message to the Transport Processing Function via the MCDF;</td></tr>
<tr><td>14.</td><td>The OITF receives the notification message related to the scheduled content.</td></tr>
</table>
</section>
</section>
<section><h2>Personalised Channel </h2>
<p>&ldquo;Personalised Channel&rdquo; is a service where content items from scheduled content and CoD service are lined up on a per-user basis according to the user's preferences, viewing habits or service provider recommendations. </p>
<p>There are two approaches based on which entity provides the Personalised Channel:</p><ul>
<li><b>OITF-centric Personalised Channel</b>
<p>The OITF itself generates the personalised content guide based on the user's preference or viewing habits and creates the Personalised Channel. The OITF takes necessary actions such as detecting any overlapped content items and generating recording requests to the nPVR or LPVR as necessary.</p>
<li><b>Network-centric Personalised Channel </b>
<p>The IPTV Service Provider generates the personalised content guide based on the user's preference or service provider recommendations, which may be based on audience measurement data. The IPTV Service Provider takes necessary actions to provide the Personalised Channel such as detecting overlapped content items and generating recording request to the nPVR or LPVR for such cases.</p>
<p><b>Note:</b> The generated Personalized Content Guide can be modified whenever the user requests it.</p>
</ul>
<section id="s6-16-1"><h3>OITF-centric Personalised Channel</h3>
The call flow in Figure <a href="#oitf-centric-personalized-channel" class="figureRef">6-73</a> shows a simple use case when the OITF provides the Personalised Channel. This consists of two parts: Personalised Channel setup and viewing the Personalised Channel. 
<figure id="oitf-centric-personalized-channel">
<figcaption>Figure #-####: OITF-centric Personalized Channel</figcaption>
<img src="images/oitf-centric-personalized-channel.png" alt="figure 6-73" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:<p>
<table class="sequence">
<tr><td>0.</td><td>The OITF obtains the basic Content Guide as described in section <a href="#s6-2-1-5" class="sectionRef">6.2.1.5</a>.</td></tr>
<tr><td>1.</td><td>The OITF generates the content guide for a Personalised Channel based on the user's preferences or viewing habits.</td></tr>
<tr><td>2.</td><td>The OITF detects overlapping content items and decides on the location (LPVR or nPVR) for recording the overlapped contents.</td></tr>
<tr><td>3.</td><td>The overlapping content is recorded.  If the OITF decides in Step 2 to record using an LPVR, then Step 3-1 will be performed. If the OITF decides in Step 2 to record at an nPVR, then Step 3-2 will be followed.</td></tr>
<tr><td>3-1.</td><td>The OITF records the overlapping contents using an LPVR</td></tr>
<tr><td>3-2.</td><td>The OITF sends a scheduled nPVR recording request message.</td></tr>
<tr><td>3-2-1.</td><td>The overlapped content items are recorded at an nPVR</td></tr>
<tr><td>4.</td><td>The OITF sets up the proper session for content delivery or plays the content locally.  Depending on the content item in the personalised content guide, the appropriate session is set up, the content is transported and the session finally torn down. This step will be performed repeatedly for each content item in the personalised Content Guide.<ol type="a">
<li>For broadcast content, a multicast session is set up and torn down. 
<li>For content from an nPVR or a CoD item, a unicast session is setup and torn down. 
<li>The content items from an LPVR is played without network intervention
<li>The content items from a home network device is played without network intervention</ol></td></tr>
<tr><td colspan="2"><p class="indent"><b>Note:</b> Steps 2 and 3 can be happen whenever a new overlap among content items is detected.</p></td></tr>
</table>
</section>
<section><h3>Network-centric Personalised Channel (PCh)</h3>
<p>Figure <a href="#pch-high-level-procedure" class="figureRef">6-74</a> shows a high level procedure for a network-centric Personalised Channel service. The procedure includes the following three sub-procedures: </p>
<p><b>Network-centric PCh Configuration procedure:</b> The user configures the PCh as described in section <a href="#s6-16-2-1" class="sectionRef">6.16.2.1</a>.</p>
<p><b>Network-centric PCh Service set-up procedure:</b> The user initiates the PCh service session when he/she wants to watch the Personalised Channel. The detailed procedure is described in section <a href="#s6-16-2-2" class="sectionRef">6.16.2.2</a> or in section <a href="#s6-16-2-3" class="sectionRef">6.16.2.3</a> based on the deployment chosen.</p>
<p><b>Network-centric PCh Service teardown procedure:</b> The PCh service teardown procedure may be triggered by the user's action, at the end of the PCh service or when it is needed.  The procedure in section <a href="#s6-4-3" class="sectionRef">6.4.3</a> or <a href="#s6-6-2" class="sectionRef">6.6.2</a> shall be reused.</p>
<figure id="pch-high-level-procedure">
<figcaption>Figure #-####: High-level procedure for network-centric PCh service</figcaption>
<img src="images/pch-high-level-procedure.png" alt="figure 6-74" style="width:90%"/>
</figure>
<section id="s6-16-2-1"><h4>Network-centric PCh Configuration</h4>
<p>Figure <a href="#network-pch-configuration" class="figureRef">6-75</a> below depicts the call flow for configuration of the Personalised Channel, where the IPTV Application generates, at the user's request, the personalised content guide based on the user profile and content metadata.</p>
<p>The user can update the personalised content guide with his preferences as well.</p>
<figure id="network-pch-configuration">
<figcaption>Figure #-####: Network-centric PCh configuration procedure</figcaption>
<img src="images/network-pch-configuration.png" alt="figure 6-75" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The ITF sends an HTTP GET, with the user id, to the IPTV Application to request the configuration of the PCh.</td></tr>
<tr><td>2.</td><td>The IPTV Application sends an XCAP GET to the IPTV Service Profile with the user id, which responds with a 200 OK including the user's IPTV service profile. </td></tr>
<tr><td>3.</td><td>The IPTV Application checks the user's rights for the PCh service, and interacts with the IPTV Metadata Control to generate a personalised content guide based on user preference, etc., and creates related information, e.g. PCh id.</td></tr>
<tr><td>4.</td><td>The IPTV Application sends a 200 OK to the ITF with the PCh content guide containing related information e.g., PCh id, selected content IDs and related time schedule. </td></tr>
<tr><td>5.</td><td>The ITF sends an HTTP POST to the IPTV Application to update the PCh content guide. The IPTV Application may store the PCh information in the IPTV Service Profile.</td></tr>
<tr><td>6.</td><td>The IPTV Application sends HTTP 200 OK back to the ITF</td></tr>
<tr><td>7.</td><td>If supported by the OITF, the DAE may be used to set up any necessary local PVR. </td></tr>
</table>
</section>
<section id="s6-16-2-2"><h4>Network-centric procedure for PCh service set-up (multicast/unicast)</h4>
<p>Figure <a href="#network-pch-setup-procedure" class="figureRef">6-76</a> shows the high-level call flows for PCh service setup.</p>
<figure id="network-pch-setup-procedure">
<figcaption>Figure #-####: Network-centric PCh service set-up procedure </figcaption>
<img src="images/network-pch-setup-procedure.png" alt="figure 6-76" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The user selects the PCh channel from the content guide.</td></tr>
<tr><td>2a-b.</td><td>Depending on the content guide information, the ITF requests the related PCh service, and establishes either a scheduled content session (Step 2a) or a CoD session (Step 2b). Shortly before it is time for the next item in the PCh playlist to be streamed, as indicated by the PCh information, several alternatives are possible depending on the type of content item that is being streamed and what is next:<ul>
<li>If the item being streamed is scheduled content and the next item in the PCh playlist is also a scheduled content item, and if the IPTV Application has determined that there is no overlapping in time between these content items, the IPTV Application modifies the existing scheduled content session (if appropriate) for the new content item;
<li>If the item being streamed is scheduled content and the next item in the PCh playlist is also a scheduled content item, and if there is an overlapping in time with the previous item, step 3 onwards is followed.
<li>If the item being streamed is a scheduled content item, and the next item in the PCh schedule is a CoD item, and if there is no overlapping in time, then the scheduled content session is torn down after its completion and a new session is created for the CoD item
<li>If the item being streamed is scheduled content and the next item in the PCh playlist is a CoD item, and if there is an overlapping in time with the previous item, then the CoD item shall be delayed until the scheduled content is completed.
<li>If the item being streamed is a CoD  item and the next item in the PCh playlist is a scheduled content item, and if the IPTV Application has determined that there is no overlapping in time between these content items, the IPTV application tears down the old session and a new session is established for the scheduled content
<li>If the item being streamed is a CoD item and the next item in the PCh playlist is a scheduled content item, and if the IPTV Application has determined that there is an overlapping in time with the previous content item, then step 3 onwards is followed 
<li>If the item current being watched is a CoD item and the next item in the PCh schedule is also a CoD item, and if the IPTV Application has determined that there is no overlapping in time with the previous content, then the CoD session is modified to switch to the next content item. 
<li>If the item current being watched is a CoD item and the next item in the PCh schedule is also a CoD item,  and if the IPTV Application has determined that there is an overlap in time, then the next CoD is delayed until the first CoD content is completed.  </ul></td></tr>
<tr><td>3.</td><td>The IPTV Application has detected that there is an the overlap between the content item that is currently being streamed and the next item in the PCh playlist. It selects, based on user choice or SP policy or ITF capabilities the location of the PVR (Local PVR or nPVR) for recording the overlapped content items.</td></tr>
<tr><td>4.</td><td>The IPTV Application triggers the initiation of the appropriate PVR procedure based on the selected mode of recording (Local PVR or nPVR).</td></tr>
<tr><td>5.</td><td>The OITF may play out the LPVR content, if it has been locally recorded. </td></tr>
</table>
</section>
<section id="s6-16-2-3"><h4>Network-centric procedure for PCh service setup (unicast only)</h4>
<p>Figure <a href="#network-pch-unicast-setup-procedure" class="figureRef">6-77</a> depicts the call flow for PCh service setup, where a single unicast session between the ITF and the network is established for multiple items provided by the network, regardless of the content types (scheduled content item or content-on-demand content item).</p>
<figure id="network-pch-unicast-setup-procedure">
<figcaption>Figure #-####: Network-centric PCh service unicast set-up procedure</figcaption>
<img src="images/network-pch-unicast-setup-procedure.png" alt="figure 6-77" style="width:90%"/>
</figure>
<p>This call flow shows a specific deployment where a Service Provider's CDN is used for unicast delivery of both CoD as well as scheduled content. </p>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>1.</td><td>The ITF sends the unicast session setup request (SIP INVITE), containing the PCh id and the unicast SDP, to the IPTV Control via the ASM.</td></tr>
<tr><td>2-3.</td><td>The IPTV Control validates the request and retrieves the related PCh information (e.g. list of content to be played with the time schedule of each item) from the IPTV Application.</td></tr>
<tr><td>4-5.</td><td>The IPTV Control sends the unicast session setup request (SIP INVITE), containing the content ID (e.g. BC Channel ID or COD content ID) to be played, to the CC via the ASM and the CDNC.</td></tr>
<tr><td>6.</td><td>The CC sets up the content delivery session (using RTSP SETUP) towards the CDF. </td></tr>
<tr><td>7.</td><td>For scheduled content, which is not stored in the CDF, the CDF will need to join the multicast channel and perform the multicast-to-unicast conversion.</td></tr>
<tr><td>8.</td><td>Following that, the CDF returns an RTSP 200 OK to the CC. </td></tr>
<tr><td>9-11.</td><td>The session setup response (SIP 200 OK) is sent from the CC to the ITF via the CDNC, IPTV Control and ASM.</td></tr>
<tr><td>12.</td><td>The content is delivered from the CDF to the ITF through a unicast delivery channel.</td></tr>
<tr><td>13.</td><td>When the PCh information indicates that it is time for the next item to be streamed, and it has been determined that there is no overlap with the ongoing content item currently being streamed, the IPTV Application initiates a unicast session modification procedure, via the ASM, CDNC and CC, to indicate to the CDF to switch to the new content using the next Content ID (e.g., BC Channel ID or CoD Content ID). </td></tr>
<tr><td>14.</td><td>When the PCh information indicates that it is time for the next item in the content play list to be streamed, and the IPTV Application detects an overlap between the current content, which is still being streamed to the OITF, and the new one that is about to start, the IPTV Application decides on the location of the PVR (Local PVR or nPVR) to be used for recording the overlapped contents.</td></tr>
<tr><td>15.</td><td>The IPTV Applications triggers the initiation of the procedure to start an nPVR or a Local PVR, based on the user's choice, or SP policy, or ITF capability, in accordance with section <a href="#s6-10" class="sectionRef">6.10</a>.</td></tr>
<tr><td>16.</td><td>The unicast session may be modified if the reserved resource is not sufficient for the upcoming PCh item, e.g. due to a higher bandwidth requirement. In this case, the CC-initiated session modification procedure is applied.</td></tr>
</table>
</section>
</section>
</section>
<section id="s6-17"><h2>Session Transfer and Replication</h2>
<p><b>Session Transfer</b> allows a user to transfer an ongoing unicast session from the device where the content is currently being streamed, and which will be called the original device, to another device, called the target device, where the user can resume watching the same content. Following the successful transfer of the session, the original session is terminated.</p>
<p><b>Session Replication</b> allows a user to replicate an ongoing unicast session from the device where the content is currently being streamed, and which will be called original device, to another device, called the target device, where the user can resume watching the same content. The original session continues to be maintained following the successful replication of the session, and indeed the original device and the target device have now completely independent sessions.</p>
<p>There are 2 modes of operation for session transfer and session replication. They are:</p><ul>
<li><b>Push mode:</b> Where the end-user pushes the current session from the device where he is currently watching to a target device of his choice.
<li><b>Pull mode:</b> Where the end-user uses the target device to pull the session he desires to resume watching from the target device. 
</ul>
<p>Note that the term device in all of the above implies any physical entity that incorporates the OITF, or a mobile device that has access to the same IMS-based managed network. </p>
<p class="inline-header">Considerations when both devices, party to a session transfer, are behind the same access network</p>
<p>The session transfer procedure involves establishing two sessions simultaneously during the transition period before the procedure is successfully completed. If the two devices are located behind the same access, e.g. behind the same IG in a household, then the IG has to ensure that the two established sessions, during the transition period, do not result in the reserved QoS resources being doubled, which can be a problem for certain types of home-to-access network interfaces where bandwidth is limited. </p>
<p>This can be accomplished through the IG detecting that the two devices are within the same household, and behind the same IG. The IG can then release the resources associated with the original device during the transfer process, without tearing down the session, so that these resources can be allocated to the target device.   </p>
<p>Note that although all figures depicting various call flows show a single IG for simplicity, indeed the description assumes that each OITF is associated with a separate IG. This aspect is further highlighted in the description where appropriate.  </p>
<p>Also note that all green shaded boxes and/or green shaded areas are unique to the pull or push method, while non-shaded areas and boxes are common to both pull and push. The shading is meant to highlight the differences and commonalities, amongst the two modes.</p>
<section><h3>Push Mode</h3>
<section><h4>High Level Push Procedure for Session Transfer and Session Replication</h4>
Figure <a href="#session-xfer-repl-high-level" class="figureRef">6-78</a> shows the high level procedure employed in the push mode for session transfer and replication.
<figure id="session-xfer-repl-high-level">
<figcaption>Figure #-####: High-level Push procedure for session transfer/replication</figcaption>
<img src="images/session-xfer-repl-high-level.png" alt="figure 6-78" style="width:90%"/>
</figure>
<p>The following is brief description of the steps in the call flow:</p>
<table class="sequence">
<tr><td>1.</td><td>It is assumed that the OITF1 is receiving streaming content over an established CoD session. At some point in time, the user on OITF1 decides that he wants to transfer or replicate the current CoD session to (or on) another device (another OITF for example). </td></tr>
<tr><td>2.</td><td>In this step, a dynamic device discovery procedure is performed to identify the potential list of devices, one of which will be the target device for a session transfer or replication. This procedure is specified by 3GPP in [[!Ref-37]]. </td></tr>
<tr><td>3.</td><td>In this example, OITF2 has been selected as the target device, and a request is sent to OITF2 to request it to initiate a session transfer or to replicate a session.</td></tr>
<tr><td>4.</td><td>If OITF2 accepts the incoming request, it initiates a new session with the network to transfer or replicate the session on OITF1. </td></tr>
<tr><td>5.</td><td>The request in step 4 is sent to the IG.  If the request is for a session transfer, the IG verifies if the target and the original devices are located within the same household and behind the same IG. If so, the IG performs the necessary procedure to avoid multiple QoS reservation.  </td></tr>
<tr><td>6.</td><td>The IPTV Control FE optionally bookmarks the ongoing session, if no bookmark has been performed by the original device, so that viewing the content from the target device can start from the point in time where the session transfer or replication was initiated.</td></tr>
<tr><td>7.</td><td>The new session from OITF2 is successfully established.</td></tr>
<tr><td>8.</td><td>In the session transfer case, once the new session is successfully transferred, the IPTV Control FE tears down the old session. </td></tr>
</table>
</section>
<section><h4>Push Procedure for Session Transfer and Session Replication</h4>
<p>The call flows in Figure <a href="#session-xfer-repl-push-part1" class="figureRef">6-79</a> and Figure <a href="#session-xfer-repl-push-part2" class="figureRef">6-80</a> depict a more detailed procedure for session transfer/replication. </p>
<figure id="session-xfer-repl-push-part1">
<figcaption>Figure #-####: Detailed Push procedure for session transfer/replication &mdash; Part 1</figcaption>
<img src="images/session-xfer-repl-push-part1.png" alt="figure 6-79" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the call flow: </p>
<table class="sequence">
<tr><td>1.</td><td>The user has established a CoD session on OITF1, and decides to transfer or replicate the session to another device. The user selects the push option on OITF1. In order to select a target device, the 3GPP procedure for dynamic discovery of devices is performed to allow the user to discover all devices registered to all users that are under the same subscription.</td></tr>
<tr><td>2.</td><td>Once a device is selected by the end user, OITF1 issues an HTTP POST to the IG for a session transfer or replication. The request includes the identity of the session to be transferred (Session Transfer Identifier &mdash; STI), the identity of the target device the session is transferred to, and an indicator to show if session transfer or replication is requested. OITF1 may include the offset as well in the request. Additional pertinent parameters are also included in the request. </td></tr>
<tr><td>3.</td><td>The IG then issues a SIP REFER request to the target device via the ASM and the IPTV Control FE. The REFER request includes the STI, the content identifier, the target device identity and other pertinent parameters. The position being viewed on the device may be included in the body of the SIP REFER.</td></tr>
<tr><td>4.</td><td>OITF1 issues an HTTP POST pending request in anticipation of the response.</td></tr>
<tr><td>5.</td><td>The IPTV Control FE proxies the SIP REFER back to the IG associated with the target device.</td></tr>
<tr><td>6.</td><td>The IG sends an HTTP 200 OK to OITF2 that includes the SIP REFER. (It is assumed that a HTTP pending request has previously been issued by OITF2 in anticipation of any unsolicited response from the network)</td></tr>
<tr><td>7.</td><td>The OITF2 accepts the incoming request and issues an HTTP POST request to the IG that includes a SIP 202 ACCEPTED response in the POST body.</td></tr>
<tr><td>8.</td><td>The IG forwards the SIP 202 ACCEPTED to the ASM and the IPTV Control FE</td></tr>
<tr><td>9.</td><td>The IPTV Control FE forwards the SIP 202 ACCEPTED to the IG associated with OITF1.</td></tr>
<tr><td>10.</td><td>The IG sends an HTTP 200 OK to OITF1 that includes the SIP 202 ACCEPTED response in the HTTP response body.</td></tr>
<tr><td>11.</td><td>OITF1 issues an HTTP POST pending request.</td></tr> 
<tr><td>12.</td><td>OITF2 now starts the transfer procedure: OITF2 issues an HTTP POST request to the IG. The IG includes the STI for the session to be transferred, the CoD content identifier, and an indication of whether this is a session transfer or a session replication request in addition to other pertinent parameters. (Note that this step can occur right after step 7)</td></tr>
<tr><td colspan="2"><p class="indent">If the request is for a session transfer, the IG verifies if the original and the target OITF belong to the same household and are behind the same IG. If that is the case, then the IG executes the procedure defined in section <a href="#s6-17-3-1" class="sectionRef">6.17.3.1</a>  prior to executing the next step in this procedure. If the request is for a session replication, the IG does not perform any additional procedure, and moves onto the next step in this procedure.</p></td></tr>
<tr><td colspan="2"><p class="indent">In this call flow it is assumed that the two OITFs do not belong to the same household, even though one IG is only shown in the figure for simplicity.</p></td></tr>
<tr><td>13.</td><td>The IG then issues a SIP INVITE to the ASM. The INVITE request includes the STI, the CoD content identifier and other relevant parameters as obtained from step 12. The ASM performs resource reservation based on the requested bandwidth.</td></tr>
<tr><td>14.</td><td>The ASM forwards the INVITE to the IPTV Control FE.</td></tr>
<tr><td>15.</td><td>The IPTV Control FE optionally performs bookmarking for the original session, using the procedure defined in section <a href="#s6-17-3-2" class="sectionRef">6.17.3.2</a>, if the original device, OITF1, did not perform one.  The IPTV Control FE is involved in the bookmarking procedure and as such it is aware if OITF1 bookmarked the session.</td></tr>
<tr><td colspan="2"><p class="indent">Steps 16-21 are performed in case the request is for session transfer. In these steps, the IPTV Control FE instructs the original device, OITF1 to put the media on hold, if OITF1 did not already undertake that step. Note that if both devices involved in a session transfer are behind the same IG, the IG instructs the OITF to put the media on hold as per the procedure described in section <a href="#s6-17-3-1" class="sectionRef">6.17.3.1</a> and this procedure is not performed, </td></tr>
<tr><td>16.</td><td>The IPTV Control FE sends a SIP re-INVITE to the original device, OITF1, to put the media on hold. If OITF1 has already put the media on hold, step 21 onwards is executed.</td></tr>
<tr><td>17.</td><td>Upon receipt of the re-INVITE to put the media on hold, OITF sends an RTSP PAUSE to the CC prior to putting the media on hold.</td></tr>
<tr><td>18.</td><td>The CC in turn issues an RTSP PAUSE to the CDF</td></tr>
<tr><td>19.</td><td>The CDF returns a 200 OK to the CC</td></tr>
<tr><td>20.</td><td>The CC returns a 200 OK to OITF1.</td></tr>
</table>
<figure id="session-xfer-repl-push-part2">
<figcaption>Figure #-####: Detailed Push procedure for session transfer/replication &mdash; Part 2</figcaption>
<img src="images/session-xfer-repl-push-part2.png" alt="figure 6-80" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>21.</td><td>OITF1 returns a 200 OK SIP response to the IPTV Control FE.</td></tr>
<tr><td colspan="2"><p class="indent">For steps 22-32, if the request is for session transfer and the same CDF (used by OITF1) will be used for OITF2, then the IPTV Control FE can initiate a SIP UPDATE or re-INVITE towards the remote target, otherwise a new SIP session will be established, in which case the old SIP and RTSP session SHALL be torn down by the IPTV Control FE (tearing down the old SIP and RTSP session is not shown for brevity)</p></td></tr>
<tr><td colspan="2"><p class="indent">If the request is for session replication, then a new SIP (RTSP) session SHALL be established and the old SIP (RTSP) session SHALL be maintained</p></td></tr>
<tr><td>22.</td><td>The IPTV Control FE starts a new SIP session by sending a SIP INVITE to the selected CDNC via the ASM</td></tr>
<tr><td>23-32.</td><td>Steps 23-32 are identical to the CoD session procedure and will not be described again for brevity. The only exception is step 29. This step is executed only if this is a session transfer case.</td></tr>
<tr><td>33.</td><td>Following the successful establishment of the new session in OITF2, OITF2 issues an HTTP POST to the IG in step 33 to notify OITF1 that the session has been successfully transferred or replicated.</td></tr>
<tr><td>34.</td><td>The IG sends a SIP NOTIFY to the IPTV Control FE via the ASM.</td></tr>
<tr><td>35.</td><td>The IPTV Control FE forwards the SIP NOTIFY to the IG of the original device, OITF1.</td></tr>
<tr><td>36.</td><td>The IG sends an HTTP 200 OK response that includes the SIP NOTIFY</td></tr>
<tr><td>37.</td><td>OITF1 issues an HTTP POST to the IG that includes the SIP 200 OK response to the incoming SIP NOTIFY</td></tr>
<tr><td>38.</td><td>The IG sends the 200 OK to the IPTV Control FE via the ASM</td></tr>
<tr><td>39.</td><td>The IPTV Control FE forwards the 200 OK to the IG for OITF2.</td></tr>
<tr><td>40.</td><td>The IG sends an HTTP 200 OK response to OITF 2 that includes the SIP 200 OK response</td></tr>
<tr><td>41.</td><td>Following that, OITF2 retrieves the bookmark associated with the content as per the procedure defined in section <a href="#s6-11" class="sectionRef">6.11</a> if not received in step 31</td></tr>
<tr><td>42.</td><td>OITF2 now issues an RTSP PLAY to the CC for viewing the content starting at the desired position.</td></tr>
<tr><td>43.</td><td>CC proxies the RTSP PLAY to the appropriate CDF. </td></tr>
<tr><td>44.</td><td>The CDF responds with a 200 OK to the CC</td></tr>
<tr><td>45.</td><td>The CC responds to OITF2 with a 200 OK</td></tr>
</table>
<p>At this point, OITF2 receives the same content.</p>
</section>
<section><h4>Procedure for dynamic device discovery and device awareness</h4>
<p>Figure <a href="#dynamic-discovery-of-devices" class="figureRef">6-81</a> depicts the procedure for dynamic discovery of devices belonging to the same IPTV subscription.  </p>
<figure id="dynamic-discovery-of-devices">
<figcaption>Figure #-####: Dynamic Discovery of devices</figcaption>
<img src="images/dynamic-discovery-of-devices.png" alt="figure 6-81" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the call flow:</p>
<table class="sequence">
<tr><td>1.</td><td>OITF2 issues an HTTP POST to the IG. The HTTP POST includes the SIP SUBSCRIBE to the Registration event package, and is destined to the IPTV Control FE.</td></tr>
<tr><td>2.</td><td>The IG forwards the SIP SUBSCRIBE to the ASM.</td></tr>
<tr><td>3.</td><td>The ASM forwards the SIP SUBSCIBE to the IPTV Control FE</td></tr>
<tr><td>4.</td><td>The IPTV Control FE returns a SIP 200 OK to the ASM.</td></tr>
<tr><td>5.</td><td>The ASM forwards the SIP 200 OK to the IG.</td></tr>
<tr><td>6.</td><td>The IG returns an HTTP 200 OK to OITF2 that includes the SIP 200 OK response.</td></tr>
<tr><td>7.</td><td>OITI2 issues an HTTP Pending IG request</td></tr>
<tr><td>8.</td><td>The IPTV control generates a SIP NOTIFY that includes all registered devices belonging to all users under the same IPTV subscription as that of the originator of the procedure.  The IPTV Control FE sends the SIP NOTIFY to the ASM.</td></tr>
<tr><td>9.</td><td>The ASM forwards the SIP NOTIFY to the IG.</td></tr>
<tr><td>10.</td><td>The IG returns an HTTP 200 OK to OITF2 that includes the SIP NOTIFY </td></tr>
<tr><td>11.</td><td>OITF2 issues an HTTP POST to the IG that includes the SIP 200 OK response to the incoming SIP NOTIFY.</td></tr>
<tr><td>12.</td><td>The IG forwards the SIP 200 OK to the ASM</td></tr>
<tr><td>13.</td><td>AMS forwards the SIP 200 OK to the IPTV Control FE</td></tr>
</table>
</section>
</section>
<section><h3>Pull Mode</h3>
<section><h4>High level pull procedure for session transfer or replication</h4>
<p>Figure <a href="#session-xfer-repl-high-level-pull" class="figureRef">6-82</a> shows the high level procedure employed in the pull mode for both session transfer and replication.</p>
<figure id="session-xfer-repl-high-level-pull">
<figcaption>Figure #-####: High-level Pull procedure for session transfer/replication</figcaption>
<img src="images/session-xfer-repl-high-level-pull.png" alt="figure 6-82" style="width:90%"/>
</figure>
<p>The following is brief description of the steps in the call flow:</p>
<table class="sequence">
<tr><td>1.</td><td>It is assumed that the OITF1 is receiving streaming content over an established CoD session. At some point in time, the user on OITF1 decides he wants to transfer or replicate the current CoD session to (or on) another device, OITF2, in this example.c
<tr><td>2.</td><td>The user registers at the target device, OITF2. Following that, the dynamic active session discovery procedure is performed to identify active sessions that can be transferred or replicated on OITF2. This procedure is specified by 3GPP [[!Ref-37]]. </td></tr>
<tr><td>3.</td><td>The target device, OITF2, initiates a new session with the IG to transfer or replicate the chosen session.</td></tr> 
<tr><td>4.</td><td>The IG verifies if the target and the original devices are located within the same household and behind the same IG. If so, the IG performs the necessary procedure to avoid multiple QoS reservation.</td></tr>
<tr><td>5.</td><td>The IPTV Control FE optionally bookmarks the ongoing session, if no bookmark has been performed by the original device, so that viewing the content from the target device can start from the point in time where the session transfer started.</td></tr>
<tr><td>6.</td><td>The new session is successfully established both for replication or session transfer.</td></tr>
<tr><td>7.</td><td>In the session transfer case, once the new session has been successfully transferred, the IPTV Control FE tears down the old session. </td></tr>
</table>
</section>
<section><h4>Pull Procedure for Session Transfer and Session Replication</h4>
<p>The call flows in Figure <a href="#session-xfer-repl-pull-part1" class="figureRef">6-83</a> and Figure <a href="#session-xfer-repl-pull-part2" class="figureRef">6-84</a> depict a more detailed procedure for session transfer/replication for the pull method.</p> 
<figure id="session-xfer-repl-pull-part1">
<figcaption>Figure #-####: Detailed Pull procedure for session transfer/replication &mdash; Part 1</figcaption>
<img src="images/session-xfer-repl-pull-part1.png" alt="figure 6-83" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the call flow:</p>
<table class="sequence">
<tr><td>1.</td><td>The user has established a CoD session on OITF1, and decides to transfer or replicate the session to another device, OITF2. The user selects the pull option. </td></tr>
<tr><td>2.</td><td>The user registers on OITF2, and then starts the pull procedure. Subsequently, the 3GPP procedure for dynamic discovery of active sessions on other devices where the user, or other users under the same IPTV subscription, are registered and active in a session, is performed to allow the user to select a session.</td></tr>
<tr><td>3.</td><td>Once a session is selected by the user, OITF2 issues an HTTP POST to the IG for a session transfer or replication. The request includes the identity of the session to be transferred (Session Transfer Identifier &mdash; STI) and an indicator to show if session transfer or replication is requested. Additional pertinent parameters are also included in the request. </td></tr>
<tr><td colspan="2"><p class="indent">If the request is for a session transfer, the IG verifies if the original and the target OITF belong to the same household and are behind the same IG. If that is the case, then the IG executes the procedure defined in section <a href="#s6-17-3-1" class="sectionRef">6.17.3.1</a> prior to executing the next step in this procedure. If the request is for session replication, the IG does not perform any procedure, and moves to the next step in this procedure.</p></td></tr>
<tr><td colspan="2"><p class="indent">In the call flow in Figure <a href="#session-xfer-repl-pull-part1" class="figureRef">6-83</a>, it is assumed that the two OITFs do not belong to the same household, even though only one IG is only shown in the figure for simplicity.</p></td></tr>
<tr><td>4.</td><td>OITF1 issues an HTTP pending request</td></tr>
<tr><td>5.</td><td>The IG then issues a SIP INVITE to the ASM. The INVITE request includes the STI, the CoD content identifier and other relevant parameters received in step 3. The ASM performs resource reservation based on the requested bandwidth</td></tr>
<tr><td>6.</td><td>The ASM forwards the INVITE to the IPTV Control FE</td></tr>
<tr><td>7.</td><td>The IPTV Control FE optionally bookmarks the original content, based on the procedure defined in section <a href="#s6-17-3-2" class="sectionRef">6.17.3.2</a>, if the original device, OITF1, did not perform one. </td></tr>
<tr><td colspan="2"><p class="indent">Steps 8-13 are performed in case the request is for session transfer. In these steps, the IPTV Control FE instructs the original device, OITF1, to put the media on hold, if OITF1 has not already undertaken that step. Note that if both devices involved in a session transfer are behind the same IG, the IG instructs the OITF to put the media on hold as described in section <a href="#s6-17-3-1" class="sectionRef">6.17.3.1</a> and this procedure is not performed, </p></td></tr>
<tr><td>8.</td><td>The IPTV Control FE sends a SIP Re-INVITE to the original device, OITF1, to put the media on hold. If OITF1 has already put the media on hold, steps 13 onwards are executed.</td></tr>
<tr><td>9.</td><td>Upon receipt of the Re-INVITE to put the media on hold, OITF1 sends an RTSP PAUSE to the CC prior to putting the media on hold.</td></tr>
<tr><td>10.</td><td>The CC in turn issues an RTSP PAUSE to the CDF</td></tr>
<tr><td>11.</td><td>The CDF returns a RTSP 200 OK to the CC</td></tr>
<tr><td>12.</td><td>The CC returns a SIP 200 OK to OITF1.</td></tr>
<tr><td>13.</td><td>OITF1 returns SIP 200 OK response to the IPTV Control FE.</td></tr>
<tr><td colspan="2"><p class="indent">For steps 14-26, if the request is for session transfer and the same CDF (used by OITF1) is to be used for OITF2, then the IPTV Control FE can initiate a SIP UPDATE or re-INVITE towards the remote end; otherwise a new SIP session will be established, in which case the old SIP and RTSP session SHALL be torn down by the IPTV Control FE (tearing down the old SIP and RTSP session is not shown for brevity)</p></td></tr>
<tr><td colspan="2"><p class="indent">If the request is for session replication, then a new SIP (RTSP) session SHALL be established and the old SIP (RTSP) session SHALL be maintained.</p></td></tr>
<tr><td>14.</td><td>The IPTV Control FE starts a new SIP session by sending a SIP INVITE to the selected CDNC via the ASM.</td></tr>
<tr><td>15-26.</td><td>Steps 15-26 are identical to the normal CoD session establishment procedure and will not be described again for brevity. The only exception is step 23. This step is executed only if this is a session transfer case. The remaining steps are shown in Figure <a href="#session-xfer-repl-pull-part2" class="figureRef">6-84</a>.</td></tr>
<tr><td>27.</td><td>OITF2 retrieves the bookmark associated with the content as per the procedure defined in section <a href="#s6-11" class="sectionRef">6.11</a> if not received in step 21.</td></tr>
<tr><td>28.</td><td>OITF2 now issues an RTSP PLAY to the CC for viewing the content starting at the desired position.</td></tr>
<tr><td>29.</td><td>The CC proxies the RTSP PLAY to the appropriate CDF. </td></tr>
<tr><td>30.</td><td>The CDF responds with a 200 OK to the CC</td></tr>
<tr><td>31.</td><td>The CC responds to OITF2 with a SIP 200 OK</td></tr>
</table>
<p>Following that, OITF2 receives the same content as that received on OITF1.</p>
<figure id="session-xfer-repl-pull-part2">
<figcaption>Figure #-####: Detailed Pull procedure for session transfer/replication &mdash; Part 2</figcaption>
<img src="images/session-xfer-repl-pull-part2.png" alt="figure 6-84" style="width:90%"/>
</figure>
</section>
<section><h4>Procedure for dynamic device discovery and active sessions awareness</h4>
<p>Figure <a href="#dynamic-discovery-of-devices-same-subscription" class="figureRef">6-85</a> depicts the procedure for dynamic discovery of devices belonging to the same IPTV subscription and the active IPTV sessions on these devices.  </p>
<figure id="dynamic-discovery-of-devices-same-subscription">
<figcaption>Figure #-####: Dynamic device discovery and active session awareness</figcaption>
<img src="images/dynamic-discovery-of-devices-same-subscription.png" alt="figure 6-85" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the call flow:</p>
<table class="sequence">
<tr><td>1.</td><td>OITF2 issues an HTTP POST to the IG. The HTTP POST includes a SIP SUBSCRIBE to the Registration event package, and is destined to the IPTV Control FE.</td></tr>
<tr><td>2.</td><td>The IG forwards the SIP SUBSCRIBE to the ASM.</td></tr>
<tr><td>3.</td><td>The ASM forwards the SIP SUBSCIBE to the IPTV Control FE</td></tr>
<tr><td>4.</td><td>The IPTV Control FE returns a SIP 200 OK to the ASM.</td></tr>
<tr><td>5.</td><td>The ASM forwards the SIP 200 OK to the IG.</td></tr>
<tr><td>6.</td><td>The IG returns an HTTP 200 OK to OITF2 that includes the SIP 200 OK response.</td></tr>
<tr><td>7.</td><td>OITI2 issues an HTTP pending request</td></tr>
<tr><td>8.</td><td>The IPTV control generates a SIP NOTIFY that includes all registered devices belonging to all users under the same IPTV subscription as that of the originator of the procedure.  The IPTV Control FE sends the SIP NOTIFY to the ASM.</td></tr>
<tr><td>9.</td><td>The ASM forwards the SIP NOTIFY to the IG.</td></tr>
<tr><td>10.</td><td>The IG returns an HTTP 200 OK to OITF2 that includes the SIP NOTIFY </td></tr>
<tr><td>11.</td><td>OITF2 issues an HTTP POST to the IG that includes the SIP 200 OK response to the incoming SIP NOTIFY.</td></tr>
<tr><td>12.</td><td>The IG forwards the SIP 200 OK to the ASM</td></tr>
<tr><td>13.</td><td>The ASM forwards the SIP 200 OK to the IPTV Control FE</td></tr>
<tr><td>14.</td><td>OITF2 issues an HTTP POST to the IG. The HTTP POST includes the SIP SUBSCRIBE to the dialog event package [[!Ref-38]], and is destined to the IPTV Control FE.</td></tr>
<tr><td>15.</td><td>The IG forwards the SIP SUBSCRIBE to the ASM.</td></tr>
<tr><td>16.</td><td>The ASM forwards the SIP SUBSCIBE to the IPTV Control FE</td></tr>
<tr><td>17.</td><td>The IPTV Control FE returns a SIP 200 OK to the ASM.</td></tr>
<tr><td>18.</td><td>The ASM forwards the SIP 200 OK to the IG.</td></tr>
<tr><td>19.</td><td>The IG returns an HTTP 200 OK to OITF2 that includes the SIP 200 OK response.</td></tr>
<tr><td>20.</td><td>OITI2 issues an HTTP pending request</td></tr>
<tr><td>21.</td><td>The IPTV Control generates a SIP NOTIFY that includes all active IPTV sessions active on all devices of users belonging to the same IPTV subscription as that of the originator of the procedure.  The IPTV Control FE sends the SIP NOTIFY to the ASM. OITF2 shall be able to correlate the information received here in conjunction with the information received in step 8 to identify the session and the device.</td></tr>
<tr><td>22.</td><td>The ASM forwards the SIP NOTIFY to the IG.</td></tr>
<tr><td>23.</td><td>The IG returns an HTTP 200 OK to OITF2 that includes the SIP NOTIFY </td></tr>
<tr><td>24.</td><td>OITF2 issues an HTTP POST to the IG that includes the SIP 200 OK response to the incoming SIP NOTIFY.</td></tr>
<tr><td>25.</td><td>The IG forwards the SIP 200 OK to the ASM</td></tr>
<tr><td>26.</td><td>The ASM forwards the SIP 200 OK to the IPTV Control FE</td></tr>
</table>
</section>
</section>
<section><h3>Procedures common to both push and pull modes</h3>
<section id="s6-17-3-1"><h4>Procedure at the IG to avoid double QoS reservation</h4>
<p>This procedure is invoked by the IG if it detects that the original and target device involved in a session transfer are in the same household, behind the same IG.</p>
<figure id="ig-avoiding-multiple-qos-booking">
<figcaption>Figure #-####: IG procedure to avoid multiple QoS booking during session transfer</figcaption>
<img src="images/ig-avoiding-multiple-qos-booking.png" alt="figure 6-86" style="width:90%"/>
</figure>
<p>Below is a brief description of the steps in the call flow:</p>
<table class="sequene">
<tr><td>1.</td><td>It is assumed that OITF2, the target device in a session transfer, is behind the same IG as OITF1, the original device. OITF2 issues an HTTP POST request to initiate session transfer. The request includes the STI, and other pertinent parameters. The IG verifies if the STI included in the request matches an existing session whose state is maintained in the IG. If the verification outcome is positive, then both devices are behind the same IG and the remaining steps are executed.  Otherwise the rest of the steps are skipped.</td></tr>
<tr><td>2.</td><td>OITF1 issues an HTTP pending request</td></tr>
<tr><td>3.</td><td>The IG returns an HTTP 200 OK response to OITF1 that includes, in the HTTP body, a SIP re-INVITE request from the IG to OITF1 to put the media on hold.</td></tr>
<tr><td>4.</td><td>OITF1 issues an RTSP PAUSE to the CC.</td></tr>
<tr><td>5.</td><td>The CC issues an RTSP PAUSE to the CDF.</td></tr>
<tr><td>6.</td><td>The CDF returns an RTSP 200 OK.</td></tr>
<tr><td>7.</td><td>The CC returns a SIP 200 OK to OITF1</td></tr>
<tr><td>8.</td><td>OITF1 issues an HTTP Pending request that includes, in the HTTP message body, the SIP 200 OK response to the re-INVITE from step 3.</td></tr>
<tr><td>9.</td><td>The IG returns an HTTP 200 OK response that includes the ACK in the HTTP message body.</td></tr>
<tr><td>10.</td><td>The IG sends a SIP UPDATE to the ASM to release the QoS resources for OITF1.</td></tr>
<tr><td>11.</td><td>The ASM forwards the SIP UPDATE to the IPTV Control FE.</td></tr>
<tr><td>12.</td><td>The IPTV Control FE returns a SIP 200 OK to the ASM.</td></tr>
<tr><td>13.</td><td>The ASM returns a SIP 200 OK to the IG.</td></tr>
</table>
</section>
<section id="s6-17-3-2"><h4>Network-initiated Bookmarking</h4>
<p>This procedure is performed when the IPTV Control FE needs to acquire the offset for the purpose of session transfer or session replication (note that other applications may need this procedure as well). </p>
<p>This is further described in section <a href="#s6-11-2-4" class="sectionRef">6.11.2.4</a>.</p>
</section>
</section>
</section>
<section id="s6-18"><h2>Content Preparation</h2>
<section><h3>Content on Demand</h3>
<p>The following diagram shows the flows for CoD content preparation over the reference points identified in sections <a href="#s5-2-1" class="sectionRef">5.2.1</a> and <a href="#s5-2-3" class="sectionRef">5.2.3</a>. These flows allow the key to be generated by the CoD Encryption Function or by the Key Management Function.</p>
<figure id="content-prep-cod">
<figcaption>Figure #-####: Content on Demand Flows</figcaption>
<img src="images/content-prep-cod.png" alt="figure 6-87" style="width:90%"/>
</figure>
</section>
<section><h3>Scheduled Content</h3>
This section covers the flows for Scheduled Content over the reference points identified in sections <a href="#s5-2-1" class="sectionRef">5.2.1</a> and <a href="#s5-2-3" class="sectionRef">5.2.3</a>. These flows allow the key to be generated by the Scheduled Content Encryption Function or by the Key Management Function.
<section><h4>Unicast Scheduled Content, with periodic time based key rotation</h4>
<figure id="content-prep-sc-periodic-key">
<figcaption>Figure #-####: Unicast Scheduled Content Flows - periodic time based key rotation</figcaption>
<img src="images/content-prep-sc-periodic-key.png" alt="figure 6-88" style="width:90%"/>
</figure>
<p>On a regular basis the Scheduled Content Encryption Function requests keys or provides keys to the Key Management Function for each scheduled content service.</p>
<p>When the key is generated by Scheduled Content Encryption Function this function is in charge of the key rotation.</p>
<p>When the key is generated by the Key Management Function, the Scheduled Content Encryption Function may still be in charge of the schedule and key rotation. </p>
<p>When the Key Management Function manages the schedule for key changes for scheduled content services, it maintains a list of keys associated with time.</p>
<p>The Key Management Function centralizes all the information required to generate the DRM specific signaling, e.g. to be included in a DASH MPD and/or within an asset. This information is returned to the Scheduled Content Encryption Function that inserts the actual signaling.</p>
</section>
<section><h4>Unicast Scheduled Content, with event based key rotation</h4>
<figure id="content-prep-sc-event-key">
<figcaption>Figure #-####: Unicast Scheduled Content Flows - event based key rotation</figcaption>
<img src="images/content-prep-sc-event-key.png" alt="figure 6-89" style="width:90%"/>
</figure>
<p>The Scheduling Function provides a schedule of events to the Scheduled Content Encryption Function.</p>
<p>The Scheduled Content Encryption Function requests keys or provides keys to the Key Management Function for each event.</p>
<p>The Key Management Function maintains the relationship between events and keys.</p>
<p>The Key Management Function centralizes all the information required to generate the DRM specific signaling, e.g. to be included in a DASH MPD and/or within an asset. This information is returned to the Scheduled Content Encryption Function that inserts the actual signaling.</p>
</section>
</section>
<section><h3>Start-over/Pause and Catch-up</h3></section>
The following diagram shows Start-ver and Catch-up specific flows over the reference points identified in sections <a href="#s5-2-1" class="sectionRef">5.2.1</a> and <a href="#s5-2-3" class="sectionRef">5.2.3</a>. These flows come along with the flows presented for unicast Scheduled Content.
<figure id="startover-pause-catchup">
<figcaption>Figure #-####: Start-over/Pause and Catch-up Flows</figcaption>
<img src="images/startover-pause-catchup.png" alt="figure 6-90" style="width:90%"/>
</figure>
</section>
<section id="s6-19"><h2>Remote Download of Content and Service Protection Software</h2>
<p>This feature allows the controlled download of a service and content protection software thus allowing device interoperability of the CPE with protected services and content deployed by different service providers. Following such an approach the same end user device can sequently be used for the consumption of services coming from different IPTV providers and each of these providers only needs to support one protection system. IPTV terminals of new customers can be attached to a service in a fast and automated way as the OITF can automatically be configured for a new service provider. </p>
<p>The following Functional Entities are involved in the provisioning of the CSP Software:</p>
<p><b>Service Access Authentication:</b>  This entity is responsible for the service access authentication of the user and in combination with the IPTV Applications entity and the IPTV Service Profile entity it ensures that the CSP software is available for download if needed. </p>
<p>NOTE: An IMS-based authentication mechanism is not considered here.</p>
<p><b>IPTV Service Profile: </b>This entity holds the user profile associated with the user's subscription with an IPTV service provider. Part of this profile is the information about the CSP Software that ought to be used by that user. </p>
<p><b>IPTV Applications:</b> This entity triggers and monitors the download of the CSP software in collaboration with the DAE of the OITF. The application is started after a successful authentication of the user and after a successful check that CSP software needs to be downloaded. </p>
<p><b>Remote Management:</b> This entity manages the server-side functionalities necessary for remotely provisioning the CSP software to the end user's device. </p>
<p><b>Remote Management Client:</b>  This entity manages the client-side functionalities necessary for remotely provisioning the CSP software to the end user's device.</p>
<p><b>DAE:</b> The DAE in the OITF ensures the access to the Remote Management Client.   </p>
<p>The following Reference Points are involved in the provisioning of the CSP Software:</p>
<p><b>NPI-17:</b> This Reference Point allows interaction between the IPTV Service Profile entity and the IPTV Applications Entity. The information exchanged over this reference point relates to the preparation for the download of the CSP software to a certain user or a user group. </p>
<p><b>UNIS-6:</b> This Reference Point is used for the interaction with the application logic of the CSP software in order to initiate the download of the CSP software to the client and to monitor its state. </p>
<p><b>UNIS-14:</b> This Reference Point is the interface for the service access authentication of a user. It is used for the information exchange related to the authentication management between the OITF and the service provider's network.  </p>
<p><b>UNI-RMS:</b> This Reference Point is used for the exchange of download information for the CSP software between the Remote Management and the Remote Management Client.</p>
<section><h3>Generic signalling flow</h3>
<p>The following diagram shows the generic signalling flow using the entities identified above under the assumption that a download of the CSP software needs to be initiated. </p>
<figure id="remote-download-signalling-flow">
<figcaption>Figure #-####: Signalling Flow Diagram</figcaption>
<img src="images/remote-download-signalling-flow" alt="figure 6-91" style="width:90%"/>
</figure>
<p>* For service access and user authentication the functionalities described in section 6.3.2 can also be used for non-IMS based services.</p>
<table class="sequence">
<tr><td>1.</td><td>The terminal wants to build up a connection to the IPTV service and asks for access.</td></tr>
<tr><td>2.</td><td>The Service Access Authentication checks the validity of this claim and sends an authentication to the IPTV User Profile which is part of the IPTV Service Profile.</td></tr>
<tr><td>3.</td><td>The IPTV Service Profile checks in the User Profile the actual version of the CSP SW.</td></tr>
<tr><td>4.</td><td>The IPTV Service Profile informs the IPTV Applications entity about the necessity to download a new version of the CSP SW. </td></tr>
<tr><td>5.</td><td>An application is started that initiates the download of the new CSP SW to the OITF in collaboration with the Remote Management.</td></tr>
<tr><td>6.</td><td>The OITF informs the IPTV Applications entity about the successful finalization of the download.</td></tr> 
<tr><td>7.</td><td>The new CSP SW is registered in the IPTV User Profile. </td></tr>
</table>
</section>
<section><h3>Procedural Steps</h3>
<p>This section describes the procedural steps for provisioning the remote download of CSP software.  It uses the Reference Points identified in the upper part of this chapter and the items to be fulfilled by the corresponding Functional Entities. The description follows the order of the steps shown in the signalling flow diagram in Figure <a href="#remote-download-signalling-flow" class="figureRef">6-91</a>.</p> 
<p class="inline-header">Step 1: Request for service access and user authentication</p>
<p>Involved Functional Entities: OITF, Service Access Authentication, IPTV Service Profile</p>
<p>Involved Reference Points: UNIS-14</p>
<p>The Service Access Authentication Function is contacted by the OITF for gaining access to the managed IPTV service offered by a service provider. This approach happens via Reference Point UNIS-14. Upon reception of the access request, the Service Access Authentication Function checks the validity of the access request and creates via the Reference Point an entry in the User Profile of the IPTV Service Profile that access to the IPTV service is granted. </p> 
<p class="inline-header">Step 2: Preparation for CSP SW download</p>
<p>Involved Functional Entities: IPTV Service Profile, IPTV Applications, OITF</p>
<p>Involved Reference Points: NPI-17, UNIS-6</p>
<p>The IPTV Service Profile checks in the User Profile the actual version of the CSP SW to be used. Afterwards it triggers the download of the new CSP SW via the IPTV Applications Entity using the Remote Management API of the OITF as specified in <a href="volume5.html#remote-management-apis" class="extRef">section 7.11</a> of [[.OIPF_DAE2]]. </p>
<p class="inline-header">Step 3: Download of the new CSP SW</p>
<p>Involved Functional Entities: OITF, Remote Management</p>
<p>Involved Reference Points: UNI-RMS</p>
<p>The Remote Management Entity provides the server-side functionalities to manage the download of the new CSP SW in collaboration with the OITF. This includes the authentication of the device that is selected for a CSP SW download, followed by a secure download of the CSP SW.</p>
<p>The details of the download are under the responsibility of the IPTV Service Provider and are no subject to standardization. The delivery mechanism follows the guidelines described in clause 6.6 of [[!DVB_FUS]]. </p>
<p class="inline-header">Step 4: Finalization and registration of new CSP SW</p>
<p>Involved Functional Entities: OITF, IPTV Applications, IPTV Service Profile</p>
<p>Involved Reference Points: UNIS-6, NPI-17</p>
<p>The OITF informs the IPTV Applications Entity about the successful finalization of the download of the new CSP SW via the Reference Point UNIS-6. The IPTV Applications Entity takes care of registering the new CSP SW in the User Profile of the IPV Service Profile Entity using Reference Point NPI-17.  </p>
</section>
</section>
</section> <!-- end of section 6 -->

<section><h1>Interworking between IPTV and Communication Services	(informative)</h1>
<section><h2>Caller ID</h2>
<p>The Communication Service Caller ID feature allows the display on an OITF of the Caller Id for an incoming voice call. When a user receives a voice call, information related to the Caller ID is sent to the Caller ID enabler from the network managing the call. Using session management procedures, the OITF is able to display the caller's identity (and the called identity, if needed) on the OITF display device.</p>
<p>In a managed network, it is important to ensure that:</p><ul>
<li>The user has subscribed to such a service, for all identities and E.164 numbers [[!Ref-20]] (POTS, IMS phone, SIP phones, etc) for which he would like to receive Caller ID notifications. 
<li>The networks (POTS, mobile, IMS) managing the identities and the incoming calls, are able to notify the IPTV Control FE of information related to incoming voice calls.
<li>The Caller ID enabler FE, upon receiving this notification, can generate and send a message to the OITF, in order to display the related call information. </ul>
<p>The notification mechanism between the Voice Network and the Caller ID enabler is out of scope of this specification.</p>
<p>Figure <a href="#caller-id-presentation" class="figureRef">7-1</a> shows an informational call flow for the Caller ID communication service. </p>
<figure id="caller-id-presentation">
<figcaption>Figure #-####: Call flow for presentation of caller ID</figcaption>
<img src="images/caller-id-presentation.png" alt="figure 7-1" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow. As a precondition, the User must be IMS registered via the Authentication and Session Management prior to the call flow.</p>
<table class="sequence">
<tr><td>1.</td><td>A network (POTS, PLMN, IMS &hellip;) notifies the Caller ID enabler about an incoming voice call related to a POTS, PLMN, IMS number/identity associated with an IPTV user. This message contains the caller's identity (caller ID) and called identity (called ID), but should also carry additional information (i.e. the network originating the notification, etc.)</td></tr>
<tr><td>2.</td><td>The Caller ID enabler generates and sends a SIP MESSAGE (that includes the caller Id, the called Id, additional information) towards the Authentication and Session Management FE associated with the End User.</td></tr>
<tr><td>3.</td><td>The SIP MESSAGE is proxied to the IMS Gateway, where it is intercepted by the Authentication and Session management function.</td></tr>
<tr><td>4.</td><td>The Auth/Session Mgmt. function in the IG invokes the third party notification functionality of the IG OITF Server function. </td></tr>
<tr><td>5.</td><td>The IG-OITF Server function starts the notification procedure via the DAE. 
<p>Two possible mechanisms for notifying the OITF are: <ul>
<li>&ldquo;Third Party Notification Procedure&rdquo;: With this mechanism the IG-OITF-Server sends the appropriate CEA 2014 [[!Ref-3]] operations so that the OITF can display the appropriate message. In more detail:<ul>
<li>The IG-OITF Server creates locally the notification message (UPnP multicast) and sends it to the OITF. This message contains the reference/link to the &ldquo;notification content&rdquo;.
<li>The OITF receives the notification message and loads, from the IG-OITF Server, the content referred by the &ldquo;notification content&rdquo;. In this case, the &ldquo;notification content&rdquo; contains the information to be loaded and displayed on the OITF.
<li>The OITF sends the response to the IG-OITF-Server after the &ldquo;notification content&rdquo; has loaded;</ul>
<li>Use of  UPnP GENA [[!Ref-28]]</ul></td></tr>
<tr><td>6.</td><td>The IG-OITF Server reports the Operation Result to the Authentication and Session Management function in the IMS Gateway.</td></tr>
<tr><td>7-8.</td><td>The response to the MESSAGE request is forwarded to the Caller ID enabler via the Authentication and Session Management FE.</td></tr>
<tr><td>9.</td><td>The OITF displays the information on the screen.</td></tr>
</table>
</section>
<section><h2>Messaging</h2>
<p>The Communication Service Messaging allows a user to send and receive textual messages to and from other users (or a list of users). When a user receives a textual message, it is displayed by the OITF on the screen.</p>
<p>The messages are sent and received without initiating a communication context; thus no communication context state is stored in the IPTV Solution. </p>
<p>In order to support the Communication Service Messaging, an Instant Messaging Enabler functionality is used in the Person-to-Person Communication Enablers FE. </p>
<p>The Open Mobile Alliance (OMA) has specified an enabler for Instant Messaging (IM) that allows the  exchange of Instant Messaging messages between users in near real-time, based on the IETF SIP protocol (RFC 3261) [[!Ref-21]] with SIMPLE and 3GPP extensions. The procedure described in this chapter is aligned with the &ldquo;Pager mode&rdquo; functionality as specified in OMA &ldquo;Instant Messaging using SIMPLE&rdquo; (OMA-ERP-SIMPLE_IM-V1_0-20070816-C) [[!Ref-22]].</p>
<p>The application running on the OITF sends and receives messages using either:</p><ul>
<li>A DAE application (HTML + ECMAscript [[!Ref-23]]) downloaded to the OITF, or
<li>A native application on the OITF
</ul>
<section><h3>Outgoing Messaging</h3>
<p>Figure <a href="#outgoing-messaging" class="figureRef">7-2</a> shows an example of outgoing messaging communication service, followed by a brief description of the flow.</p>
<figure id="outgoing-messaging">
<figcaption>Figure #-####: Call flow for an outgoing messaging communications service</figcaption>
<img src="images/outgoing-messaging.png" alt="figure 7-2" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>A user logged onto an OITF enters the text message.  The OITF sends an HTTP POST message including the text to be sent, the originating user identification and the receiving user identification (or list of users) to the IG-OITF Server function in the IG. </td></tr>
<tr><td>2.</td><td>The IG-OITF Server function intercepts the HTTP request and invokes the Authentication/Session Management function in the IG to send the text.  </td></tr>
<tr><td>3.</td><td>The Authentication/Session Management function in the IG composes a SIP MESSAGE (that includes the textual message) and sends it to the user's home Authentication and Session Management FE.</td></tr>
<tr><td>4.</td><td>Based on the originating filter criteria with the user, the SIP MESSAGE is forwarded to the appropriate IM Enabler FE. This IM Enabler FE is in charge of the delivery the text message to the final receiver or receivers in the list.</td></tr>
<tr><td>5.</td><td>A 200 OK is received as a response from the terminating network.</td></tr>
<tr><td>6.</td><td>The 200 OK is proxied to the IMS Gateway.</td></tr>
<tr><td>7.</td><td>The IG Auth/Session Mgmt function sends the operation result to the IG-OITF Server.</td></tr>
<tr><td>8.</td><td>The IG-OITF Server sends a 200 OK to the OITF as a response to the HTTP POST operation.</td></tr>
<tr><td>9.</td><td>The OITF displays the information result on the screen.</td></tr>
</table>
</section>
<section><h3>Incoming Messaging</h3>
<p>Figure <a href="#incoming-messaging" class="figureRef">7-3</a> shows an example of incoming messaging communication service, followed by a brief description of the flow.</p>
<figure id="incoming-messaging">
<figcaption>Figure #-####: Call flow for an incoming messaging communications service</figcaption>
<img src="images/incoming-messaging.png" alt="figure 7-3" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>A text message has been sent to the user and arrives to the IM Enabler function, responsible for managing the message delivery to the final receiver (or the users belonging to list).</td></tr>
<tr><td>2.</td><td>The IM Enabler function sends a SIP MESSAGE (that includes the text message that will be displayed via the OITF) to Authentication and Session Management.</td></tr>
<tr><td>3.</td><td>The SIP MESSAGE is proxyed to the user IMS Gateway, where it is intercepted by the Auth/Session Mgmt function in the IG.</td></tr>
<tr><td>4.</td><td>The IG Auth/Session Mgmt function invokes the third party notification functionality in the IG-OITF Server function. </td></tr>
<tr><td>5.</td><td>The IG-OITF Server starts the Third Party Notification Procedure. In particular the IG-OITF sends the appropriate CEA 2014 [[!Ref-3]] operations so that the OITF displays the appropriate message. In more detail: <ol type="a">
<li>The IG-OITF Server function creates locally the notification message (multicast) and sends it to the OITF. This message contains the reference/link to the &ldquo;notification content&rdquo;.
<li>The OITF receives the notification message and loads, from the IG-OITF Server, the content referred to by the &ldquo;notification content&rdquo;. In this case, the &ldquo;notification content&rdquo; contains the information to be loaded and displayed on the OITF. 
<li>OITF sends the response to the IG-OITF Server function in the IG after the &ldquo;notification content&rdquo; loading;</ol></td></tr>
<tr><td>6.</td><td>The IG-OITF Server reports the Operation Result to the IG Auth/Session Mgmt function in the IMS Gateway.</td></tr>
<tr><td>7-8.</td><td>The response to the MESSAGE request is forwarded to the other network via Authentication and Session Management.</td></tr>
<tr><td>9.</td><td>The OITF displays the information on the screen.</td></tr>
</table>
</section>
</section>
<section><h2>Chatting</h2>
<p>The Communication Service Chatting allows a user to establish a communication context with another user or with a group of users, so that the IPTV Solution allows the user to send textual messages and files within a communication context and have all other users in that context receive them. Private messages and files can also be sent to one or more participants within a communication context.</p>
<p>The messages and files are sent/received within a communication context; the state of the communication context is stored in the IPTV Solution. </p>
<p>In order to support the Communication Service Chatting, an Instant Messaging Enabler functionality is introduced. OMA (Open Mobile Alliance) has specified an enabler for Instant Messaging (IM) that allows the exchange of Instant Messaging messages and files between users in near real-time, based on the IETF SIP protocol (RFC 3261) [[!Ref-21]] with SIMPLE and 3GPP extensions. The procedure described in this chapter is aligned with the &ldquo;Session mode&rdquo; and &ldquo;File Transfer&rdquo; functionalities as specified in OMA &ldquo;Instant Messaging using SIMPLE&rdquo; (OMA-TS-SIMPLE_IM-V1_0-20070816-C) [[!Ref-22]].</p>
<section id="s7-3-1"><h3>Chat session setup</h3>
<p>Figure <a href="#chat-session-setup" class="figureRef">7-4</a> shows an example of a chatting session set-up (i.e. communication context set-up), followed by a brief description of the flow. In this case the chatting template is generated and presented to the user directly by the OITF. The chatting template could be also generated by the IG, with a procedure including initial steps analogous to the ones presented in section <a href="#s7-4-2-1" class="sectionRef">7.4.2.1</a>.</p>
<figure id="chat-session-setup">
<figcaption>Figure #-####: Call flow for Chat session setup</figcaption>
<img src="images/chat-session-setup.png" alt="figure 7-4" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>A user logged onto an OITF wants to set up a chat session.  The OITF presents a template to be filled up by the user; the user fills the template and the OITF sends an HTTP POST message including the needed information (e.g. originating user and the Chat-URL) to the IG-OITF server. </td></tr>
<tr><td>2.</td><td>The IG-OITF Server intercepts the HTTP request and invokes the IG Auth/Session Mgmt function to set up a chat session.</td></tr>
<tr><td>3-4.</td><td>The IG Auth/Session Mgmt function composes a SIP INVITE (including the originating user and the Chat-URL) and sends it to the user's home Authentication and Session Management FE in order to establish a chat session. The SIP INVITE is proxied to the IM Enabler function that manages the chat session (The details of SIP message exchange are not shown here).</td></tr>
<tr><td>5-6.</td><td>A 200 OK is received as a response from the IM Enabler function and it is proxied to IMS Gateway, and a chat session is established between the IG and the IM Enabler.</td></tr>
<tr><td>7.</td><td>The IG Auth/Session Mgmt function sends the operation result to the IG-OITF Server function.</td></tr>
<tr><td>8.</td><td>The IG-OITF Server subsequently sends a 200 OK to the OITF as a response to the HTTP POST  operation,  containing the result page (which will be updated when a chat event is received) and an ECMA Notification Script, that will be run by the client in order to set-up an In-Session Notification Procedure.</td></tr>
<tr><td>9.</td><td>The OITF sets up an In-Session Notification Procedure (XML HTTP request or Persistent TCP Connection Mode) with the IG-OITF Server function in the IG. The IG-OITF Server function will then be able to send a notification message to update the OITF UI page dynamically without the need to reload the XHTML page.</td></tr>
</table>
</section>
<section><h3>Chat outgoing message</h3>
<p>Figure <a href="#chat-outgoing-message" class="figureRef">7-5</a> shows an example of chat outgoing message, followed by a brief description of the flow.</p>
</section>
<figure id="chat-outgoing-message">
<figcaption>Figure #-####: Call flow for a Chat outgoing message</figcaption>
<img src="images/chat-outgoing-message.png" alt="figure 7-5" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>A user logged on an OITF has already established a chat session (for details, see section <a href="#s7-3-1" class="sectionRef">7.3.1</a>) with the IM Enabler function for a specific Chat-URL. </td></tr>
<tr><td>2.</td><td>A user wants to send a text message in that chat session.  The OITF sends an HTTP POST message including the information needed (text to be sent, the originating user and Chat-URL, etc.) to the IG-OITF Server. </td></tr>
<tr><td>3.</td><td>The IG-OITF Server intercepts the HTTP request and invokes IG Auth/Session Mgmt function to send the text in a chat session.  </td></tr>
<tr><td>4-5.</td><td>The IG Auth/Session Mgmt function composes a MSRP SEND message (that includes the text message) and sends it, in the chat session, to the user's home network Authentication and Session Management functional entity. The MSRP SEND message is proxied to the IM Enabler function.</td></tr>
<tr><td>6-7.</td><td>A MSRP REPORT message is received from the IM Enabler function as a response to the MSRP SEND message, and it is proxied to IMS Gateway.</td></tr>
<tr><td>8.</td><td>The IG Auth/Session Mgmt sends the operation result to the IG-OITF server.</td></tr>
<tr><td>9.</td><td>The IG-OITF Server subsequently sends a 200 OK to the OITF as a response to the HTTP POST operation.</td></tr>
<tr><td>10.</td><td>The IG-OITF Server, if needed, performs the necessary CEA-2014 [[!Ref-3]] operation so that the OITF displays the result information on the screen, using the In-Session Notification established earlier during the chat session set-up procedure.</td></tr>
</table>
<section><h3>Chat incoming message</h3>
<p>Figure <a href="#chat-incoming-message" class="figureRef">7-6</a> shows an example of a chat incoming message, followed by a brief description of the flow.</p>
<figure id="chat-incoming-message">
<figcaption>Figure #-####: Call flow for a Chat incoming session</figcaption>
<img src="images/chat-incoming-message.png" alt="figure 7-6" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>A user logged on an OITF has already established a chat session (for details see section <a href="#s7-3-1" class="sectionRef">7.3.1</a>) with the IPTV Control. </td></tr>
<tr><td>2.</td><td>The IM Enabler function receives a MSRP SEND message (that includes the message to be delivered to the OITF) from another user in the chat session (identified by a Chat-URL).</td></tr>
<tr><td>3-4.</td><td>The MSRP SEND message is proxied via Authentication and Session Management to the user's IMS Gateway, where it is intercepted by the IG Auth/Session Mgmt function.</td></tr>
<tr><td>5.</td><td>The IG Auth/Session Mgmt function invokes the In-session Notification functionality in the IG-OITF Server. </td></tr>
<tr><td>6.</td><td>The IG-OITF Server performs the necessary CEA-2014 [[!Ref-3]] operation so that the OITF displays the message on the screen, using the In-Session Notification established earlier during the chat session set-up procedure. </td></tr>
<tr><td>7.</td><td>The IG-OITF Server reports the Operation Result to the IG Auth/Session Mgmt function on the IMS Gateway.</td></tr>
<tr><td>8-9.</td><td>Finally, the MSRP REPORT, in response to the MSRP SEND message, is forwarded to IM Enabler via the Authentication and Session Management FE.</td></tr>
</table>
</section>
<section><h3>Chat session teardown</h3>
<p>When the user wants to end the chat session, he performs the needed actions on the OITF (e.g. pushing a button). This causes:</p><ul>
<li>the In-session Notification tear down;
<li>a terminating message to be sent to the IG;
<li>the tear down of  the chat session between the IG and the IM Enabler, through standard IM session-mode and IMS tear-down procedures.  
</ul>
</section>
</section>
<section><h2>Presence</h2>
<section><h3>General Description of Presence in IPTV</h3>
<p>IPTV services may be combined with Presence service capability. The mechanisms used in order to combine IPTV services with the Presence service capabilities may also be used for other purposes such as:</p><ul>
<li>Gathering channel statistics and user behaviour information.
<li>Supporting session continuity between different terminals</ul>
<p>The ITF must be able to collect and send Presence information related to:</p><ul>
<li>the end user (e.g. status of the end user);
<li>the IPTV service activated (e.g. Scheduled Content, CoD, PVR);
<li>the IPTV program watched (e.g. channel currently accessed, program currently watched, content currently accessed);
<li>other information the ITF can manage (e.g. in case of a hybrid ITF  - IPTV and DTT capable - channel/program accessed/watched on DTT; in case of a combined deployment &mdash; unmanaged and managed models are both enabled &mdash; channel/program accessed via an unmanaged network).</ul>
<p>It is the user's decision (through the use of privacy preferences) as to which specific IPTV attributes to include in the Presence information that is made available to other users. </p>
<p>Figure <a href="#sending-presence-to-iptv-control" class="figureRef">7-7</a> and Figure <a href="#sending-presence-to-presence-enabler" class="figureRef">7-8</a> show two examples of the use of the Presence service with IPTV.</p>
<p>Figure <a href="#sending-presence-to-iptv-control" class="figureRef">7-7</a> shows the mechanism proposed in order to allow an ITF to communicate Presence information. </p>
<figure id="sending-presence-to-iptv-control">
<figcaption>Figure #-####: Call flow for sending Presence information to IPTV Control</figcaption>
<img src="images/sending-presence-to-iptv-control.png" alt="figure 7-7" style="width:90%"/>
</figure>
<p>The IPTV Control can forward and aggregate the Presence information collected towards other entities (e.g. external Presence Server, other specific application server) based on internal policies/rules.</p>
<p>The ITF may also collect and send the IPTV Presence information to the P2P Communication Enabler (Presence Enabler) directly, as shown in Figure <a href="#sending-presence-to-presence-enabler" class="figureRef">7-8</a>.</p>
<figure id="sending-presence-to-presence-enabler">
<figcaption>Figure #-####: Call flow for sending Presence information to the Presence Enabler</figcaption>
<img src="images/sending-presence-to-presence-enabler.png" alt="figure 7-8" style="width:90%"/>
</figure>
</section>
<section><h3>Presence Session Management Procedures</h3>
<p>The Communication Service Presence allows multiple users of an ITF to communicate their presence information inside an IPTV Service network. A user (A) can subscribe to the presence information of other users (B,C ...) so that  when one of these users changes his Presence status  user (A) will receive a notification of this change.</p>
<p>The OMA (Open Mobile Alliance) has specified an enabler for Presence allowing the management of the collection and the controlled dissemination of presence information over a SIP/IP network. The enabler is based on the IETF SIP protocol (RFC 3261) [[!Ref-21]] with SIMPLE and 3GPP extensions. The procedure described in this section is aligned with the procedures specified in OMA &ldquo;Presence SIMPLE Specification&rdquo; (OMA-ERP-Presence_SIMPLE-V1_0_1-20061128-A) [[!Ref-24]]</p>

<section id="s7-4-2-1"><h4>Presence session set-up &mdash; Presence template produced by the IG</h4>
<figure id="presence-session-setup">
<figcaption>Figure #-####: Call flow for Presence session setup</figcaption>
<img src="images/presence-session-setup.png" alt="figure 7-9" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>1.</td><td>A user logged on to an OITF wants to subscribe to the presence events associated with another user or a group of users.  The OITF sends an HTTP GET message that allows it to fetch a template form to be filled up by the user.</td></tr>
<tr><td>2.</td><td>The IG-OITF Server intercepts the request and returns an HTML form document to be filled out by the end user in a 200 OK message.</td></tr>
<tr><td>3.</td><td>The OITF sends an HTTP POST message including the completed template form to the IG-OITF Server.</td></tr>
<tr><td>4.</td><td>The IG-OITF Server intercepts the message and invokes the appropriate operation in the Auth/Session Mgmt. function in the IG.</td></tr>
<tr><td>5.</td><td>The Auth/Session Mgmt. function in the IG creates a SIP SUBSCRIBE message with the appropriate information and sends it to the Authentication and Session Management FE in the user's home network.</td></tr>
<tr><td>6.</td><td>A SIP SUBSCRIBE message is forwarded to the Presence Enabler function.</td></tr>
<tr><td>7.</td><td>A 200 OK is received as a response from the Presence Enabler function.</td></tr>
<tr><td>8.</td><td>A 200 OK is forwarded to the Auth/Session Mgmt. function in the IG.</td></tr>
<tr><td>9.</td><td>The Auth/Session Mgmt. function in the IG sends the operation result to the IG-OITF Server.</td></tr>
<tr><td>10.</td><td>The IG-OITF Server sends a 200 OK to the OITF as a response to the HTTP POST  operation, which contains the result page (which will be updated when a presence event is received) and an ECMA Notification Script that is run by the client in order to set-up an In-Session Notification Procedure.</td></tr>
<tr><td>11.</td><td>The OITF sets up an In-Session Notification Procedure (XML HTTP request or Persistent TCP Connection Mode) with the IG-OITF Server. The IG-OITF Server will then be able to send a notification message to update the OITF UI page dynamically without the need to reload the XHTML-page.</td></tr>
<tr><td>12-13.</td><td>The Auth/Session Mgmt. function in the IG receives a NOTIFY message that includes the Presence status from Presence Enabler function via Authentication and Session Mgmt. function.</td></tr>
<tr><td>14.</td><td>The Auth/Session Mgmt. function in the IG invokes the In-session notification function in the IG-OITF Server.</td></tr>
<tr><td>15.</td><td>The Auth/Session Mgmt. function in the IG sends 200 OK message to Authentication and Session Mgmt. function in responds to the SIP NOTIFY.</td></tr>
<tr><td>16.</td><td>A 200 OK is forwarded to Presence Enabler function.</td></tr>
<tr><td>17.</td><td>The IG-OITF Server performs the necessary in-session notification operation (CEA 2014) [[!Ref-3]] for the OITF to display the presence information to the end-user. All NOTIFY messages, for this subscription, are delivered within the In Session Notification session, established in step 9.</td></tr>
<tr><td>18.</td><td>Finally the IG-OITF Server sends back to the IG Auth/Session Mgmt. function the operation result.</td></tr> 
</table>
</section>
<section id="s7-4-2-2"><h4>Presence Privacy Management</h4>
<p>The Communication Service Presence allows a user at an ITF to manage the privacy settings of the user's presence information. The user can do so by configuring the presence authorization rules on the Presence enabler which is used to proactively or reactively authorize the incoming presence subscription requests from other users. For reactive authorization, the user subscribes to changes in the watcher information. That way when a subscription request comes in from a potential watcher, the presence enabler notifies the user who can then proceed to accept or deny the subscription.</p>
<p>Figure <a href="#presence-privacy-management" class="figureRef">7-10</a> provides an example of a signalling flow for presence privacy management using reactive authorization.</p>
<figure id="presence-privacy-management">
<figcaption>Figure #-####: Presence Privacy Management using reactive authorization</figcaption>
<img src="images/presence-privacy-management.png" alt="figure 7-10" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>1.</td><td>A user (A) logged on to an OITF decides to start his presence service application. The OITF sends an HTTP POST message to subscribe to the watcher information event associated with himself.</td></tr>
<tr><td>2.</td><td>The IG-OITF Server intercepts the message and invokes the appropriate operation in the Auth/Session Mgmt. function in the IG.</td></tr>
<tr><td>3.</td><td>The Auth/Session Mgmt. function in the IG creates a SIP SUBSCRIBE message with the appropriate information and sends it to the Authentication and Session Management FE in the user's home network.</td></tr>
<tr><td>4.</td><td>A SIP SUBSCRIBE message is forwarded to the Presence Enabler function.</td></tr>
<tr><td>5.</td><td>A 200 OK is received as a response from the Presence Enabler function.</td></tr>
<tr><td>6.</td><td>A 200 OK is forwarded to the Auth/Session Mgmt. function in the IG.</td></tr>
<tr><td>7.</td><td>The Auth/Session Mgmt. function in the IG sends the operation result to the IG-OITF Server.</td></tr>
<tr><td>8.</td><td>The IG-OITF Server sends a 200 OK to the OITF as a response to the HTTP POST  operation, which contains the result page (which will be updated when a watcher information event is received) and an ECMA Notification Script that is run by the client in order to set-up an In-Session Notification Procedure.</td></tr>
<tr><td>9.</td><td>The OITF sets up an In-Session Notification Procedure (XML HTTP Request or Persistent TCP Connection Mode) with the IG-OITF Server. The IG-OITF Server will then be able to send a notification message to update the OITF UI page dynamically without the need to reload the XHTML-page.</td></tr>
<tr><td>10.</td><td>Upon reception of a presence information request from another user (B), and based on presence privacy rules stored in presence enabler profile, the presence enabler may decide to send a SIP NOTIFY message with &ldquo;pending&rdquo; presence authorization status.</td></tr>
<tr><td>11.</td><td>A SIP NOTIFY message is forwarded to the Auth/Session Mgmt. function in the IG.</td></tr>
<tr><td>12.</td><td>The Auth/Session Mgmt. function in the IG invokes third party notification in the IG-OITF Server.</td></tr>
<tr><td>13.</td><td>The IG-OITF Server performs the necessary in-session notification operation (CEA 2014) [[!Ref-3]] for the OITF to display the presence information to the end-user. All NOTIFY messages, for this subscription, are delivered within the In Session Notification session, established in step 9.</td></tr>
<tr><td>14.</td><td>The IG-OITF Server sends back to the IG Auth/Session Mgmt. function the operation result.</td></tr>
<tr><td>15.</td><td>The Auth/Session Mgmt. function in the IG sends 200 OK message to the Authentication and Session Mgmt. function in response to the SIP NOTIFY.</td></tr>
<tr><td>16.</td><td>A 200 OK is forwarded to Presence enabler FE.</td></tr>
<tr><td>17.</td><td>Upon reception of presence authorization request (step 13), the OITF sends an HTTP GET request to the Presence enabler profile.</td></tr>
<tr><td>18.</td><td>The Presence enabler profile returns the presence privacy profile to the OITF in a 200 OK.</td></tr>
<tr><td>19.</td><td>Upon selection by the user (A) of the presence authorization option, e.g. allow, the OITF sends an HTTP PUT request to update the Presence enabler profile.</td></tr>
<tr><td>20.</td><td>The Presence enabler profile acknowledges the HTTP request in a 200 OK.</td></tr>
</table>
<p>At this point the Presence enabler can send user A's presence information to user B.</p>
</section>
</section>
<section><h3>Scheduled Content and fast update rate events case</h3>
<p>When channel switching during a Scheduled Content service, users will likely be able to zap between a set of channels within the same &ldquo;bouquet&rdquo; (e.g. channel with the same bandwidth requirements) without further signalling related to the Service Setup Session (from ITF to IPTV Control). In this case, sending presence information each time the user changes channel may lead to a heavy load on the network (e.g. in case of zapping). In order to reduce and control possible overload caused by frequent channel hopping, it shall be possible to define some mechanisms that is able to limit the number of publications of channel change. In particular, two instances of mechanisms can be foreseen:</p><ul>
<li>Client side &mdash; configurable delay: the ITF client should not inform the IPTV Control about several consecutive channel changes within the delay period. When the user stops zapping, information about the watched channel should be sent to the IPTV Solution. The delay time that is used may be configurable.
<li>Server side &mdash; rate control: The IPTV Solution should control the rate of information sent by ITF client so it can decrease the frequency of publication of change channel.
</ul>
<p>Figure <a href="#sc-channel-switch-client-control" class="figureRef">7-11</a> and Figure <a href="#sc-channel-switch-server-control" class="figureRef">7-12</a> provide examples of a signalling flow for channel switching, for the case of Client side and Server side load control, respectively. </p>

<section id="s7-4-3-1"><h4>Scheduled Content channel switching; Client Side load control</h4>
<figure id="sc-channel-switch-client-control">
<figcaption>Figure #-####: Scheduled Content (Broadcast TV) channel switching; Client Side load control</figcaption>
<img src="images/sc-channel-switch-client-control.png" alt="figure 7-11" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>0.</td><td>The ITF leaves a multicast channel and joins another multicast channel with the same QoS requirements.<ol type="a">
<li>A delay may be applied. If the user switches channel again during this delay time, the flow is restarted at step 0.
<li>(see a.)
<li>(see a.)
<li>...</ol>
</td></tr>
<tr><td>1.</td><td>The ITF sends information about which channel that is being watched.</td></tr>
<tr><td>2.</td><td>The Authentication and Session Management FE routes the information to the IPTV Control.</td></tr>
<tr><td>3.</td><td>IPTV Control responds to the Inform channel change request.</td></tr>
<tr><td>4.</td><td>The Authentication and Session Management routes the response to the ITF.</td></tr>
</table>
</section>
<section id="s7-4-3-2"><h4>Scheduled Content channel switching; Server Side load control</h4>
<figure id="sc-channel-switch-server-control">
<figcaption>Figure #-####: Scheduled Content (Broadcast TV) channel switching; Client Side load control</figcaption>
<img src="images/sc-channel-switch-server-control.png" alt="figure 7-12" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>0.</td><td>The ITF leaves a multicast channel and joins another multicast channel.</td></tr>
<tr><td>1.</td><td>The ITF sends information about which channel is being watched.</td></tr>
<tr><td>2.</td><td>The Authentication and Session Management FE routes the information to the IPTV Control.</td></tr>
<tr><td>3.</td><td>IPTV Control checks the rate notification from the ITF and responds to the Inform channel change request; also sent in the response is an info (rate of publication) to decrease the frequency of sending the change channel information.</td></tr>
<tr><td>4.</td><td>The Authentication and Session Management FE routes the response to the OITF which updates its own rate of publication.</td></tr>
</table>
</section>
</section>
</section>
<section><h2>Multimedia Telephony</h2>
<p>The Communication Service Multimedia Telephony allows a user to establish multimedia conversational communications on his OITF.</p>
<p>In order to support the Communication Service Multimedia Telephony, a Multimedia Telephony Enabler functionality is introduced. 3GPP has specified an IMS multimedia telephony communication service based on SIP and 3GPP IMS specifications. The IPTV Solution follows 3GPP TS 24.173 [[!Ref-39]] procedures to support Multimedia Telephony functionalities such as audio and video telephony session setup, data exchange, media renegotiation, and session tear down.</p>
</section>
</section> <!-- end of section 7 -->

<section><h1>Remote Access</h1>
This section is vacant. An informative description of the remote access feature is provided in Appendix <a href="#remote-access-annex" class="sectionRef">G</a>. 
</section> <!-- end of section 8 -->

<section><h1>Audience Research</h1>
<p>The Audience Research is a component of the OIPF Architecture that enables the collection, under the explicit consent of users, of a consistent set of data representing metrics for content (Scheduled Content, CoD, etc.), access, navigation and interactive applications consumption.<p>
<section><h2>Audience Research Architecture</h2>
<p>The Audience Research subsystem is designed to:</p><ul>
<li>Support multiple network deployment scenarios
<li>Allow Audience Research system deployed for non-IPTV applications to co-exist with IPTV services</ul>
<p>The Audience Research subsystem could be deployed with support of different mechanisms related to the deployment and the configuration chosen. It is based on the following deployment:</p><ul>
<li>Network Application based (in the Transport Processing Function)
<li>Signalling based (in the IPTV Control, Cluster Controller, etc)
<li>Or any combination of the above mentioned options.</ul>
<p>Figure <a href="#audience-research-architecture" class="figureRef">9-1</a> describes the detailed architecture for supporting the Audience Research functions:</p>
<figure id="audience-research-architecture">
<figcaption>Figure #-####: Audience Research Architecture</figcaption>
<img src="images/audience-research-architecture.png" alt="figure 9-1" style="width:90%"/>
</figure>
<p>From a purely architectural point of view, the Network approach with the Transport Processing Function nodes does not introduce new elements into the network architecture, but it may use elements that already exist, such as the SPDF, A-RACF, RCEF and BTF. These elements host the features that allow the network to trigger events on specific patterns, trigger the control to detect the service involved by these patterns, to collect the appropriate data for the service and acting opportunely. Some of these features can be obtained by extending existing functionalities; others need new additions inside the elements in order to manage the logic and the interactions required. How the Transport Processing Function supports these is out of scope of this specification.</p>
<p>The Audience Research Collector is the FE that receives the data collected by the other FE and processes it for further internal use or for exposing to the Audience Research Agency (e.g. Advertising, Personalization, Content Recommendation, etc). The Audience Research Collector can either be located in a stand alone server, a component located in IPTV Applications, or a component located in IPTV Control, depending on different implementation choices.</p>
</section>
<section><h2>Audience Research Data Model</h2>
<p>The Data Model used for Audience Research is the structure of data sets that can be retrieved by the platform and used to perform Audience Research activities. 
<p>The data of interest can be classified generally into 3 categories (so as to be flexible and extensible enough for including additional services):</p><ul>
<li>Service access data
<li>Trick play data
<li>Service interaction data</ul>
<p><b>Service access data</b> describes the entries for the user's access to the IPTV services (scheduled, CoD, PVR etc). It includes 'service type', 'user id', 'target content id', 'access begin time', 'access end time', 'access location', 'terminal type' and other extensible parameters for each specific service, e.g. the license, the event type.</p>
<p><b>Trick play data</b> describes the user operations (FF, RW, PLAY, PAUSE, etc.) upon the content which can be randomly accessed, e.g. downloaded or CoD/TsTV/PVR content. It includes 'operation type', 'user id', 'target content id', 'operation begin time', 'operation end time' and other extensible parameters e.g. the play speed, offset </p>
<p><b>Service interaction data</b> describes the user actions that mostly occur during the interactive/hybrid services (rate, vote, gamble, comment, dial click-to-call, etc.). It includes also 'action type', 'user id', 'target content id', 'action begin time' , 'action end time' and other extensible parameters e.g. the rating level, the commenting text, the call number for click-to-call dial. </p>
<p>This is not an exhaustive list and other data types may be defined. </p>
<p>Appendix <a href="#audience-research-data-model" class="sectionRef">F</a> provides an example of an audience research data model.</p>

</section>

</section> <!-- end of section 9 -->

<section><h1>Interworking ITF with DLNA devices 	(informative)</h1>
<p>The following is a high level signal flow which shows how &ldquo;DLNA functions&rdquo; in the OITF interwork with DLNA compliant devices. In all use cases described in this section, the DLNA Function in the OITF serves IPTV content to other DLNA devices which implement the appropriate DLNA device class or DLNA device capability.  However, in general, &ldquo;DLNA functions&rdquo; in the OITF may support other DLNA device classes or DLNA device capabilities, such as DLNA Digital Media Player (DMP), in order to support accessing AV content (which may not be IPTV content) which are served by other DLNA devices. For further information about DLNA system usages, please refer to DLNA Networked Device Interoperability Guidelines (October 2006) [[!Ref-2]].</p>
<p><b>Note:</b> The reference to the DLNA guideline will be updated to DLNA 2.0 as soon as it is published. </p>
<p>Basically, the signal flows between the ITF and the Provider(s) Networks are the same as defined by this specification. The signal flow between ITF and DLNA devices are the same as defined in the DLNA guidelines. The high level signal flow in Figure 10 1 is intended to show the relation between the IPTV signal flow and the DLNA signal flow on the assumption that the DLNA function in the OITF converts IPTV protocols, such as metadata access,  media delivery and control UI delivery protocols, on the fly to DLNA protocols. In the case where the ITF has a local storage, the IPTV content in the storage may be served to DLNA devices; however, the following high level signal flows do not apply to these cases.  </p>
<p>The IPTV content item served by the DLNA function can be protected by DTCP-IP, with content usage specified via the content and service protection scheme of the IPTV service.</p>
<p>Note that each call flow between the ITF and the Provider(s) Networks can include an optional authentication step to avoid unauthorized access to IPTV services.</p>
<figure id="iptv-vs-dlna">
<figcaption>Figure #-####: Relation between the IPTV and the DLNA signal flows</figcaption>
<img src="images/iptv-vs-dlna.png" alt="figure 10-1" style="width:90%"/>
</figure>
<p>The DLNA guideline defines system usages, i.e. use cases, showing how DLNA device classes and DLNA functions interact with each other. Table <a href="#dlna-functions" class="tableRef">5</a> indicates what DLNA use cases could be supported and how DLNA device class or DLNA functional capability should be implemented in the DLNA function of the OITF to realize each use case. Note that mobile networked devices, such as M-DMS, M-DMC, are not listed in this table, but a mobile networked device corresponding to a home network device also apply to these system usages as well. </p>
<table class="simple" id="dlna-functions">
<caption>Table ####: Relevant DLNA system usages</caption>
<tr><th>DLNA system usages (use cases)</th><th>DLNA function in OITF</th><th>DLNA Device(s) which interwork with the DLNA function in the OITF</th></tr>
<tr><td><b>2 BOX PULL</b></td><td>Digital Media Server (DMS)</td><td>Digital Media Player (DMP)</td></tr>
<tr><td><b>DOWNLOAD</b></td><td>Digital Media Server (DMS)</td><td>Download Controller (+DN+)</td></tr>
<tr><td rowspan="2"><b>3 BOX</b></td><td>Digital Media Server (DMS)</td><td>Digital Media Controller (DMC)<br/>Digital Media Render (DMR)</td></tr>
<tr><td>Digital Media Server (DMS)<br/>Digital Media Controller (DMC)</td><td>Digital Media Render (DMR)</td></tr>
<tr><td><b>2 BOX PUSH</b></td><td>Push Controller (+PU+) </td><td>Digital Media Renderer (DMR)</td></tr>
<tr><td><b>UPLOAD</b></td><td>Upload Controller (+UP+) </td><td>Digital Media Server (DMS) with upload capability</td></tr>
<tr><td><b>Remote UI</b></td><td>RUI Source capability (+RUISRC+) </td><td>RUI Pull Controller (+RUIPL+)</td></tr>
</table>
<section><h2>2 BOX PULL</h2>
<p>Figure <a href="#dlna-2-box-pull" class="figureRef">10-2</a> shows the signal flow for the 2 BOX PULL system usage where an OITF serves IPTV content to a DMP. In this system usage, a user operates the DLNA Device which implements the DLNA Digital Media Player (DMP)</p>
<p>The signal flow applies to the case when OITF automatically has access to the IPTV content. </p>
<figure id="dlna-2-box-pull">
<figcaption>Figure #-####: Signal flows for a 2 BOX PULL system usage</figcaption>
<img src="images/dlna-2-box-pull.png" alt="figure 10-2" style="width:90%"/>
</figure>
</section>
<section><h2>DOWNLOAD</h2>
<p>The signal flow for DLNA download system usage is the same as for the 2 BOX PULL, except that the DLNA device implements the Download Controller (+DN+) instead of the DMP, and the media delivery on the network side will be based on a file transfer protocol instead of a media streaming protocol. In this system usage, a user operates the DLNA device which implements the DLNA Download Controller (+DN+).</p>
<p>The signal flow shown in Figure <a href="#dlna-download" class="figureRef">10-3</a> applies to the case when the OITF automatically has access to the IPTV content. </p>
<figure id="dlna-download">
<figcaption>Figure #-####: Signal flow for DLNA download system </figcaption>
<img src="images/dlna-download.png" alt="figure 10-3" style="width:90%"/>
</figure>
</section>
<section><h2>3 BOX</h2>
<p>Figure <a href="#dlna-3-box" class="figureRef">10-4</a> shows the signal flow for the 3 BOX system usage where the ITF acts as a DMS. The two DLNA devices (DMR and DMC) interwork with the DMS implemented in the OITF FE of the ITF. In this system usage, a user operates the DLNA device which implements the DLNA Digital Media Controller (DMC).</p>
<p>The signal flow applies to the case where the OITF automatically has access to the IPTV content. </p>
<figure id="dlna-3-box">
<figcaption>Figure #-####: Signal flow for the 3 BOX system usage where the ITF acts as a DMS</figcaption>
<img src="images/dlna-3-box.png" alt="figure 10-4" style="width:90%"/>
</figure>
<p>Figure <a href="#dlna-3-box-dmc" class="figureRef">10-5</a> shows the signal flow for the 3 BOX system usage where the ITF acts as both a DMC and a DMS. In this system usage, a user operates the OITF which implements the DLNA Digital Media Controller (DMC).
<figure id="dlna-3-box-dmc">
<figcaption>Figure #-####: Signal flow for the 3 BOX system usage where the ITF acts as both a DMC and a DMS</figcaption>
<img src="images/dlna-3-box-dmc.png" alt="figure 10-5" style="width:90%"/>
</figure>
</section>
<section><h2>2 BOX PUSH</h2>
<p>The signal flow for the 2 BOX PUSH system usage shows the case where the ITF acts as a DLNA Push Controller (+PU+) and is the same as the 3 BOX PUSH system usage where the ITF acts as both a DMC and a DMS. In this system usage, a user operates the OITF which implements the DLNA push controller (+PU+), as shown in Figure <a href="#dlna-2-box-push" class="figureRef">10-6</a>.</p>
<figure id="dlna-2-box-push">
<figcaption>Figure #-####: Signal flow for the 2 BOX PUSH system usage where the ITF acts as a DNLA Push Controller</figcaption>
<img src="images/dlna-2-box-push.png" alt="figure 10-6" style="width:90%"/>
</figure>
</section>
<section><h2>Upload</h2>
<p>Figure <a href="#dlna-upload" class="figureRef">10-7</a> shows the signal flow for the upload system usage where the ITF acts as a DLNA Upload Controller (+UP+). In this system usage, a user operates the OITF which implements DLNA Upload Controller (+UP+).</p>
<figure id="dlna-upload">
<figcaption>Figure #-####: Signal flow for a system usage where the ITF acts as a DNLA Upload Controller</figcaption>
<img src="images/dlna-upload.png" alt="figure 10-7 " style="width:90%"/>
</figure>
</section>
<section id="s10-6"><h2>Remote Control Function using DLNA RUI</h2>
<p>The DLNA Functions in the OITF supports DLNA RUI Source capability (+RUISRC+) to expose and source UI contents to the DLNA RUI Pull Controller (+RUIPL+) with the role of finding and loading remote UI content exposed by a +RUISRC+ capability and rendering and interacting with the UI content.</p>
<p>Figure <a href="#dlna-rcf" class="figureRef">10-8</a> shows the signal flow for RUI system usage where ITF acts as RUI Source capability (+RUISRC+). In this system usage, a user operates the DLNA device which implements the RUI Pull Controller (+RUIPL+), and the RUI Pull Controller (+RUIPL+) acts as an ITF Remote Control Function (IRCF) for controlling the ITF device and the IPTV service by using Control UI (Remote UI) sent from IPTV Applications via OITF or pre-stored in OITF.</p>
<p>The signal flow applies to the case when a user wants to control the ITF device or the IPTV service with Default or Common Control UI or by using the specialized or optimized Control UIs for the ITF device and the IPTV service.</p>
<figure id="dlna-rcf">
<figcaption>Figure #-####:  Call flow for the remote control function using the DLNA RUI</figcaption>
<img src="images/dlna-rcf.png" alt="figure 10-8" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in the flow:</p>
<table class="sequence">
<tr><td>1.</td><td>The user actives an ITF Remote Control Function (IRCF) by using the DLNA Device (+RUIPL+).</td></tr>
<tr><td>2.</td><td>If the DLNA Device (+RUIPL+) discovers a DLNA Functions (+RUISRC+) in the OITF, then the DLNA Device (+RUIPL+) can request the Default Control UI.</td></tr>
<tr><td>3.</td><td>A DLNA Functions (+RUISRC+) in the OITF sends the Default Control UI to the DLNA Device (+RUIPL+).</td></tr>
<tr><td>4.</td><td>The DLNA Device (+RUIPL+) renders the Default Control UI.</td></tr>
<tr><td>5.</td><td>The user selects the IPTV service through the Default Control UI.</td></tr>
<tr><td>6.</td><td>The HTTP message containing the selected IPTV service is sent to the DLNA Functions.</td></tr>
<tr><td>7.</td><td>A DLNA Functions (+RUISRC+) gives the requested message to the DAE.</td></tr>
<tr><td>8.</td><td>The DAE requests the DAE Application related to the service and the Control UIs which are dedicated to the service.</td></tr>
<tr><td>9.</td><td>The IPTV Applications send the DAE Application related to the service and the Control UIs which are dedicated to the service.</td></tr>
<tr><td>10.</td><td>The DAE sends the Control UIs to a DLNA Functions.</td></tr>
<tr><td>11.</td><td>A DLNA Functions (+RUISRC+) sends the Control UI to the DLNA Device (+RUIPL+).</td></tr>
<tr><td>12.</td><td>The DLNA Device (+RUIPL+) renders the Control UI.</td></tr>
<tr><td>13.</td><td>A user invokes the control action by using the Control UI.</td></tr>
<tr><td>14.</td><td>The DLNA Device (+RUIPL+) sends the HTTP message containing the control action to the DLNA Functions.</td></tr>
<tr><td>15.</td><td>The OITF handles the control action and the result of the control action is reflected in the OITF and the IPTV service.</td></tr>
<tr><td>16.</td><td>A DLNA Functions (+RUISRC+) returns the HTTP 200 OK to the DLNA Device (+RUIPL+).</td></tr>
</table>
</section>
</section> <!-- end of section 10 -->


<section class="appendix"><h1>Compliance of Architecture to the Requirements</h1>
<p>The following notation is used to describe the degree of compliance of the architecture with the requirements.</p>
<p><b>Compliant:</b> All the requirements in the referenced section are satisfied by the architecture, or do not require additions to the architecture for their support.</p>
<p><b>Not compliant:</b> The requirements in the referenced section have not been addressed by the architecture.</p>
<p><b>Partially compliant:</b> The architecture provides a solution which satisfies some of the requirements. The requirements which have not been addressed, or have no obvious architectural implications, are identified under &ldquo;Specific Requirements&rdquo; and the discussed under &ldquo;Comments and Clarifications&rdquo;.</p>
<p><b>Not applicable:</b> The requirements have no implications for the architecture (e.g., business level agreements).</p>
<table class="simple" id="requirements-compliance">
<caption>Table ####: Compliance to the Requirements</caption>
<tr><th>Ref</th><th>Requirements Section</th><th>Compliance</th><th>Specific Requirements</th><th>Comments and clarification</th></tr>
<tr><td>5</td><td colspan="4">Service Requirements</td></tr>
<tr class="compliant"><td>5.1</td><td>General</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.2</td><td>Provider Relationships</td><td>Compliant</td><td></td><td></td></tr>
<tr><td>5.3</td><td colspan="4">Service Categories</td></tr>
<tr class="partial-compliant"><td>5.3.1</td><td>Scheduled Content Service </td><td>Partially compliant</td><td>
<p>[2-1171] [R2] Time delay in switching from one scheduled content channel to another should be no greater than 2 sec.</p>
<p>[2-1172] [R2] The IPTV Solution shall provide a fast channel changing mechanism to switch from one scheduled content channel to another in less than 500 msec.</p>
</td><td>
<p>The Release 2 architecture should achieve the 2 sec channel change times assuming video GOP lengths are maintained at ~15; however the architecture  does not include any architectural components designed to bring channel change times down to &lt;500ms). </p>
<p>Note that there are industry initiatives (DVB, IETF) on FCC mechanism via additional components, but a standardized solution may not be available for reuse in time for inclusion in the Release 2 solution. Any additional components are expected to be included in the Transport Processing Function, and thus not visible in this application level architecture specification.</p>
</td></tr>
<tr><td>5.3.2</td><td colspan="4">Content on Demand (CoD)</td></tr>
<tr class="compliant"><td>5.3.2.1</td><td>Common Requirements</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.2.2</td><td>Streamed CoD Requirements</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.2.3</td><td>Push CoD</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.2.3</td><td>Deferred Download CoD</td><td>Compliant</td><td></td><td></td></tr>
<tr><td>5.3.3</td><td colspan="4">PVR</td></tr>
<tr class="compliant"><td>5.3.3.1</td><td>Local PVR</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.3.2</td><td>nPVR</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.4</td><td>Time Shift</td><td>Compliant</td><td></td><td></td></tr>
<tr class="partial-compliant"><td>5.3.5</td><td>Service and Content Navigation</td><td>Partially compliant</td><td>[2-1451] [R2] The IPTV Solution shall support a mechanism to receive information from a mobile or a portable device describing an item of IPTV content and enable the user to then access this IPTV content item on an ITF.</td><td>The use of the IRCF function in a mobile device may allow this requirement to be implemented. However, the specifics of the network signalling have not been investigated.</td></tr>
<tr class="compliant"><td>5.3.5.1</td><td>Service Navigation</td><td>Compliant</td><td></td><td></td></tr>
<tr class="partial-compliant"><td>5.3.5.2</td><td>Content Guide (CG)</td><td><p>Partially compliant for network implementation.</p><p>Compliant for implementation in an OITF.</p></td><td><p>[1-1540] [R1]	The IPTV Solution shall support filtering of Content Guide information to show different amounts of detail according to whether the content item is part of the subscription or not. </p><p>[1-1550] [R1]	The IPTV Solution shall support filtering of Content Guide information according to the rating of the item and the personal profile (including parental controls placed if any) of the user.</p></td><td>Additional inter-FE interfaces may be required. </td></tr>
<tr class="compliant"><td>5.3.6</td><td>User Notification Service</td><td>Compliant</td><td></td><td></td></tr>
<tr class="not-compliant"><td>5.3.7</td><td>Advertising</td><td>Not compliant</td><td>All the requirements.</td><td>Work is ongoing to determine how these requirements can be supported by the architecture.</td></tr>
<tr><td>5.3.8</td><td colspan="4">Communication Services</td></tr>
<tr class="compliant"><td>5.3.8.1</td><td>Caller ID</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.8.2</td><td>Presence</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.8.3</td><td>Messaging</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.8.4</td><td>Chatting</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.8.5</td><td>Voice and Video Telephony</td><td>Compliant</td><td></td><td></td></tr>
<tr class="not-compliant"><td>5.3.8.6</td><td>Content Sharing</td><td>Not compliant</td><td>
<p>[2-1798] [R2] When allowed by the relevant DRM policies, users shall be able to select items of content available at their ITFs and send them directly to another user's ITF.</p><p>[2-1799] [R2] The IPTV Solution shall support that the receiving user can select the appropriate ITF for consumption of the content.</p>
</td><td>No procedures have been evaluated to determine how these could work. No determination has been made if any additional architectural components are needed.</td></tr>
<tr class="compliant"><td>5.3.9</td><td>Bookmarks</td><td>Compliant</td><td></td><td></td></tr>
<tr><td>5.3.10</td><td colspan="4">Personalized Services</td></tr>
<tr class="compliant"><td>5.3.10.1</td><td>Personalized Channel</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.3.10.2</td><td>Purchase of Digital Media</td><td>Compliant</td><td></td><td></td></tr>
<tr class="not-compliant"><td>5.3.12</td><td>User Reviews</td><td>Not compliant</td><td>[2-1851] [R2] The IPTV Solution shall provide a mechanism for presenting messages or comments expressed by other users during a previous instance, synchronized in line with the content.</td><td>No procedures have been evaluated to determine how these could work. No determination has been made if any additional architectural components are needed.</td></tr>
<tr class="partial-compliant"><td>5.4</td><td>Remote Control Functions</td><td>Partially compliant</td><td><p>[2-1862] [R2] The IPTV Solution shall support the ability to enable and disable a user's IRCF remote control access per ITF.</p><p>[2-1863] [R2] The IPTV Solution shall offer a mechanism through which an IRCF associated with an IPTV User can be correlated to a specific ITF.</p>
</td><td>No procedures have been evaluated to determine how these could work with the DLNA-based IRCF function defined in the architecture.</td></tr>
<tr><td>5.5</td><td colspan="4">Application Deployment and Execution</td></tr>
<tr class="compliant"><td>5.5.1</td><td>General Requirements</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.5.2</td><td>Common Requirements</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.5.3</td><td>Requirements Specific to Browser Applications</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.5.4</td><td>Requirements Specific to Executable Applications</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.5.5</td><td>Other Requirements</td><td>Compliant</td><td></td><td></td></tr>
<tr><td>5.6</td><td colspan="4">Security</td></tr>
<tr><td>5.6.1</td><td colspan="4">Access control</td></tr>
<tr class="compliant"><td>5.6.1.1</td><td>Application Security</td><td>Compliant</td><td></td><td></td></tr>
<tr><td>5.6.2</td><td colspan="4">Authentication</td></tr>
<tr class="partial-compliant"><td>5.6.2.1</td><td>User Authentication</td><td>Partially compliant</td><td><p>[1-2210] [R2] When an IPTV Service Provider does not belong to the same business entity as the Service Platform Provider but has a service level agreement with the Service Platform Provider, the IPTV Solution shall support the ability to be able to reuse the Service Platform-level authentication for granting IPTV service access.</p><p>[2-2231] [R2] The IPTV Solution shall support a single sign-on mechanism that protects the privacy of the user across different IPTV services.</p><p>[2-2232] [R2] The IPTV Solution shall support a single sign-on mechanism that allow an IPTV service to request particular sets of information about the user.</p><p>[2-2233] [R2] The IPTV Solution shall support a single sign-on mechanism that allows one authentication session to enable access to multiple IPTV services at the same time.</p>
</td><td>No procedures have been evaluated to determine how these could work. No determination has been made if any additional architectural components are needed.</td></tr>
<tr class="compliant"><td>5.6.2.2</td><td>Application Authentication</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.6.3</td><td>Data Confidentiality</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.6.4</td><td>Service and Content Protection / DRM</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.6.5</td><td>Forced playout</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.6.6</td><td>Communication Security</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.7</td><td>Remote Management</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.8</td><td>Registration</td><td>Compliant</td><td></td><td>These requirements are for the process of signing up for a subscription. Covered by O&amp;M to service profile interfaces. O&amp;M is not included in the architecture.</td></tr>
<tr class="partial-compliant"><td>5.9</td><td>Charging</td><td>Partially compliant</td><td><p>[1-2770] [R1] When the appropriate relationships and agreements are in place between the access network provider, IPTV Service Provider and SPP, the IPTV Solution shall support a mechanism for the SPP can to aggregate charging data with respect to usage of the access network and/or IP connectivity services with charging data generated with respect to usage of Platform Provider services and the IPTV services of IPTV Service Providers.</p><p>[2-2821] [R2] The IPTV Solution shall allow for purchased Digital Media to be charged alongside the regular billing activities for IPTV services.</p><p>[2-2822] [R2] The IPTV Solution shall support aggregation of charging information of all services of a user independently of the end device and the access network over which the service is used.</p>
</td><td>No explicit interfaces or mechanisms from the charging FE to billing and other external systems are defined. IMS Service level charging is covered by existing IMS charging capabilities.</td></tr>
<tr class="compliant"><td>5.10</td><td>Accessibility</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.11</td><td>Audience Measurement</td><td>Compliant</td><td></td><td></td></tr>
<tr><td>5.12</td><td colspan="4">Profiles</td></tr>
<tr class="compliant"><td>5.12.1</td><td>User Profiles</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.12.2</td><td>Network Resources</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.13</td><td>Content &ldquo;Parental&rdquo; Control</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.14</td><td>Service Portability</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.15</td><td>Session Continuity</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.16</td><td>Home Network</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.16.1</td><td>Remote Access</td><td>Compliant</td><td></td><td></td></tr>
<tr><td>5.17</td><td colspan="4">Protocols and Data Formats </td></tr>
<tr class="compliant"><td>5.17.1</td><td>Content Formats</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.17.2</td><td>Transmission Protocols</td><td>Compliant</td><td></td><td></td></tr>
<tr class="partial-compliant"><td>5.17.3</td><td>Control Protocols</td><td>Partially compliant</td><td><p>[2-3171] [R2] The IPTV Solution shall provide a standardized mechanism to recover content streams from transmission errors by providing error recovery data in addition to the content stream, both for Scheduled Content Services as well as CoD services.</p><p>[2-3172] [R2] The IPTV Solution shall provide a standardized mechanism to recover content streams from transmission errors by retransmission of the missing data, both for Scheduled Content Services as well as CoD services.</p><p>[2-3173] [R2] The mechanism for recovery from transmission errors shall not affect rendering of the content stream by ITFs that do not support such mechanisms.</p>
</td><td>No additional architectural components defined. The inclusion of RET servers is assumed as a part of the Transport Processing Function.</td></tr>
<tr class="compliant"><td>5.17.4</td><td>Content Download Protocols</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.17.5</td><td>Metadata</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.17.6</td><td>Digital Media Transfer</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.17.7</td><td>Quality of Service</td><td>Compliant</td><td></td><td></td></tr>
<tr class="not-compliant"><td>5.18</td><td>Data Export</td><td>Not compliant</td><td><p>[1-3270] [R1] The IPTV Service Provider shall be able to export filtered content metadata to a 3rd party Content Guide provider.</p><p>[1-3280] [R1] The IPTV Solution shall support standard mechanisms to export filtered subscription data excluding any explicit reference to the actual user identity.</p>
</td><td>No interface defined</td></tr>
<tr><td>5.19</td><td colspan="4">Managed Network Specific Service Requirements</td></tr>
<tr class="compliant"><td>5.19.1</td><td>Network Resources</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.20</td><td>Open Internet Specific Service Requirements</td><td>Compliant</td><td></td><td></td></tr>
<tr class="compliant"><td>5.21</td><td>Hybrid Device Requirements</td><td>Compliant</td><td></td><td></td></tr>
<tr><td>6</td><td colspan="4">Platform Requirements</td></tr>
<tr class="not-compliant"><td>6.1</td><td>Content Delivery Networks</td><td>Not compliant</td><td>All the requirements.</td><td>No procedures have been evaluated to determine how these could work. No determination has been made if any additional architectural components are needed.</td></tr>
</table>
</section>
<section class="appendix" id="proxy-description-and-gba-sso"><h1>Proxy Description and GBA Single Sign-on	(informative)</h1>
<p>This section introduces single-sign on architecture defined for IMS, and known as the Generic Bootstrap Architecture (GBA) [[!Ref-25]], and the role the authentication proxy. </p>
<section><h2>GBA Single Sign-on Architecture Description</h2>
<p>Figure <a href="#gba-sso-arch" class="figureRef">B-1</a> depicts the proposed GBA Single Sign-on architecture. This architecture capitalizes on the existing authentication schemes that are deployed to register an ITF to the network, and the shared secret between the ITF and certain network entities.</p>
<figure id="gba-sso-arch">
<figcaption>Figure #-####: GBA Single Sign-on Architecture</figcaption>
<img src="images/gba-sso-arch.png" alt="figure B-1" style="width:50%"/>
</figure>
<p>An ITF that desires to establish a secure channel with an Application Server (AS) before accessing the service must be able to acquire a key to share with the AS for securing its communication with that AS.</p>
<p>For that purpose, the ITF authenticates itself to a trusted node in the network dedicated for that purpose. This is the role of the GBA Single Sign-on function. Once successfully authenticated with the GBA Single Sign-on function, the ITF generates locally a master key that it uses to generate the key to be shared with the AS. The Single Sign-on FE performs the same procedure and generates the same master key. The procedure used to generate the key shall be known to the ITF and the GBA Single Sign-on function, and is based on existing standard mechanisms. </p>
<p>As previously stated, the master key generated in the ITF and the Single Sign-on node is used to generate the key to be shared with the AS. In order to allow the ITF to share separate keys with the different ASs with whom it wants to communicate, the AS URI can be used in the generation of the shared key in combination with the master key.</p>
<p>Later on, when the ITF attempts to activate the service, mutual authentication is required with the AS. Server certificates can be used by the ITF to authenticate the AS. Following that, a secure channel can be established. Once the secure channel is set up, the user can be authenticated by the AS using the shared key. The ITF uses the shared secret as a password, and the AS can fetch the same key from the GBA Single Sign-on function. Once mutual authentication is successfully concluded by the AS, it can verify if the user is authorized for the service. Obviously that step is skipped if the mutual authentication cannot be established.  Service authorization is based on the service access information in the Subscription profile.</p>
<p>Figure <a href="#gba-sso-flow" class="figureRef">B-2</a> depicts a call flow illustrating the above procedure:</p>
<table class="sequence">
<tr><td>1.</td><td>The ITF authenticates itself with the GBA Single Sign-on function using the same credentials used in the IMS registration process.</td></tr>
<tr><td>2.</td><td>The ITF generates a master key locally and uses that key to generate separate keys for all ASs with whom it desires to communicate.</td></tr>
<tr><td>3.</td><td>The GBA Single Sign-on function performs the same process.</td></tr>
<tr><td>4.</td><td>The ITF establishes a secure channel with the AS using the AS's public server certificate for that purpose.</td></tr>
<tr><td>5.</td><td>The AS fetches the shared key for that user from the GBA Single Sign-on function.</td></tr>
<tr><td>6.</td><td>The ITF then uses the shared key with the AS as its password to authenticate itself. The AS compares the received password with the one fetched from the GBA Single Sign-on function.</td></tr>
<tr><td>7.</td><td>Mutual authentication is now completed and signalling exchange can start.</td></tr>
</table>
<figure id="gba-sso-flow">
<figcaption>Figure #-####: GBA Single Sign-on call flow</figcaption>
<img src="images/gba-sso-flow.png" alt="figure B-2" style="width:90%"/>
</figure>
</section>
<section><h2>Authentication Proxy and Service Access in a multi-AS Environment</h2>
<p>The procedure presented in Figure <a href="#gba-sso-flow" class="figureRef">B-2</a> shows that the AS must implement some specific procedures to be able to capitalize on the Single Sign-on procedure described above. This is not desirable since it implies that every AS must implement that scheme. In order to alleviate the need for the AS to have to cope with that, a new node, the Authentication Proxy node, is introduced in the network. Figure <a href="#gba-sso-auth-proxy" class="figureRef">B-3</a> depicts such an architecture. </p>
<p>Within that architecture, the Authentication Proxy (AP) plays the same role depicted by the AS in the previous section. The advantage of such an approach are numerous: application servers don't need to do anything special in that regard, the ITF establishes a single secure channel with the AP and can use that to communicate with any AS later. Finally, any application server requiring such a scheme can be introduced in the network without any changes to existing architecture thus simplifying network deployment. Note that the AP is transparent to the ITF since the AP obtains the AS address through DNS lookup.</p>
<figure id="gba-sso-auth-proxy">
<figcaption>Figure #-####: Authentication Proxy and GBA Single Sign-on Architecture</figcaption>
<img src="images/gba-sso-auth-proxy.png" alt="figure B-3" style="width:70%"/>
</figure>
</section>
</section>
<section class="appendix"><h1>Content Delivery Network Architecture description	 (informative)</h1>
<section><h2>General Description: CDN Architecture Overview</h2>
<p>The CDN (Content Delivery Network) is a fundamental functionality in an IPTV CoD solution, since it allows the optimization of the network use through a distribution of the media servers in the physical network, and the optimization of the storage resources through a popularity-based distribution of the A/V content on the media servers. This usually results in having popular A/V content massively distributed on media servers at the edge of the network (as close as possible to the customer) while less popular content are distributed on an reduced number of media servers. </p>
<p>The following definitions and assumptions are used with regard to the CDN architecture:</p><ul>
<li>The term Video File corresponds to the Media of a movie stored on a CDF in a defined format.
<li>The term Content is a generic naming used in the present document to designate a video movie. It does not represent the physical media itself (which is the Video File). Content may be available in different Video File formats.
<li>The term Cluster corresponds to a logical association of one or more CDFs which share some resources (such as location, storage capacity).
<li>The term Cluster Controller (CC) corresponds to the function in charge of the management of the resources of the Cluster.
<li>A CDN is a set of CDFs/CCs/CDNC.
<li>One CDF belongs to only one Cluster at a time (1 Cluster : n CDF)
<li>One CC is responsible for the control of the CDFs associated with the Cluster (1 CC : n CDF) (This doesn't presume that CC function can not be redundant to improve service resilience)
<li>Both Cluster and ITF could have a location attribute which will allow calculating the 'Network distance' between the ITF and the Cluster. Other strategies could also be envisaged depending on the choice algorithm.
<li>Video Files available to customers are not necessarily distributed uniformly among the CDFs.
<li>A Video File may be present in some Clusters while absent in others.
<li>A Video File may be present in some CDFs within a given Cluster and absent in some other CDFs within the same Cluster.
<li>The ingestion and distribution of the Video Files among the CDFs is not in the scope of the contribution. However in some cases the distribution strategy and dynamic behaviour of content popularity can have a major impact on the choice of service and delivery setup.
<li>CCs are managed by a CDNC (NB: This does not presume the number of instances of CDNC function across the CDN).
</ul>
<p>The hierarchical relationship between CDNCs/ CCs and CDF is shown in Figure <a href="#cdn-hierarchy" class="figureRef">C-1</a>.</p>
<figure id="cdn-hierarchy">
<figcaption>Figure #-####: Relationship between IPTVC/CDNC/CC/CDF</figcaption>
<img src="images/cdn-hierarchy.png" alt="figure C-1" style="width:90%"/>
</figure>
<p>Two types of sessions are put in place to enable content delivery to the user:</p><ul>
<li>The Service Setup Session, which is used to setup an audiovisual service. It concerns the ITF, the Authentication and session management, the IPTV Control, the CDNC, the CC and the CDF. This session leads to the creation of a Content Delivery Session. 
<li>The Content Delivery Session, which delivers the media from the CDF to the ITF. This session involves the ITF, the CC and the CDF.  A Content Delivery Session is associated to a single Service Setup Session. This session is composed of:<ul>
<li>A Content Delivery Session Control Plane: this allows the establishment of the Content Delivery Session and the control its progress.
<li>A Content Delivery Session Transfer Plane: this allows the delivery of the media to the ITF.
</ul></ul>
<p>Several Content Delivery Sessions can be created from the same Service Setup Session (for instance in order to take into account modifications in the course of the session). We consider here that these Content Delivery Sessions happen sequentially in time. Each Content Delivery Session contributes to the delivery of the media to the ITF. </p>
<p>Whenever the ITF or the CDF have to be re-selected (e.g. for service continuity), this causes to establish a new Content Delivery Session, If resource reservation is needed the service session needs to be updated. Please refer to section <a href="#s6-4-2" class="sectionRef">6.4.2</a> for more information.</p>
<p>The IPTV Control, Authentication and session management and the CDNC can choose to stay informed with the Content Delivery Session progress and major events. They can change/teardown both sessions' parameters at any time, according to a defined policy.</p>
</section>
<section><h2>Role of the CDN in the CoD service</h2>
<p>The CDN operations, regarding the service setup session are organized in three sequential steps:</p><ul>
<li>CDNC selection
<li>CC selection
<li>CDF selection
</ul>
<section><h3>CDNC selection</h3>
<p>Two strategies can be applied while choosing the CDNC depending on the popularity of the content.</p><ul>
<li>If the content has a rather stable popularity, the choice of the CDNC can be performed directly by the IPTVC, and be considered as part of the Video file selection step. A stable popularity means the redistribution of the video files across the CDN is performed on a daily basis. This is the case of long, mainstream contents (e.g. movies). In order for the IPTVC to choose the CDNC it has to have the information that the video file is within the CDNC's stratum of the CDN. This corresponds to the call flows shown in section <a href="#s6-4-1" class="sectionRef">6.4.1</a>.
<li>If the content has a very dynamic popularity, the choice of the CDNC is left to a selection process performed across the CDN. A dynamic popularity means that the contents are redistributed across the CDN on an hourly basis (as an example). This is the case of short specialized contents, like music videos and user generated contents. Hence, the IPTVC does not need to keep up with all the file locations, and does not choose the CDNC, It forwards the aforementioned parameters to a default CDNC (for example) to trigger the decentralized selection process (as shown in Figure <a href="#decentralized-cdn-controller" class="figureRef">C-3</a>). the right CDN controller's choice could be based on:<ul>
<li>Video Content Selection Parameters
<li>CDNC's organisation (Figure <a href="#CDN-organization-examples" class="figureRef">C-2</a> shows a few examples of such an organization)
<li>Search and discovery algorithms (e.g., peer-to-peer algorithms, theme based, length based, etc.)
</ul></ul>
<p class="notebox"><b>NOTE</b> &mdash; it is required to have a mechanism to avoid a loop between CDNC, in order to implement this option</p>
<p>In both cases the choice of the target CDNC depends on a set of parameters generated by the IPTV controller such as:</p><ul>
<li>Applicable video files 
<li>Access Network information
<li>ITF capabilities
</ul>
<figure id="CDN-organization-examples">
<figcaption>Figure #-####: CDNC organization examples</figcaption>
<img src="images/CDN-organization-examples.png" alt="figure C-2" style="width:90%"/>
</figure>
<figure id="decentralized-cdn-controller">
<figcaption>Figure #-####: The decentralized CDN controller choice option</figcaption>
<img src="images/decentralized-cdn-controller.png" alt="figure C-3" />
</figure>
</section>
<section><h3>CC selection</h3>
<p>The chosen CDNC shall choose, depending on the parameters generated by the IPTV Control, the best cluster to coordinate the content delivery session. The most important parameter in that choice could be the location and model of the ITF.</p>
</section>
<section><h3>CDF selection</h3>
<p>The chosen CC would then select the most appropriate Content Delivery Function, within the cluster, for sending the content to the user. The most important parameter in that choice would be the availability of the applicable files, and the load on the CDF's, visible only to the CC.</p>
<p>Once all the involved functions in the CDN are identified, the IPTV Control is informed of the success and forwards a success message to the ITF, with the green light to proceed to the next step.</p>
</section>
</section>
</section>
<section class="appendix"><h1>IMS User Identities 	(informative)</h1>
<p>This section provides a brief overview of IMS User identities and how they can be used within the managed IPTV solution. For more information refer to TS 23.228 [[!Ref-15]].</p>
<p>The examples and description within this section are based on IMS AKA authentication mechanisms described in section <a href="#s6-3-2-1" class="sectionRef">6.3.2.1</a>. This authentication mechanism requires one or more UICCs in the residential network.</p>
<p>The examples are not exhaustive. </p>
<section><h2>Introduction</h2>
<p>There are various identities that may be associated with a user of IP multimedia services described in the following subsection.</p>
<section><h3>IMS Private User Identities - IMPI</h3>
<p>Every user who wishes to participate in IMS-based communications services must be associated with one or more IMS Private User Identities (IMPI). An IMPI is assigned by the home network <mark class="footnote">In telecommunications, the term &ldquo;home network&rdquo; refers to the network operator with whom a user has a subscription for services</mark> operator at the time of subscription to IMS based services and used subsequently for Registration, Authorization, Administration, and Accounting purposes. </p>
<p>The Private User Identity is stored in the home network operator's HSS as well as in a UICC (smart card) provided by the residential network operator to the subscriber, and is not accessible to the end user. In addition to storing the IMPI, the UICC also contains the security credentials (long term secret key) shared with the residential network operator and necessary for authentication.</p>
<p>The Private User Identity identifies the subscription, not the user. It is not used for routing of SIP messages. The Private User Identity is used to access, during Registration, the user's IMS-related subscription information (e.g. the security credentials needed for authentication) stored within the HSS. </p>
<p>The IMPI is authenticated using the security credentials stored in the UICC at the time of the registration (as well as during re-registration and de-registration). </p>
<p>The registrar in the residential network, the S-CSCF, obtains and stores the authenticated Private User Identity upon successful registration and deletes it when the UE is de-registered. The authenticated IMPI can be used by the S-CSCF to obtain from the HSS a list of the subscribed-to IMS services, so that subsequent attempts to communicate requiring these services can be authorized.</p>
</section>
<section><h3>IMS Public User Identities - IMPU</h3>
<p>An IMS subscription may support multiple end users. Each end user must be associated with one or more IMS Public User Identities (IMPU) for the purpose of IMS-based communications with services or other users. During registration, at least one IMPU is bound to the contact address (SIP URI containing the IP address) of the registering UE. This contact address serves as the point of contact for an end user associated with that IMPU for originating and terminating IMS sessions.</p>
<p>The IMPU takes the form of a SIP URI or a &ldquo;Tel URI&rdquo;. The residential network operator is responsible for the assignment of Public User Identities. The assignment of a human-friendly username for a SIP URI depends on the provisioning options offered by the operator.</p>
<p>The assignment of IMPUs associated with an IMPI to multiple end users is a matter for the owner of the subscription, and outside the scope of standardization.</p>
<p>Public User Identities are not authenticated by the network during IMS registration. Therefore, a communicating end user is not authenticated by the IMS network. This is not an issue for typical mobile person-to-person communications services, where there is usually a 1-to-1 relationship between the communicating end user and the holder of the subscription, and one can assume that an authenticated subscription implies an authenticated end user, but such a relationship cannot be assumed in the general case (multiple end-users associated with a single subscription).</p>
<p>Public User Identities may be used to identify the user's IMS profile within the HSS for example during mobile terminated session set-up. </p>
</section>
</section>
<section><h2>Relationship of IMS Private and Public User Identities</h2>
<p>The relationship of Public User Identities to Private User Identities, and the resulting relationship with an IMS subscription is shown in Figure <a href="#impi-impu-relationship" class="figureRef">D-1</a>.</p>
<figure id="impi-impu-relationship">
<figcaption>Figure #-####: Relationship of the Private User Identity and Public User Identities</figcaption>
<img src="images/impi-impu-relationship.png" alt="figure D-1" style="width:90%"/>
</figure>
<p>A Public User Identity may be shared by multiple Private User Identities within the same IMS subscription. </p>
<p>Hence, a particular Public User Identity may be simultaneously registered from multiple UEs that use different Private User Identities and bound to different contact addresses. </p>
</section>
<section><h2>Relationship of IMS Service Profiles to IMPIs/IMPUs</h2>
<p>An IMS Service Profile is a collection of service and user related data as defined in 3GPP TS 29.228 [[!Ref-26]].  It is possible to identify the Public User Identities of a user who is linked to the same service profile and has the exact same service configuration for each and every service (i.e. &ldquo;alias&rdquo; Public User Identities).</p>
<p>The IMS service profile is defined and maintained in the HSS and its scope is limited to IMS Core Network Subsystem. A Public User Identity is registered at a single S-CSCF. All Public User Identities of an IMS subscription are registered at the same S-CSCF. The service profile is downloaded from the HSS to the S-CSCF. Only one service profile can be associated with a Public User Identity at the S-CSCF at a given time. Multiple service profiles may be defined in the HSS for a subscription. Each Public User Identity is associated with one and only one service profile. Each service profile is associated with one or more Public User Identities.</p>
<p>The relationship for a shared Public User Identity with Private User Identities, and the resulting relationship with service profiles and IMS subscription, is depicted in Figure <a href="#impi-impu-service-relationship" class="figureRef">D-2</a>.</p>
<figure id="impi-impu-service-relationship">
<figcaption>Figure #-####: Relationship of the Private User Identity and Public User Identities to Service Profiles</figcaption>
<img src="images/impi-impu-service-relationship.png" alt="figure D-2" style="width:90%"/>
</figure>
All Service Profiles of a user shall be stored in the same HSS, even if the user has one or more shared Public User Identities.
</section>
<section id="annex-d-4"><h2>Identity Model Options in IMS-IPTV</h2>
<p>To use IMS capabilities and allow personalization of the IPTV services and blending of IPTV and IMS services, subscribers must be assigned IMS public identities as per 3GPP principles and TS 23.228. [[!Ref-15]]</p>
<p>Each IMS Public Identity associated with an IMS-IPTV subscription represents a user within the household. This identity is used when the user &ldquo;logs on&rdquo; to the ITF for personalized IPTV services using the specific IMPU assigned to them (i.e., registers with the IMS network). A user can have more than one IMS Public Identity if they so choose. How the user is assigned one or more IMPU(s) is out of scope of standardization, but normally this is done by the owner of the subscription (e.g., head of household) in some manner.</p>
<p>Where multiple public identities are associated with an IMPI, one of these identities serves as a default public identity and is not associated with a member of the household.</p>
<p>At power-up the default public identity associated with the IMPI is registered on successful authentication of the IMPI. Once the default identity successfully registers in IMS, the service profile associated with the default identity is available to all users within that IPTV subscription so long as they do not login with their own public identity. In this case their personal profile takes over after they have successfully registers their public identity in IMS.</p>
<p>The ISIM, or IMS Subscription Identity Module, contains the collection of parameters that are used for user identification (IMPUs), user authentication (long-term secret key shared between ISIM and home IMS network) and terminal configuration.</p> 
<p>One ISIM application will host one IMPI and at least one IMPU.</p>
<p>There can be several ISIMs on one UICC, and they can also co-exist with other SIMs and USIMs</p>
<p>Multiple options are available for </p><ul>
<li>the number of IMPIs to be deployed within a house hold 
<li>the number of IMS-IPTV subscriptions, 
<li>how the public identities should be associated with the IMPIs and the IMS-IPTV subscriptions. </ul>
<p>These options depend on a number of factors, including,</p><ul>
<li>the deployment scenario,
<li>the level of desired privacy and security within a household, 
<li>the billing needs for the household, 
<li>the number of devices in the household, 
<li>the roaming needs of various members in the household.  </ul>
<p>The following sub-sections describe the main features of these options, including the pros and cons, </p>
<p>For the illustration of the options, it is assumed that members in a household are a mom, a dad and a son. <u>Note that even though in the following sections the term UICC is used, the ISIM could as well be running in a software container.</u></p>
<p class="inline-header"><u>Option 1: Shared UICC for the entire household</u></p>
<p>In this option, all household members share a single UICC. There are several sub-options in this option.</p>
<p class="inline-header">Option 1.1: All IMPUs are associated with a single IMPI</p>
<p>This is depicted in Figure <a href="#single-impi" class="figureRef">D-3</a> below. In this sub-option, all IMPUs are associated with the same IMPI.  There would be also a single IMS IPTV subscription for the entire household.</p>
<figure id="single-impi">
<figcaption>Figure #-####: All IMPUs associated with a single IMPI</figcaption>
<img src="images/single-impi.png" alt="figure D-3" style="width:90%"/>
</figure>
<p><b>Pros:</b></p><ul>
<li>No need to change UICC when a household member wants to register. Hence from a usability point of view, this is quite convenient</ul>
<p><b>Cons:</b></p><ul>
<li>Any member of the household can use any one of the IMPUs at the time of registration, unless application support is provided that allows a particular user to login to the OITF prior to performing IMS registration using a particular IMPU</ul>
<p>Given that this option requires means to prevent identity theft,  it is more appropriate for a deployment that includes an IMS gateway (IG) that can house such an application and the UICC, provided that the LAN in the house is secure so that passwords cannot be stolen while being transferred from an OITF to the gateway.</p>
<p class="inline-header">Option 1.2: All IMPUs are associated with a single IMPI</p>
<p>This is depicted in Figure <a href="#1-to-1-impi-impu" class="figureRef">D-4</a> below. In this sub-option, each member in the household will have a different IMPI. A UICC (or its software equivalent) hosts multiple ISIM applications, each one associated with one IMPI.</p>
<figure id="1-to-1-impi-impu">
<figcaption>Figure #-####: 1:1 IMPU-IMPI relationship</figcaption>
<img src="images/1-to-1-impi-impu.png" alt="figure D-4" style="width:90%"/>
</figure>
<p><b>Pros:</b></p><ul>
<li>No need to change UICC when a household member wants to register.
<li>Identity theft is not possible as each user has to individually &ldquo;unlock&rdquo; his ISIM application
</ul>
<p><b>Cons:</b></p><ul>
<li>The UICC will have to incorporate multiple ISIM applications, one for each IMPI. This is not common today as operators are accustomed to have a single application on a UICC.  UICC vendors will have to support means to allow a user to select the ISIM he wants (pin unlocking or password)</ul>
<p class="inline-header">Option 1.3: Hybrid of Options 1.1 & 1.2 </p>
<p>This is depicted in Figure <a href="#mixed-impi-impu" class="figureRef">D-5</a> below. This sub-option essentially includes some household members who are associated with one IMPI, while others who are associated with a separate IMPI </p>
<figure id="mixed-impi-impu">
<figcaption>Figure #-####: Mixed IMPU-IMPI relationships</figcaption>
<img src="images/mixed-impi-impu.png" alt="figure D-5" style="width:90%"/>
</figure>
<p>If the ISIM application including IMPI2 is selected then the default public identity will be the one to be registered by default at power-up.  Following that, the son or the mom can IMS register their identities if they want to receive personalized service.  If the ISIM application including IMPI1 is selected, then the dad's public identity (IMPU1) will be registered by default.</p>
<p class="inline-header">Option 1.4: Household equipped with multiple OITFs</p>
<p>If there are multiple OITFs in the house, and to enable the entire household to share a single UICC, then the household requires an IMS gateway (IG) for that purpose.  Any household member can access the gateway from any OITF.</p>
<p class="inline-header"><u>Option 2: Multiple UICCs in the household with Single OITF</u></p>
<p>In this option, each household member has a separate UICC (or its software equivalent). The household member can share the same IMS IPTV subscription or they can have different subscriptions.   </p>
<figure id="multiple-uiccs">
<figcaption>Figure #-####: Multiple UICCs</figcaption>
<img src="images/multiple-uiccs.png" alt="figure D-6" style="width:90%"/>
</figure>
<p><b>Pros:</b></p><ul>
<li>Complete privacy (no potential for any sharing)
<li>Aligned with today's usage of UICC (one ISIM application per UICC)
<li>Flexible ISIM swapping between devices since every user has his own UICC.
</ul>
<p><b>Cons:</b></p><ul>
<li>Re-usability issues when it comes to device sharing in a household </ul>
</section>
</section>


<section class="appendix" id="RAC-for-multicast"><h1>Resource and Admission Control for multicast	(informative)</h1>
<p>This Appendix gives a more detailed description of the Resource and Admission Control Transport and the relation with Multicast Delivery Function for an xDSL access network. It also gives more detailed information flows for multicast service support and QoS issues.</p>
<p>The solution described in this Appendix is purely functional. All the examples refer to xDSL. The concepts described here, or similar ones, can be applied to other access technologies, but these are not described here for the sake of brevity.</p>
<section><h2>Transport and Multicast Delivery Function description</h2>
<p>The Network Operator's Transport and Multicast Delivery for multicast services support is typically composed by the following entities (as shown in the following picture):</p><ul>
<li>Transport Access Node (e.g. DSLAM): the access node 
<li>Transport Remote Node (e.g. IP Edge or Feeder): the network element that resides at the boundary between core networks and access networks.
<li>Aggregation: the network which interconnects the Transport Access Node to the Transport Remote Node; the aggregation network between the Transport Access Node  and the Transport Remote Node  could include intermediate nodes which can be layer 2 or layer 3 based, depending on the Transport Access Node capabilities. A simplified configuration, including just Transport Access Node and Transport Remote Node, is used hereafter for the description of the resource reservation scenarios; however, this can be extended to more complex aggregation network configurations.</ul>
<figure id="transport-network-delivery-components">
<figcaption>Figure #-####: Mixed IMPU IMPI relationships</figcaption>
<img src="images/transport-network-delivery-components.png" alt="figure E-1" style="width:90%"/>
</figure>
<p>Note that not every multicast channel is usually present at Transport Access Node (e.g. DSLAM), and the number of multicast streams that arrive at the Transport Access Node varies dynamically. Moreover, the network resources connecting the Transport Access Node to the Transport Remote Node (Aggregation or Metro Network) are limited, and a user could try to request a channel that at the moment is not already present at the Transport Access Node.</p>
<p>In a Layer 3 aggregation network, during multicast channel selection, the Transport Access Node terminates IGMP messages sent from  the user (IGMP messages relating to the content delivery Session) and sends new IGMP or PIM messages to its neighbour nodes, the Transport Remote Node.</p>
<p>In a Layer 2 aggregation network, during multicast channel selection, the Transport Access Node snoops the IGMP messages sent from the user and forwards them upstream towards the Transport Remote Node.</p>
<p>In the following examples and call flows a layer 3 Transport Access Node using PIM for multicast signalling is considered, but the examples can easily be extended to other deployments.</p>
<p>With the context of this annex, it is assumed that there are no intermediate L2 or L3 nodes between the Transport Access node and the Transport Remote Node. This is a simplification that will be removed in subsequent revisions of this Annex. </p>
<p>When the ITF wishes to join a multicast channel with different QoS requirements (e.g. zapping from a SD to a HD channel) or if the stream for the new channel requested is not present in the Transport Access Node, in order to guarantee the needed bandwidth for the channel, an interaction between the Transport and Multicast Delivery Function and Admission Control entities is needed.
In particular at least 4 cases can be considered: </p><ol>
<li>If the stream of the channel requested by the user is already received by the Transport Access Node, and the authorized bandwidth in the last mile will not be exceeded by the addition of  the bandwidth required by the channel to be viewed, the Transport Access Node terminates the IGMP join request, and streams the channel to the user;
<li>if the stream of the channel requested by the user is already received by the Transport Access Node, but the addition of the bandwidth required by the channel to be viewed exceeds the authorized bandwidth in the last mile, an interaction between the Transport Access Node and Admission Control entities is needed, to verify that there is enough bandwidth in the last mile and  that it authorizes its use;
<li>if the stream of the channel requested by the user is not received by the Transport Access Node, and the authorized bandwidth in the last mile will not be exceeded by the addition of bandwidth required by the channel to be viewed, the Transport Access Node sends a PIM request to the Transport Remote Node to replicate the multicast stream to the Transport Access Node, if enough bandwidth is available in the aggregate network. The Transport Access Node in turn streams the channel to the user
<li>if the stream of the channel requested by the user is not received by the Transport Access Node , and the addition of the bandwidth required by the channel to be viewed will exceed the authorized bandwidth in the last mile:<ul>
<li>an interaction between the Transport Access Node and Admission Control entities is needed, to see if the required bandwidth can be made available in the last mile;
<li>If this is possible, then<ul>
<li>The Transport Access Node sends a PIM request to the Transport Remote Node to replicate the multicast stream to the Transport Access Node, if enough bandwidth is available in the aggregate network. The Transport Access Node in turn streams the channel to the user</ul></ul></ol>
<p>Section <a href="#s5-4-1" class="sectionRef">5.4.1</a> describes the Resource and Admission Control (RAC) and Transport Processing Functions functional entities.</p>
<p>In the examples below, both the Transport Access Node and the Transport Remote Node comprise BTF, RCEF and A-RACF, but other deployments are allowed. The A-RACF in the Transport Access Node performs admission control for the access segment, while the A-RACF in the Transport Remote Node performs admission control for the aggregation segment.</p>
<p>The following section details some of the call flow related to the 4 cases considered above.</p>
<figure id="distribution-of-rac-functions">
<figcaption>Figure #-####: Distribution of RAC functions between the various Transport nodes</figcaption>
<img src="images/distribution-of-rac-functions.png" alt="figure E-2" style="width:90%"/>
</figure>
</section>
<section><h2>ITF &mdash; Transport and Multicast Delivery call flow</h2>
<p>In this section, a detailed information flow is presented, showing the interaction between ITF, Transport and Multicast Delivery and Admission Control functional entities.</p>
<p>The assumptions behind these scenarios are:</p><ul>
<li>The content to be accessed is not present in the Transport Access Node, but only in the Transport Remote Node, and the authorized bandwidth in the last mile will be exceeded by the addition of the channel to be viewed  (case 4 considered in the previous section);
<li>The channel requested by the user is already received by Transport Access Node and the authorized bandwidth in the last mile does is  exceeded by the addition of the channel to be viewed  ( case 2 considered in the previous section);
<li>Access Control List are pre-provisioned in the Transport Access Node to authorize the user request;
<li>The association between channels (or group of channels) and the bandwidth that they require is pre-provisioned in the Transport Access Node;
<li>BTF + RCEF + Admission Control Function are present both in Transport Access Node and in the Transport Remote Node. 
<li>There are no intermediate nodes between the Transport Access Node and Transport Remote Node 
</ul>
<p>Other deployment configurations can be foreseen, as well as a more dynamic approach, based on a binding between the service authorization and the flow authorization. These cases are not covered in the following flows, but can be easily derived from them.</p>
<section id="annex-e-2-1"><h3>Channel requested is not present in the Transport Access Node and the authorized bandwidth in the last mile will not be exceeded (case 3)</h3>
<figure id="rac-case-3">
<figcaption>Figure #-####: Call flow for case 3 </figcaption>
<img src="images/rac-case-3.png" alt="figure E-3" style="width:90%"/>
</figure>
<p>The description of the steps is the following<p>
<table class="sequence">
<tr><td>1.</td><td>The ITF requests an HD channel via IGMP Join</td></tr>
<tr><td>2.</td><td>The IGMP message triggers the BTF in the Transport Access to authorize the request with the RCEF, where the pre-provisioned ACL are stored</td></tr>
<tr><td>3.</td><td>Since the requested channel requires more bandwidth than the channel currently authorized, call admission control (CAC) is needed</td></tr>
<tr><td>4.</td><td>The BTF requests CAC towards the RCEF</td></tr>
<tr><td>5.</td><td>The RCEF builds an admission control request and sends it to the A-RACF to obtain the authorizations on the network resources (previous service authorizations was made by IMS session)</td></tr>
<tr><td>6.</td><td>The A-RACF in the Transport Access Node performs admission control on the access network and derives the traffic policies to be installed in the RCEF </td></tr>
<tr><td>7.</td><td>The A-RACF sends the traffic policies to the RCEF</td></tr>
<tr><td>8.</td><td>The RCEF enforces the traffic policies. </td></tr>
<tr><td>9.</td><td>The RCEF answers positively to the BTF request</td></tr>
<tr><td>10.</td><td>The BTF in the Transport Access Node sends a PIM join to the BTF in the Transport Remote Node, to be added to the multicast tree (PIM protocol is used to build a shared multicast distribution tree)</td></tr>
<tr><td>11.</td><td>The BTF requests the needed policies from the RCEF</td></tr>
<tr><td>12.</td><td>The RCEF forwards the request to the A-RACF</td></tr>
<tr><td>13.</td><td>The A-RACF in the Transport Remote Node builds the required traffic policies to be installed in the RCEF. It is assumed as well that there is enough bandwidth in the aggregate network to send the stream to the Transport Access Node (14) The A-RACF sends the traffic policies to the RCEF</td></tr>
<tr><td>15.</td><td>The RCEF enforces the traffic policies </td></tr>
<tr><td>16.</td><td>The RCEF answers positively to the BTF request</td></tr>
<tr><td>17.</td><td>The BTF in the Transport Remote Node starts to replicate the flow towards the Transport Access Node </td></tr>
<tr><td>18.</td><td>The BTF in the Transport Access Node replicates the flow towards the User</td></tr>
</table>
</section>
<section id="annex-e-2-2"><h3>Channel requested is present in the Transport Access Node and the authorized bandwidth in the last mile will be exceeded (case 2)</h3>
<p>In this scenario the channel requested by the user is already received by Transport Access Node; the Transport Access Node terminates the IGMP, verifies that there is enough bandwidth in the last mile, and streams the channel to the user.</p>
<p>Steps 1 to 9 and step 18 from the figure for case 4 in section <a href="#annex-e-2-1" class="sectionRef">E.2.1</a> applies.</p>
</section>
</section>
<section><h2>Linear TV and CoD unified view for reservation on Access segment</h2>
<p>In this section, an example of information flow is provided to illustrate how an unified Linear TV and CoD Admission Control works with the architectural solution described in this Appendix.</p>
<p>The examples have the following assumptions:</p><ul>
<li>Linear TV and CoD service share the same transport resource in the last mile segment
<li>Linear TV and CoD  service have different transport resources in the Aggregation segment
<li>The Linear TV channel requested by the user is already received by Transport Access Node (thus Admission Control for resources does not need to be performed in the aggregation segment) but the bandwidth in the last mile doesn't match the one needed by the channel to be viewed  The following functional elements are involved (see Figure below):
<li>A-RACF 1 is an A-RACF deployed in the Transport Access Node.. A-RACF 1 performs Admission Control for the last mile segment for Linear TV only. 
<li>RCEF 1 is deployed in the Transport Access Node 
<li>BTF 1 is deployed in the Transport Access Node 
<li>RCEF 2 is deployed in the Transport Remote Node 
<li>BTF 2 is deployed in the Transport Remote Node 
<li>A-RACF 0 is an A-RACF performing Admission Control for CoD in the Aggregation Segment and in the last mile segment. It is further handling Admission Control for Linear TV in the last mile segment through delegating an Admission Control budget to A-RACF 1. A-RACF 0 is hence aware of resource reservations in both the Aggregation and last mile segments. 
</ul>
<figure id="rac-across-access-and-aggregation">
<figcaption>Figure #-####: Functions needed for a unified treatment of resource and admission control across access and aggregation networks</figcaption>
<img src="images/rac-across-access-and-aggregation.png" alt="figure E-4" style="width:90%"/>
</figure>
<p>The Information flow for delivering both Linear TV and CoD comprises 3 phases:</p><ol>
<li>Linear TV Session Initiation
<li>CoD Session request and delivery
<li>Linear TV delivery
</ol>
<section><h3>Linear TV Session Initiation</h3>
In this phase, after receiving the user request, an admission control budget is installed in A-RACF_1 for Linear TV.
<figure id="admission-control-for-linear">
<figcaption>Figure #-####: Admission control for Linear TV</figcaption>
<img src="images/admission-control-for-linear.png" alt="figure E-5" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>The user requests access to Linear TV</td></tr>
<tr><td>2-3.</td><td>Reservation request</td></tr>
<tr><td>4-7.</td><td>A-RACF_0 installs a bandwidth budget in A-RACF_1</td></tr>
<tr><td>8-9.</td><td>Reservation answers</td></tr>
<tr><td>10.</td><td>Answer to the user request</td></tr>
</table>
</section>
<section><h3>CoD Session request and delivery</h3>
<p>In this phase, a CoD request is received and A-RACF_0 does not have sufficient resources to fulfil the request in the last mile segment. It asks the A-RACF_1 for the needed resources which can be done by reducing its Linear TV budget provided that the bandwidth currently consumed by linear TV is below the admission control budget.</p>
<figure id="rac-for-vod">
<figcaption>Figure #-####: Resource and admission control for VoD</figcaption>
<img src="images/rac-for-vod.png" alt="figure E-6" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>The user requests access to CoD. A session setup request is propagated in the control plane.</td></tr>
<tr><td>2-3.</td><td>A Reservation Request is sent to the A-RACF_0</td></tr>
<tr><td>4-7.</td><td>A-RACF_0 requests the needed bandwidth from A-RACF_1. These steps are optional and depend on the capabilities of the A-RACF_0.</td></tr>
<tr><td>8-13.</td><td>Policies related to the new linear TV budget and the unicast flow are installed, as appropriate, in the RCEFs</td></tr>
<tr><td>14-15.</td><td>Reservation answers</td></tr>
<tr><td>16.</td><td>Answer to user request</td></tr>
</table>
</section>
<section><h3>Linear TV delivery</h3>
<p>In this phase the user accesses Linear TV and tries to view a channel that requests a higher bandwidth; A-RACF_1 has finished its Linear TV budget and asks for an increase to A-RACF_0.</p>
<figure id="rac-for-linear-with-bandwidth-request">
<figcaption>Figure #-####: Resource and admission control for linear TV with higher bandwidth requirement</figcaption>
<img src="images/rac-for-linear-with-bandwidth-request.png" alt="figure E-7" style="width:90%"/>
</figure>
<table class="sequence">
<tr><td>1.</td><td>User requests channel via IGMP</td></tr>
<tr><td>2.</td><td>The IGMP message triggers the check of the ACL to authorize the request</td></tr>
<tr><td>3.</td><td>Since the requested channel requires more bandwidth than the channel currently accessed, CAC is needed (call admission control)</td></tr>
<tr><td>4-5.</td><td>CAC Request</td></tr>
<tr><td>6-9.</td><td>Bandwidth not sufficient: request to A-RACF_0 for bandwidth increase</td></tr>
<tr><td>10-12.</td><td>Installation of Policies.</td></tr>
<tr><td>13.</td><td>Answer and Linear TV flow delivery</td></tr>
</table>
</section>
</section>
</section>

<section class="appendix" id="audience-research-data-model"><h1>Audience Research Data model (informative)</h1>
<p>Figure <a href="#audience-research-data-model-fig" class="figureRef">F-1</a> provides a generic example of the data model for Audience Research, with examples of a few possible applicable values for the data types:</p>
<figure id="audience-research-data-model-fig">
<figcaption>Figure #-####: AR Data Model with possible values</figcaption>
<img src="images/audience-research-data-model.png" alt="figure G-1" style="width:90%"/>
</figure>
</section>

<section class="appendix" id="remote-access-annex"><h1>Remote Access in the Managed Model (informative)</h1>
<p>Remote Access (RA) allows a user to remotely, using a UPnP RA client device, access other DLNA devices in a residential network for the purpose of content downloading, uploading, or content streaming. To achieve this, a VPN is established between the remote device and the IG. This allows for the secure transfer of information between the remote device and the entry point into the residential network.</p>
<section><h2>Architecture</h2>
<p>Figure <a href="#remote-access-function-architecture" class="figureRef">G.1</a> shows the additional components required in the IG to accommodate the remote access feature. These components are:</p>
<p><b>Remote Access Discovery Agent (RADA):</b>  The remote access discovery agent manages the DLNA device discovery procedure between the remote device and DLNA devices in the residential network. The RADA maps to the following functional components in the UPnP RA architecture (RADA Sync, RADASync CP, Inbound Connection Config, RADA Listener/Relay and RADA Config) [[!Ref-54]]</p>
<p><b>Remote Access Transport Agent (RATA):</b> The remote access transport agent is used during the key exchanges for setting up IPSec-based security over the IMS tunnel between the remote device and the residential network. The RATA maps to the following functional components in the UPnP RA architecture (RA Transport Agent, RATA Config) [[!Ref-54]]</p>
<p><b>Remote Access for establishing IMS tunnel (RA-IMS):</b>  This handles the IMS procedures for session setup, modification and termination (including the QoS aspects) between the remote device and the residential network.</p>
<p><b>RA QoS Coordinator:</b> This maps the procedures between the DLNA QoS and the IMS QoS to coordinate the QoS on the IMS side with that on the UPnP side to ensure end-to-end QoS between the UPnP RA-enabled device in the residential network and the remote device. </p>
<figure id="remote-access-function-architecture">
<figcaption>Figure #-####: The additional components in the IG to support the Remote Access feature</figcaption>
<img src="images/remote-access-function-architecture.png" alt="figure G-1" style="width:90%"/>
</figure>
<p>The device used for remote access and the target device(s) in the residential network SHALL be DLNA/UPnP compliant devices. This implies that the remote device SHALL be equipped with a UPnP RA client, hence allowing the remote device to be seen as just another DLNA/UPnP device from the other DLNA/UPnP devices in the residential network, and vice versa [[!Ref-54]].  Normal DLNA device discovery will occur between the remote device and the DLNA-enabled devices in the residential network.  VPN enables these devices to belong to the same subnet, and all DLNA devices can be accessed by the remote device. However, it is beneficial to limit DLNA devices which can be accessed by the remote device.  This requires a new inter-working function in the IG to act as a proxy of the DLNA device discovery for the remote device. This function is called the Remote Access Discovery Agent (RADA).</p>
<p>To establish the VPN between the remote device and the IG, an IMS tunnel is first established between the remote device and the IG. Following the successful establishment of the IMS tunnel, the tunnel is secured using IPSec [[!Ref-48]]. This allows traffic transported through the tunnel to be encrypted. </p>
<p>To establish the IMS tunnel, a new function is required in the IG. This function is called the Remote Access IMS client (RA IMS). In addition, every IG in a residential network supporting remote access SHALL be allocated an IMPU that can be used by the remote device for the purpose of remote access.</p>
<p>To secure the IMS tunnel using IPSec, a new function is required in the IG. This function is called the Remote Access Transport Agent (RATA).</p>
<p>Finally, in order to map the DLNA QoS aspects to IMS QoS procedures, and vice versa, in support of end-to-end QoS, a new functional element is required in the IG for this purpose.   This element is called the Remote Access QoS coordinator.</p>
<p>Figure <a href="#remote-access-architecture" class="figureRef">G-2</a> depicts the above architecture.</p>
<figure id="remote-access-architecture">
<figcaption>Figure #-####: Remote Access Architecture</figcaption>
<img src="images/remote-access-architecture.png" alt="figure G-2" style="width:90%"/>
</figure>
<p class="inline-header">Access Control Lists (ACL)</p>
<p>To ensure that only authorized users are allowed access to a residential network, the remote access application server maintains an access control list per IG. The ACL includes the list of authorized users and is checked every time an IMS channel is established or modified. The ACL is managed by the residential network IPTV subscription owner using normal XCAP procedures.</p>
<p>Note that within the call flows, the remote access application server will be depicted as an IPTV Application. </p>
<p class="inline-header">Media Codecs</p>
<p>To ensure interoperability between remote peers engaged, a number of media codecs SHALL be mandated.</p>
</section>
<section><h2>Remote Access Procedures without Transcoders</h2>
<p>The call flows in Figure <a href="#remote-access-ims-session" class="figureRef">G-3</a> and Figure <a href="#remote-access-ims-session-qos" class="figureRef">G-4</a> depict the call sequences needed to establish a VPN tunnel for remote access.</p>
<figure id="remote-access-ims-session">
<figcaption>Figure #-####: Remote Access - IMS session establishment</figcaption>
<img src="images/remote-access-ims-session.png" alt="figure G-3" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in Figure <a href="#remote-access-ims-session" class="figureRef">G-3</a>:</p>
<table class="sequence">
<tr><td>1.</td><td>The remote access client on the remote device (e.g., a DLNA-enabled mobile phone) initiates a SIP INVITE to the ASM. </td></tr>
<tr><td>2.</td><td>The ASM performs an initial resource reservation.</td></tr>
<tr><td>3.</td><td>The ASM proxies the INVITE to the IPTV Control FE.</td></tr>
<tr><td>4.</td><td>The IPTV Control FE sends an access request to the IPTV Application to verify if the originator is allowed to access the residential network.</td></tr>
<tr><td>5.</td><td>The positive response is received.</td></tr>
<tr><td>6.</td><td>The IPTV Control FE sends a SIP INVITE to the IG via the ASM (which is not shown for simplicity).</td></tr>
<tr><td>7.</td><td>The IG accepts the session, and returns a 200 OK to the IPTV Control FE.</td></tr>
<tr><td>8.</td><td>The IPTV Control FE forwards the 200 OK to the ASM.</td></tr>
<tr><td>9.</td><td>The ASM performs the final resource reservation</td></tr>
<tr><td>10.</td><td>The ASM forwards the 200 OK to the remote device</td></tr>
<tr><td>11.</td><td>The remote device sends an ACK to the ASM</td></tr>
<tr><td>12.</td><td>The ASM forwards the ACK to the IPTV Control FE.</td></tr>
<tr><td>13.</td><td>The IPTV Control FE forwards the ACK to the IG.</td></tr>
</table>
<p>Following that, the key exchanges can take place to establish the IPSec encrypted channel. Once the IPSec tunnel is established, the DLNA service discovery procedure, and content selection and presentation, etc., can occur.</p>
<p>The remaining steps are shown in Figure <a href="#remote-access-ims-session-qos" class="figureRef">G-4</a>.</p>
<figure id="remote-access-ims-session-qos">
<figcaption>Figure #-####: Remote Access - IMS session modification based on e2e QoS</figcaption>
<img src="images/remote-access-ims-session-qos.png" alt="figure G-4" style="width:90%"/>
</figure>
<p>The following is a brief description of the remaining steps shown in Figure <a href="#remote-access-ims-session-qos" class="figureRef">G-4</a>:</p>
<table class="sequence">
<tr><td>14.</td><td>Once the previous steps are completed, the remote device performs session modification, if needed, to handle the new QoS for the session. For that purpose, the remote device issues a re-INVITE to the ASM.</td></tr>
<tr><td>15.</td><td>The ASM performs an initial resource modification.</td></tr>
<tr><td>16.</td><td>The ASM proxies the re-INVITE to the IPTV Control FE</td></tr>
<tr><td>17.</td><td>The IPTV Control FE sends an access request to the IPTV Application to verify if the originator is allowed to access the residential network.</td></tr>
<tr><td>18.</td><td>The response is received.</td></tr>
<tr><td>19.</td><td>The IPTV Control FE sends a SIP re-INVITE to the IG via the ASM (which is not shown for simplicity).</td></tr>
<tr><td>20.</td><td>The IG accepts the session, and returns a 200 OK to the IPTV Control FE</td></tr>
<tr><td>21.</td><td>The IPTV Control FE forwards the 200 OK to the ASM.</td></tr>
<tr><td>22.</td><td>The ASM performs the final resource modification</td></tr>
<tr><td>23.</td><td>The ASM forwards the 200 OK to the remote device</td></tr>
<tr><td>24.</td><td>The remote device sends an ACK to the ASM</td></tr>
<tr><td>25.</td><td>The ASM forwards the ACK to the IPTV Control FE.</td></tr>
<tr><td>26.</td><td>The IPTV Control FE forwards the ACK to the IG.</td></tr>
</table>
<p>Following that, the streaming session can commence.</p>
</section>
<section><h2>Policies for ACL</h2>
<p>ACL policies are configured in the IPTV remote access application server using XCAP.</p>
<section><h3>Provisioning of Policies from the OITF (IMS)</h3>
<p>In an IMS environment, XCAP procedures are invoked directly from the OITF to provision the ACL policies.</p>
</section>
<section><h3>Provisioning of Policies from the OITF (DAE)</h3>
<p>Figure <a href="#dae-based-policy-provisioning" class="figureRef">G-5</a> shows a call sequence for a DAE-based ACL policy provisioning.</p>
<figure id="dae-based-policy-provisioning">
<figcaption>Figure #-####: DAE-based policy provisioning</figcaption>
<img src="images/dae-based-policy-provisioning.png" alt="figure G-5" style="width:90%"/>
</figure>
<p>The following is a brief description of the sequence:</p>
<table class="sequence">
<tr><td>1.</td><td>The OITF issues an HTTP POST request to the IPTV Application to upload the remote access ACL policies</td></tr>
<tr><td>2.</td><td>The IPTV Application issues an XCAP PUT request to the IPTV Service Profile to store the needed policies</td></tr>
<tr><td>3.</td><td>The IPTV Service Profile returns an HTTP 200 OK response to the IPTV Application.</td></tr>
<tr><td>4.</td><td>The IPTV Application subsequently returns an HTTP 200 OK to the OITF.</td></tr>
</table>
</section>
</section>
<section><h2>Remote Access Procedures with Transcoders</h2>
<p>Following the DLNA exchange for control, eventing,  presentation etc, via the VPN tunnel, and if the remote device determines that a transcoder is needed for the media transport, it initiates a new IMS session for the media transport via the Transcoder functional entity in the provider(s) network.</p>
<section><h3>Remote Access with network-based Transcoders</h3>
<p>The call flows in Figure <a href="#remote-access-ims-session-with-transcoders" class="figureRef">G-6</a> and Figure <a href="#remote-access-ims-session-with-transcoders-part2" class="figureRef">G-7</a> depict the call sequence to establish a VPN tunnel for remote access when transcoders are engaged in a pro-active manner. </p>
<figure id="remote-access-ims-session-with-transcoders">
<figcaption>Figure #-####: Remote Access - IMS session establishment with transcoders (proactive mode)</figcaption>
<img src="images/remote-access-ims-session-with-transcoders.png" alt="figure G-6" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps in Figure <a href="#remote-access-ims-session-with-transcoders" class="figureRef">G-6</a>:</p>
<table class="sequence">
<tr><td>1-2.</td><td>The remote device initiates the remote access client, which initiates a SIP INVITE to the ASM.</td></tr>
<tr><td>3.</td><td>The ASM performs the resource reservation for the DLNA control path.</td></tr>
<tr><td>4.</td><td>The ASM proxies the INVITE to the IPTV Control FE.</td></tr>
<tr><td>5.</td><td>The IPTV Control FE sends an access request to the IPTV Application to verify if the originator is allowed to access the residential network.</td></tr>
<tr><td>6-7.</td><td>When a positive response is received, the IPTV Control FE sends a SIP INVITE to the IG (via the ASM which is not shown here for simplicity). </td></tr>
<tr><td>8-9.</td><td>The IG accepts the session, and returns a 200 OK to the IPTV Control FE, which forwards the 200 OK to the ASM.</td></tr>
<tr><td>10.</td><td>The ASM performs final resource reservation</td></tr>
<tr><td>11.</td><td>The ASM forwards the 200 OK to the remote device</td></tr>
<tr><td>12.</td><td>The remote device sends an ACK to the ASM</td></tr>
<tr><td>13.</td><td>The ASM forwards the ACK to the IPTV Control FE.</td></tr>
<tr><td>14.</td><td>The IPTV Control FE forwards the ACK to the IG </td></tr>
</table>
<p>Following that, the key exchanges can take place to establish the IPSec for DLNA control. Once the IPSec is established the DLNA service discovery procedure, and content selection and presentation, etc., can occur.</p>
<p>The remaining steps are shown in Figure <a href="#remote-access-ims-session-with-transcoders-part2" class="figureRef">G-7</a>.</p>
<figure id="remote-access-ims-session-with-transcoders-part2">
<figcaption>Figure #-####: Remote Access - IMS session modification with transcoders (proactive mode)</figcaption>
<img src="images/remote-access-ims-session-with-transcoders-part2.png" alt="figure G-7" style="width:90%"/>
</figure>
<p>The following is a brief description of the steps:</p>
<table class="sequence">
<tr><td>15.</td><td>At this point, the remote device realizes there is a need for a transcoder. The remote device issues an INVITE to the ASM.</td></tr>
<tr><td>16.</td><td>The ASM performs a resource reservation for the DLNA media.</td></tr>
<tr><td>17.</td><td>The ASM proxies the INVITE to the IPTV Control FE.</td></tr>
<tr><td>18.</td><td>The IPTV Control FE sends an access request to the IPTV Application to verify if the originator is allowed to access the residential network.</td></tr>
<tr><td>19.</td><td>A positive response is received.</td></tr>
<tr><td>20.</td><td>The IPTV Control FE sends a SIP INVITE to the transcoder device. The transcoder reserves the required resources.</td></tr>
<tr><td>21.</td><td>The transcoder sends a SIP INVITE to the IG, via the ASM (not shown in the figure for simplicity) that includes the IP address of the selected resource to be used by the IG for streaming.</td></tr>
<tr><td>22.</td><td>The IG accepts the session, and returns a 200 OK to the transcoder. The transcoder updates the transcoder resources.</td></tr>
<tr><td>23.</td><td>The transcoder forwards the 200 OK, including the IP address to be used by the mobile device for streaming purpose to the IPTV Control FE </td></tr>
<tr><td>24.</td><td>The IPTV Control FE forwards the 200 OK to the ASM.</td></tr>
<tr><td>25.</td><td>The ASM performs a final resource modification</td></tr>
<tr><td>26.</td><td>The ASM forwards the 200 OK to the remote device</td></tr>
<tr><td>27.</td><td>The remote device sends an ACK to the ASM</td></tr>
<tr><td>28.</td><td>The ASM forwards the ACK to the IPTV Control FE.</td></tr>
<tr><td>29.</td><td>The IPTV Control FE forwards the ACK to the transcoder</td></tr>
<tr><td>30.</td><td>The transcoder forwards the ACK to the IG.</td></tr>
</table>
<p>Following this, the media stream session can commence. The key exchanges can take place to establish the IPSec channel for the DLNA media. Once the IPSec channel is established, DLNA media transport procedure can occur.</p>
</section>
<section><h3>Remote Access with DLNA Content Transformation device in the IMS Gateway</h3>
<p>In order to provider content transformation between DLNA devices and remote access devices (e.g. mobile phone), the IMS gateway MAY implement the DLNA Content Transformation devices connected to the residential network. Content transformation may include transcoding, transrating, or scaling of media. </p>
<p>The DLNA Content Transformations devices belong to the DLNA Media Interoperability Unit (MUI) device class, which support media interoperability between all DLNA Home Network Devices (HNDs) and all DLNA Mobile Handheld Devices (MHDs), or DLNA device class, e.g. DMS, which implements the DLNA virtual device functionality in order to support content transformation for specific DLNA devices. (For more information, please refer to &ldquo;7.5 Content Transformation Device Virtualization&rdquo; and &ldquo;7.6 Media Interoperability Unit (MIU)&rdquo; of [[!Ref-2]].</p> 
<p>It should be noted that the DLNA Content Transformation device may be implemented in any devices (e.g., AG) in the residential network.
</p>
</section>
</section>
<section><h2>Remote Access in the Unmanaged Model</h2><p>The IG is not used in unmanaged network deployments. Therefore, functional elements which are required to enable remote access, namely the RATA and RADA, have to be located in the WAN Gateway for that purpose.</p></section>
</section>

</body>
</html>
