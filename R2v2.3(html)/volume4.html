<!DOCTYPE html>  
<html lang="en" xml:lang="en">
<head>
<title>overwritten</title>
	<script src='js/respec.js' class='remove'></script>
	<script class='remove'>        
    
    var respecConfig = {
           
          // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
          specStatus:           "OIPF-FINAL",

		  OIPFrelease: "2",  
          OIPFversion: "2.3",
          OIPFvolume: "4",
      
          OIPFAppendixLabel: "Annex",
          
          // the specification's short name, as in http://www.w3.org/TR/short-name/
          shortName:            "volume4",

          // if your specification has a subtitle that goes below the main
          // formal title, define it here
		  title: "Protocols",
          subtitle   :  "",

          // if you wish the publication date to be other than today, set this
          publishDate:  "2014-01-24",

          // if the specification's copyright date is a range of years, specify
          // the start date here:
          //copyrightStart: "2005",
    
		  //additionalCopyrightHolders: "",
      
		  overrideCopyright: " ",
      
      
          // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
          // and its maturity status
          // previousPublishDate:  "1977-03-15",
          // previousMaturity:  "WD",

          // if there a publicly available Editor's Draft, this is the link
          edDraftURI:           "",

          // if this is a LCWD, uncomment and set the end of its review period
          // lcEnd: "2009-08-05",



          // editors, add as many as you like
          // only "name" is required
          editors:  [
              { name: "Editor", url: "contact@oipf.tv",
                company: "Open IPTV Forum", companyURL: "http://www.oipf.tv/" },
          ],
      
          // authors, add as many as you like. 
          // This is optional, uncomment if you have authors as well as editors.
          // only "name" is required. Same format as editors.

          //authors:  [
          //    { name: "Your Name", url: "http://example.org/",
          //      company: "Your Company", companyURL: "http://example.com/" },
          //],
          
          // name of the WG
          wg:           "OIPF Solutions WG",
          
          // URI of the public WG page
          wgURI:        "http://www.oipf.tv",
          
          // name (with the @w3c.org) of the public mailing to which comments are due
          wgPublicList: "contact@oipf.tv",
          
          // URI of the patent status for this WG, for Rec-track documents
          // !!!! IMPORTANT !!!!
          // This is important for Rec-track documents, do not copy a patent URI from a random
          // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
          // Team Contact.
          wgPatentURI:  "",
                
      maxTocLevel:  3,
      
        
      localBiblio: {
      "BCG":"ETSI, TS 102 539, \"Digital Video Broadcasting (DVB);Carriage of Broadband Content Guide (BCG) information over Internet Protocol (IP)\"",
      "UPNP":"UPnP Forum, \"UPnP Device Architecture\"",
      
      "TS124503":"ETSI, TS 124 503, \"Digital cellular telecommunications system (Phase 2+); Universal Mobile Telecommunications System (UMTS); TISPAN; IP Multimedia Call Control Protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP) Stage 3\" [3GPP TS 24.229 (Release 7), modified] (3GPP TS 24.503 Release 8)",
      "UMTS-SH":"ETSI, TS 129 329, \"Digital cellular telecommunications system (Phase 2+); Universal Mobile Telecommunications System (UMTS); Sh interface based on the Diameter protocol; Protocol details\" (3GPP TS 29.329 version 7.4.0 Release 7)",
      "CHNG":"ETSI, ES 282 010, \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); Charging\"",
      "DIAM":"ETSI, TS 183 033, \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN);IP Multimedia; Diameter based protocol for the interfaces between the Call Session Control Function and the User Profile Server Function/Subscription Locator Function; Signalling flows and protocol details\" [3GPP TS 29.228 V6.8.0 and 3GPP TS 29.229 V6.6.0, modified]",
      "AFSPDF":"ETSI, TS 183 017, \"Telecommunications and Internet Converged Services and Protocols for Advanced Networking (TISPAN);Resource and Admission Control: DIAMETER protocol for session based policy set-up information exchange between the Application Function (AF) and the Service Policy Decision Function (SPDF);Protocol specification\"",
      "RACS-RE":"ETSI, TS 183 060. \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); Resource and Admission Control Subsystem (RACS); Re interface based on the DIAMETER protocol\"",
      "NASS-E4":"ETSI, ES 283 034, \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); Network Attachment Sub-System (NASS); e4 interface based on the DIAMETER protocol\"",
      "TS183063":"ETSI, TS 183 063, \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN);IMS-based IPTV stage 3 specification\", Release 3",
      "PSS-MBMS":"3GPP, TS 26.237, \"IP Multimedia Subsystem (IMS) based Packet Switch Streaming (PSS) and Multimedia Broadcast/Multicast Service (MBMS) User Service; Protocols (Release 8)\"",
      "ES282003":"ETSI, ES 282 003, \"Resource and Admission Control Sub-system (RACS) - Functional architecture\"",
      "TS26114":"3GPP, TS 26.114, \"IP Multimedia Subsystem (IMS); Multimedia telephony; Media handling and interaction\".",
      "DIAMCHG":"3GPP, TS 32.299, \"Telecommunication management; Charging management; Diameter charging applications (Release 8)\"",
      
      "SRVCONT":"3GPP, TS 24.237, \"IP Multimedia (IM) Core Network (CN) subsystem IP Multimedia Subsystem (IMS) service continuity; Stage 3\"",
      
      "RTSP2-AN":"IETF, draft-stiemerling-rtsp-announce-01, \"RTSP 2.0 Asynchronous Notification\"",
      
      "ES283002":"ETSI, ES 283 002, \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN);H.248 Profile for controlling Access and Residential Gateways\"",
      "ES283003":"ETSI, ES 283 003, \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN);IP Multimedia Call Control based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP) Stage 3\" [3GPP TS 24.229 [Release 7], modified]",
      
      "SMPL-IM":"OMA, OMA-TS-SIMPLE_IM-V1_0-20100322-C, \"Instant Messaging using SIMPLE\"",
      "SMPL-PRES":"OMA, OMA-ERP-Presence_SIMPLE-V1_1-20080627-A, \"Presence SIMPLE Specification\"",
      
      "TVA-MD":"ETSI, TS 102 822-3-1, \"Broadcast and On-line Services: Search, select, and rightful use of content on personal storage systems (\"TV-Anytime Phase 1\"); Part 3: Metadata; Sub-part 1: Metadata schemas\"",
      
      "DLNA":"DLNA, IEC, 62481-2, Digital living network alliance (DLNA) home networked device interoperability guidelines – Part 2: Media Formats, ed1.0 (2007-08).",
            
      "UPNP-MR":"UPnP Forum, \"MediaRenderer:1 Device Template Version 1.01\"",
      "UPNP-MS":"UPnP Forum, \"MediaServer:1 Device Template Version 1.01\"",
      
      "SHA-1":"U.S. Department of Commerce/National Institute of Standards and Technology, FIPS PUB 180-1, \"Secure Hash Standard\"",
      "TS183019":"ETSI, TS 183 019, \"Network Attachment: User-Network protocol Interface Definitions\"",
      
      "FCC":"DVB BlueBook A152 (08/10), \"Server-Based Fast Channel Change in DVB-IPTV Systems\"",
      "3G-SEC":"3GPP, TS 33.203, \"3G security; Access security for IP-based services\"",
      
      "PSS":"3GPP, TS 26.234v750, \"Transparent end to end packet switched streaming service (PSS) – Protocols and Codecs\"",
      "PSS-MBMS":"3GPP, TS 26.237, \"IP Multimedia Subsystem (IMS) based Packet Switch Streaming (PSS) and Multimedia Broadcast/Multicast Service (MBMS) User Service; Protocols (Release 8)\"",
      
      "DVB-SC":"ETSI, TS 103 197 V1.5.1, \"Digital Video Broadcasting (DVB); Head-end implementation of DVB SimulCrypt\", March 2007.",
      
      "UB-UA":"3GPP, TS 24.109, \"Bootstrapping interface (Ub) and network application function interface (Ua); Protocol details\"",
      "GAA":"3GPP, TS 33.220, \"Generic Authentication Architecture (GAA); Generic bootstrapping architecture\"",
      
      "VIDEOSHARE":"GSMA, PRD IR.84 Video Share Interoperability Specification, 2.0.",
      },
    
    
    };
    
	</script>
<link rel="stylesheet" href="styles/oipf-prot-spec.css" type="text/css" />
</head>
<body>

<section id="abstract">
<p>This Technical Specification (TS) has been produced by the Open IPTV Forum.</p>
<p>This specification provides multiple options for some features. The Open IPTV Forum Profiles specification complements the Release 2 specifications by defining the Open IPTV Forum implementation and deployment profiles. This document is Volume 4 in the 10 Volume set of specifications that define the Open IPTV Forum Release 2 Solution.</p>
<p>The other Volumes in the set are: </p><ul>
<li>Volume 1 – Overview [[.OIPF_OVIEW2]],
<li>Volume 2 – Media Formats [[.OIPF_MEDIA2]],
<li>Volume 2a – HTTP Adaptive Streaming [[.OIPF_HAS2]],
<li>Volume 3 – Content Metadata [[.OIPF_META2]],
<li>Volume 4 – Protocols (the present volume),
<li>Volume 4a – Examples of Protocol Sequences [[.OIPF_PROT_EX2]],
<li>Volume 5 – Declarative Application Environment [[.OIPF_DAE2]],
<li>Volume 5a – Web Standards TV Profile [[.OIPF_WSTVP2]], 
<li>Volume 6 – Procedural Application Environment [[.OIPF_PAE2]], and
<li>Volume 7 – Authentication, Content Protection and Service Protection [[.OIPF_CSP2]].
</ul>

<p>This document specifies the protocols over the following reference point interfaces defined in the Open IPTV Forum Release 2 Architecture specification [[.OIPF_ARCH2]].</p><ul>
<li>The UNI interfaces, between the network or service provider domains and the consumer domain
<li>The HNI interfaces, between the functional entities in the consumer network domain
<li>The NPI interfaces, between the functional entities in the network and service provider domains
<li>Interfaces to external systems, which include
<li>DLNA networks in the  consumer domain</ul>
<p>The requirements for these interfaces are derived from the following sources:</p><ul>
<li>Open IPTV Forum Service and Platform Requirement for Release 2 [[.OIPF_REQS2]]
<li>Open IPTV Forum Functional Architecture for Release 2 [[.OIPF_ARCH2]]
<li>Other Open IPTV Forum specifications  [[.OIPF_DAE2]], [[.OIPF_CSP2]], [[.OIPF_META2]] and [[.OIPF_MEDIA2]]
</ul>
</section>

<section id='references'>
<h2>References</h2>
</section>

<section>
<h2>Conventions and Terminology</h2>
<section><h3>Conventions</h3>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [[RFC2119]]. </p>
<p>All sections and appendixes, except "Introduction", are normative, unless they are explicitly indicated to be informative.</p>
<p>OIPF usually abbreviates "Scheduled Content" as "SC". This specification additionally uses, for the same meaning and only in the field names, the abbreviation "BC". </p>
</section>
<section><h3>Terminology</h3>
<section><h4>Definitions</h4>
<table class="definitions">
<tr><th>Term</th><th>Definition</th></tr>
<tr><td>Native HNI-IGI function (often shortened to Native HNI-IGI)</td><td>The procedures for interactions on the HNI-IGI interface are provided as part of the OITF implementation - typically in native code.</td></tr>
<tr><td>Non-native HNI-IGI function (often shortened to Non-native HNI-IGI)</td><td>The procedures for interactions on the HNI-IGI interface are provided by a service provider in JavaScript as part of a DAE application.</td></tr>
</table>
</section>
<section><h4>Abbreviations</h4>
<p>In addition to the Abbreviations provided in <a href="volume1.html#abbreviations" class="extRef">Volume 1</a>, the following abbreviations are used in this Volume.</p>
<table class="definitions">
<tr>
<th>Acronym</th><th>Explanation</th>
</tr>
<tr><td>FCC</td><td>Fast Channel Change</td></tr>
<tr><td>GSMA</td><td>GSM Association</td></tr>
<tr><td>ISC</td><td>IMS Service Control</td></tr>
<tr><td>PCh</td><td>Personalised Channel</td></tr>
<tr><td>PPV</td><td>Pay Per View</td></tr>
<tr><td>RET</td><td>RETransmission Function</td></tr>
<tr><td>RFC</td><td>Request For Comments</td></tr>
<tr><td>XCAP</td><td>XML Configuration Access Protocol</td></tr>
<tr><td>XDM</td><td>XML Document Management</td></tr>
</table>
</section>
</section>
</section>

<section id="release-2-interfaces"><h1>Release 2 Interfaces</h1>
<section id="s3-1"><h2>Consumer Network to Provider Network Interfaces (UNI)</h2>
<p>The functional entities, functions and reference points defined for the Consumer Network are described in <a href="architecture.html#s5-3" class="extRef">section 5.3</a> of [[.OIPF_ARCH2]].</p>
<table id="uni-reference-points-and-protocols" class="interface-protocol-table">
<caption>Table ####: UNI Reference Points and Protocols</caption>
<tr><th>Reference Point</th><th>Description</th><th>Protocols</th></tr>
<tr><td>UNIP-1</td><td>Reference point for user initiated IPTV service profile management.</td><td>HTTP, XCAP</td></tr>
<tr><td>UNIP-2</td><td>Reference point for user initiated profile management of Person-to-Person Communication Enablers, such as presence privacy, resource list management, group management, etc.
<p>Note that group management is included to support the management of pre-defined groups that can be reused for several purposes, such as presence privacy, presence request, massaging, chatting, etc.</p></td><td>OMA XDM, OMA Presence Enablers, IMS SIP</td></tr>
<tr><td>UNIS-6</td><td>Reference point for user interaction with application logic for transfer of user requests and interactive feedback of user responses (provider specific GUI). HTTP, FLUTE and TCP based application specific protocols are used to interface between the DAE and the IPTV Application Function.</td><td>HTTP, FLUTE</td></tr>
<tr><td>UNIS-7</td><td>Requests for transport and encoding of content guide metadata. The reference point includes the metadata and the protocols used to deliver the metadata, and SHALL be based on DVB-IP BCG [[!BCG]].</td><td>HTTP, DVBSTP</td></tr>
<tr><td>UNIS-8</td><td>Authentication and session management relying on IMS.</td><td>IMS SIP </td></tr>
<tr><td>UNIS-9</td><td>Authentication for GBA Single-Sign on. See [[.OIPF_CSP2]]</td><td>HTTP</td></tr>
<tr><td>UNIS-11</td><td>Reference point for control of real time streaming (e.g. control for pause, rewind, skip forward). The reference point includes content delivery session setup when not relying on IMS.</td><td>RTSP</td></tr>
<tr><td>UNIS-12</td><td>Reference point between the AG and the provider specific application functional entity. Encompasses two functions:<ul>
<li>Signalling and download of applications in a generic format. This function is subject to standardization.
<li>Interaction of generic applications with the provider network.  This function is not subject to standardization.</ul></td><td>HTTP, FLUTE</td></tr>
<tr><td>UNIS-13</td><td>User Stream control for multicast of real time content and data.</td><td>IGMP</td></tr>
<tr><td>UNIS-14</td><td>Reference point used for authorization of service access. See [[.OIPF_CSP2]]</td><td>HTTP</td></tr>
<tr><td>UNIS-15</td><td>Reference point to the IPTV Service Discovery Functional Entity (FE) to obtain information about IPTV services offered by an IPTV Service Provider.</td><td>HTTP, DVBSTP </td></tr>
<tr><td>UNIT-16</td><td>Reference point used for Network Attachment.  Functions connected to this reference point include DHCP Server and DHCP Relay.</td><td>DHCP</td></tr>
<tr><td>UNIT-17</td><td>Content stream including content; content encryption (for protected services) and content encoding.  This reference point MAY be used for both multicast and unicast (UNIT-17M and UNIT-17U, respectively).</td><td>RTP, HTTP, UDP</td></tr>
<tr><td>UNIT-18</td><td>Performance monitoring interface for reporting the performance monitoring results, including RTCP for RET/FCC requesting/control.</td><td>RTCP, RTSP</td></tr>
<tr><td>UNIT-19</td><td>Multicast Data Channel, used to deliver data of different kinds to the OITF by means of multicast. This reference point can carry discrete data that is carried over unicast through e.g., the interfaces UNIS-6 and UNIS-7.  Other uses such as UNI-RMS are not excluded.</td><td>FLUTE</td></tr>
<tr><td>UNIS-19</td><td>Reference point to the IPTV Service Provider Discovery functional entity to obtain the list of Service Providers, and related information.</td><td>HTTP</td></tr>
<tr><td>UNI-RMS</td><td>Remote Management using Broadband Forum TR-069 framework [[!TR069]] and related extensions based on the DVB-IP-RMS specification.</td><td>HTTP/TR-069</td></tr>
<tr><td>UNIS-CSP-T</td><td>Rights management for protected content – including key management and rights expression. See [[.OIPF_CSP2]]</td><td>HTTP/MARLIN</td></tr>
<tr><td>UNIS-CSP-G</td><td>Reference point to support a service and content protection solution specific to the IPTV Service Provider.  This interface MAY be used to obtain licenses for purchases/subscribed content, control content and the service protection system and MAY also be used to deliver content.</td><td></td></tr>
</table>

<table id="other-interfaces" class="interface-protocol-table">
<caption>Table ####: Other Interfaces</caption>
<tr><td>WAN gateway<br />LAN Interfaces</td><td>Interface between OITF/IG and AG and the WAN Gateway</td><td>DHCP, IGMP </td></tr>
<tr><td>HNI-DM</td><td>Interface between the WAN gateway and the OITF to support remote management of the OITF in the home.</td><td>UPnP DM [[!UPNP]]</td></tr>
<tr><td>HNI-IGI</td><td>Interface between the IMS gateway and the OITF providing, to the OITF, access to IG functions for the adaptation to IPTV services on managed networks relying on IMS.</td><td>HTTP, SIP</td></tr>
</table>
<p>In a device that implements both the OITF and the IG, the use of the HNI-IGI interface is OPTIONAL.  In this case, the device SHALL support the UNIS-8, UNIS-9 and UNI-RMS interfaces.</p>
<p>The HNI-IGI interface consists of a set of interactions between the OITF and the IG. </p>
<p>The HNI-IGI interface supports two OPTIONAL protocols:</p><ul>
<li>An HTTP option, where HTTP is deployed over the interface.
<li>A SIP option, where SIP as defined in RFC 3261 [[!SIP]] and pertinent RFC extensions is deployed over the interface.
</ul>
<p>The functionality supported by the OITF and the IG is identical for both options.  All IMS specifics are supported by the IG in both options as well.</p>
<p>For the HTTP option, certain interactions on the HNI-IGI interface MAY be implemented either natively or as a DAE application, whereas other interactions cannot be implemented as a DAE applications and MUST be implemented in native code. An OITF is said to implement the "native HNI-IGI HTTP option function" if it supports at least (but is not limited to) the interactions which MUST be implemented in native code. The case where no native interaction is supported is hereafter known as "non-native HNI-IGI HTTP option function". </p>
<p>The interactions that MUST be implemented natively consist of user registration (sections <a href="#s5-4-6-1" class="sectionRef">5.4.6.1</a> and <a href="#s6-1-3-2-2" class="sectionRef">6.1.3.2.2</a>) including service provider discovery (section <a href="#s5-4-1-1" class="sectionRef">5.4.1.1</a>), and GBA procedures (section <a href="#s5-4-6-2" class="sectionRef">5.4.6.2</a>) performed at OITF startup.</p>
<p>An OITF that supports the non-native HNI-IGI HTTP option function can still be used in a managed network scenario, but without the support of GBA based authentication or HTTP digest authentication using IG to application servers.</p>
<p>Note that GBA authentication can be achieved using either the GBA Authentication using IMS Gateway procedure, specified in [[.OIPF_CSP2]] <a href="volume7.html#gba-authentication-using-ims-gateway" class="extRef">section 5.4.5</a> or the, more general, procedure, HTTP Digest Authentication using IMS Gateway in [[.OIPF_CSP2]] <a href="volume7.html#http-digest-authentication-using-ims-gateway" class="extRef">section 5.4.4</a>. The latter; more general procedure allows the use of different authentication mechanism in a way that is transparent to the OITF, including possible future authentication mechanisms, and should preferably be used. It is expected that GBA Authentication using IMS Gateway procedure will be deprecated and removed in future versions of this specification.</p>
</section>
<section><h2>Provider Network Reference Points Description</h2>
<p>The Functional Entities and Reference Points in the service provider network defined in <a href="architecture.html#s5-2" class="extRef">section 5.2</a> of [[.OIPF_ARCH2]].</p>
<table id="npi-reference-points-and-protocols" class="interface-protocol-table">
<caption>Table ####: NPI Reference Points and Protocols</caption>
<tr><th>Reference Point</th><th>Description</th><th>Protocols</th></tr>
<tr><td>NPI-1</td><td>Reference point between the Service Access Authentication FE and the User Database.</td><td>Not Specified</td></tr>
<tr><td>NPI-2</td><td>An OPTIONAL reference point allowing interaction between IPTV applications and the IPTV Control FE.</td><td>Not Specified </td></tr>
<tr><td>NPI-3</td><td>The reference point between Authentication Session Management and Person-to-Person Communication Enablers.</td><td>ISC interface [[!TS124503]]</td></tr>
<tr><td>NPI-4</td><td>Reference point for routing of IPTV service related messages to the IPTV Control FE.</td><td>ISC interface [[!TS124503]]</td></tr>
<tr><td>NPI-6</td><td>This reference point allows the IPTV Control FE to retrieve the subscriber’s IPTV-related service data when a user registers in the IMS network.</td><td>Not Specified </td></tr>
<tr><td>NPI-7</td><td>This reference point allows person-to-person application enablers to retrieve the subscriber’s IMS data from the user database.</td><td>Sh Interface [[!UMTS-SH]]</td></tr>
<tr><td>NPI-9</td><td>This reference point allows the IPTV Control Point to retrieve the subscriber’s IMS-specific data from the user database.</td><td>Sh Interface [[!UMTS-SH]]</td></tr>
<tr><td>NPI-10</td><td>A reference point for the allocation/de-allocation and control of content for a unicast session.</td><td>RTSP</td></tr>
<tr><td>NPI-11</td><td>A reference point for sending events and charging information.</td><td>Rf and Ro [[!CHNG]]</td></tr>
<tr><td>NPI-12</td><td>This reference point allows the Authentication and Session Management FE to retrieve the subscriber’s IMS data from the User Database as a part of the user’s IMS registration.</td><td>Cx [[!DIAM]]</td></tr>
<tr><td>NPI-14</td><td>A reference point from Charging FE and Authentication and Session Management FE.</td><td>Rf [[!CHNG]]</td></tr>
<tr><td>NPI-15</td><td>This reference point controls the Resources and Admission Control.</td><td>Gq’ [[!AFSPDF]]</td></tr>
<tr><td>NPI-16</td><td>Reference point between the Transport Processing Function and Resource and Admission Control.</td><td>Re [[!RACS-RE]]</td></tr>
<tr><td>NPI-17</td><td>Reference point between the IPTV Applications and the IPTV Service Profile.</td><td>XCAP </td></tr>
<tr><td>NPI-18</td><td>Reference point between the Service Access and Authentication FE and the IPTV Applications.</td><td>Not Specified</td></tr>
<tr><td>NPI-19</td><td>This reference point SHALL be used for unicast session setup control between the Authentication and Session Management and the Content Delivery Network Controller.</td><td>SIP/SDP</td></tr>
<tr><td>NPI-20</td><td>This OPTIONAL reference point allows the retrieval of CG data.</td><td>Not Specified </td></tr>
<tr><td>NPI-21</td><td>This reference point allows the GBA Single Sign-on functional entity to validate user credentials.</td><td>Not Specified </td></tr>
<tr><td>NPI-25</td><td>This reference point allows forwarding unicast control messages to the appropriate Content Delivery Network Controller FE.</td><td>SIP/SDP</td></tr>
<tr><td>NPI-26</td><td>The reference point allows the Content Delivery Network Controller to delegate the handling of a unicast session to a specific Cluster Controller.</td><td>SIP/SDP</td></tr>
<tr><td>NPI-27</td><td>The reference point between the Authentication Proxy and the GBA Single Sign-on node allows the proxy to retrieve a user key for authentication purposes.</td><td>Not Specified </td></tr>
<tr><td>NPI-28</td><td>This reference point SHALL be used to push the user access capabilities to the Network Attachment and the RAC.</td><td>e4 [[!NASS-E4]]</td></tr>
<tr><td>NPI-30</td><td>This reference point supports the IPTV Service Provider Discovery step of the service discovery procedure relying on IMS.</td><td>ISC interface [[!TS124503]]</td></tr>
<tr><td>NPI-32</td><td>Reference point between the ASM FE and the IMS messaging AS. (This is the ISC interface defined by 3GPP in TS 23.228)</td><td>ISC interface [[!TS124503]]</td></tr>
<tr><td>NPI-33</td><td>Reference point allowing interaction between IPTV Applications and the IPTV Metadata Control FE. This is not subject to standardization.</td><td>Not Specified</td></tr>
<tr><td>NPI-34</td><td>The reference point between the IMS messaging server and the notification services. It is based on IMS SIP as defined by 3GPP in TS 24.229.</td><td>SIP</td></tr>
<tr><td>NPI-36</td><td>This reference points allows access to notification services. It is based on Parlay X -API as defined by (<a href="http://www.3gpp.org/ftp/Specs/html-info/29-series.htm">http://www.3gpp.org/ftp/Specs/html-info/29-series.htm</a>). </td><td> 
Parlay X</td></tr>
<tr><td>NPI-38</td><td>This reference point between notification services and multicast and delivery control function supports multicast traffic for emergency services and is FFS.</td><td>Not Specified</td></tr>
<tr><td>NPI-39</td><td>This reference point between emergency services and the notification services is local and regional specific.</td><td>Not Specified</td></tr>
<tr><td>NPI-40</td><td>Content Delivery Function (CDF) Stream control for multicast of real time. The protocol used on this interface is IGMP. This interface is optional.</td><td>IGMP</td></tr>
<tr><td>NPI-41</td><td>Content stream including content; content encryption (for protected services) and content encoding.  This reference point is used for multicast delivery. The protocol used on this interface is RTP. This interface is optional.</td><td>RTP</td></tr>
<tr><td>NPI-42</td><td>This reference point between the IPTV Application and the Multicast Content Delivery Function supports multicast traffic for notification services.</td><td>FLUTE</td></tr>
<tr><td>NPI-CSPT1</td><td>Reference point to confirm whether a Marlin content license can be issued for the request received via UNIS CSP-T.</td><td>See [[.OIPF_CSP2]]</td></tr>
<tr><td>NPI-CSPG1</td><td>Reference point to allow the CSP-G Server to be provisioned with entitlement information by IPTV Applications.</td><td>Not Specified</td></tr>
<tr><td>NPI-CSPG1a</td><td>Reference point to allow the CSP-G Server to be provisioned with entitlement information by the IPTV Service Profile.</td><td>Not Specified</td></tr>
<tr><td>NPI-CSPG3</td><td>Reference point for the Key Management Function to exchange content encryption information with CSP-G Server.</td><td>HTTP</td></tr>
<tr><td>NPI-CSPT1a</td><td>Reference point used by the Marlin DRM system to include business information or a reference to business information into a DRM request (e.g. license request) as requested via UNIS-CSP-T, and the subsequent confirmation and retrieval of this business information when the DRM request is consumed.</td><td>See [[.OIPF_CSP2]]</td></tr>
<tr><td>NPI-CSPT2</td><td>Reference point, used in the managed network model, to retrieve information on the appropriate cluster controller in the Content Delivery Network that will serve a particular request for purchased or subscribed-to content. This chosen cluster controller will be contacted by the CSP-T Server functional entity via NPI-CSP3.</td><td>Not Specified</td></tr>
<tr><td>NPI-CSPT3</td><td>Reference point to retrieve the appropriate encryption key needed to prepare a Marlin content license for the chosen content. It is the content encryption key for downloadable content or the key that encodes the Marlin short term key message that contains the key that encodes the streaming media.</td><td>HTTP</td></tr>
<tr><td>NPI-43</td><td>Reference point that provides GBA authentication mechanism to the Service Access Authentication Function.</td><td></td></tr>
<tr><td>NPI-44</td><td>Reference point where the encrypted content is stored on the content storage entity for delivery by the Content Delivery Function. This interface has been identified just to illustrate informatively the separation between content encryption, which is part of content preparation, and content delivery.</td><td>Not Specified</td></tr>
<tr><td>NPI-45</td><td>Reference point where the content Service, Program and Content Keys and ECM attached information are provided to the CoD Encryption Management Function.</td><td>HTTP</td></tr>
<tr><td>NPI-46</td><td>Reference point where the content Service, Program and Content Keys and content protection related ECM attached information (e.g. ECM, DRM metadata) are provided to the Scheduled Content Encryption Function. This interface is specified by this version of the specification for the unicast stream encryption case. This interface is not specified by this version of the specification for the multicast stream encryption case.</td><td>HTTP</td></tr>
<tr><td>NPI-47</td><td>Reference point where the On Demand Content is fetched by the Content Delivery Function for delivery. This interface has been identified just to illustrate informatively the separation between content encryption, which is part of content preparation, and content delivery.</td><td>Not Specified</td></tr>
<tr><td>NPI-48</td><td>Reference point for the Key Management Function to provide appropriate information to the IPTV Applications functional entity, e.g. in relation with content access licenses.</td><td>Not Specified</td></tr>
<tr><td>NPI-49</td><td>Reference point for the Content Management Function to provide the CoD Encryption Function with content related information.</td><td>Not Specified</td></tr>
<tr><td>NPI-50</td><td>Reference point for the Scheduling Function to provide the Recording Function with a record list/schedule for the Catch-up and Start-over use cases.</td><td>Not Specified</td></tr>
<tr><td>NPI-51</td><td>Reference point for the Content Management Function to provide appropriate information to the IPTV Applications functional entity.</td><td>Not Specified</td></tr>
<tr><td>NPI-52</td><td>Reference point for the Scheduling Function to provide appropriate information to the IPTV Applications functional entity.</td><td>Not Specified</td></tr>
<tr><td>NPI-53</td><td>Reference point for the Scheduling Function to provide the Scheduled Content Encryption Function with content related information and schedule.</td><td>Not Specified</td></tr>
<tr><td>NPI-AR-01</td><td>Reference point for providing static audience data about users who have opted-in. It includes content metadata and user related information stored in the IPTV Service Profile.</td><td></td></tr>
<tr><td>NPI-AR-02<br />NPI-AR-02’<br />NPI-AR-02’’</td><td>Reference points for collecting the information intercepted by the Transport Processing Function, the IPTV Control, the Cluster Control or other FEs based on different criteria, e.g. the events triggered by the Audience Research Collector, event detected from other FEs, the deployment done by the service provider etc.
<p>Note: The IPTV Control can retrieve the Audience Research data from the ITF or the Cluster Controller using existing SIP messages such as SIP INFO, MESSAGE, INVITE or PRESENCE.</p></td><td></td></tr>
<tr><td>NPI-AR-03</td><td>Reference point used for exposing the Audience Research data to the Audience Research Agency.</td><td></td></tr>
</table>
</section>
<section><h2>Interfaces to External Systems</h2>
<section><h3>Consumer Network</h3>
<table id="external-interfaces-consumer-network" class="interface-protocol-table">
<caption>Table ####: External Interfaces from the Consumer Network</caption>
<tr><td>DLNA Function</td><td>Interface between the OITF and DLNA devices in the home.</td><td>DLNA</td></tr>
</table>
</section>
</section>
</section>  <!-- section 3 -->

<section><h1>Structure of the document</h1>
<p>Each section of this specification identified below defines the procedures that use a specific protocol:</p><ul class="nobullet">
<li>Section <a href="#http" class="sectionRef"></a>: <a href="#http" class="sectionTitleRef"></a>
<li>Section <a href="#sip" class="sectionRef"></a>: <a href="#sip" class="sectionTitleRef"></a>
<li>Section <a href="#rtsp" class="sectionRef"></a>: <a href="#rtsp" class="sectionTitleRef"></a>
<li>Section <a href="#igmp" class="sectionRef"></a>: <a href="#igmp" class="sectionTitleRef"></a>
<li>Section <a href="#rtp" class="sectionRef"></a>: <a href="#rtp" class="sectionTitleRef"></a>
<li>Section <a href="#upnp" class="sectionRef"></a>: <a href="#upnp" class="sectionTitleRef"></a>
<li>Section <a href="#dlna" class="sectionRef"></a>: <a href="#dlna" class="sectionTitleRef"></a>
<li>Section <a href="#dhcp" class="sectionRef"></a>: <a href="#dhcp" class="sectionTitleRef"></a>
<li>Section <a href="#udp" class="sectionRef"></a>: <a href="#udp" class="sectionTitleRef"></a>
<li>Section <a href="#flute" class="sectionRef"></a>: <a href="#flute" class="sectionTitleRef"></a>
<li>Section <a href="#diameter" class="sectionRef"></a>: <a href="#diameter" class="sectionTitleRef"></a>
<li>The annexes cover the following topics:
<li>Annex <a href="#change-history" class="sectionRef"></a>: <a href="#change-history" class="sectionTitleRef"></a>
<li>Annex <a href="#example-messages" class="sectionRef"></a>: <a href="#example-messages" class="sectionTitleRef"></a>
<li>Annex <a href="#user-profile-description" class="sectionRef"></a>: <a href="#user-profile-description" class="sectionTitleRef"></a>
<li>Annex <a href="#attributes-for-scheduled-content" class="sectionRef"></a>: <a href="#attributes-for-scheduled-content" class="sectionTitleRef"></a>
<li>Annex <a href="#protocol-names" class="sectionRef"></a>: <a href="#protocol-names" class="sectionTitleRef"></a>
<li>Annex <a href="#system-infrastructure" class="sectionRef"></a>: <a href="#system-infrastructure" class="sectionTitleRef"></a>
<li>Annex <a href="#system-infrastructure-mechanisms" class="sectionRef"></a>: <a href="#system-infrastructure-mechanisms" class="sectionTitleRef"></a>
<li>Annex <a href="#presence-xml-schema" class="sectionRef"></a>: <a href="#presence-xml-schema" class="sectionTitleRef"></a>
<li>Annex <a href="#protocol-procedure-section-structure" class="sectionRef"></a>: <a href="#protocol-procedure-section-structure" class="sectionTitleRef"></a>
<li>Annex <a href="#specific-tr-135-and-106-objects" class="sectionRef"></a>: <a href="#specific-tr-135-and-106-objects" class="sectionTitleRef"></a>
<li>Annex <a href="#new-event-package-format" class="sectionRef"></a>: <a href="#new-event-package-format" class="sectionTitleRef"></a>
<li>Annex <a href="#overview-of-notification-services" class="sectionRef"></a>: <a href="#overview-of-notification-services" class="sectionTitleRef"></a>
<li>Annex <a href="#fcc-and-ret" class="sectionRef"></a>: <a href="#fcc-and-ret" class="sectionTitleRef"></a>
<li>Annex <a href="#ig-handling-of-impus-with-gruu" class="sectionRef"></a>: <a href="#ig-handling-of-impus-with-gruu" class="sectionTitleRef"></a>
<li>Annex <a href="#fdt-schema-extensions" class="sectionRef"></a>: <a href="#fdt-schema-extensions" class="sectionTitleRef"></a>
<li>Annex <a href="#ig-service-awareness" class="sectionRef"></a>: <a href="#ig-service-awareness" class="sectionTitleRef"></a>
<li>Annex <a href="#content-reporting-info-package" class="sectionRef"></a>: <a href="#content-reporting-info-package" class="sectionTitleRef"></a>
<li>Annex <a href="#digital-media-purchase-info-package" class="sectionRef"></a>: <a href="#digital-media-purchase-info-package" class="sectionTitleRef"></a>
<li>Annex <a href="#parental-control-watched-content-info-package" class="sectionRef"></a>: <a href="#parental-control-watched-content-info-package" class="sectionTitleRef"></a>
<li>Annex <a href="#common-types" class="sectionRef"></a>: <a href="#common-types" class="sectionTitleRef"></a>
<li>Annex <a href="#flute-fdt-extension-schema" class="sectionRef"></a>: <a href="#flute-fdt-extension-schema" class="sectionTitleRef"></a>
</ul></section>

<section id="http"><h1>HTTP</h1>
<section><h2>HTTP Reference points</h2>
<p>This section defines the protocol for the use of HTTP over the following reference points:</p><ul>
<li>HNI-IGI – HTTP Option
<br />Certain interactions on the HNI-IGI interface can only be implemented natively, while the rest can be implemented either in native code or in a DAE application.  In the following sections, if no qualification is provided it must be understood that the function can be performed natively or as a DAE application.
<li>UNIP-1
<li>UNIS-6
<li>UNIS-7
<li>UNIS-9
<li>UNIS-15
<li>UNIT-17
<li>UNIS-19
</ul>
</section>
<section><h2>IG as a protocol converter supporting the HNI-IGI interface – HTTP Option</h2>
<p>In support of the HNI-IGI HTTP option the IG SHALL act a protocol converter between HTTP and SIP.  In that respect, the IG acts as an HTTP server towards the OITF, and as a SIP User Agent (UA) towards the IMS network. The following lists the behaviour of the IG as a SIP UA towards the IMS network:</p><ul>
<li>The IG SHALL handle all SIP headers that are mandatory by [[!SIP]]; creating and storing them where applicable when initiating requests from the OITF towards the network or when receiving incoming requests from the IMS network targeted for an OITF. The same applies to SIP responses. The different services specify what needs to be stripped before a request/response is sent to the OITF. 
<li>The IG SHALL handle all IMS specific SIP headers; storing what is received from the network for re-insertion during outgoing requests (e.g. P-Preferred-Identity) according to [[!TS124503]], and stripping those headers before a request/response is sent to the OITF.
<li>The IG SHALL behave transparently to all SIP headers defined in [[!SIP]], that are received from the network, and Shall not alter them before being sent to the OITF (encoded as HTTP headers), where applicable. The same applies to SIP headers (encoded as HTTP headers) sent from the OITF to the IMS network. 
<li>The IG SHALL validate incoming SIP headers (encoded as HTTP headers) from the OITF before accepting a request. The same applies to SIP responses received from the OITF. The various services specify the validation to be performed by the IG.
<li>The IG Shall not validate compliance to any XML schema. 
<li>The IG SHALL validate SDP (encoded in the HTTP body) syntax for correctness. 
<li>In regard to IMS registration, the IG SHALL perform the IMS registration when requested by the OITF. The IG is therefore stateful to IMS registration. However, graceful de-registration and re-registration SHALL be triggered by the OITF.  The IG SHALL deal with all non-graceful circumstances. The specific sections on IMS registration specifies detailed behaviour for the OITF and IG.
<li>The IG SHALL be stateful, to all IMS sessions.  Session initiation, termination, and session refresh can be triggered by the OITF or the network, depending on the specific service. The IG SHALL deal with non-graceful circumstances.
</ul>
</section>

<section><h2>Protocols for IPTV Service Functions</h2>
<section><h3>Multicast content streaming with SIP session management</h3>
<section><h4>Protocol over HNI-IGI – HTTP Option</h4>
<p>When the OITF initiates, modifies or terminates a multcast content service, the OITF sends HNI-IGI messages containing the appropriate method, mapped to HNI-IGI as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>”.</p>
<p>The SIP-specific information in the related messages is described in section <a href="#s6-1-2-1" class="sectionRef">6.1.2.1</a>, “<a href="#s6-1-2-1" class="sectionTitleRef"></a>.” The SIP-specific information is mapped to the HNI-IGI protocol, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>”. In particular, the OITF creates HTTP headers for an HNI-IGI message by adding “X-OITF-” in front of the necessary SIP header names. In addition, OPTIONAL parameters MAY be included as defined in [[!TS124503]].</p>
<p>Certain interactions on the HNI-IGI interface SHALL be implemented natively, while the remaining applicable interactions MAY be implemented either natively or as a DAE application. In the following sections, if no qualification is provided, it MUST be understood that the interaction can be performed natively or as a DAE application.</p>
<section id="s5-3-1-1-1"><h5>Session Initiation</h5>
<p>The HNI-IGI function in the OITF SHALL follow the following procedure for session initiation:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>
<p>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - see Table <a href="#t5" class="tableRef"></a>
</ul></td></tr>
<tr><td>HTTP Request Body:  SDP offer containing the following elements (conforming to [[!TS183063]]):<ul>
<li>The m-line(s) SHALL be set to the multicast content service which the OITF intends to join first, according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a>, “<a href="#annex-d-1" class="sectionTitleRef"></a>”<ul>
<li>If the multicast content service includes FCC and/or RET and the OITF supports FCC and/or RET, the &lt;proto&gt; field SHALL be “RTP/AVPF”. If the OITF does not support FCC and/or RET, “RTP/AVPF” SHALL NOT be used.</ul>
<li>The c-line(s) SHALL be set to the multicast content service which the OITF intends to join first, according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a>, “<a href="#annex-d-1" class="sectionTitleRef"></a>” 
<li>An a=bc_service: BCServiceId line SHALL indicate the multicast content service that the OITF intends to join  (according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a>, “<a href="#annex-d-1" class="sectionTitleRef"></a>”).
<li>If the OITF does not intend to use FCC and/or RET and has knowledge of the bandwidth of the multicast content service with the highest bandwidth requirement included in the session, the b-line SHALL be included and set to this value.<ul>
<li>If the OITF supports FEC and the multicast content service has FEC enabled, then the OITF SHALL include the additional bandwidth in the value set in the b-line. If the OITF does not support FEC and the multicast content service includes FEC that uses the same multicast group address then the FEC bandwidth SHALL be included.
<li>If the OITF supports Network Generated Notification service and the multicast content service has associated Network Generated Notification service, then the OITF SHALL include the additional bandwidth in the value set in the b=line. If the OITF does not support Network Generated Notification service and the multicast content service has associated Network Generated Notification service that uses the same multicast group address then the additional bandwidth SHALL be included.
</ul>
<li>If the OITF intends to use FCC and/or RET, it SHALL have performed the procedure in section <a href="#s5-3-1-1-2" class="sectionRef">5.3.1.1.2</a>, “<a href="#s5-3-1-1-2" class="sectionTitleRef"></a>” and SHALL include in the session b-line the value returned from that procedure
<li>If the OITF intends to make use of RET services only for a RET-enabled multicast content service session, it SHALL include the attribute a=rtcp-fb:&lt;fmt&gt;  nack where &lt;fmt&gt; indicates the RTP payload type of the IP multicast stream that carries the multicast content service.
<li>If the OITF intends to make use of FCC service for a FCC-enabled multicast content service session, it SHALL include the attribute  a=rtcp-fb:&lt;fmt&gt; nack rai where &lt;fmt&gt; indicates the RTP payload type of the IP multicast stream that carries the multicast content service.
<li>If  the OITF wants to make use of RET and/or FCC, there SHALL be an a=rtcp: &lt;port&gt; &lt;network type&gt; &lt;address type&gt; &lt;connection address&gt; line after the m-line for the IP multicast stream, providing the OITF destination IP address and port for the RTCP feedback messages associated with the IP multicast stream.
<p>Note: The RTCP feedback target transport address signalled in the a=rtcp: &lt;port&gt; &lt;network type&gt; &lt;address type&gt; &lt;connection address&gt; line on the media level for the IP multicast stream is only valid for the first IP multicast channel the OITF intends to connect to. For other channels that are part of the same broadcast package, the SDNS signalled values (RTCPReporting@DestinationPort and  RTCPReporting@DestinationAddress) for each particular channel SHALL prevail.</p>
<li>An a=recvonly line
</ul>
<p>In order for the OITF to connect to the FEC stream associated with the original multicast stream, additional parameters SHALL be included in the SDP offer as follows:</p><ul>
<li>An m-line for the FEC stream, as indicated by the Service Discovery or Metadata Control FE. The m line SHALL be set according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a>, “<a href="#annex-d-1" class="sectionTitleRef"></a>.”
<li>A c-line according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a>, “<a href="#annex-d-1" class="sectionTitleRef"></a>.”
</ul>
<p>In order for the OITF to consume additional network generated notification service associated with the multicast content service, additional parameters SHALL be included in the SDP offer as follows:</p><ul>
<li>An m-line for the notification multicast stream, as indicated by the Service Discovery or Metadata Control FE. The m line SHALL be set according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a>, “<a href="#annex-d-1" class="sectionTitleRef"></a>.”
<li>A c-line according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a>, “<a href="#annex-d-1" class="sectionTitleRef"></a>.”
<li>An a=bc_service: BCServiceId line SHALL indicate the Network Generated Notification service that the OITF intends to join  (according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a>, “<a href="#annex-d-1" class="sectionTitleRef"></a>.”).
<li>OPTIONALly one or more a=bc_service_package: &lt;BCPackageId&gt; as defined in Annex <a href="#annex-d-2" class="sectionRef">D.2</a>, “<a href="#annex-d-2" class="sectionTitleRef"></a>.” The initial offer SHALL NOT contain mult_list and bc_tv_service_id_list parameter. If the initiation is the result of a previously denied initiation, the OITF MAY restrict the Network Generated Notification services by including mult_list attributes.
</ul>
</td></tr>
</table>
</td></tr>
<tr><td colspan=2>If the OITF indicates its support for RET by means of the "a=rtcp-fb:&lt;fmt&gt; nack" and multicast RET is offered as a service as indicated by SD&amp;S, in order for the OITF to connect to the multicast RET stream, the SDP offer SHALL include an additional m-line for the multicast RET stream  (m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt&gt; ) which  SHALL be set according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a>, “<a href="#annex-d-1" class="sectionTitleRef"></a>.”</td></tr>
<tr><td class="label">Step 2:</td><td>If the request is for a multicast content service session, the IG SHALL validate that the request includes all the mandatory SIP headers for the process as per Table <a href="#t5" class="tableRef"></a>. The IG SHALL send a SIP INVITE to the network to request the initiation of the multicast content service session, and SHALL wait for the response to the request.  The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>On receipt of the response from the network the IG SHALL return a HTTP 200 OK response (or other appropriate received responses) to the OITF to report the response to the initiation request.  The response SHALL include a list of SIP headers as per Table <a href="#t6" class="tableRef"></a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]], and the same SDP answer body that was received by the IG in the SIP message.</td></tr>
<tr><td class="label">Step 4:</td><td>When the OITF receives the response to the INVITE, it SHALL examine the media parameters in the received SDP. The OITF SHALL restrict the multicast content services that it joins according to the parameter (a=bc_service_package attribute) received from the IPTV Control FE. However, if the OITF retrieved the IPTV user profile prior to session initiation, then it MAY ignore the=bc_service_package attribute.
<p>If the OITF receives an error code with an Insufficient Bandwidth indication in the response from the IG, the OITF MAY perform a new INVITE with a reduced maximum bandwidth for the multicast content service. This procedure MAY be repeated. If no agreement can be reached, the OITF MAY display a failure message to the user.</p></td></tr>
<tr><td class="label">Step 5:</td><td>Upon receipt of a 200 OK response, the OITF SHALL send an HTTP PENDING_IG to acknowledge the final response. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - see Table <a href="#t7" class="tableRef"></a>
</ul></td></tr>
<tr><td>HTTP Request Body:  Empty</td></tr>
</table>
</td></tr>
</table>

<table id="t5" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the HNI-IGI INVITE Request message for multicast content service session setup (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line
<p>The Request-URI in the INVITE request SHALL be the well known PSI (Public Service Identifier) of the content service:  OIPF_IPTV_SC_Service@&lt;domain name&gt;.<br />
The domain part SHALL be the IPTV Service Provider domain name obtained via Service Provider discovery.</p></td><td>RFC 3261 [[!SIP]]
<p>INVITE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To
<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact
<p>The URI parameter and the sip.instance feature tag MUST be included and MUST match what is sent in the contact header included in the registration request.</p>
<p>The IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]] (application/sdp)</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Supported</td><td>RFC 3261 [[!SIP]] set to timer</td></tr>
<tr><td>X-OITF-Session-Expires</td><td>RFC 4028 [[!SES-TIMR]]</td></tr>
<tr><td>X-OITF-Recv-Info
<p>SHALL be empty or the list of info packages the OITF is willing to receive</p></td><td>RFC 6086 [[!INFO-PKG]]
<p>TS 26.237 [[!PSS-MBMS]]</p></td></tr>
</table>
<table id="t6" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response message to an HNI-IGI INVITE request message for multicast content service session setup (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]
<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Session-Expires</td><td>RFC 4028 [[!SES-TIMR]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Recv-Info
<p>SHALL be empty to stop receiving any SIP INFO including any Info Package</p>
Or
<p>SHALL be set to Content-Reporting Info Package to indicate willingness to receive the Info Package.</p>
And/Or
<p>SHALL be set to CoD-Bookmark Info Package according to section 12 of [[!PSS-MBMS]] to indicate willingness to receive the Info Package</p>
And/Or
<p>SHALL be set to Digital-Purchase Info Package to indicate willingness to receive the Info Package</p></td><td>RFC 6086 [[!INFO-PKG]]<p>TS 26.237 [[!PSS-MBMS]]</p></td></tr>
</table>
<table id="t7" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the HNI-IGI ACK message for a successful multicast content service session setup (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line
<p>The Request-URI in the ACK request SHALL be the contact included in the response to the INVITE message</p></td><td>RFC 3261 [[!SIP]]<p>ACK &lt;Request URI&gt;  SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To
<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line” of the initial request</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact
<p>The URI parameter MUST be included, and MUST match what has been inserted in the INVITE message. The IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-3-1-1-2"><h5>Retrieval of bandwidth parameter for FCC and/or RET enabled multicast content service</h5>
<p>If the OITF intends to use FCC and/or RET,  when the multicast content service is FCC and/or RET enabled,  the OITF SHALL use the  procedure defined in section <a href="#s5-3-2-1-1" class="sectionRef">5.3.2.1.1</a>, “<a href="#s5-3-2-1-1" class="sectionTitleRef"></a>”,  with the following modifications:</p><ul>
<li>The Request-URI in the method line is set to well-known PSI for the multicast content service 
<li>The OITF SHALL include an HTTP body that SHALL include an SDP that includes one m line that matches the m line associated with the multicast content service the OITF intends to join first (see section <a href="#s5-3-1-1-1" class="sectionRef">5.3.1.1.1</a>, “<a href="#s5-3-1-1-1" class="sectionTitleRef"></a>”) with the following exceptions:<ul>
<li>No b-line is included
<li>The following additional a attribute SHALL be included when the OITF intends to use RET:<ul>
<li>a=rtcp-fb:&lt;fmt&gt;  nack<br />where &lt;fmt&gt; indicates the RTP payload type of the IP multicast stream that carries the content service.</ul>
<li>The following additional a attribute SHALL be included when the OITF intends to use FCC:<ul>
<li>a=rtcp-fb:&lt;fmt&gt;  nack rai<br />where &lt;fmt&gt; indicates the RTP payload type of the IP multicast stream that carries the content service.</ul>
</ul></ul>
<p>The returned response SHALL include total bandwidth of the multicast content service with the highest total bandwidth, including the overhead bandwidth required for the FCC/RET stream. Maximum bandwidth will be signalled by means of the following media level bandwidth modifier:</p><ul>
<li>b=AS:&lt;bandwidth&gt;<br />where &lt;bandwidth&gt; is the maximum calculated bandwidth according to the b=AS bandwidth modifier defined in RFC 4566 [[!SDP]] expressed in kbps.
</ul>
</section>
<section id="s5-3-1-1-3"><h5>Session Modification</h5>
<p>To join a service outside the set of channels negotiated at session initiation or to perform a bandwidth modification, the OITF SHALL send a request to the IG for session modification. The OITF SHALL generate a re-INVITE request, as defined in Table <a href="#t5" class="tableRef"></a>.</p>
<p>The OITF SHALL include an SDP offer in the session modification request. The format of this request SHALL be the same as for a session initiation.</p>
</section>
<section id="s5-3-1-1-4"><h5>Session Termination</h5>
<p>To terminate a multicast content streaming session, the OITF SHALL use the following procedure:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>
The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>5.6.1, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t8" class="tableRef"></a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers needed for the message as per Table <a href="#t8" class="tableRef"></a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection. The IG SHALL send a SIP BYE to the network, to request the termination of the multicast content streaming session, and SHALL wait for the response.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL then return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the Termination request.  The response SHALL include, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]], a list of SIP headers as per Table <a href="#t9" class="tableRef"></a>.</td></tr>
</table>
<table id="t8" class="mapping">
<caption>Table ####: Supported HTTP extension headers in HNI-IGI BYE Request for teardown of a multicast content streaming session (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the contact returned in the 200 OK for the invite.</p></td><td>RFC 3261 [[!SIP]]<p>BYE &lt;Request URI&gt;  SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line” of the initial request</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact </td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t9" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to an HNI-IGI BYE Request for teardown of a multicast content streaming session (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-3-1-1-5"><h5>Session Refresh</h5>
<p>It is the responsibility of the OITF application to refresh the multicast content streaming session before the session expires. The IG SHALL consider a session terminated if it is not refreshed.</p>
</section>
<section id="s5-3-1-1-6"><h5>Content Reporting and Management of Content Reporting of Watched Scheduled Content</h5>
<section id="s5-3-1-1-6-1"><h6>Content Reporting by the OITF</h6>
<p>The OITF SHALL follow the following procedure for reporting a watched scheduled content:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>
To report the scheduled content being watched after the IPTV end user stopped zapping for the configured time, and if the IPTV Control FE permitted content reporting, the OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>”  The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - see Table <a href="#t10" class="tableRef"></a>
</ul></td></tr>
<tr><td>HTTP Request Body: SHALL include the XML document as per Annex D of [[!PSS-MBMS]]</td></tr>
</table>
</td></tr>
<tr><td colspan="2">
<p>The Content-Reporting Info Package SHALL contain an XML document defined in Annex D of [[!PSS-MBMS]] with MIME type “application/3gpp-ims-pss-mbms-command+xml”. </p>
<p>The XML document SHALL include either one element of a PSS content switch data or one element of MBMS content switch data. The selection of PSS content switch data or MBMS content switch data is determined according to the content delivery mechanism. Scheduled Content delivered to the OITF through a multicast mechanism SHALL use the MBMS content switch choice. Scheduled Content delivered by unicast streaming mechanism SHALL use the PSS content switch choice. For either of those elements there SHALL be at least one defined sequence included.</p>
<p>The elements in the XML document SHALL be populated as follows:</p><ul>
<li>For PssSwitchData<ul>
<li>ContentID – RTSP URI of the content
<li>DateTime – MAY be used</ul>
<li>For MbmsSwitchData<ul>
<li>ServiceId – The BCServiceId of the channel
<li>ProgrammeId – SHALL NOT be used 
<li>DateTime – MAY be used 
</ul></ul>
<p>Also note that the SIP INFO including the info-event Watched Content is sent only within the context of a scheduled content session.</p>
</td></tr>
<tr><td class="label">Step 2:</td><td>
The IG SHALL validate that the request includes all the mandatory SIP headers for the process as per Table <a href="#t10" class="tableRef"></a>. The IG SHALL send a SIP INFO to the network and SHALL wait for the response to the request.  The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.
</td></tr>
<tr><td class="label">Step 3:</td><td>
On receipt of the response from the network the IG SHALL return a HTTP 200 OK response (or other appropriate received responses) to the OITF to report the response to the INFO request.  The response SHALL include a list of SIP headers as per Table <a href="#t11" class="tableRef"></a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].
</td></tr>
</table>
</section>
<section id="s5-3-1-1-6-2"><h6>Management of Reporting by IPTV Control FE</h6>
<p>The OITF SHALL comply with the following when it comes to management of reporting a watched scheduled content:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>At any time, the IG can receive a SIP UPDATE, including an empty Recv-Info header or including the Content-Reporting Info Package, from the network to order the OITF to stop or start reporting the watched content.  When a SIP UPDATE is received by the IG, the IG SHALL return an HTTP 200 OK response to the OITF.  The response includes a list of SIP headers as per Table <a href="#t12" class="tableRef"></a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 2:</td><td>
Once the OITF accepts the incoming SIP UPDATE, it SHALL send to the IG an HTTP HNI-IGI PENDING_IG request to acknowledge the receipt of the SIP UPDATE. The content of the HTTP request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - see Table <a href="#t13" class="tableRef"></a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td colspan=2>If the SIP UPDATE is for resumption of content reporting, the OITF SHALL immediately report the currently watched content in accordance with section <a href="#s5-3-1-1-6-1" class="sectionRef">5.3.1.1.6.1</a>, “<a href="#s5-3-1-1-6-1" class="sectionTitleRef"></a>”</td></tr>
</table>
<table id="t10" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the HNI-IGI SIP INFO Request message for Content Reporting (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the INFO request SHALL be the well known PSI (Public Service Identifier) of the content service: OIPF_IPTV_SC_Service@&lt;domain name&gt;.</p></td><td>RFC 3261 [[!SIP]]<p>INFO &lt;Request URI&gt;  SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact
<p>The URI parameter MUST be included, and MUST match what was used in the SIP INVITE for the scheduled content session.</p>
<p>The IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID<p>MUST match what was used in the SIP INVITE for the scheduled content session</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF_Info-Package<p>SHALL be set to Content-Reporting Info Package</p></td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to 
“application/3gpp-ims-mbms-psscommand+xml” that corresponds to Annex D of [[!PSS-MBMS]]</p></td><td>RFC 6086 [[!INFO-PKG]]<p>TS 26.237 [[!PSS-MBMS]]</p></td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Disposition</td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
</table>
<table id="t11" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response message to an HNI-IGI INFO request message for Content Reporting (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t12" class="mapping">
<caption>Table ####: List of HTTP extension headers for an incoming SIP UPDATE (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line
<p>The Request-URI in the INVITE MUST match the  contact URI included in the contact filed of the SIP INVITE for the scheduled content session</p></td><td>RFC 3261 [[!SIP]]
<p>UPDATE &lt;Request URI&gt;  SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p>The URI parameter and the sip.instance feature tag MUST be included and MUST match what is sent in the contact header included in the registration request.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Recv-Info
<p>SHALL be set to remove support for the reception of the Content-Reporting Info Package</p>
<p> OR</p> <p>SHALL be set to indicate support for the reception of  Content-Reporting Info Package</p>
</td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
</table>
<table id="t13" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response message to an incoming HNI-IGI SIP UPDATE Request Message (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
</section>
<section id="s5-3-1-1-7"><h5>Network-based multicast content streaming Time Shift</h5>
<section id="s5-3-1-1-7-1"><h6>User-initiated Activation of multicast content streaming Time Shift</h6>
<p>As a prerequisite it is assumed that the user has an established multicast content streaming session as per the procedure defined in section <a href="#s5-3-1-1-1" class="sectionRef">5.3.1.1.1</a>, “<a href="#s5-3-1-1-1" class="sectionTitleRef"></a>”</p>
<p>The OITF SHALL follow the following procedure to initiate a time shift for the watched multicast content service:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>
<p>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>” The content of the HTTP Request SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]] 
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t5" class="tableRef"></a>. 
</ul></td></tr>
<tr><td>HTTP Request Body:  The Request body SHALL include a MIME Multipart/Related container conforming to [[!RFC2837]]. The first body part SHALL be an SDP offer containing the following elements conforming to [[!TS183063]]:<ul>
<li>An m-line for the RTSP control channel set in accordance with section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”
<li>An m-line for the unicast media delivery channel set in accordance with section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”, and where the transport and codecs values SHALL be set identical to the values used in the multicast content streaming setup request, while following the rules for modifying a session in [[!OFRANSR]]. The multicast media descriptor SHALL be de-activated. Note that the media descriptors SHALL be reused to avoid the SDP from eventually becoming too large.
<li>BCServiceId SHALL be present only if the OITF has not informed the IPTV Control FE of the selected channel prior to this procedure (as defined in section <a href="#s5-3-1-1-6" class="sectionRef">5.3.1.1.6</a>, “<a href="#s5-3-1-1-6" class="sectionTitleRef"></a>” and SHALL be set to the value of the current channel.
</ul></td></tr></table>
</td></tr>
<tr><td></td><td>The second body part SHALL conform to the OITF-IPTV Service Action command XML schema in section <a href="#s5-3-1-1-7-3" class="sectionRef">5.3.1.1.7.3</a>, “<a href="#s5-3-1-1-7-3" class="sectionTitleRef"></a>”, and SHALL only include the following:
<table class="http-element">
<tr><td><ul>
<li>IPTVActionDataCommand SHALL be set to "SwitchtoTM".
<li>SwitchToTM SHALL be set to elements defined by "IPTVBcActionData".
</ul></td></tr></table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers as per Table <a href="#t5" class="tableRef"></a>. The IG SHALL send a SIP re-INVITE to the network to request the initiation of the time shift procedure, and SHALL wait for the response to the request.  The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>On receipt of the response from the network the IG SHALL return a HTTP 200 OK response (or other appropriate received responses) to the OITF to report the response to the time shift activation request.  The response SHALL include a list of SIP headers as per Table <a href="#t6" class="tableRef"></a>, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]]. The SDP answer SHALL be in accordance with section <a href="#s6-1-2-2-2-5" class="sectionRef">6.1.2.2.2.5</a>, “<a href="#s6-1-2-2-2-5" class="sectionTitleRef"></a>” in addition to the following:<ul>
<li>An a=fmtp:iptv_rtsp h-offset SHALL be included in the SDP answer, and SHALL have a value different than 0 indicating the offset in the time shifted selected content. This can be used by the OITF during media control. 
</ul></td></tr>
<tr><td class="label">Step 4:</td><td>When the OITF receives the response to the re-INVITE, it SHALL examine the media parameters in the received SDP, and SHALL store the parameters a:fmtp:iptv_rtsp h-session, a=fmtp:iptv_rtsp h-offset, and a=fmtp:iptv_rtsp h-uri for later usage. </td></tr>
<tr><td class="label">Step 5:</td><td>
<p>Upon receipt of a 200 OK response, the OITF SHALL send an HTTP HNI-IGI PENDING_IG request to acknowledge the final response. The content of the HTTP Request SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t7" class="tableRef"></a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
</table>
</section>
<section id="s5-3-1-1-7-2"><h6>User Initiated De-activation of multicast content steaming Time Shift</h6>
<p>As a prerequisite it is assumed that the user has an activated scheduled content time shift session as per the procedure in section <a href="#s5-3-1-1-7-1" class="sectionRef">5.3.1.1.7.1</a>, “<a href="#s5-3-1-1-7-1" class="sectionTitleRef"></a>”</p>
<p>The OITF SHALL follow the following procedure to initiate the de-activation of a time shifted multicast content service:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>
<p>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>” The content of the HTTP Request SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t5" class="tableRef"></a>. 
</ul></td></tr>
<tr><td>HTTP Request Body: The Request body SHALL include a MIME Multipart/Related container conforming to [[!RFC2837]] The first body part SHALL be an SDP offer identical to the one that activated the scheduled content time shift with the following exceptions:<ul>
<li>The m-line for the multicast content streaming session SHALL be reactivated (i.e. the port SHALL NOT be set to 0) while following the rules for modifying a session in [[!OFRANSR]]. The unicast media delivery channel and the RTSP control channel SHALL be de-activated. Note that the media descriptors SHALL be reused to avoid the SDP from eventually becoming too large.
<li>BCServiceId SHALL be set to the value of the selected channel. 
</ul></td></tr>
</table>
</td></tr>
<tr><td></td><td>The second body part SHALL conform to the OIPF-IPTV Service Action command schema in section <a href="#s5-3-1-1-7-3" class="sectionRef">5.3.1.1.7.3</a>, “<a href="#s5-3-1-1-7-3" class="sectionTitleRef"></a>”, and SHALL only include the following:
<table class="http-element">
<tr><td><ul>
<li>IPTVActionDataCommand SHALL be set to "SwitchtoBC".
<li>SwitchToBC SHALL be set to elements defined by "IPTVBcActionData".
</ul></td></tr>
</table>
</td></tr>

<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers as per Table <a href="#t5" class="tableRef"></a>. The IG SHALL send a SIP re-INVITE to the network to request the de-activation of the time shift procedure,  and SHALL wait for the response to the request.  The IG SHALL reject a request that is missing any mandatory SIP headers, with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>On receipt of the response from the network the IG SHALL return a HTTP 200 OK response (or other appropriate received responses) to the OITF to report the response to the time shift de activation request.  The response SHALL include a list of SIP headers as per Table <a href="#t6" class="tableRef"></a>, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].  </td></tr>
<tr><td class="label">Step 4:</td><td>Upon receipt of a 200 OK response, the OITF SHALL send an HTTP HNI-IGI PENDING_IG request to acknowledge the final response. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t7" class="tableRef"></a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>

</table>

</section>
<section id="s5-3-1-1-7-3"><h6>XML Schema for OITF-IPTV Commands</h6>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:iptv:IPTVAction:2009"
  xmlns:tns="urn:oipf:iptv:IPTVAction:2009"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:bc ="urn:org:etsi:ngn:params:xml:ns:iptvbcserviceactiondata"
  xmlns:co ="urn:org:etsi:ngn:params:xml:ns:iptvcodserviceactiondata"
  xmlns:np ="urn:org:etsi:ngn:params:xml:ns:iptvnpvrserviceactiondata"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;

  &lt;xs:import namespace="urn:org:etsi:ngn:params:xml:ns:iptvbcserviceactiondata"
    schemaLocation="imports/iptvbcserviceactiondata.xsd"/&gt;

  &lt;xs:import namespace="urn:org:etsi:ngn:params:xml:ns:iptvcodserviceactiondata"
    schemaLocation="imports/iptvcodserviceactiondata.xsd"/&gt;

  &lt;xs:import
    namespace="urn:org:etsi:ngn:params:xml:ns:iptvnpvrserviceactiondata"
    schemaLocation="imports/iptvnpvrserviceactiondata.xsd"/&gt;

  &lt;xs:element name="IPTVAction" type="tns:IPTVActionType"/&gt;

  &lt;xs:complexType name="IPTVActionType"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element name="Notify" type="tns:NotifyType"/&gt;
      &lt;xs:element name="Record" type="tns:RecordType"/&gt;
      &lt;xs:element name="SwitchToTM" type="tns:SwitchToTMType"/&gt;
      &lt;xs:element name="SwitchToBC" type="tns:SwitchToBCType"/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="NotifyType"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element ref="bc:IPTVBcActionData" /&gt;
      &lt;xs:element ref="co:IPTVCoDActionData" /&gt;
      &lt;xs:element ref="np:IPTVNpvrActionData" /&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="RecordType"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element ref="bc:IPTVBcActionData" /&gt;
      &lt;xs:element ref="np:IPTVNpvrActionData" /&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="SwitchToTMType"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element ref="bc:IPTVBcActionData" /&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="SwitchToBCType"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element ref="bc:IPTVBcActionData" /&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre>
</section></section>


</section>
</section>
<section id="s5-3-2"><h3>Unicast content streaming with SIP session management</h3>
<section id="s5-3-2-1"><h4>Protocol for SIP session management over HNI-IGI – HTTP Option</h4>
<section id="s5-3-2-1-1"><h5>Retrieval of Session Parameters</h5>
<p>If the OITF does not have all the necessary parameters to form the SDP offer the HNI-IGI function in the OITF SHALL retrieve missing SDP parameters using the following procedure:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG on the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t14" class="tableRef">14</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers REQUIRED for the outgoing message as per Table <a href="#t14" class="tableRef">14</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response that includes the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP OPTIONS message to the network, to retrieve missing SDP parameters and SHALL wait for the response to the request.  The IG SHALL then return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the request for missing SDP parameters.  The response includes a list of SIP headers as per Table <a href="#t15" class="tableRef">15</a>, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]], as well as an SDP body containing the missing SDP parameters according to section <a href="#s6-1-2-2-1-2" class="sectionRef">6.1.2.2.1.2</a>, “<a href="#s6-1-2-2-1-2" class="sectionTitleRef"></a>.”</td></tr>
</table>
<table id="t14" class="mapping">
<caption>Table ####: Supported HTTP extension headers in HNI-IGI OPTION Request for unicast content streaming session setup parameters (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line
Note: The request URI SHALL be set to the PSI (Public Service Identifier) of the content service as follows:<br />
For CoD: OIPF_IPTV_CoD_Service_*@&lt;domain name&gt;<br />
Where:<ul>
<li>The wild card part (*) is a content instance identifier, constructed according to <a href="volume3.html#crid-location-resolution" class="extRef">clause 4.3</a> in [[.OIPF_META2]] when CoD content identifiers are delivered via the Content Guide.  For DAE applications signalling CoD, the wild card part is constructed according to <a href="volume5.html#cod-unicast-streaming-with-sip-session-management" class="extRef">clause 8.2.2</a> in [[.OIPF_DAE2]].
<li>The domain part (&lt;domain name&gt;) is the IPTV Service Provider domain name, obtained from the IPTV Service Provider discovery function.</ul></td><td>RFC 3261 [[!SIP]]<p>OPTIONS  &lt;Request URI&gt;  SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<br />SHALL be set to the value of the request URI in  the “X-OITF-Request-Line OPTIONS” header</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept</td><td>Set to application/sdp as per RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Recv-Info<br />
SHALL be set to remove support for the reception of the CoD-Bookmark Info Package<br />
Or<br />
SHALL be set to indicate support for the reception of the CoD-Bookmark Info Package<br />
Note: The CoD-Bookmark Info Package is defined in section 12 of [[!PSS-MBMS]]</td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
</table>
<table id="t15" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to an HNI-IGI OPTION Request for unicast content streaming session setup parameters</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-3-2-1-2"><h5>Session Initiation</h5>
<p>The OITF SHALL initiate the request for a unicast content streaming session using the following procedure.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>
The OITF SHALL send an HTTP POST request to the IG on the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t16" class="tableRef">16</a>
</ul></td></tr>
<tr><td>HTTP Request Body: The request body includes the SDP offer generated by the OITF. The SDP offer SHALL include a media description for the RTSP content control channel and the media description for the content delivery channel. SDP SHALL be used as specified in [[!TS124503]].</td></tr>
<tr><td><ul><li>SDP Parameters for the RTSP control channel</ul></td></tr>
</table>
<p>The RTSP content control media description SHALL be carried by TCP and follow [[!SDP-TCP]]. Hence, the SDP parameters for the RTSP content control channel SHALL be set as follows:</p>
<table class="http-element">
<tr><td><ul class="liststart-2">
<li>An m-line for an RTSP stream of format:    m=&lt;media&gt; &lt;port&gt; &lt;transport&gt; &lt;fmt&gt;<ul>
<li>The &lt;media&gt; field SHALL have a value of “application”.
<li>The &lt;port&gt; field SHALL be set according to [[!SDP-TCP]]. The “a=setup” attribute SHALL be set to ‘active’, and port field SHALL be set to a value of “9”, which is the discard port.
<li>The &lt;transport&gt; field SHALL be set to “TCP” or “TCP/TLS”.  The former SHALL be used when RTSP runs directly on top of TCP and the latter SHALL be used when RTSP runs on top of TLS, which in turn runs on top of TCP.
<li>The &lt;fmt&gt; parameter SHALL be included and set to “iptv_rtsp”<br />(ex. m=application 9 tcp iptv_rtsp)</ul>
<li>An “a=setup” attribute SHALL be present and set to “active” as defined in [[!SDP-TCP]]<br />(ex. a=setup:active)
<li>An “a= connection” attribute SHALL be present and set as “new” as defined in [[!SDP-TCP]]<br />(ex. a=connection:new)
<li>A c-line SHALL include the network type with the value set to “IN”, the address type set to “IP4” and IP address of the RTSP content control stream.<br />(ex. c=IN IP4 &lt;IP_ADDRESS&gt;)
<li>One or more a=fmtp lines representing RTSP specific attributes set as follows:<ul>
<li>The RTSP Version MAY be specified in a “fmtp:iptv_rtsp version” parameter.
</ul></ul>
</td></tr>
</table>

<table class="http-element">
<tr><td><ul><li>SDP Parameters for the content delivery channels</ul></td></tr>
</table>
<p>For each media stream controlled by the RTSP content control channel the SDP offer SHALL include a content delivery channel media description, set as follows:</p>
<table class="http-element">
<tr><td><ul class="liststart-2">
<li>The m-line indicates the type of the media (“video”), the transport protocol and the OITF’s desired port of the related content delivery channel as follows: m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt&gt;
<li>&lt;fmt&gt; settings:<ul>
<li>When MPEG2-Transport Stream [[!MPEG2TS]] is used, &lt;fmt&gt; SHALL be “33” as specified in RFC 3551 [[!RFC3551]]
<li>When OPTIONAL Timestamped-TS defined by [[!DLNA]] is used, the RTP/AVP dynamic payload type SHALL be used and &lt;encoding name&gt; of “a=rtpmap”  line SHALL be “vnd.dlna.mpeg-tts” as specified in [[!DLNA]], e.g.
m=video 49232 RTP/AVP 98
a=rtpmap:98 vnd.dlna.mpeg-tts/27000000
<li>When the media stream is retransmission protected, &lt;fmt&gt; SHALL have two payload type values : one for the original stream (&lt;fmt1&gt;) and one for the retransmission stream (&lt;fmt2&gt;), with the two streams being SSRC multiplexed. E.g.
m=video &lt;port&gt; RTP/AVPF &lt;fmt1&gt;&lt;fmt2&gt;
<p>The &lt;fmt&gt; values are retrieved by the OITF from the response to the SIP OPTIONS and the following attributes are used that define which &lt;fmt&gt; corresponds with which stream SHALL be used:</p><ul class="nobullet">
<li>a=rtcp-fb:&lt;fmt1&gt; nack
<li>a=rtpmap:&lt;fmt2&gt; &lt;rtx/clock_rate&gt;
<li>a=fmtp:&lt;fmt2&gt; apt= &lt;fmt1&gt;</ul>
Where &lt;fmt2&gt; is the RTP payload type of the retransmission stream, and &lt;fmt1&gt; is the RTP payload type of the original media stream</ul>
<li>&lt;proto&gt; settings:<ul>
<li>&lt;proto&gt; SHALL be set according to information obtained by the OITF either by OPTIONS or in the service access stage. If streaming is RTP, &lt;proto&gt; SHALL be set to RTP/AVP. If streaming is RTP and retransmission is supported, &lt;proto&gt; SHALL be set to RTP/AVPF. If streaming is direct over UDP, &lt;proto&gt; SHALL be set to “MP2T/H2221/UDP” or “RAW/RAW/UDP”</ul>
<li>The “c- line” SHALL include the network type with the value set to “IN”, the address type set to “IP4” followed by the address of the OITF.<br />(e.g., c=IN IP4 &lt;IP_ADDRESS&gt;)
<li>The “b-line” SHALL contain the proposed bandwidth obtained by the OITF either by OPTIONS or during the service access phase. If the media stream is FEC protected and the OITF wishes to use one or more FEC streams, the bandwidth SHALL be the sum of the media stream bandwidth and the bandwidths of all the FEC stream to be used by the OITF.  If the OITF cannot obtain the bandwidth, the b= attribute SHALL be set to a pre-configured value. If the media stream is retransmission protected and the OITF wishes to make use of retransmission, the bandwidth MAY be adjusted to take into account the maximum (peak) bandwidth the OITF can accept for receiving retransmissions.<br />(e.g.,. b=AS:15000)
<li>A b=RR:&lt;bandwidth-value&gt;, line indicating the bandwidth value (in kbps) that the OITF proposes to use for sending Receiver Reports (RR). If this value is set to zero by the OITF, then it means that the OITF can not, or does not, wish to send Receiver Reports. This is the default setting, as explained in section <a href="#s9-1-2-1" class="sectionRef">9.1.2.1</a>, “<a href="#s9-1-2-1" class="sectionTitleRef"></a>.” Note that if the OITF sends RTCP Receiver Reports, then these can be used as keep-alive messages, as shown in section <a href="#s6-1-2-2-2-5" class="sectionRef">6.1.2.2.2.5</a>, “<a href="#s6-1-2-2-2-5" class="sectionTitleRef"></a>.” When the &lt;proto&gt; in the m-line is AVPF, the b=RR SHALL NOT be set to zero.
<li>An “a=” line with a “recvonly”<br />(e.g., a=recvonly)
</ul></td></tr></table>

<p>If a media stream is FEC protected, the OITF MAY include the following for each FEC protected stream:</p>
<table class="http-element">
<tr><td><ul class="liststart-2">
<li>One or more m-line for the FEC streams indicated in the response to the OPTIONS request. The m lines shall be set according to the returned response.
</ul></td></tr></table>

<p>In case there are multiple media streams to be FEC protected, or a single media stream protected by multiple FEC streams, grouping line(s) SHALL be included for the purpose of associating FEC stream(s) with media stream(s), one for each media stream m-line that is associated to a FEC stream. The grouping line uses the “FEC” semantic as defined in RFC 4756 [[!FEC]]:</p>
<table class="http-element">
<tr><td><ul class="liststart-2">
<li>a=group:FEC:&lt;original stream id&gt; &lt;base FEC stream id&gt; &lt;enhancement FEC stream id&gt;
</ul></td></tr></table>

<p>The original stream id SHALL reflect the value held by the media description of media stream in the a=mid attribute. This implies that, when a grouping line is included, there SHALL be an additional media identification attribute within the m-line of the original media stream that is within the grouping line. The format for that attribute is:</p>
<table class="http-element">
<tr><td><ul class="liststart-2">
<li>a=mid:&lt;original stream id&gt;
</ul></td></tr></table>

<p>The base FEC stream id SHALL reflect the value held by the media description of the FEC stream (associated to the original stream) in the a=mid attribute.</p>
</td></tr>
<tr><td class="label">Step 2:</td><td>If the request is for a unicast content streaming session, the IG SHALL validate that the request includes all the mandatory SIP headers needed for the outgoing message, as per Table <a href="#t16" class="tableRef">16</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP INVITE to the network, to request the initiation of a unicast session, and SHALL wait for the response to the request.  The IG SHALL then return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the initiation request.  The response includes a list of SIP headers as per Table <a href="#t17" class="tableRef">17</a>, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]], and the same SDP answer body received by the IG, as described in section <a href="#s6-1-2-2-2-5" class="sectionRef">6.1.2.2.2.5</a>, “<a href="#s6-1-2-2-2-5" class="sectionTitleRef"></a>”.</td></tr>
<tr><td class="label">Step 4:</td><td>Upon receipt of a 200 OK response, the OITF SHALL send an HTTP Pending Request to acknowledge the final response. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t18" class="tableRef">18</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
</table>
<p>When parsing the b=RR:&lt;bandwidth-value&gt; line by the OITF: if the bandwidth value agreed is non-zero, then the OITF SHALL send RTCP RRs and SHALL NOT send RTSP keep-alive messages. If the bandwidth value received is zero, then the OITF SHALL NOT sends RTCP RRs but instead it SHALL send RTSP keep-alive messages.</p>
<table id="t16" class="mapping">
<caption>Table ####: Supported HTTP extension headers in HNI-IGI INVITE Request for unicast content streaming session setup (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>
Note: The request URI MUST be set to the PSI (Public Service Identifier) of the content service as follows:<br />
For CoD:  OIPF_IPTV_CoD_Service_*@&lt;domain name&gt;<br />
Where:</p><ul>
<li>The wild card part (*) is a content instance identifier, constructed according to <mark class="refError">clause 4.3.2.2 in [[.OIPF_META2]]</mark> when CoD content identifiers are delivered via the Content Guide. For DAE applications signalling CoD, the wild card part is constructed according to <a href="volume5.html#cod-unicast-streaming-with-sip-session-management" class="extRef">clause 8.2.2</a> in [[.OIPF_DAE2]].
<li>The domain part (&lt;domain name&gt;) is the IPTV Service Provider domain name, obtained from the IPTV Service Provider discovery function.
</ul></td><td>RFC 3261 [[!SIP]]<p>INVITE  &lt;Request URI&gt;  SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>MUST be set to the value of the request URI in the “X-OITF-Request-Line INVITE” header</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact
<p class="notes-list">Notes:</p>
<ol class="notes-list">
<li>URI parameter SHALL be included and SHALL match what is sent in the contact header included in the registration request.
<li>Expires parameter SHOULD be included.</ol></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Supported</td><td>RFC 3261 [[!SIP]] set to timer</td></tr>
<tr><td>X-OITF-Session-Expires</td><td>RFC 4028 [[!SES-TIMR]]</td></tr>
</table>

<table id="t17" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to an HNI-IGI INVITE Request for unicast content streaming session setup (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]
<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p>
The URI parameter and the sip.instance feature tag MUST be included and MUST match what is sent in the contact header included in the registration request.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Session-Expires</td><td>RFC 4028 [[!SES-TIMR]]</td></tr>
<tr><td>X-OITF-Recv-Info
<p>To indicate willingness to receive the CoD-Bookmark Info Package, it SHALL be set to CoD-Bookmark or add CoD Bookmark to the Info Package set;<br /> 
Or <br />
To indicate unwillingness, it SHALL be empty or remove CoD-Bookmark from the Info Package set.</p>
Note: The CoD-Bookmark is defined in section 12 of [[!PSS-MBMS]]</td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
</table>

<table id="t18" class="mapping">
<caption>Table ####: Supported HTTP extension headers in HNI-IGI ACK Request for successful unicast content streaming session teardown (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the ACK request SHALL be the contact included in the response to the INVITE message</p></td><td>RFC 3261 [[!SIP]]
<p>ACK &lt;Request URI&gt;  SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To
<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line” of the initial request</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact
<p>The URI parameter SHALL be included, and SHALL match what has been inserted in the INVITE message. The IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-3-2-1-3"><h5>Session Termination</h5>
<p>The OITF SHALL send the request for a unicast content streaming session termination using the following procedure:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t19" class="tableRef">19</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers REQUIRED for the outgoing message, as per Table <a href="#t19" class="tableRef">19</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP BYE to the network, to request the termination of a unicast session, and SHALL wait for the response.  The IG SHALL then return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the termination request.  The response includes a list of SIP headers as per Table <a href="#t20" class="tableRef">20</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>

<table id="t19" class="mapping">
<caption>Table ####: Supported HTTP extension headers in HNI-IGI BYE Request for unicast content streaming session teardown (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line</td><td>RFC 3261 [[!SIP]]
<p>BYE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line” of the initial request</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t20" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to an HNI-IGI BYE Request for unicast content streaming session teardown (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line</td><td>RFC 3261 [[!SIP]]
<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

</section>
<section id="s5-3-2-1-4"><h5>Session Refresh</h5>
<p>It is the responsibility of the OITF application to refresh the unicast content streaming session before the session expires. The IG SHALL consider a session terminated if it is not refreshed.</p>
</section>
</section>
<section id="s5-3-2-2"><h4>Protocol for streaming over UNIT-17</h4>
<p>The use of the HTTP protocol on this reference point SHALL comply with [[!HTTP]]</p>
<p>The Content Delivery Function SHALL support the Range HTTP header in a GET request from the OITF to reduce unnecessary network usage by allowing partial retrieval for use in cases such as trick play. The OITF MAY pre-buffer the content in order to sustain play-out even when the HTTP transfer is stalled.</p>
</section>

</section>
<section id="s5-3-3"><h3>Forced Play Out Control with SIP session management</h3>
<section id="s5-3-3-1"><h4>Protocol for Forced Play Out Control over HNI-IGI</h4>
Given that Forced Play Out is completely supported in the network with no OITF impacts, the OITF SHALL initiate the request for unicast content streaming session using the procedure described in section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”.
</section>
</section>
<section id="s5-3-4"><h3>Content Download</h3>
<p>Content Download is a service where IPTV content is downloaded to the OPTIONAL Internal Storage System in the OITF. The OITF MAY play-out the content while downloading. Trick play MAY be performed within the downloaded content depending on the content rights.</p>
<section id="s5-3-4-1"><h4>Protocol over UNIT-17</h4>
<p>The use of the HTTP protocol on this reference point SHALL comply with [[!HTTP]].</p>
<p>The Content Delivery Function SHALL support the Range HTTP header in a GET request from the OITF to reduce unnecessary network usage by allowing partial retrieval.</p>
</section>
</section>
<section id="s5-3-5"><h3>Purchase of Digital Media Service using SIP</h3>
<p>A native application in the OITF MAY allow purchase of Digital Media related to a content item. Purchase of Digital Media is a service where the users want to buy and download additional Digital Media related to a content item in which they are interested. There are three steps to purchase Digital Media: advertising and retrieving the Digital Media related to the content item, the purchase request for selected Digital Media, and downloading the purchased Digital Media.</p>
<section id="s5-3-5-1"><h4>Retrieving the OIPF RelatedMaterial metadata for the content</h4>
<p>The Digital Media related to the content is described through the OIPF RelatedMaterialType metadata which is extended from the TV-Anytime RelatedMaterial schema defined in [[!TVA-MD]]. In order to provide advertising for the related material, the new element “Position_Size” is needed in the schema.</p>
<p>When the user pauses, OITF retrieves the OIPF RelatedMaterialType metadata of the content in order to advertise the related material. The new element “Position_Size” is used to define where promotional messages or media will appear on the user’s screen and in what size. </p>
<p>The element Position_Size in RelatedMaterialType is shown in red in Figure <a href="#f1" class="figureRef">1</a>.</p>
<figure id="f1">
<figcaption>Figure ####: Elements of OIPF extended RelatedMaterialType</figcaption>
<img alt="FIGURE 1" src="images/OIPFextendedReletedMaterialType.png" />
</figure>
<p>Position_Size includes 4 numbers (x, y, w, h), where (x, y) means the top-left point of the advertisement, and w and h means the width and height of the advertisement, respectively. The position and size of each advertisement is decided and sent by IPTV Metadata Control FE. The concept of constructing an advertising window using (x, y, w, h) in Position_Size element is shown in Figure <a href="#f2" class="figureRef">2</a>.</p>
<p>Different resolution support:  the Position_Size is set for the default resolution (for example, 800&times;600). If the OITF use another resolution (for example, 1024&times;768), the OITF scales the Position_Size to fit in with that resolution.</p>
<figure id="f2">
<figcaption>Figure ####: Construction of advertising window using (x,y,w,h) in Position_Size element</figcaption>
<img alt="FIGURE 2" src="images/Position_Size_element.png" />
</figure>
</section>
<section id="s5-3-5-2"><h4>Advertising Digital Media through the use of overlays</h4>
<p>The OITF advertise Digital Media to user by overlaying the received PromotionalText and/or PromotionalMedia (e.g., a logo) of OIPF defined RelatedMaterialType and the original IPTV content, as shown in Figure <a href="#f3" class="figureRef">3</a>.</p>
<figure id="f3">
<figcaption>Figure ####: Overlaying the content with advertisement for related media</figcaption>
<img alt="FIGURE 3" src="images/OverlayingRelatedMaterial.png" />
</figure>
</section>
<section id="s5-3-5-3"><h4>Protocol over HNI-IGI – HTTP Option</h4>
<section id="s5-3-5-3-1"><h5>Purchase Procedure for Selected Digital Media Related to the Content</h5>
<p>It is assumed that the OITF has an established session and has retrieved the necessary information to perform the purchase procedures as depicted in the steps below. It is also assumed that the network indicated its willingness to receive the Digital-Media-Purchase Info Package.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF sends HTTP request (with SelectedDigitalMediaURI, UserID) to IG for purchase selected Digital Media. The content of the HTTP request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header:  Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - see per Table <a href="#t21" class="tableRef">21</a>
</ul></td></tr>
<tr><td> HTTP Request Body:  (As defined in section <a href="#s5-3-5-8" class="sectionRef">5.3.5.8</a>, “<a href="#s5-3-5-8" class="sectionTitleRef"></a>”, the “SelectedDigitalMediaURI” sets as the content of &lt;MediaUri&gt; in &lt;MediaLocator&gt; of OIPFRelatedMaterial, and “UserID” sets as &lt;IMPU&gt;).</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory headers as per Table <a href="#t21" class="tableRef">21</a>. The IG SHALL reject a request that is missing any mandatory SIP header with a non-200 HTTP OK response including the reason for rejection.  Furthermore, it is assumed that the IPTV Control FE indicated its willingness to receive the Digital-Media-Purchase Info Package at session setup time. Otherwise, the IG SHALL reject the request. The IG SHALL send a SIP INFO to the network including the Digital-Media-Purchase Info Package and SHALL wait for the response from the network.</td></tr>
<tr><td class="label">Step 3:</td><td>
On receipt of a response message from network, the IG return SHALL return an HTTP 200 OK with the purchase result to OITF. The content of the HTTP response SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header:  Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - see per Table <a href="#t22" class="tableRef">22</a>
</ul></td></tr>
<tr><td> HTTP Request Body:  purchase result. (It will be a simple string “success” if purchase request success, or an Unsigned 32bit “Result-Code” if purchase request failure)</td></tr>
</table>
</td></tr>
</table>

<table id="t21" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the HNI-IGI SIP INFO Request message for Digital Media Purchase (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the INFO request SHALL be the well known PSI (Public Service Identifier) of the Digital Media Purchase Service:  OIPF_IPTV_DMPurchase_Service@&lt;domain name&gt;.</p></td><td>RFC 3261 [[!SIP]]<p>INFO &lt;Request URI&gt;  SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF_Info-Package<p>SHALL be set to “Digital Purchase”</p></td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to the “application/vnd.oipf.purchase+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Disposition</td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
</table>

<table id="t22" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response message to an HNI-IGI INFO request message for Digital Media Purchase (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]
<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-3-5-3-2"><h5>Management of Purchase Request for Digital Media by Network</h5>
<p>The OITF SHALL comply with the following when it comes to network management for purchasing Digital Media:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>At any time, the IG can receive a SIP UPDATE from the network, and where the Recv-Info header is set to remove or re-instate support for reception of Digital-Media-Purchase Info Package to order the OITF to stop or start sending digital media purchase requests.  When a SIP UPDATE is received by the IG, the IG SHALL return an HTTP 200 OK response to the OITF.  The response includes a list of SIP headers as per Table <a href="#t23" class="tableRef">23</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 2:</td><td>Once the OITF accepts the incoming SIP UPDATE, it SHALL send an HTTP HNI-IGI PENDING-IG request to acknowledge the receipt of the SIP UPDATE. The HTTP request includes a list of SIP headers as per Table <a href="#t24" class="tableRef">24</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>

<table id="t23" class="mapping">
<caption>Table ####: List of HTTP extension headers for an incoming SIP UPDATE (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the INVITE MUST match the  contact URI included in the contact field of the SIP INVITE</p></td><td>RFC 3261 [[!SIP]]<p>UPDATE &lt;Request URI&gt;  SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Recv-Info<p>
To indicate willingness to receive the Digital Media Purchase Info Package, it SHALL be set to “Digital Media Purchase” or add Digital-Purchase to the capability set;<br />
or <br />
To indicate unwillingness, it SHALL be empty or remove “Digital-Media Purchase”</p></td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
</table>
<table id="t24" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response message to an incoming HNI-IGI SIP UPDATE Request Message (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
</section>
<section id="s5-3-5-4"><h4>Protocol over UNIP-1</h4>
<section id="s5-3-5-4-1"><h5>Protocol for Retrieving Stored Purchased Digital Media</h5>
<p>If the OITF desires to retrieve the lists of purchased digital media stored in the network over UNIP-1, it SHALL send an XCAP GET request to the IPTV Service Profile FE. The IPTV Service Profile FE SHALL returns all stored purchased digital media records in an HTTP 200 OK response.</p>
<p>Note that the purchased digital media record can only updated by the IPTV Control FE, not the OITF.</p>
</section>
</section>
<section id="s5-3-5-5"><h4>Protocol over NPI-2</h4>
<section id="s5-3-5-5-1"><h5>Protocol for Storing Purchased Digital Media</h5>
<p>Upon receipt of a request to store purchased digital media from the IPTV Control FE, the IPTV Applications FE SHALL send the XCAP PUT request to IPTV Service Profile FE to store a new purchased digital media record.</p>
<p>After updating the user’s profile, the IPTV Service Profile FE SHALL return a response to IPTV Applications FE, and then the IPTV Applications FE SHALL return a response to IPTV Control FE.</p>
</section>
</section>
<section id="s5-3-5-6"><h4>Protocol over UNIS-7</h4>
<p>Use the following procedures when the OITF wants to retrieve OIPFRelatedMaterial of the content for advertisement.</p>
<p>Note: The network initiated push to the OIPF RelatedMaterial is not specified.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF sends an HTTP request to IPTV Metadata Control FE to retrieving OIPFRelatedMaterial for the content for advertisement.
<table class="http-element">
<tr><td>HTTP Request Header:  Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per Table <a href="#t25" class="tableRef">25</a>
</ul></td></tr>
<tr><td>HTTP Request Body: It SHALL be a simple string “OIPFRelatedMaterial_Request..</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IPTV Metadata Control FE returns the HTTP response to OITF with the OIPFRelatedMaterial for the content.
<table class="http-element">
<tr><td>HTTP Request Header:  Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per Table <a href="#t26" class="tableRef">26</a>
</ul></td></tr>
<tr><td>HTTP Request Body: As defined in section <a href="#s5-3-5-7" class="sectionRef">5.3.5.7</a>, “<a href="#s5-3-5-7" class="sectionTitleRef"></a>”.</td></tr>
</table>
</td></tr>
</table>

<table id="t25" class="mapping">
<caption>Table ####: Mandatory HTTP headers in the Request message for Advertisement of Digital Media (OITF&rarr;IPTV Metadata Control FE)</caption>
<tr><th>HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Request-Line</td><td>RFC 2616 [[!HTTP]]<p>POST &lt;Request URI&gt;  HTTP/1.1</p></td></tr>
<tr><td>Content-Length</td><td>RFC 2616 [[!HTTP]]</td></tr>
<tr><td>Content-Type<p>OPTIONAL. The default value of Content-Type is “text/plain; charset=us-ascii” as defined in RFC 2045 [[!RFC2045]]</p></td><td>RFC 2616 [[!HTTP]]</td></tr>
<tr><td>Host</td><td>RFC 2616 [[!HTTP]]</td></tr>
</table>
<table id="t26" class="mapping">
<caption>Table ####: Mandatory HTTP headers in the Response message for Advertisement of Digital Media (IPTV Metadata Control FE&rarr;OITF)</caption>
<tr><th>HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Request-Line</td><td>RFC 2616 [[!HTTP]]<p>HTTP/1.1  &lt;Status-Code&gt; &lt;Reason-Phrase&gt;</p></td></tr>
<tr><td>Content-Length</td><td>RFC 2616 [[!HTTP]]</td></tr>
<tr><td>Content-Type<p>SHALL be set to “application/vnd.oipf.OIPFRelatedMaterial+xml”</p></td><td>RFC 2616 [[!HTTP]]</td></tr>
</table>

</section>
<section id="s5-3-5-7"><h4>XML Schema for Advertisement of Digital Media</h4>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:service:RelatedMaterial:2011"
  xmlns:tns="urn:oipf:service:RelatedMaterial:2011"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:tva="urn:tva:metadata:2011"&gt;

  &lt;xs:import namespace="urn:tva:metadata:2011"
    schemaLocation="imports/tva_metadata_3-1_v171.xsd"/&gt;

  &lt;xs:complexType name="RelatedMaterialType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="tva:RelatedMaterialType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="Position_Size" type="tns:PositionSizeType"/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="PositionSizeType"&gt;
    &lt;xs:attribute name="x" type="xs:unsignedShort" use="required"/&gt;
    &lt;xs:attribute name="y" type="xs:unsignedShort" use="required"/&gt;
    &lt;xs:attribute name="w" type="xs:unsignedShort" use="required"/&gt;
    &lt;xs:attribute name="h" type="xs:unsignedShort" use="required"/&gt;
  &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre>
</section>
<section id="s5-3-5-8"><h4>XML Schema for Purchase Request of Digital Media</h4>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:service:PurchaseRequest:2010"
  xmlns:ct="urn:oipf:base:CommonTypes:2011"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;xs:import namespace="urn:oipf:base:CommonTypes:2011" 
    schemaLocation="base-CommonTypes.xsd" /&gt;

  &lt;!--"SelectedDigitalMediaURI" sets as the content of &lt;MediaUri&gt; in
    &lt;MediaLocator&gt; of RelatedMaterial --&gt;
  &lt;!--"UserID" sets as &lt;IMPU&gt; --&gt;
  &lt;xs:complexType name="PurchaseDigitalMediaRequestType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="SelectedDigitalMediaURI" type="xs:anyURI"/&gt;
      &lt;xs:element name="UserID" type="ct:UserIdType"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre>
<p>The SelectedDigitalMediaURI element represents the selected Digital Media that user wants to purchase.</p>
<p>The UserID element represents who made the digital media purchase request.</p>
</section>

</section>
<section id="s5-3-6"><h3>Pay Per View multicast content service with SIP session management</h3>
<section id="s5-3-6-1"><h4>Protocol over HNI-IGI – HTTP Option</h4>
<p>When the OITF initiates, modifies or terminates a Pay-Per-View multicast content service, the OITF SHALL send HNI-IGI messages containing the appropriate method, mapped to HNI-IGI as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.”</p>
<p>The SIP-specific information in the related messages is described in section <a href="#s6-1-2-5" class="sectionRef">6.1.2.5</a>, “<a href="#s6-1-2-5" class="sectionTitleRef"></a>.” The SIP-specific information is mapped to the HNI-IGI protocol, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” In particular, the OITF creates HTTP headers for an HNI-IGI message by adding “X-OITF-” in front of the necessary SIP header names. In addition, OPTIONAL parameters MAY be included as defined in [[!TS124503]].</p>
<section id="s5-3-6-1-1"><h5>PPV Service initiation without existing multicast content streaming session</h5>
<p>PPV service initiation without an existing multicast content session is similar to the multicast content session initiation described in section <a href="#s5-3-1-1-1" class="sectionRef">5.3.1.1.1</a>, “<a href="#s5-3-1-1-1" class="sectionTitleRef"></a>”, with the following differences:</p>
<p>The media level of the SDP offer in the HTTP Request Body has the following additional requirements:</p><ul>
<li>The m-line(s) SHALL be set according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a> for the multicast content service to which the PPV service belongs.
<li>The c-line(s) SHALL be set according to the mapping defined in Annex <a href="#annex-d-1" class="sectionRef">D.1</a> for the multicast content service to which the PPV service belongs.
<li>An a=bc_service:BCServiceId line to indicate the multicast content service to which the PPV program belongs SHALL be included.
<li>An a=bc_program:BCprogramId line to indicate the PPV program SHALL be included.
</ul>
<p>When the OITF receives the response to the request, it SHALL examine the media parameters in the received SDP. The OITF SHALL restrict the multicast content services that it joins according to the parameter (the a=bc_service_package attribute) received from the IPTV Control FE.</p>
</section>
<section id="s5-3-6-1-2"><h5>Switching from a PPV service to a multicast content service</h5>
<p>To join a multicast content service outside the set of channels negotiated at session initiation, the OITF SHALL send a request to the IG for session modification. The OITF SHALL enforce a multicast content streaming session modification defined in section <a href="#s5-3-1-1-3" class="sectionRef">5.3.1.1.3</a>, “<a href="#s5-3-1-1-3" class="sectionTitleRef"></a>.”</p>
<p>To join a multicast content service inside the set of channels negotiated at session initiation, the OITF SHALL send an IGMP Leave request to stop watching the PPV service, and send an IGMP Join request to join the multicast content service. When FCC capability is available for the multicast content service, the OITF SHALL request a fast channel change as defined in Annex <a href="#annex-m-2" class="sectionRef">M.2</a>, “<a href="#annex-m-2" class="sectionTitleRef"></a>”. Further, when multicast RET service is offered, the OITF SHALL join the RET stream as defined in Annex <a href="#annex-m-1" class="sectionRef">M.1</a>, “<a href="#annex-m-1" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s5-3-6-1-3"><h5>Switching to a PPV service from a multicast content service or another PPV service</h5>
<p>The OITF SHALL send a request to the IG for session modification. The OITF SHALL generate a re-INVITE request, as defined in section <a href="#s5-3-6-1-1" class="sectionRef">5.3.6.1.1</a>, “<a href="#s5-3-6-1-1" class="sectionTitleRef"></a>.”</p>
<p>The OITF SHALL include an SDP offer in the session modification request. The format of this SDP offer SHALL be the same as for a session initiation. Note that session modification is only necessary if the PPV service is not included at session startup.</p>
</section>
<section id="s5-3-6-1-4"><h5>Session Termination</h5>
<p>When the OITF wants to terminate the session, the OITF SHALL generate a HTTP POST request as described in section <a href="#s5-3-1-1-4" class="sectionRef">5.3.1.1.4</a>, “<a href="#s5-3-1-1-4" class="sectionTitleRef"></a>” for an originating OITF.</p>
</section>
</section>
</section>
<section id="s5-3-7"><h3>Parental Control for Content using SIP</h3>
<p>Note: Parental control relationship establishment, modification or deletion is out of scope of this specification.</p>
<section id="s5-3-7-1"><h4>Protocol for What is on TV – OITF initiated – HTTP Option</h4>
<section id="s5-3-7-1-1"><h5>User Initiated Subscription to Acquire Information Related to Watched Content by another User</h5>
<p>An IPTV end user having the parental control authority over another user can initiate subscription to acquire information related to the watched content by the user under his parental control. To initiate the request to receive the information, the OITF SHALL follow the following procedure:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t27" class="tableRef">27</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>

</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers as per Table <a href="#t27" class="tableRef">27</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP SUBSCRIBE to the network, to subscribe to the Parental Control Watched Content event, and SHALL wait for the response to the subscription request. The IG SHALL return an HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the subscription request. The response SHALL include a list of SIP headers as per Table <a href="#t28" class="tableRef">28</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>Following that, the OITF SHALL send an HTTP HNI-IGI PENDING_IG request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionTitleRef"></a>”), and SHALL wait for any response.</td></tr>
<tr><td class="label">Step 5:</td><td>When a SIP NOTIFY is received by the IG, the IG SHALL return an HTTP 200 OK response to the OITF. The response SHALL include the list of SIP headers as per Table <a href="#t29" class="tableRef">29</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]]. The body of the HTTP response SHALL include the SIP body received in the incoming NOTIFY (See also section <a href="#s6-1-3-2-2" class="sectionRef">6.1.3.2.2</a>, “<a href="#s6-1-3-2-2" class="sectionTitleRef"></a>.”)</td></tr>
<tr><td class="label">Step 6:</td><td>
<p>Once the OITF accepts the incoming SIP NOTIFY, it SHALL send an HTTP HNI-IGI PENDING_IG request to the IG to send the SIP 200 OK response to the received SIP NOTIFY. The content of the HTTP Request SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Request Header: It includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t30" class="tableRef">30</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 7:</td><td>The IG SHALL send the SIP 200 OK response to the network and then SHALL return to Step 5 to handle any subsequent NOTIFY received from the network.</td></tr>
</table>

<table id="t27" class="mapping">
<caption>Table ####: Supported HTTP extension headers in HNI-IGI SUBSCRIBE Request for the Parental Control Watched Content Event Package</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line
<p>Note: The request URI can be set in one of 2 ways:</p><ul>
<li>It can be set to the Public identity of the IPTV target end user under the parental control of the originator of the request in the From field or
<li>It can be OPTIONALly set to a PSI defined by the service provider
</ul>
<p>In either of the above cases, any SUBSCRIBE request to the Parental Control Watched Event SHALL be configured to be routed to the IPTV Control FE (through iFC). This ensures that unauthorized requests are rejected by the network (unauthorized users MAY use the public identity of the target user instead of PSI in the Request URI line)</p>
</td>
<td>RFC 3261 [[!SIP]] and RFC 3265 [[!SIP-EVNT]]<p>SUBSCRIBE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To
<p>The To field is typically set to the public identity of the target user under the parental control of the originator of the request.</p>
<p>If the To field is set to be identical to the From field, (i.e. the originator of the request) then the subscription is for all IPTV end users under the parental control of the originator of the request.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event
<p>SHALL be set to the Event Package Parental-Control-Watched-Content</p></td><td>RFC 3265 [[!SIP-EVNT]] and Parental Control Watched Content (section <a href="#s5-3-7-1-4" class="sectionRef">5.3.7.1.4</a>, “<a href="#s5-3-7-1-4" class="sectionTitleRef"></a>”)</td></tr>
<tr><td>X-OITF-Accept
<p>SHALL be set to “application/vnd.oipf.iptvparentalcontrol.whatsontv+xml”</p></td><td>RFC 3265 [[!SIP-EVNT]] and Parental Control Watched Content (section <a href="#s5-3-7-1-4" class="sectionRef">5.3.7.1.4</a>, “<a href="#s5-3-7-1-4" class="sectionTitleRef"></a>”)</td></tr>
<tr><td>X-OITF-Contact
<p class="notes-list">Notes:</p><ol class="notes-list">
<li>The URI parameter and the sip.instance feature tag MUST be included and MUST match what is sent in the contact header included in the registration request.
<li>Expires parameter SHOULD be included
<li>Priority parameter SHOULD be included
</ol>
<p>The IG includes all other mandatory parameters that are absent.</p>
</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t28" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to an HNI-IGI SUBSCRIBE Request for the Parental Control Watched Content Event Package</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t29" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the NOTIFY request containing changes in the watched program (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The Request URI MUST match the contact URI included in the contact field of the SIP SUBSCRIBE</p></td><td>RFC 3261 [[!SIP]]<p>NOTIFY &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3265 [[!SIP-EVNT]] and Parental Control Watched Content (section <a href="#s5-3-7-1-4" class="sectionRef">5.3.7.1.4</a>, “<a href="#s5-3-7-1-4" class="sectionTitleRef"></a>”)</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Subscription-State</td><td>RFC 3265 [[!SIP-EVNT]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.iptvparentalcontrol.whatsontv+xml”</p></td><td>RFC 3265 [[!SIP-EVNT]] and Parental Control Watched Content (section <a href="#s5-3-7-1-4" class="sectionRef">5.3.7.1.4</a>, “<a href="#s5-3-7-1-4" class="sectionTitleRef"></a>”)</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t30" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to a NOTIFY request (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-3-7-1-2"><h5>Terminating a Subscription to the Parental Control Watched Content Event Package</h5>
<p>This procedure SHALL be invoked at any time and/or prior to de-registering the user that created the subscription.</p>
<p>The procedure is the same as the procedure for initiating a subscription to the Parental Control Watched Content event, however in this case the X-OITF-Expires header in Table <a href="#t27" class="tableRef">27</a> SHALL be set to 0.</p>
<p>The IG SHALL consider a subscription terminated if is not refreshed.</p>
</section>
<section id="s5-3-7-1-3"><h5>Refreshing Subscription to Parental Control Watched Event Package</h5>
<p>This procedure is the same as the procedure for initiating a subscription.</p>
<p>It is the responsibility of the application initiating the subscription procedure to refresh the subscription according to the refresh subscription timer information received in the response to the subscription request. Refreshing the subscription SHOULD be performed before the expiry of the refresh timer. A subscription that is not refreshed before the expiration of the refresh timer SHALL be terminated.</p>
</section>
<section id="s5-3-7-1-4"><h5>XML Schema for Parental Control Watched Content</h5>
<p>Note: OITF contact information is mapped to DeviceId; OITF Call-ID is mapped to SessionId</p>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:iptv:WhatsOnTv:2011"
  xmlns:tns="urn:oipf:iptv:WhatsOnTv:2011"
  xmlns:ct="urn:oipf:base:CommonTypes:2011"
  xmlns:xs=http://www.w3.org/2001/XMLSchema
  xmlns:pss="urn:org:etsi:ngn:params:xml:ns:PssContentSwitchData"
  xmlns:mbms="urn:org:etsi:ngn:params:xml:ns:MbmsContentSwitchData"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:import namespace="urn:oipf:base:CommonTypes:2011"
    schemaLocation="base-CommonTypes.xsd" /&gt;
  &lt;xs:import namespace="urn:org:etsi:ngn:params:xml:ns:PssContentSwitchData"
    schemaLocation="imports/PssSwitchData.xsd"/&gt;
  &lt;xs:import namespace="urn:org:etsi:ngn:params:xml:ns:MbmsContentSwitchData"
    schemaLocation="imports/MbmsSwitchData.xsd"/&gt;
  &lt;xs:element name="WhatsOnTvResponse" type="tns:WhatsOnTvResponseType"/&gt;
  &lt;xs:complexType name="WhatsOnTvResponseType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="User" type="tns:UserType" minOccurs="0"
        maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="UserType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="name" type="ct:UserIdType"/&gt;
      &lt;xs:element name="content" type="tns:WatchedContentType" minOccurs="0"
        maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="WatchedContentType"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element name="PssWatchedContent" type="tns:PssWatchedContentType"/&gt;
      &lt;xs:element name="MbmsWatchedContent" type="tns:MbmsWatchedContentType"/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="PssWatchedContentType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element ref="pss:PssSwitchData"/&gt;
      &lt;xs:element name="DeviceId" type="xs:string"/&gt;
      &lt;xs:element name="SessionId" type="xs:string"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="MbmsWatchedContentType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element ref="mbms:MbmsSwitchData"/&gt;
      &lt;xs:element name="DeviceId" type="xs:string"/&gt;
      &lt;xs:element name="SessionId" type="xs:string"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre>
</section>
</section>
<section id="s5-3-7-2"><h4>Protocol for Parental Control over HNI-IGI – HTTP Option</h4>
<section id="s5-3-7-2-1"><h5>Protocol for OITF Originating a Request for Parental Control</h5>
<p>The user to be controlled is watching content and the controller finds out the information related to the watched content (SC Service ID or content ID, ratings etc.) as described in section <a href="#s5-3-7-1" class="sectionRef">5.3.7.1</a>, “<a href="#s5-3-7-1" class="sectionTitleRef"></a>.” When the controller wants to block the content program, the OITF of the controller SHALL originate a request for Parental Control. The SIP-specific information in the related messages is described in section <a href="#s6-1-2-6" class="sectionRef">6.1.2.6</a>, “<a href="#s6-1-2-6" class="sectionTitleRef"></a>.” The SIP-specific information is mapped to the HNI-IGI protocol, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.”</p>

<table class="sequence">
<tr><td class="label">Step 1:</td><td>
The OITF SHALL send an HTTP POST request to the IG using the HNI-IGI functionality, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t31" class="tableRef">31</a>
</ul></td></tr>
<tr><td>HTTP Request Body: The OITF SHALL include a body associated with the appid “urn:oipf:application:iptv-parental-control”.</td></tr>
</table>
<p>The message body SHALL include the parameters related to Parental Control as follows.</p><ul>
<li>PC-Command: the command for parental control, e.g. channel change, session teardown.
<li>PC-ChannelChangedTo: When the PC-Command is channel change, this parameter MAY be included. It indicates the new channel to change to.
<li>PC-ContentControlled: the identifier of the content being blocked by the controller. For scheduled content, it SHALL be the SC service ID. For content on demand, it SHALL be the content ID.</ul>
<p>Note: The detailed XML schema refers to section <a href="#s5-3-7-2-3" class="sectionRef">5.3.7.2.3</a>, “<a href="#s5-3-7-2-3" class="sectionTitleRef"></a>.”</p>
<p>The Content-Type of the message body SHALL be set to “application/vnd.oipf.iptvparentalcontrol+xml” as described in Table Table <a href="#t31" class="tableRef">31</a> for X-OITF-Content-Type header.</p>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers for the message as per Table <a href="#t31" class="tableRef">31</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP MESSAGE to the network. When the IG receives the response, the IG SHALL return a HTTP 200 OK response (or other appropriate response) to the OITF to report the response to the SIP MESSAGE. The response includes a list of SIP headers as per Table <a href="#t32" class="tableRef">32</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>

<table id="t31" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the MESSAGE request for Parental Control (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the MESSAGE request SHALL be set to the public identity of the controlled user.</p></td><td>RFC 3261 [[!SIP]]<p>MESSAGE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From<p>The From in the MESSAGE request SHALL be set to the identity of the controller.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The To in the MESSAGE request SHALL be set to the identity of the controlled user.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.iptvparentalcontrol+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t32" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response message to a MESSAGE request message for Parental Control (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

</section>
<section id="s5-3-7-2-2"><h5>Protocol for OITF Receiving a Request for Parental Control</h5>
<p>The following procedure is supported in the OITF of the controlled user for receiving a request for Parental Control.</p>
<p>The incoming message can be handled either by a native application in the OITF, or in a DAE application. The same HNI-IGI message format is used in either case.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG receives a SIP MESSAGE for Parental Control.</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL forward the SIP MESSAGE to the OITF as an HTTP response to a PENDING_IG request. The list of SIP headers to be included in the notification forward to the OITF SHALL be as per Table <a href="#t33" class="tableRef">33</a>. The body of the SIP MESSAGE SHALL be included in the HTTP body.</td></tr>
<tr><td class="label">Step 3:</td><td>Upon receipt of the message, the OITF SHALL check the Content-Type in the “X-OITF-Content-Type” to determine that it is a Parental Control request. Then the OITF SHALL examine the parameters in the body, and initiate a request corresponding to the parameters in PC-Command, PC-ContentControlled. If the value in the PC-Command is Channel Change, the OITF SHALL leave the channel indicated in PC-ContentControlled and join a new channel which MAY be pre-configured or indicated in PC-ChannelChangedTo if present, as described in section <a href="#s8-1-1" class="sectionRef">8.1.1</a>, “<a href="#s8-1-1" class="sectionTitleRef"></a>.” If the value in the PC-Command is Session Teardown, the OITF SHALL initiate a request to terminate the session of the multicast content indicated in PC-ContentControlled, as described in section <a href="#s5-3-2-1-3" class="sectionRef">5.3.2.1.3</a>, “<a href="#s5-3-2-1-3" class="sectionTitleRef"></a>”</td></tr>
<tr><td class="label">Step 4:</td><td>The OITF SHALL issue an HTTP POST request. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t33" class="tableRef">33</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 5:</td><td>The IG SHALL forward the SIP 200 OK to the network.</td></tr>
</table>
<table id="t33" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the MESSAGE request for Parental Control (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI MUST be set to the Public identity of the controlled user.</p></td><td>RFC 3261 [[!SIP]]<p>MESSAGE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From<p>The From MUST be set to the Public identity of the controller.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request-URI in the “X-OITF-Request-Line”.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.iptvparentalcontrol+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>

<section id="s5-3-7-2-3"><h5>XML Schema for Parental Control</h5>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:iptv:parentalcontrol:2011"
  xmlns:tns="urn:oipf:itpv:parentalcontrol:2011"
  xmlns:ct="urn:oipf:base:CommonTypes:2011"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:annotation&gt;
    &lt;xs:documentation xml:lang="en"&gt;
      Defines the command for parental control
      associated with the controller
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;
  &lt;xs:import namespace="urn:oipf:base:CommonTypes:2011"
    schemaLocation="base-CommonTypes.xsd"/&gt;
  &lt;xs:element name="IPTVParentalControl" type="tns:tIPTVParentalControl" /&gt;
  &lt;xs:complexType name="tIPTVParentalControl"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="PC-Command" type="tns:tPCCommand" /&gt;
      &lt;xs:element name="PC-ChannelChangedTo" type="tns:tPCChannelChangedTo"
        minOccurs="0" /&gt;
      &lt;xs:element name="PC-ContentControlled" type="ct:ProgramIdType" &gt;
        &lt;xs:annotation&gt;&lt;xs:documentation xml:lang="en"&gt;
          Identifier of the content being controled by the controller. MAY be SC
          service ID or content ID.
        &lt;/xs:documentation&gt;&lt;/xs:annotation&gt;
      &lt;/xs:element&gt;
      &lt;xs:any namespace="##other" processContents="lax"
        minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="tPCCommand" final="list restriction"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="Channel Change" /&gt;
      &lt;xs:enumeration value="Session Teardown" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:simpleType name="tPCChannelChangedTo" final="list restriction"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation xml:lang="en"&gt;
        Identifier of a new channel to which the controlled user SHALL change.
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:minLength value="0" /&gt;
      &lt;xs:maxLength value="16" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;
</pre>
</section>
</section>

</section>
<section id="s5-3-8"><h3>Network-Based User Notification Services</h3>
<p>User notification service refers to the family of services that includes a notification being sent to an IPTV end user. The notification can be sent either to an OITF or to a cellular device depending on user preference. There are several types of notification services. This section deals with notification services related to broadcast reminders where the user can subscribe to be reminded, through a notification, before a specific broadcast starts. The actual notification can be sent anytime before the program starts at the IPTV SP discretion. Notification services related to broadcast reminders involve interaction with the EPG for setting up a notification request. The Notification Services AS is an MMS Parlay-X web services AS.</p>
<section id="s5-3-8-1"><h4>Protocol over HNI-IGI – HTTP Option</h4>
<section id="s5-3-8-1-1"><h5>Native HNI-IGI (IMS-based) Notification Request Setup Procedure</h5>
<p>To initiate a request to setup a notification service, the OITF SHALL follow the following procedure:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>As a pre-requisite it is assumed that the user is interacting with EPG where supported notification services are depicted to the end user. Once the user makes a selection, the OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t34" class="tableRef">34</a>
</ul></td></tr>
<tr><td>HTTP Request Body: See section <a href="#s5-3-8-6" class="sectionRef">5.3.8.6</a>, “<a href="#s5-3-8-6" class="sectionTitleRef"></a>.”</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers as per Table <a href="#t34" class="tableRef">34</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP MESSAGE to the network, to setup the request and SHALL wait for the response. The IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the setup request. The response SHALL include a list of SIP headers as per Table <a href="#t35" class="tableRef">35</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>Following that, the OITF SHALL send an HTTP HNI-IGI PENDING_IG request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionTitleRef"></a>”), and SHALL wait for any response.</td></tr>
</table>

<table id="t34" class="mapping">
<caption>Table ####: List of HTTP extension headers for an outgoing SIP MESSAGE for setting up a user notification request (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the well-known PSI for the notification service</p></td><td>RFC 3261 [[!SIP]]<p>MESSAGE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.network-based-user-notification+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p>The URI parameter and the sip.instance feature tag MUST be included and MUST match what is sent in the contact header included in the registration request.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t35" class="mapping">
<caption>Table ####: List of HTTP extension headers for the response to an outgoing SIP MESSAGE for setting up a user notification request (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
</section>
<section id="s5-3-8-2"><h4>Protocol over UNIS-6 for DAE-based Notification Management</h4>
<section id="s5-3-8-2-1"><h5>DAE-based Notification Request Setup</h5><p>Upon receipt of a notification setup request from the OITF, the IPTV application SHALL validate the request against the appropriate schema. Upon successful validation, the IPTV application stores the notification request in the user IPTV profile using XCAP PUT request for that purpose.</p></section>
<section id="s5-3-8-2-2"><h5>DAE-based Update of Pending Notifications</h5>
<p>Update of pending notification requests is achieved through XML re-writing of the IPTV user service profile. It includes three steps; first all the user pending notification requests are retrieved from the user service profile; next the end user performs the necessary deletions/alterations; and finally the updated pending notification request is saved in the user service profile.</p>
<p>The IPTV application issue an XCAP GET to the user service profile and display the result to the user.</p>
<p>Upon receipt of a pending notification update request from the OITF, the IPTV application SHALL authorize the request, update its internal state, and subsequently SHALL issue an XCAP PUT to the IPTV service profile to store the updated pending notification requests. The IPTV service profile SHALL acknowledge the successful storage of the updated pending notification requests in an HTTP 200 OK to the IPTV application which in turn returns the response back to the OITF.</p>
</section>
<section id="s5-3-8-2-3"><h5>DAE-based Procedure for Retrieving Pending Notification Requests</h5><p>Upon receipt of a pending notification retrieval request from the OITF, the IPTV application SHALL first authorize the request and subsequently SHALL issue an XCAP request to the IPTV service profile to retrieve all stored pending notification requests for the subject user. Upon receipt by the IPTV application of the stored information, it SHALL return to the OITF in an HTTP 200 OK response the requested information.</p></section>
</section>
<section id="s5-3-8-3"><h4>Protocol over UNIP-1</h4>
<section id="s5-3-8-3-1"><h5>Protocol for Updating Pending Notification Requests</h5><p>If the OITF desires to update pending notification requests stored in the network over UNIP-1, it SHALL send an XCAP GET request to the IPTV service profile. The IPTV service profile SHALL return all stored pending notification requests in an HTTP 200 OK response. Once the user completes the modification process, the OITF SHALL send an XCAP PUT request to the IPTV service profile to update pending notification requests.</p>
<p>If the IPTV service profile detects a change in the pending notification requests, it SHALL inform the IPTV Control FE, which in turn notifies the IPTV Application. The IPTV Control FE SHALL wait for the response before sending an HTTP 200 OK back to the OITF (or an appropriate error message if applicable).</p></section>
<section id="s5-3-8-3-2"><h5>Protocol for Retrieving Stored Pending Notification Requests</h5><p>An OITF that desires to retrieve pending notification requests over UNIP-1, SHALL send an XCAP GET request to the IPTV service profile. The IPTV service profile SHALL return all pending notification requests in an HTTP 200 OK response.</p></section>
</section>
<section id="s5-3-8-4"><h4>Protocol over NPI-2</h4>
<section id="s5-3-8-4-1"><h5>Procedure for Notification Request Setup</h5>
<p>Upon receipt of a store request for user notification from the IPTV Control FE, the IPTV application SHALL validate the request against the appropriate schema.</p>
<p>Upon successful validation, the IPTV application SHALL update its internal state and SHALL store the notification request in the user IPTV profile using XCAP PUT request for that purpose prior to returning a response.</p>
</section>
<section id="s5-3-8-4-2"><h5>Procedure for Updating (Deleting) a Pending Notification</h5>
<p>Upon receipt of an update (delete request) for a pending user notification request from the IPTV Control FE, the IPTV application SHALL validate the request against its internal state and SHALL update its internal state accordingly.</p>
<p>Following that, the IPTV application SHALL acknowledge the update (deletion) or send an appropriate error response if applicable.</p>
</section>
</section>
<section id="s5-3-8-5"><h4>Protocol over NPI-36</h4>
<section id="s5-3-8-5-1"><h5>Incoming Request to the Notification AS for Delivery Notification to an IPTV User</h5>
<p>Upon receipt by the Notification Services AS (MMS Parlay X web services AS) for an HTTP POST request for sending a delivery notification using the IMPagerMode, the Notification Services AS SHALL send a corresponding SIP MESSAGE to the Messaging AS, and SHALL wait for the SIP 200 OK (or other responses) before returning the corresponding HTTP response.</p>
<p>Upon receipt by the IPTV application of the HTTP 200 OK, it SHALL proceed to update its internal state and SHALL update as well the IPTV service profile to reflect the updated list of pending notification requests.</p>
</section>
</section>
<section id="s5-3-8-6"><h4>XML Schema for Notification Request for Broadcast Reminder</h4>
<p>Broadcast reminders related to notification are sent to the end user before a broadcast starts. It typically involves interaction with the EPG.</p>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:iptv:reminder:2011"
  xmlns:tns="urn:oipf:iptv:reminder:2011"
  xmlns:tva="urn:tva:metadata:2011"
  xmlns:xs=http://www.w3.org/2001/XMLSchema
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:import namespace="urn:oipf:base:CommonTypes:2011"
    schemaLocation="base-CommonTypes.xsd" /&gt;
  &lt;xs:import namespace="urn:tva:metadata:2011"
    schemaLocation="imports/tva_metadata_3-1_v171.xsd"/&gt;
  &lt;xs:element name="ReminderList"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="Reminder" type="tns:ReminderType" minOccurs="0"
          maxOccurs="unbounded"/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  &lt;xs:complexType name="ReminderType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="Creator" type="ct:UserIdType"/&gt;
      &lt;xs:element name="Created" type="xs:dateTime"/&gt;
      &lt;xs:choice&gt;
        &lt;xs:element name="ProgramIdentifier" type="ct:ProgramIdType"/&gt;
        &lt;xs:element name="SeriesIdentifier" type="tva:EpisodeOfType"/&gt;
      &lt;/xs:choice&gt;
      &lt;xs:element name="AnnouncementTime" type="xs:duration"/&gt;
    &lt;/xs:sequence&gt;
    &lt;xs:attribute name="id" type="xs:string" use="required"/&gt;
  &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre>

</section>
</section>
<section id="s5-3-9"><h3>Content Bookmarking</h3>
<p>Content bookmarking is a feature that allows a user to store in the network a point in time for a scheduled content or content on demand session where later it can be retrieved and where viewing can resume from that point on.</p>
<p>For a scheduled content session, bookmarking essentially represents a mark in a file stored in the network for the scheduled content. As such, it is a pre-requisite that the scheduled content be stored in the network for any bookmarking to be available for a scheduled content session. The stored bookmarking hence will be a pointer in a file storing the scheduled content.</p>
<section id="s5-3-9-1"><h4>Protocol over HNI-IGI – HTTP Option</h4>
<section id="s5-3-9-1-1"><h5>IMS-based Content Bookmark Creation Request</h5>
<p>The OITF SHALL follow the following procedure for a content bookmark creation request:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>If the OITF decides to store a content bookmark for watched content during a multicast or unicast content streaming session, and if it is permitted by the network to do so, the OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t38" class="tableRef">38</a>
</ul></td></tr>
<tr><td>HTTP Request Body: SHALL include the Content Bookmark based on the XML schema as per section <a href="#s5-3-9-5" class="sectionRef">5.3.9.5</a>, “<a href="#s5-3-9-5" class="sectionTitleRef"></a>”.</td></tr>
</table>
</td></tr>
<tr><td colspan="2">Note that the SIP INFO including the CoD-Bookmark Info Package according to section 12 of [[!PSS-MBMS]] is sent only within the context of a multicast or unicast content streaming session.</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers for the process as per Table <a href="#t38" class="tableRef">38</a>. The IG SHALL send a SIP INFO including the CoD-Bookmark Info Package to the network and SHALL wait for the response to the request. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>On receipt of the response from the network the IG SHALL return a HTTP 200 OK response (or other appropriate received responses) to the OITF to report the response to the INFO request. The response SHALL include a list of SIP headers as per Table <a href="#t39" class="tableRef">39</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>
If the OITF desires to provide the user with the Replay URL, it can optionally initiate the proper procedures for that purpose. This is an option that is available to the OITF.
</section>
<section id="s5-3-9-1-2"><h5>Management of Content Bookmarking Creation Request by the Network</h5>
The OITF SHALL comply with the following when it comes to network management for storing a content bookmark in the network, for either a multicast or unicast content streaming (scheduled content or a CoD):
<table class="sequence">
<tr><td class="label">Step 1:</td><td>At any time, the IG can receive a SIP UPDATE from the network, and where the Recv-Info header is set to remove or re-instate support for reception of CoD-Bookmark Info Package according to section 12 of [[!PSS-MBMS]] to order the OITF to stop or start sending content bookmark creation requests. When a SIP UPDATE is received by the IG, the IG SHALL return an HTTP 200 OK response to the OITF. The response includes a list of SIP headers as per Table <a href="#t40" class="tableRef">40</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 2:</td><td>Once the OITF accepts the incoming SIP UPDATE, it SHALL send an HTTP HNI-IGI PENDING-IG request to acknowledge the receipt of the SIP UPDATE. The content of the HTTP request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t41" class="tableRef">41</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
</table>
</section>
<section id="s5-3-9-1-3"><h5>Content-related bookmark retrieval over HNI-IGI</h5>
<p>The procedure for retrieval of content related bookmarks is similar to the procedure defined in section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>” with the addition that the OITF has indicated its willingness to receive the CoD-Bookmark Info Package according to section 12 of [[!PSS-MBMS]] at session initiation. Assuming that is the case, the following additional steps are added to the existing procedure:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG SHALL wait for the SIP INFO with the Bookmark list from the network. The IG SHALL then return a HTTP 200 OK response to the OITF to report the Bookmark list. The response includes a list of SIP headers as per Table <a href="#t36" class="tableRef">36</a>, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]], and XML (see section <a href="#s5-3-9-5" class="sectionRef">5.3.9.5</a>, “<a href="#s5-3-9-5" class="sectionTitleRef"></a>”) in the SIP INFO body received by the IG , as described in section <a href="#s6-1-2-8-3-1" class="sectionRef">6.1.2.8.3.1</a>, “<a href="#s6-1-2-8-3-1" class="sectionTitleRef"></a>”. The IG then returns a SIP 200 OK to the network.</td></tr>
<tr><td class="label">Step 2:</td><td>Upon receipt of a 200 OK response, the OITF SHALL send an HTTP Pending Request to acknowledge the final response. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t37" class="tableRef">37</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
</table>
<p>After the OITF retrieves the content-related bookmark lists, the OITF displays the bookmark list to the user, and the user selects the bookmark from which she wishes to start viewing the content.</p>

<table id="t36" class="mapping">
<caption>Table ####: Supported HTTP extension headers for an incoming SIP INFO (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line<p>The Request-URI in the SIP INFO request SHALL be the contact included in the INVITE Request message, that is the user ID (IMPU).</p></td><td>RFC 3261 [[!SIP]]<p>INFO &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/3gpp-ims-pss-mbms-bookmark+xml” that corresponds to Annex J of [[!PSS-MBMS]]</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Recv-Info<p>To indicate willingness to receive the CoD-Bookmark Info Package according to section 12 of [[!PSS-MBMS]], it SHALL be set to CoD-Bookmark or add CoD-Bookmark to the capability set;<br/>
or<br/>
To indicate unwillingness, it SHALL be empty or remove CoD-Bookmark</p></td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
</table>


<table id="t37" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response message to an incoming HNI-IGI SIP INFO (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the ACK request SHALL be the contact included in the incoming SIP INFO message</p></td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line” of the INVITE request</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p>The URI parameter SHALL be included, and SHALL match what has been inserted in the INVITE message. The IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
</section>
<section id="s5-3-9-2"><h4>Protocol over UNIS-6 for DAE-based Content Bookmark management</h4>
<p>UNIS-6 MAY be used for the unicast transport of HTML ECMAScript documents between the OITF DAE function and the IPTV Application FE for DAE-based subscription profile management. In this case, the IPTV Application FE acts as a front-end to the IPTV Service Profile FE. When the HTTP request for bookmark management is received from OITF, the IPTV Application FE manipulates the IPTV Service Profile FE.</p>
<section id="s5-3-9-2-1"><h5>DAE-based Content Bookmark Creation Request</h5>
<p>Upon receipt of an HTTP Request for a content bookmark creation request from the OITF, the bookmark IPTV Application SHALL authorize the request and SHALL verify if the bookmark is for scheduled content or CoD.</p>
<p>If the content bookmark is for a scheduled content, the bookmark IPTV application verifies first if the content is available for bookmarking, i.e. stored in the network. If available for bookmarking, the bookmark IPTV application, after performing the necessary adaptation, stores the bookmark information in the IPTV Service Profile using XCAP PUT request for that purpose.</p>
<p>For bookmarks related to CoD, the bookmark information is stored in the user IPTV Service Profile without any additional verification by the IPTV application.</p>
</section>
<section id="s5-3-9-2-2"><h5>DAE-based Bookmark Retrieval Request</h5>
<p>Upon receipt of a content bookmark retrieval request from the OITF, the bookmark IPTV Application SHALL first authorize the request and subsequently SHALL issue an XCAP GET request to the IPTV Service Profile to retrieve all stored content bookmarks for the user.</p></section>
<section id="s5-3-9-2-3"><h5>DAE-based Content Bookmark Update over UNIS-6</h5>
<p>Content Bookmark update is essentially achieved through XML re-writing of the content bookmarks in the IPTV user Service Profile. It includes three steps; first all the content bookmarks are retrieved from the IPTV Service Profile; next the end user performs locally the necessary update (deletions/alterations); and finally the updated content bookmark is saved in the IPTV Service Profile.</p>
<p>The bookmark IPTV Application SHALL authorize the request and subsequently SHALL issue an XCAP GET to the IPTV Service Profile and display the results to the user.</p>
<p>Upon receipt of a content bookmark request from the OITF, the bookmark IPTV Application SHALL authorize the request and subsequently SHALL issue an XCAP PUT to the IPTV Service Profile to store the updated content bookmarks. The IPTV Service Profile SHALL acknowledge the successful storage of the updated content bookmarks in an HTTP 200 OK to the bookmark IPTV application which in turn returns the response back to the OITF.</p>
<p>Note that XCAP supports several approaches for retrieving/storing bookmark information within the user profile. It is an implementation issue as to which approach the IPTV application implements.</p>
</section>
</section>
<section id="s5-3-9-3"><h4>Protocol over NPI-2</h4>
<section id="s5-3-9-3-1"><h5>Protocol for Storing Content Bookmarks</h5>
<p>Upon receipt of a bookmark store request from the IPTV Control FE, the bookmark IPTV Application SHALL verify if the bookmark is for scheduled content or CoD.</p>
<p>If the content bookmark is for a scheduled content, the bookmark IPTV Application verifies first if the content is available for bookmarking, i.e. stored in the network. If available for bookmarking, the bookmark IPTV Application, after performing the necessary adaptation, stores the content bookmark information in the user IPTV Service Profile using XCAP PUT request for that purpose.</p>
<p>For bookmarks related to CoD, the content bookmark information is stored in the user IPTV Service Profile without any additional verification by the bookmark IPTV Application.</p>
<p>Following the completion of the XCAP transaction, a response is sent to the IPTV control server FE.</p>
</section>
</section>
<section id="s5-3-9-4"><h4>Protocol over UNIP-1</h4>
<section id="s5-3-9-4-1"><h5>Protocol for Retrieving Stored Content Bookmarks</h5>
<p>If the OITF desirers to retrieve content bookmarks stored in the network over UNIP-1, it SHALL send an XCAP GET request to the IPTV Service Profile. The IPTV Service Profile SHALL return all stored bookmarks in an HTTP 200 OK response.</p>
</section>
<section id="s5-3-9-4-2"><h5>Protocol for Updating Content Bookmarks</h5>
<p>If the OITF desirers to update a content bookmark(s) stored in the network over UNIP-1, it SHALL send an XCAP GET request to the IPTV Service Profile. The IPTV Service Profile SHALL return all stored bookmarks in an HTTP 200 OK response. Once the user completes the update process, the OITF SHALL send an XCAP PUT request to the IPTV Service Profile to update the content bookmarks. The IPTV Service Profile SHALL acknowledge the successful storage of the updated content bookmarks in an HTTP 200 OK response.</p>
<table id="t38" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the HNI-IGI SIP INFO Request message for Content Bookmark (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the INFO request SHALL be the well-known PSI (Public Service Identifier) of the bookmarked content service.</p><p>For a Scheduled Service: OIPF_IPTV_SC_Service@&lt;domain name&gt;.</p>
<p>For a Content on Demand: OIPF_IPTV_CoD_Service_*@&lt;domain name&gt;.</p></td><td>RFC 3261 [[!SIP]]<p>INFO &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p>The URI parameter MUST be included, and MUST match what is returned in the Contact header included in the response to the registration process.</p><p>The IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Info-Package<p>SHALL be set to CoD-Bookmark according to section 12 of [[!PSS-MBMS]].</p></td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/3gpp-ims-pss-mbms-bookmark+xml” that corresponds to Annex J of [[!PSS-MBMS]]</p></td><td>RFC 6086 [[!INFO-PKG]], section <a href="#s5-3-9-5" class="sectionRef">5.3.9.5</a>, “<a href="#s5-3-9-5" class="sectionTitleRef"></a>”</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Disposition</td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
</table>

<table id="t39" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response message to an HNI-IGI INFO request message for Content Bookmark (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t40" class="mapping">
<caption>Table ####: List of HTTP extension headers for an incoming SIP UPDATE (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the INVITE MUST match the contact URI included in the contact filed of the SIP INVITE</p></td><td>RFC 3261 [[!SIP]]<p>UPDATE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Recv-Info<p>To indicate willingness to receive the CoD-Bookmark Info Package according to section 12 of [[!PSS-MBMS]], it SHALL be set to CoD-Bookmark or add CoD-Bookmark to the capability set;<br />
or<br />
To indicate unwillingness, it SHALL be empty or remove CoD-Bookmark</p></td><td>RFC 6086 [[!INFO-PKG]]</td></tr>
</table>

<table id="t41" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response message to an incoming HNI-IGI SIP UPDATE Request Message (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

</section>
</section>
<section id="s5-3-9-5"><h4>XML Schema for Content Bookmarking</h4>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:iptv:bookmark:2011"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:tns="urn:oipf:iptv:bookmark:2011"
  xmlns:bmk3gpp="urn:3gpp:bookmark:2009:IMS-PSS-MBMS"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:import namespace="urn:3gpp:bookmark:2009:IMS-PSS-MBMS"
    schemaLocation="imports/3gpp-bookmark-2009-IMS-PSS-MBMS.xsd"/&gt;
  &lt;xs:complexType name="BookmarkType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="bmk3gpp:BookmarkType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="Location" type="xs:string" minOccurs="0"/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre>
<p>The following elements SHALL be provisioned by the entity submitting the content bookmark for storage:</p><ul>
<li>Creator. This element is set to the IMS Public Identity (IMPU).
<li>Created.
<li>Comment. This element represents any comment chosen by the user.
<li>Tag. This element represents any categorization chosen by the user.
<li>Rank. This element represents the user favourite rating for the bookmark.
<li>Sharing. If set to “true”, the bookmark can be shared with others.
<li>Retrieval count SHALL be set to 0 and incremented by the service provider when the bookmark is retrieved.</ul>
<p>The following elements and attributes SHALL be provisioned by the service provider before storing the content bookmark in the user service profile:</p><ul>
<li>Expires
<li>id</ul>
<p>The following elements SHALL be conditionally provisioned by the OITF or the service provider as described below:</p><ul>
<li>ProgramId and ProgramType. This reflects the identifier of the content being bookmarked. This information is typically submitted by the OITF.<ul>
<li>For scheduled content, the CRID for the program currently being watched SHALL be included in this ProgramId element and the ProgramType element SHALL be set to “SC”;
<li>for content on demand the CRID for the content SHALL be included in the ProgramId element and the ProgramType element SHALL be set to “CoD”.</ul>
The network SHALL verify provisioned information in case of scheduled content and content on demand, and SHALL ensure that the information provided is accurate. If the provisioned information is inaccurate or missing, it SHALL be corrected/completed respectively by the network, where applicable. Furthermore, for scheduled content, the network SHALL ensure that the program is stored in the network before the request is accepted.
<li>Location. This item includes the bookmark URL. The URL SHALL allow the user to stream the content at a later time from the bookmarked position. The information SHALL be created by the network, and included in the element before storing the information in the IPTV Service Profile
<li>Offset. This element includes the bookmark position in the form of an offset from the beginning of the stream.<ul>
<li>For content on demand, the Offset SHALL be included by the OITF and SHALL be verified before storage, if possible.
<li>For scheduled content, the OITF SHALL set the Offset to PT0S. The network SHALL first ensure that the content is recorded in the network. The network SHALL consult with the EPG and the time of the incoming request to calculate the Offset prior to storage in the network. The calculated stored Offset SHALL take into account the network storage aspects into consideration to ensure accurate mapping when streaming is later activated through the bookmark URL.</ul>
<li>Retrieval Time SHALL be updated with a new entry every time the content bookmark is retrieved (note that retrieval does not imply the content bookmark is used)</ul>

</section>
</section>
<section id="s5-3-10"><h3>Local PVR Service using SIP</h3>
<section id="s5-3-10-1"><h4>Local PVR Service using SIP</h4>
<p>The OITF initiates the request for PVR Service Capture Request using the following procedure:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t42" class="tableRef">42</a>
</ul></td></tr>
<tr><td>HTTP Request Body: The OITF SHALL include a body associated with the appid “urn:oipf:service:PVR:2011”.<ul>
<li>The message body SHALL include the parameters related to ctCaptureRequest Type choice setup as follows.<ul>
<li>RequestType: indicates type of service request (i.e. SetUpRecording, CancelRecording, UpdateRecording, RetrievalRecording.)
<li>ProgramId: identifies the content or program to be recorded in the OITF
<li>BCServiceId: identifies scheduled content channel from which the program is to be recorded in the OITF
<li>ProgramStartTime: indicates the time to start the recording that the OITF requests
<li>ProgramDuration: indicates the time duration of the recording that the OITF requests
<li>StorageRecMode: indicates the location where requested content will be recorded (i.e. Local, Network). In case of Local PVR service, the StorageRecMode SHALL be “Local”.
<li>TargetDeviceID: identifies the target Local PVR (OITF) whom contents are recorded at. This parameter SHALL be shown as syntax of sip.instance feature tag or GRUU
</ul></ul></td></tr>
</table>
</td></tr>
<tr><td colspan="2"><p>According to the RequestType, the OITF SHALL initiate a request for recording order setup, recording order cancel, recording order update, recording order retrieval.</p>
<p>The Content-Type of the message body SHALL be set to “application/vnd.oipf.pvr+xml” as described in Table <a href="#t42" class="tableRef">42</a> for X-OITF-Content-Type header.</p></td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers for the process as per Table <a href="#t42" class="tableRef">42</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP MESSAGE to the network to initiate LPVR as requested by the OITF, and SHALL wait for the response to the request. The IG SHALL return HTTP 200 OK response (or other appropriate response) to the OITF to report the response to the PVR Service Capture Request. The response SHALL include a list of SIP header as per Table <a href="#t43" class="tableRef">43</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>The OITF SHALL send an HTTP HNI-IGI PENDING_IG request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionTitleRef"></a>”) and SHALL wait for any response.</td></tr>
<tr><td class="label">Step 5:</td><td>When a SIP MESSAGE is received by the IG, the IG SHALL return an HTTP 200 OK response to the OITF. The response SHALL include the list of SIP header as per Table <a href="#t45" class="tableRef">45</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]]. The body of the HTTP response SHALL include the SIP body received in the incoming MESSAGE message. The content of the HTTP Response SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t45" class="tableRef">45</a>
</ul></td></tr>
<tr><td>HTTP Request Body: The OITF SHALL include a body associated with the appid “urn:oipf:service:PVR:2011”.<ul>
<li>The message body SHALL include the parameters related to ctLPVRRecordRequest Type choice setup as follows.<ul>
<li>RequestType: indicates type of service request (i.e. SetUpRecording, CancelRecording, UpdateRecording, RetrievalRecording.)
<li>ProgramId: identifies the content or program to be recorded in the OITF
<li>BCServiceId: identifies scheduled content channel from which the program is to be recorded in the OITF
<li>ProgramStartTime: indicates the time to start the recording that the OITF requests
<li>ProgramDuration: indicates the time duration of the recording that the OITF requests
<li>StorageRequirement: indicates the REQUIRED storage of Local PVR for recording requested content.
</ul></ul></td></tr>
</table>
</td></tr>
<tr><td colspan="2"><p>Note that at any time, the IG can receive such a message from the network to perform a new request type on a pending recording request (e.g., recording order cancel, recording order update).</p>
<p>The Content-Type of the message body SHALL be set to “application/vnd.oipf.pvr+xml” as described in Table <a href="#t42" class="tableRef">42</a> for X-OITF-Content-Type header.</p></td></tr>
<tr><td class="label">Step 6:</td><td>Once the OITF accepts the incoming request, the OITF SHALL send an HTTP POST request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionTitleRef"></a>”) to the IG to convey the SIP response. The HTTP request SHALL include the SIP headers as per Table <a href="#t43" class="tableRef">43</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 7:</td><td>When time to order recording of a requested content is up, the OITF SHALL initiate the multicast content streaming session setup. The OITF SHALL follow the steps defined by section <a href="#s5-3-1-1-1" class="sectionRef">5.3.1.1.1</a>, “<a href="#s5-3-1-1-1" class="sectionTitleRef"></a>.”</td></tr>
</table>

<table id="t42" class="mapping">
<caption>Table ####: List of HTTP extension headers for PVR Service Capture Request Message (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the well-known PSI for the PVR Service.</p></td><td>RFC 3261 [[!SIP]]<p>MESSAGE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.pvr+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Contact<p>The URI parameter and the sip.instance feature tag MUST be included and MUST match what is sent in the contact header included in the registration request.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t43" class="mapping">
<caption>Table ####: List of HTTP extension headers for the response to PVR Service Capture Request and PVR Record Request Message (IG&rarr;OITF and OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t44" class="mapping">
<caption>Table ####: List of HTTP extension headers for the PVR Record Request (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the Public identity of the target of the message</p></td><td>RFC 3261 [[!SIP]]<p>MESSAGE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.pvr+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept-Content</td><td>Set to the SIP Instance of the TargetDevice<p>This parameter includes REQUIRED and explicated as RFC 3841 [[!RFC3841]]</p></td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

</section>
<section id="s5-3-10-2"><h4>XML Schema for PVR Service</h4>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:service:PVR:2011"
  xmlns:tns="urn:oipf:service:PVR:2011"
  xmlns:ct="urn:oipf:base:CommonTypes:2011"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:ueprofile="urn:oipf:iptv:UEProfile:2010"
  xmlns:iptvprofile="urn:oipf:iptv:IPTVProfile:2011"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:import namespace="urn:oipf:base:CommonTypes:2011"
    schemaLocation="base-CommonTypes.xsd" /&gt;
  &lt;xs:import namespace="urn:oipf:iptv:UEProfile:2010"
    schemaLocation="iptv-UEProfile.xsd"/&gt;
  &lt;xs:import namespace="urn:oipf:iptv:IPTVProfile:2011"
    schemaLocation="iptv-IPTVProfile.xsd"/&gt;
  &lt;xs:element name="PVR"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="ServiceType" type="tns:ctServiceType"/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  &lt;xs:complexType name="ctServiceType"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element name="CaptureRequest" type="tns:ctCaptureRequest"
        maxOccurs="unbounded"/&gt;
      &lt;xs:element name="LPVRRecordRequest" type="tns:ctLPVRRecordRequest"
        maxOccurs="unbounded"/&gt;
      &lt;xs:element name="NPVRRecordRequest" type="tns:ctNPVRRecordRequest"
        maxOccurs="unbounded"/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="ctCaptureRequest"&gt;&lt;!-LPVR Capture request/response--&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="RequestType" type="tns:stRequestType"/&gt;
      &lt;xs:element name="ProgramID" type="ct:ProgramIdType"/&gt;
      &lt;xs:element name="BCServiceID" type="iptvprofile:tBCServiceID"/&gt;
      &lt;xs:element name="ProgramStartTime" type="xs:dateTime"/&gt;
      &lt;xs:element name="ProgramDuration" type="xs:duration"/&gt;
      &lt;xs:element name="StorageRecMode" type="tns:stStorageRecMode"/&gt;
      &lt;xs:element name="TargetDeviceID" type="ueprofile:tUEID"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="ctLPVRRecordRequest"&gt;&lt;!-LPVR Record request/response--&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="RequestType" type="tns:stRequestType"/&gt;
      &lt;xs:element name="ProgramID" type="ct:ProgramIdType"/&gt;
      &lt;xs:element name="BCServiceID" type="iptvprofile:tBCServiceID"/&gt;
      &lt;xs:element name="ProgramStartTime" type="xs:dateTime"/&gt;
      &lt;xs:element name="ProgramDuration" type="xs:duration"/&gt;
      &lt;xs:element name="StorageRequirement" type="tns:ctStorageRequirement"
        minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="ctNPVRRecordRequest"&gt;&lt;!-NPVR Record request/response--&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="RequestType" type="tns:stRequestType"/&gt;
      &lt;xs:element name="ProgramID" type="ct:ProgramIdType"/&gt;
      &lt;xs:element name="BCServiceID" type="iptvprofile:tBCServiceID"/&gt;
      &lt;xs:element name="ProgramStartTime" type="xs:dateTime"/&gt;
      &lt;xs:element name="ProgramDuration" type="xs:duration"/&gt;
      &lt;xs:element name="StorageRequirement" type="tns:ctStorageRequirement"
        minOccurs="0"/&gt;
      &lt;xs:element name="RequestStatus" type="tns:tRequestStatus" minOccurs="0"/&gt;
      &lt;xs:element name="CRID" type="xs:string" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="stRequestType"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="SetUp"/&gt;
      &lt;xs:enumeration value="Cancel"/&gt;
      &lt;xs:enumeration value="Update"/&gt;
      &lt;xs:enumeration value="Retrieval"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:simpleType name="stStorageRecMode"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="Local"/&gt;
      &lt;xs:enumeration value="Network"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:complexType name="ctStorageRequirement"&gt;
    &lt;xs:simpleContent&gt;
      &lt;xs:extension base="xs:int"&gt;
        &lt;xs:attribute name="unit" type="xs:string" use="optional" default="KB"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="tRequestStatus"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="Recording Scheduled"/&gt;
      &lt;xs:enumeration value="Recording Started"/&gt;
      &lt;xs:enumeration value="Recording Completed"/&gt;
      &lt;xs:enumeration value="Recording Deleted"/&gt;
      &lt;xs:enumeration value="Recording Failed"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;
</pre>
</section>
</section>
<section id="s5-3-11"><h3>Network PVR (nPVR) using SIP</h3>
<section id="s5-3-11-1"><h4>Protocol over HNI-IGI – HTTP Option</h4>
<p>When the OITF initiates the request for network PVR Service Request, the procedure defined in section <a href="#s5-3-10" class="sectionRef">5.3.10</a>, “<a href="#s5-3-10" class="sectionTitleRef"></a>” SHALL apply, with following additional constraints:</p><ul>
<li>In step 1, the HTTP Request Body SHALL be set so that in the PVR request message ctNPVRRecordRequest SHALL be the selected choice and SHALL be set as follows:<ul>
<li>RequestType: indicates type of service request
<li>ProgramId: identifies the content or program to be recorded in the OITF
<li>BCServiceId: Identifies the scheduled content channel from which the program is to be recorded in the OITF
<li>ProgramStartTime: indicates the time to start the recording that the OITF requests
<li>ProgramDuration: indicates the time duration of the recording that the OITF requests
<li>StorageRecMode: SHALL be set to “Network”;</ul>
<li>Steps 5-6 are replaced by the following steps:
<table class="sequence">
<tr><td class="label">Step 5:</td><td>When a SIP MESSAGE is received by the IG due to the failure of a submitted request or to report the outcome of a pending recording request, the IG SHALL return an HTTP 200 OK response to the OITF. The response SHALL include the list of SIP headers as per Table <a href="#t45" class="tableRef">45</a>. The body of the HTTP response SHALL include the SIP body received in the incoming SIP MESSAGE. The content of the HTTP Response SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t45" class="tableRef">45</a>
</ul></td></tr>
<tr><td>HTTP Response Body: The actual content included in the SIP MESSAGE body.</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 6:</td><td>The OITF SHALL extract the pertinent information from the body and SHALL send a SIP 200 OK response to the network in an HTTP POST request</td></tr>
</table>
</ul>

<table id="t45" class="mapping">
<caption>Table ####: List of HTTP extension headers for the PVR Record Request (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the Public identity of the target of the message</p></td><td>RFC 3261 [[!SIP]]<p>MESSAGE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.pvrresult+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

</section>
<section id="s5-3-11-2"><h4>XML schema for nPVR recording result</h4>
This section specifies the XML schema of the record status report which the CDF send to the Cluster Controller FE.
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:service:PVR:report:2010"
  xmlns:tns="urn:oipf:service:PVR:report:2010"
  xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:tva="urn:tva:metadata:2011"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:import namespace="urn:tva:metadata:2011" schemaLocation="imports/tva_metadata_3-1_v171.xsd"/&gt;
  &lt;xs:element name="PVRResult"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="RecordResult" type="tns:tRecordingResult"/&gt;
        &lt;xs:element name="NPVRLocation" type="tns:tNPVRLocator"/&gt;
        &lt;xs:element name="SpareStorage" type="xs:double"/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  &lt;xs:complexType name="tRecordingResult"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="RecordingStatus" type="tns:tRecordStatus"/&gt;
    &lt;/xs:sequence&gt;
    &lt;xs:attribute name="ErrorCode" type="xs:string" use="optional"/&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="tRecordStatus"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="Completed"/&gt;
      &lt;xs:enumeration value="Partial"/&gt;
      &lt;xs:enumeration value="Error"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:complexType name="tNPVRLocator"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element name="CRID" type="tva:CRIDType"/&gt;
      &lt;xs:element name="URL" type="xs:anyURI"/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre>
<p>If recording is successful, the ErrorCode element attribute SHALL NOT be present. If recording failed (i.e., RecordResult element contains “Error”), any information in the NPVRLocator element SHALL be discarded by the OITF.</p>
</section>
</section>
<section id="s5-3-12"><h3>Personalized Channel</h3>

<section id="s5-3-12-1"><h4>Procedure for Network-centric Personalized Channel (unicast only)</h4>
<p>These procedures assume that the Personalised Channel content will be served by a single CDF, regardless of where the content is sourced.</p>
<section id="s5-3-12-1-1"><h5>PCh profile configuration</h5>
<p>When the user wants to create a new Personalised Channel, the OITF of the user SHALL originate an HTTP GET request towards the IPTV Application via UNIS-6 reference point. The request SHALL carry the user ID.</p>
<p>When receiving the HTTP GET request for PCh configuration, the IPTV Application SHALL authorize and verify the request, and then send XCAP GET request to the IPTV Service Profile and retrieve the user’s IPTV service profile. The XCAP GET request SHALL be delivered on NPI-17 and include the intended user ID.</p>
<p>After the request is authorized, the IPTV Application SHALL contact the IPTV Metadata Control via NPI-33 for searching and filtering of the content metadata, and generate the personalised content guide based on the user’s personal setting (e.g. preference, location etc). The IPTV Application SHALL also create a valid Personalised Channel Identifier (PChId) for the generated PCh information.</p>
<p>The IPTV Application then responds 200 OK to the OITF via UNIS-6, carrying the generated PChId and associated PCh information, e.g., PCh item IDs (SC service ID or COD content ID), related time schedule, etc.</p>
<p>If the OITF desires to modify the PCh information that has been created, it SHALL send an HTTP PUT request through UNIS-6 to the IPTV Application, carrying the intended user ID and the PCh information for updating. The IPTV Application SHALL updates the PCh information towards the IPTV Service Profile FE through XCAP PUT over NPI-17, and then responds the OITF with a 200 OK.</p>
</section>
<section id="s5-3-12-1-2"><h5>PCh service provision</h5>
<section id="s5-3-12-1-2-1"><h6>PCh session initiation over HNI-IGI</h6>
When the user wants to watch the programs scheduled in their PCh, the OITF of the user SHALL originate a request for PCh Service Set-up. The procedure is similar to the procedure described in section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”, with the exception that the X-OITF-Request-Line extension header delivered over HNI-IGI (Table <a href="#t16" class="tableRef">16</a>) SHALL include the Personalised Channel identifier (PChId), e.g. IPTV_PCH_Service_PChId@&lt;domain name&gt;, where:<ul>
<li>The Personalised Channel identifier (PChId) is retrieved from the IPTV Application in the PCh configuration procedure, section <a href="#s5-3-12-1-1" class="sectionRef">5.3.12.1.1</a>, “<a href="#s5-3-12-1-1" class="sectionTitleRef"></a>.”
<li>The domain part (&lt;domain name&gt;) is the IPTV Service Provider domain name, obtained from the IPTV Service Provider discovery function.</ul>
</section>
<section id="s5-3-12-1-2-2"><h6>PCh session termination over HNI-IGI</h6>
The OITF SHALL send the request for a Personalised Channel session termination using the procedure as described in section <a href="#s5-3-2-1-3" class="sectionRef">5.3.2.1.3</a>, “<a href="#s5-3-2-1-3" class="sectionTitleRef"></a>”.
</section>

</section>
</section>
<section id="s5-3-12-2"><h4>OITF-centric Personalised Channel</h4>
<p>When the user wants to create a new Personalised Channel, the user’s OITF MAY originate an HTTP GET request towards the IPTV Application via the UNIS-6 reference point. The request SHALL carry the user ID.</p>
<p>When receiving the HTTP GET request for PCh configuration, the IPTV Application SHALL authorize and verify the request, and then send an XCAP GET request to the IPTV Service Profile and retrieve the user’s IPTV service profile. The XCAP GET request SHALL be delivered on the NPI-17 interface and includes the intended user ID.</p>
<p>The IPTV Application then responds with a 200 OK message to the OITF via UNIS-6, carrying the user profile which can be used for generating the Personalised Channel Guide at the OITF.</p>
<p>The OITF SHOULD ensure that the Personalized Channel does not include a time gap. When the OITF detects a time gap between adjacent content items in the PCh schedule, it determines if the length of the time gap is longer than a specified threshold (e.g. user defined), and MAY insert padding content into the time gap.</p>
<p>The padding content can be obtained from a PCh compatible source, e.g. PVR or other Home Network device as shown in the Figure 30 of [[.OIPF_PROT_EX2]].</p>
<p>When the OITF detects an overlap between adjacent content items in the PCh schedule, the OITF decides the location of the PVR (LPVR or nPVR) used to record the overlapped contents based on either a pre-configured policy or the capability of OITF or network (ex, storage, bandwidth, etc).</p>
<p>The messaging and procedures for recording the overlapped content item on an LPVR SHALL be as specified in section <a href="#s5-3-10" class="sectionRef">5.3.10</a>, “<a href="#s5-3-10" class="sectionTitleRef"></a>.”</p>
<p>The messaging and procedures for recording the overlapped content item on an nPVR SHALL be as specified in section <a href="#s5-3-11" class="sectionRef">5.3.11</a>, “<a href="#s5-3-11" class="sectionTitleRef"></a>”.</p>
<p>After the overlapped content item has finished recording and the time gap has been filled, the OITF SHOULD update the Personalised Channel Guide with the revised content access information.</p>
<p>The OITF sets up the proper session for content delivery or plays the locally stored content according to the already configured Personalized Channel Guide.</p>
</section>
</section>
<section id="s5-3-13"><h3>Session Transfer with SIP session management</h3>
<section id="s5-3-13-1"><h4>Protocol over HNI-IGI – HTTP Option</h4>
<section id="s5-3-13-1-1"><h5>Generic Session Transfer Procedures</h5>
<p>The procedures in this section are generic in nature and apply equally to the various modes of session transfer.</p>
<section id="s5-3-13-1-1-1"><h6>Transferee unicast session streaming Session Initiation associated with a session Transfer</h6>
<p>For all session transfer modes, it is assumed that the transferee initiates the session associated with a transfer. As a pre-requisite before session initiation, it is assumed that the transferee has accepted a request for a session transfer, and/or has the necessary information to initiate a new session to handle the transferred session.</p>
<p>A transferee SHALL initiate the request for a unicast content streaming session to setup the content delivery channel and content control channel using the procedure defined in section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”, with the following exceptions in Table <a href="#t16" class="tableRef">16</a>:</p><ul>
<li>A new SIP header X-OITF-Replace header is included and is set to the appropriate information depending on the deployed mode. For the push mode, the information is retrieved from the incoming REFER request to the transferee as per section <a href="#s5-3-13-1-2-3" class="sectionRef">5.3.13.1.2.3</a>, “<a href="#s5-3-13-1-2-3" class="sectionTitleRef"></a>”.
<li>In the X-OITF Request Line, the wild card part (*) representing the content instance identifier to be transferred is constructed a different way than specified in the table. In the push mode, this field is extracted from the To header embedded in the Refer-To header in the incoming REFER request as per section <a href="#s5-3-13-1-2-3" class="sectionRef">5.3.13.1.2.3</a>, “<a href="#s5-3-13-1-2-3" class="sectionTitleRef"></a>”.</ul>
<p>Furthermore, the IG handling in step 2 in section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>” is replaced by the IG handling as depicted in section <a href="#s5-3-13-1-1-2" class="sectionRef">5.3.13.1.1.2</a>, “<a href="#s5-3-13-1-1-2" class="sectionTitleRef"></a>”.</p>
<p>The remaining steps in section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>” apply.</p>
</section>
<section id="s5-3-13-1-1-2"><h6>IG handling of Session Initiation Requests related to a session transfer</h6>
<p>If the transferor OITF and the transferee OITF are behind the same IG, and given the fact that the transferee MUST successfully establish the new session before the old session can be torn down, QoS resources, over the last mile, will be doubly booked while the transfer is ongoing.</p>
<p>Indeed, the new session initiated by the transferee to handle the transferred session MAY not be able to successfully complete due to resources (last mile) unavailability as a result of the old session holding on to the resources, while not being utilized, during the transfer.</p>
<p>In order to avoid this situation, special processing is REQUIRED in the IG to release the resources associated with the transferred session while the new session is being established, if both the transferor and the transferee are behind the same IG, hence sharing the same last mile.</p>
<p>If for any reason the transfer failed, the IG can reclaim the released resources associated with the transferred session back and the old session can resume.</p>
<p>To that effect, and upon receipt by the IG for an HTTP POST for a SIP INVITE the IG SHALL perform the following procedure:</p><ul>
<li>If the session is a content session associated with a session transfer and the SIP header X-OITF-Replace header is not included then the procedure terminates.
<li>If the session is a content session associated with a session transfer and the SIP header X-OITF-Replace header is included and the dialog identifier points to a session whose state is not held the IG, then the transferor and the transferee are not behind the same IG and the procedure terminates.
<li>If the session is a content session associated with a session transfer and the SIP header X-OITF-Replace header is included and the dialog identifier points to a session whose state is held the IG, then the transferor and the transferee OITF are behind the same IG. In this case the IG SHALL perform the following steps:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG SHALL send to the transferor OITF an HTTP 200 OK response. The response SHALL include a SIP re-INVITE as per Table <a href="#t16" class="tableRef">16</a> with the following exceptions:<ul>
<li>The SIP header information is populated appropriately given the re-INVITE is sent from the IG to the OITF.
<li>The HTTP body SHALL be similar to SDP included by the IG in the 200 OK response to the original content session initiation request from the transferor with the port of the m-line representing the content stream being set to zero in this case.</ul></td></tr>
<tr><td class="label">Step 2:</td><td>Once the OITF accepts the incoming SIP re-INVITE after the stream has been successfully paused (the transferor OITF could have already paused the stream or it would pause the stream before accepting the re-INVITE), it SHALL send an HTTP POST PENDING_IG request to the IG. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: It includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t17" class="tableRef">17</a> (notice the direction in this case is from OITF&rarr;IG)
</ul></td></tr>
<tr><td>HTTP Response Body: The actual content included in the SIP MESSAGE body.</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send to the transferor OITF an HTTP 200 OK response. The response SHALL include a SIP ACK as per Table <a href="#t14" class="tableRef">14</a> with the following exception:<ul>
<li>The SIP header information is populated appropriately given the ACK is sent from the IG to the OITF</ul></td></tr>
<tr><td class="label">Step 4:</td><td>The IG SHALL send a SIP UPDATE (or SIP re-INVITE) to the network, to request the transferor stream to be put on hold and to reduce the requested QoS resources on the transferor OITF last mile down to zero. The SIP UPDATE (or SIP re-INVITE) SHALL conform to [[!TS124503]] in that regard. The body of the SIP UPDATE (or SIP re-INVITE) SHALL be identical to the SDP in the INVITE of the content session initiation with the exception described above. The IG SHALL wait for the response to the request.</td></tr>
<tr><td class="label">Step 5:</td><td>Upon receipt of a SIP 200 OK response or any other response, the procedure terminates</td></tr>
</table>
</ul>
</section>
</section>
<section id="s5-3-13-1-2"><h5>Session Transfer via Push Mode</h5>
<section id="s5-3-13-1-2-1"><h6>OITF Target Discovery</h6>
An OITF that wants to locate a target OITF for session transfer purposes SHALL perform the procedures described in section <a href="#s5-4-6-1-4" class="sectionRef">5.4.6.1.4</a>, “<a href="#s5-4-6-1-4" class="sectionTitleRef"></a>”.
Subsequently a target OITF can be selected from the returned information.
</section>
<section id="s5-3-13-1-2-2"><h6>Transferor OITF Initiating a Session Transfer Request - Push Mode</h6>
<p>To initiate a session transfer request, the transferor OITF SHALL follow the following procedure:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>As a pre-requisite it is assumed that the user is watching a unicast content streaming service and has selected a target device (transferee OITF) for the session.<p>In this step the transferor OITF SHALL bookmark the content as per section <a href="#s5-3-9-1-1" class="sectionRef">5.3.9.1.1</a>, “<a href="#s5-3-9-1-1" class="sectionTitleRef"></a>”. The bookmark SHALL be included in the body of the SIP REFER (as shown in step 2)</p></td></tr>
<tr><td class="label">Step 2:</td><td>The transferor OITF SHALL send an HTTP POST request for the session transfer to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - see Table <a href="#t46" class="tableRef">46</a>
</ul></td></tr>
<tr><td>HTTP Response Body: As per section <a href="#s5-3-13-2" class="sectionRef">5.3.13.2</a>, “<a href="#s5-3-13-2" class="sectionTitleRef"></a>”.</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers as per Table <a href="#t46" class="tableRef">46</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 4:</td><td>The IG SHALL send a SIP REFER to the network, to setup the request and SHALL wait for the response. At some point in time, the IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the transferor OITF to report the received response from the transferee to the transfer request. The response SHALL include a list of SIP headers as per Table <a href="#t47" class="tableRef">47</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 5:</td><td>Following that, the transferor OITF SHALL send an HTTP HNI-IGI PENDING_IG request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionTitleRef"></a>”), and SHALL wait for any response reporting the outcome of the session transfer procedure.</td></tr>
<tr><td class="label">Step 6:</td><td>At some point in time, the IG SHALL receive an incoming SIP NOTIFY from the transferee OITF, reporting the outcome of the session transfer and which it SHALL forward to the transferor OITF in an HTTP 200 OK response. The HTTP response SHALL include the list of SIP headers as per Table <a href="#t48" class="tableRef">48</a> in addition to the normal HTTP headers. The body of the HTTP response SHALL include the SDP body received in the NOTIFY.</td></tr>
<tr><td class="label">Step 7:</td><td>The transferor OITF SHALL return the SIP 200 OK response, acknowledging the SIP NOTIFY, to the IG, in an HTTP POST PENDING_IG request. The content of the HTTP request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - see Table <a href="#t49" class="tableRef">49</a>
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
</table>

<table id="t46" class="mapping">
<caption>Table ####: List of HTTP extension headers for an outgoing SIP REFER from the transferor for initiating up a session transfer request (OITF&rarr;IG) and incoming SIP REFER request to the transferee (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI SHALL be set to the transferee (target device OITF) contact information received during the device discovery process.</p></td><td>RFC 3261 [[!SIP]]<p>REFER &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Refer-To<p>SHALL be set to the remote target URI included in the contact header field returned in the SIP 200 OK associated with initial session setup with the transferor and extended with the following URI headers fields:</p><ul>
<li>Replaces header field SHALL include the SIP dialog identifier for the original unicast content streaming session as per [[!RFC3891]]
<li>Require header field populated with the option tag value ”replaces”
<li>To header field SHALL contain the original content identifier copied from the Request URI of the original SIP INVITE request initiated from the transferor.
<li>OPTIONALLY an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag set to the IPTV Communication service identifier "urn%3Aurn-7%3A3gpp-service.ims.icsi.iptv"
<li>P-preferred-Service set to IPTV Communication service Identifier urn:urn-7:3gpp-service.ims.icsi.iptv
<li>Body header. Contains the SDP body to be included in the SIP request initiated from the transferor. OITF. The SDP body SHALL contain the same number of media lines as the SDP used in the original session from the transferor OITF. Each media line SHALL indicate the same media type as its corresponding media component in the SDP used in the original session by the transferor OIPF. The media line for the media to be transferred SHALL include a port number with non zero value.
</ul>
Example: <br />
Refer-To: <br /> &lt;sip:remoteuser@home2.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-333333333333?Replaces=AB03a0s09a2sdfglkj490333%3Bremote-tag=Afgsdfg45%3Blocal-tag=U188gg&amp;Require=replace&amp;P-Preferred-Service=urn:urn-7:3gpp-service.ims.icsi.iptv&amp;Accept-Contact=*%3b+g.3gpp.icsi-ref%3d%22urn%253Aurn-7%253gpp-service.ims.icsi.iptv%22
</td><td>RFC 3261 [[!SIP]]<p>[[!SRVCONT]]</p><p>RFC 3891 [[!RFC3891]]</p></td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.session-transfer+xml” corresponding to section <a href="#s5-3-13-2" class="sectionRef">5.3.13.2</a>, “<a href="#s5-3-13-2" class="sectionTitleRef"></a>”</p></td><td></td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>


<table id="t47" class="mapping">
<caption>Table ####: List of HTTP extension headers for the response to an outgoing SIP REFER from the transferor for setting up a session transfer request (IG&rarr;OITF) and the response sent to an incoming SIP REFER to the transferee (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-3-13-1-2-3"><h6>Transferee OITF Receiving an Incoming Session Transfer Request – Push Mode</h6></section>
<p>The procedure at an OITF selected to be the target device (transferee OITF) in a push mode is as follows</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>It is assumed that the OITF has an HTTP PENDING_IG request. At some point in time, when a REFER request targeted for the transferee OITF is received by the IG, the IG SHALL return a HTTP 200 OK response to the OITF. The response SHALL include the list of SIP headers as per Table <a href="#t46" class="tableRef">46</a>, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]]. The body of the HTTP response SHALL include the XML structure as per section <a href="#s5-3-13-2" class="sectionRef">5.3.13.2</a>, “<a href="#s5-3-13-2" class="sectionTitleRef"></a>”.</td></tr>
<tr><td class="label">Step 2:</td><td>The OITF SHALL examine the incoming REFER request. In particular, the OITF SHALL extract the body header to use it to later construct its own SDP for the session transfer (see section <a href="#s5-3-13-1-1-1" class="sectionRef">5.3.13.1.1.1</a>, “<a href="#s5-3-13-1-1-1" class="sectionTitleRef"></a>”). If the OITF cannot successfully validate the extracted SDP, it SHALL reject the incoming request. If the OITF successfully validates the extracted SDP it SHOULD accept the incoming request.</td></tr>
<tr><td class="label">Step 3:</td><td>
Once the OITF accepts the incoming SIP REFER, it SHALL send an HTTP POST PENDING_IG request to the IG. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per  Table <a href="#t47" class="tableRef">47</a>  with the exception that the response in this case is a SIP 202 OK
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 4:</td><td>The OITF SHALL extract the following information from the incoming REFER request:<ul>
<li>The Content URI extracted from the To header included in the Refer-To header.
<li>The body header.
<li>The Dialog ID to be replaced extracted from the Replace header in the Refer-To header.
<li>The content bookmark from the HTTP body, if present, and if understood by the OITF.</ul></td></tr>
<tr><td class="label">Step 5:</td><td>The transferee OITF SHALL then construct an SDP that it can used to initiate a new session to handle the transfer. The OITF MAY follow section <a href="#s5-3-2-1-1" class="sectionRef">5.3.2.1.1</a>, “<a href="#s5-3-2-1-1" class="sectionTitleRef"></a>”, if need be, towards the construction of the SDP.</td></tr>
<tr><td class="label">Step 6:</td><td>The transferee OITF SHALL then invoke the procedure defined in section <a href="#s5-3-13-1-1-1" class="sectionRef">5.3.13.1.1.1</a>, “<a href="#s5-3-13-1-1-1" class="sectionTitleRef"></a>”.</td></tr>
<tr><td class="label">Step 7:</td><td>
Once the session setup is successfully completed, the OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>”. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t48" class="tableRef">48</a>
</ul></td></tr>
<tr><td>HTTP Response Body: SIP/2.0 200 OK (or the outcome of the session initiation request)</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 8:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers as per Table <a href="#t52" class="tableRef">52</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 9:</td><td>The IG SHALL send a SIP NOTIFY to the network, to report the outcome of the session transfer and SHALL wait for the response. The IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the transferee OITF to report the received response from the transferor OITF. The response SHALL include a list of SIP headers as per Table <a href="#t49" class="tableRef">49</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>
<p>Following that, all unicast content streaming procedures apply to the session.</p>

<table id="t48" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the NOTIFY request sent from the transferee OITF (OITF&rarr;IG) to the transferor (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p class="notes-list">Notes:</p><ol class="notes-list"><li> The Request URI MUST match the contact URI included in the contact field of the SIP REFER</ol></td><td>RFC 3261 [[!SIP]]<p>NOTIFY &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3515 [[!RFC3515]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Subscription-State</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “message/sipfrag”</p></td><td>RFC 3515 [[!RFC3515]], RFC 3420 [[!RFC3420]]</td></tr>
<tr><td>X-OITF-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t49" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to a NOTIFY request received from the IG (IG&rarr;OITF) transferor to the transferee</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
</section>
<section id="s5-3-13-2"><h4>XML Schema for Session Transfer Information included in a session transfer request from the transferor to transferee</h4>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:iptv:transfer:2011"
  xmlns:tns="urn:oipf:iptv:transfer:2011"
  xmlns:ct="urn:oipf:base:CommonTypes:2011"
  xmlns:bmk="urn:oipf:iptv:bookmark:2011"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:import namespace="urn:oipf:base:CommonTypes:2011"
    schemaLocation="base-CommonTypes.xsd" /&gt;
  &lt;xs:import namespace="urn:oipf:iptv:bookmark:2011"
    schemaLocation="iptv-bookmark.xsd"/&gt;
  &lt;xs:element name="Sessiontransfer"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;This describes information elements needed to support
        session transfer&lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="session-bookmark" type="bmk:BookmarkType"/&gt;
      &lt;xs:element name="transferee" type="ct:UserIdType" /&gt;
      &lt;xs:documentation&gt; this element is populated with the same information
        included in the Request URI of the REFER Request &lt;/xs:documentation&gt;
      &lt;xs:any namespace="##any" processContents="lax" minOccurs="0"
        maxOccurs="unbounded"element name="any" type="any"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;
</pre>
</section>


</section>
</section>

<section id="s5-4"><h2>Protocol for Service Access and Control Functions</h2>
<section id="s5-4-1"><h3>Service Provider Discovery</h3>
<section id="s5-4-1-1"><h4>Protocol over HNI-IGI – HTTP Option</h4>
<section id="s5-4-1-1-1"><h5>Retrieval of Service Provider Discovery Information</h5>
<p>The procedures in this section SHALL only be performed in the context of the default user. When the OITF supports native HNI-IGI, it SHALL follow the following procedure to retrieve Service Provider Discovery Information:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t50" class="tableRef">50</a>
</ul></td></tr>
<tr><td>HTTP Response Body: Empty or optionally, the OITF MAY include a body associated with the appid “urn:oipf:application:iptv-SP-discovery”. The optional message body sent to the Service Provider Discovery FE SHALL include the capabilities of the OITF. The Content-Type of the message body SHALL be set to “application/vnd.oipf.ueprofile+xml”, which refers to the MIME type of the schema defined in Annex <a href="#annex-c-2" class="sectionRef">C.2</a>. See Table <a href="#t50" class="tableRef">50</a> for X-OITF-Content-Type header.</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers REQUIRED for the outgoing message as per Table <a href="#t50" class="tableRef">50</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>If the IG has the requested information, it SHALL respond immediately with HTTP 200 OK. If not, the IG SHALL send a SIP SUBSCRIBE to the network, to subscribe to the “ua-profile” event, and SHALL wait for the response to the subscription request. The IG SHALL then return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the subscription request. The response includes a list of SIP headers as per Table <a href="#t51" class="tableRef">51</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>The OITF SHALL send an HTTP HNI-IGI PENDING_IG request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionTitleRef"></a>”), and SHALL wait for any incoming messages.</td></tr>
<tr><td class="label">Step 5:</td><td>When a SIP NOTIFY is received by the IG for a “ua-profile” event, the IG SHALL return a HTTP 200 OK response to the OITF. The response includes a list of SIP headers as per Table <a href="#t52" class="tableRef">52</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]]. The body of the HTTP response SHALL be the SIP body received in the incoming NOTIFY message. The content of the HTTP Response SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t52" class="tableRef">52</a>
</ul></td></tr>
<tr><td>HTTP Response Body: Body of the incoming NOTIFY</td></tr>
</table>
</td></tr>
<tr><td colspan="2">
<p>The OITF SHALL parse the XML document in the body to ensure that it complies with the schema defined in <a href="volume3.html#service-provider-discovery-extensions" class="extRef">section 3.2.1</a> of [[.OIPF_META2]].</p>
<p>When parsing the list of parameters, the OITF SHALL take the following action:</p><ul>
<li>If the Service Provider Discovery Information for a Service Provider is already present in the OITF (i.e., for which the OITF already has an entry), and<ul>
<li>If the “@Version” attribute does not have the same value as that received in the NOTIFY message, then the OITF SHALL perform the following actions:<ul>
<li>The OITF SHALL update its parameters with the new values sent by the Service Provider Discovery FE. Also if the Segment@ID or Segment@Version has changed, the OITF SHALL update the service discovery information with that received from the Service Discovery FE.</ul>
<li>If the “@Version” attribute has the same value as that received in the NOTIFY message, the OITF SHALL NOT update the stored Service Provider Discovery information.</ul>
<li>If the Service Provider Discovery Information for a Service Provider is not known to the OITF (i.e., the OITF does not have an entry for the Service Provider Discovery Information)<ul>
<li>The OITF SHALL create a new entry for the new Service Provider with all the parameters received in the NOTIFY message.
The IPTV Service Provider Discovery Information delivered via this protocol SHALL conform to TS 102 034 [[!TS102034]] section 5.2.5, with the extended element defined in the Metadata Specification [[.OIPF_META2]].
</ul></ul>
</td></tr>
<tr><td class="label">Step 6:</td><td>Once the OITF accepts the HTTP message containing the incoming SIP NOTIFY, it SHALL send an HTTP HNI-IGI PENDING_IG request to the IG. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t53" class="tableRef">53</a>
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 7:</td><td>The IG SHALL send the SIP 200 OK response to the network and then SHALL return to Step 5 to handle any subsequent NOTIFY received from the network.</td></tr>
</table>
</section>
<section id="s5-4-1-1-2"><h5>Procedure for Cancellation of the Subscription</h5>
<p>The procedure for de-registering the IPTV default user MUST be preceded with a cancellation of subscription.</p>
<p>The procedure is the same as the procedure for initiating a subscription to the “ua-profile”, except that the X-OITF-Expires header in Table <a href="#t50" class="tableRef">50</a> SHALL be set to 0.</p>

<table id="t50" class="mapping">
<caption>Table ####: Supported HTTP extension headers in HNI-IGI SUBSCRIBE Request for SP Discovery</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI SHALL be set to the well known PSI. The PSI SHALL be composed of the domain name extracted from the public user identity with a user part set to “OIPF_IPTV_SPD”. (e.g., OIPF_IPTV_SPD@&lt;domain_name&gt;)</p></td><td>RFC 3261 [[!SIP]]<p>SUBSCRIBE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From<p>Note: The From user MUST be set to the IMPU of the default user.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event<p>Extend the existing “ua–profile” event package for SIP SUBSCRIBE request</p>
<p>The Event header SHALL be set to the “ua-profile” event package.</p>
<p>The Event parameters SHALL be set as follows:</p><ul>
<li>The “profile-type” parameter SHALL be set to “application”.
<li>The “appids” parameter SHALL be set to “urn:oipf:application:iptv-SP-discovery”.
</ul></td><td>RFC 3265 [[!SIP-EVNT]] and as per TS 183 063 [[!TS183063]] section 5.1.2.2.1</td></tr>
<tr><td>X-OITF-Contact<p class="notes-list">Notes:</p><ol class="notes-list">
<li>URI parameter MUST be included, and MUST match the value that is sent in the Contact header in the registration request.
<li>Expires parameter SHOULD be included
<li>Priority parameter SHOULD be included</ol>
The IG includes all other mandatory parameters that are absent.
</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires<p>Note: If absent a default value according to RFC 3261 [[!SIP]] SHALL be assumed by the IG</p>
To cancel the subscription, the X-OITF-Expires SHALL be set to 0</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept<p>Set to “application/vnd.oipf.spdiscovery+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>OPTIONALly included when signalling OITF capabilities according schema defined in Annex <a href="#annex-c-2" class="sectionRef">C.2</a>. SHALL be set to “application/vnd.oipf.ueprofile+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t51" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to an HNI-IGI SUBSCRIBE Request for SP Discovery</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t52" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the NOTIFY request to the SUBSCRIBE to SP discovery</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The Request URI MUST match the contact URI included in the contact field of the SIP SUBSCRIBE</p></td><td>RFC 3261 [[!SIP]], RFC 3265 [[!SIP-EVNT]] and RFC 6080 [[!SIP-CFG]]<p>NOTIFY &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3265 [[!SIP-EVNT]] and as per TS 183 063 [[!TS183063]] section 5.2.2.2</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Subscription-State</td><td>RFC 3265 [[!SIP-EVNT]] and RFC 3856 [[!SIP-PRES]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.spdiscovery+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t53" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to a NOTIFY request to the SUBSCRIBE to SP discovery</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<p>Note: Cancellation of subscription is not REQUIRED if the X-OITF-Expires header was set to 0 in the initial SUBSCRIBE request.</p>
</section>
<section id="s5-4-1-1-3"><h5>Refreshing the Subscription</h5>
<p>The procedure for refreshing a subscription is the same as the procedure for initiating a subscription.</p>
<p>The application initiating the subscription procedure SHALL refresh the subscription based on the refresh subscription timer information received in the response to the subscription. Refreshing a subscription SHOULD be performed before the expiry of the refresh timer. A subscription that is not refreshed will be terminated.</p>
<p>The IG SHALL consider a subscription terminated if is not refreshed.</p>
</section>
</section>
<section id="s5-4-1-2"><h4>Protocol over UNIS-19 and Non-native HNI-IGI</h4>
<p>The OITF retrieves the Service Provider Discovery entry point and uses the entry point to retrieve a list of IPTV service providers using HTTP for that purpose. The IPTV Service Providers list SHALL be delivered as SD&amp;S records or DAE applications.
When an IPTV service provider discovery entry point is selected, Service Provider Discovery information SHALL be delivered as Service Discovery and Selection (SD&amp;S) records or as DAE applications. This information is provided by the Service Platform Provider.</p>
<p>When SD&amp;S records are used, the HTTP protocol conforming to TS 102 034 [[!TS102034]] section 5.4.2 SHALL be used for the transport of IPTV Service Provider Discovery Information. The data delivered SHALL conform to TS 102 034 [[!TS102034]] section 5.2.5, with the extension defined in [[.OIPF_META2]].</p>
<p>When DAE applications are used, the HTTP protocol and data formats SHALL conform to section <mark class="refError">5.3.1.1.6 of [[.OIPF_DAE2]]</mark>.</p>
</section>
</section>
<section id="s5-4-2"><h3>Service Discovery</h3>
<section id="s5-4-2-1"><h4>Protocol over UNIS-6</h4>
<p>The protocol on UNIS-6 SHALL be HTTP as defined in [[.OIPF_DAE2]] for DAE application based service discovery. This protocol is used for the unicast transport of HTML ECMAScript documents between the OITF DAE function and the IPTV Application Functional Entity.</p>
</section>
<section id="s5-4-2-2"><h4>Protocol over UNIS-15</h4>
<p>The protocol used on UNIS-15 for the transport IPTV Service Discovery information SHALL be HTTP conforming to TS 102 034 [[!TS102034]] section 5.4.2.</p>
<p>The IPTV Service Discovery information delivered via this protocol SHALL conform to TS 102 034 [[!TS102034]] section 5.2.6 with the extension defined in [[.OIPF_META2]]</p>
</section>
</section>
<section id="s5-4-3"><h3>Service Access</h3>
<section id="s5-4-3-1"><h4>Protocol over UNIS-6</h4>
<p>UNIS-6 MAY be used for the unicast transport of HTML ECMAScript documents between the OITF DAE function and the IPTV Application functional entity for DAE application based service access.</p>
<p>See [[.OIPF_DAE2]] for the details of the document format delivered via this protocol.</p>
</section>
<section id="s5-4-3-2"><h4>Protocol over UNIS-7</h4>
<p>The use of the HTTP protocol on this reference point SHALL comply with section 4.1.2.2.2 (container based delivery) or section 4.2 (query mechanism) of the DVB-IP Broadband Content Guide specification [[!BCG]].</p>
<p>The Content Guide metadata delivered via this protocol SHALL conform to TS 102 539 [[!BCG]] with the extension defined in [[.OIPF_META2]]</p>
<p>The OITF MAY request user specific information from the Metadata Control FE based on the IPTV Subscription Profile. (See section <a href="#s5-4-4" class="sectionRef">5.4.4</a>, “<a href="#s5-4-4" class="sectionTitleRef"></a>.”)</p>
</section>
</section>
<section id="s5-4-4"><h3>Subscription profile management and usage</h3>
<section id="s5-4-4-1"><h4>Protocols on UNIP-1 for XCAP-based Profile Management</h4>
<p>The OITF SHALL be able to obtain a user’s IPTV Subscription Profile. The format of the IPTV Subscription Profile SHALL conform to Annex <a href="#annex-c-1" class="sectionRef">C.1</a>, “<a href="#annex-c-1" class="sectionTitleRef"></a>.” The IPTV Subscription Profile MAY be used for filtering the Broadband Content Guide metadata, i.e. for the provision of a personalised content guide.</p>
<p>The IPTV Service Profile Functional Entity SHALL expose XCAP Server behaviour (HTTP Server 1.1, XML parser, and data repository) as defined in RFC 4825 [[!XCAP]].</p>
<p>UNIP-1 SHALL comply with XCAP as defined in RFC 4825 [[!XCAP]].</p>
<section id="s5-4-4-1-1"><h5>XCAP Application Usage for IPTV Service</h5>
<p><b>Profile Management</b></p>
<p>The XML Configuration Access Protocol (XCAP) defined in RFC 4825 [[!XCAP]] is used for manipulating data stored in the IPTV Service Profile Functional Entity. XCAP allows a client to read, write and modify application configuration data, stored in XML format, on a server. XCAP maps XML document sub-trees and element attributes to HTTP URIs, so that these components can be directly accessed by HTTP. XCAP uses the HTTP methods PUT, GET, and DELETE to operate on documents stored in the Service Profile Functional Entity.</p>
<p>The data stored in the IPTV Service Profile Functional Entity relates to the operation of the IPTV service. This specification defines a new Application Usage to allow a client to manipulate data related to IPTV services.</p>
<p>XCAP requires the definition of XML documents that are compliant with the XML schema and constraints defined for a particular XCAP application usage. The application usage defines the XML schema for the data used by the application, along with other key pieces of information.</p>
<p>Central to XCAP is the construction of the HTTP URI that points to a particular document or certain components of it. A component in an XML document can be an XML element, attribute, or the value of it.</p>
<p><b>XCAP application usage</b></p>
<p>XCAP requires application usages to fulfil a number of steps in the definition of such application usage. The remainder of this section specifies the REQUIRED definitions of the IPTV services XCAP Application Usage.</p>
<p><b>Application Unique ID (AUID)</b>: Each XCAP application usage is associated with a unique name called the Application Unique ID (AUID). The AUID defined by this application usage falls into the vendor-proprietary namespace of XCAP AUID, where Open IPTV Forum is considered a vendor.<br />
The proposed AUID to be allocated to the Open IPTV Forum IPTV services application usage SHALL be</p>
<div class="center"><i>org.openiptvforum.iptv</i></div>

<p><b>XML schema</b>: Implementations in compliance with this specification SHALL implement the XML schema defined in Annex <a href="#user-profile-description" class="sectionRef">C</a>.</p>
<p><b>Default namespace</b>: XCAP requires application usages to declare the default namespace. The default namespace of the IPTV services XCAP application usage SHALL be</p>
<div class="center"><i>urn:oipf:params:xml:ns:iptv</i></div>
<p><b>MIME Type</b>: The MIME type of IPTV service XML document SHALL be</p>
<div class="center"><i>application/vnd.oipf.userprofile+xml</i></div>
<p><b>Validation constraints</b>: This specification does not specify any additional constraints beyond those defined by XCAP.</p>
<p><b>Data Semantics</b>: The XML schema does not accept URIs that could be expressed as a relative URI reference causing a resolution problem. However, each of the supplementary services SHOULD consider if relative URIs are allowed in the subdocument tree, and in that case, they SHOULD indicate how to resolve relative URI references. In the absence of further indications, relative URI references SHOULD be resolved using the document URI as the base of the relative URI reference.</p>
<p><b>Naming conventions</b>: By default, IPTV Service Profile XML documents are stored in the IPTV Service Profile Functional Entity. In order to facilitate the manipulation of an IPTV Service Profile XML document, the default XML file name SHALL be:</p>
<div class="center"><i>iptvprofile.xml</i></div>
<p><b>Resource interdependencies</b>: This specification does not specify additional resource interdependency beyond those specified in the XML schema.</p>
<p><b>Authorization policies</b>: The authorization policy for access and manipulation of an IPTV Service Profile document SHALL be defined by the Service Provider.</p>
</section>
</section>
<section id="s5-4-4-2"><h4>Protocols over UNIS-6 for DAE-based Profile Management</h4>
<p>UNIS-6 MAY be used for the unicast transport of HTML ECMAScript documents between the OITF DAE function and the IPTV Application FE for DAE-based subscription profile management. In this case, the IPTV Application FE acts as a front-end to the IPTV Service Profile FE. When the HTTP request for profile management is received from OITF, the IPTV Application FE manipulates the IPTV Service Profile FE.</p>
</section>
<section id="s5-4-4-3"><h4>Protocols over HNI-IGI – HTTP Option</h4>
<section id="s5-4-4-3-1"><h5>Subscription to notification of changes in the IPTV Service Profile</h5>
<p>The procedure for subscription to notification of changes in the IPTV service profile SHALL be invoked from either a DAE application or an embedded application in the OITF. The procedures SHALL be as follows:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>”. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t54" class="tableRef">54</a>
</ul></td></tr>
<tr><td>HTTP Response Body: The body contains the list of the requested URIs associated with the XCAP resources for which the subscription is issued. The MIME Type of the document inserted in the body will be signalled by the Content-Type header, set to “application/vnd.oipf.userprofile+xml”.</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers needed for the outgoing subscription message, as per Table <a href="#t54" class="tableRef">54</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP SUBSCRIBE to the network, to subscribe to the “xcap-diff” event package, and SHALL wait for the response to the subscription request. The IG SHALL return a HTTP 200 OK response to the OITF to report the response to the subscription request. The response SHALL include a list of SIP Headers as per Table <a href="#t55" class="tableRef">55</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>The OITF SHALL send an HTTP HNI-IGI PENDING_IG request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionRef"></a>”), and SHALL wait for any incoming messages.</td></tr>
<tr><td class="label">Step 5:</td><td>When a SIP NOTIFY is received by the IG, the IG SHALL return a HTTP 200 OK response to the OITF that includes the information carried in the incoming NOTIFY. The response SHALL include a list of SIP headers as per Table <a href="#t56" class="tableRef">56</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]]. The body of the HTTP response SHALL include the “xcap-diff+xml” document carried in the NOTIFY body. This document contains the changes in the XCAP document(s) identified in the subscription request in Step 1(b).</td></tr>
<tr><td class="label">Step 6:</td><td>When the OITF accepts the incoming SIP NOTIFY, it SHALL send an HTTP POST PENDING_IG request to the IG to acknowledge the receipt of notification. The content of the HTTP request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t57" class="tableRef">57</a>
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 7:</td><td>The IG SHALL send the SIP 200 OK response to the network and then SHALL return to Step 5 to handle any subsequent NOTIFY messages that MAY be received from the network.</td></tr>
</table>

<table id="t54" class="mapping">
<caption>Table ####: Supported HTTP extension headers in HNI-IGI SUBSCRIBE Request for receiving notification of changes in the IPTV Service Profile</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the well-known PSI of the IPTV Service Profile FE:<br/>
The PSI SHALL be “OIPF_IPTV_ServiceProfile@&lt;domainname&gt;” where &lt;domainname&gt; SHALL be the IPTV Service Provider domain name obtained through Service Provider discovery.</p></td><td>RFC 3261 [[!SIP]], RFC 3265 [[!SIP-EVNT]] and RFC 5875 [[!XCAP-EVT]]<p>SUBSCRIBE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event<p>The Event header SHALL be set to the “xcap-diff” event package.</p></td><td>RFC 3265 [[!SIP-EVNT]] and as per TS 183 063 [[!TS183063]] section 5.1.5.1</td></tr>
<tr><td>X-OITF-Accept<p>The Accept header SHALL include the value “application/xcap-diff+xml”. This header indicates the body formats allowed in subsequent NOTIFY requests</p></td><td>RFC 3265 [[!SIP-EVNT]] and as per TS 183 063 [[!TS183063]] section 5.1.5.1</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/vnd.oipf.userprofile+xml” as the MIME Type of IPTV Subscription Profile schema.</p></td><td>RFC 3265 [[!SIP-EVNT]]</td></tr>
<tr><td>X-OITF-Contact<p class="notes-list">Notes:</p><ol class="notes-list"><li>The URI parameter SHALL be included and SHALL match what is sent in the Contact header included in the registration request<li>The Expires parameter SHOULD be included</ol></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires<p>Note: If absent a default value SHALL be assumed by the IG</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t55" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to an HNI-IGI SUBSCRIBE Request</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t56" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the NOTIFY request containing changes in the IPTV Service Profile</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The Request URI MUST match the contact URI included in the contact field of the SIP SUBSCRIBE</p></td><td>RFC 3261 [[!SIP]], RFC 3265 [[!SIP-EVNT]] and RFC 6080 [[!SIP-CFG]]<p>NOTIFY &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3265 [[!SIP-EVNT]] and as per TS 183 063 [[!TS183063]] section 5.1.5.2</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Subscription-State</td><td>RFC 3265 [[!SIP-EVNT]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type<p>SHALL be set to “application/xcap-diff+xml”.</p></td><td>RFC 3265 [[!SIP-EVNT]] and as per TS 183 063 [[!TS183063]] section 5.1.5.2</td></tr>
</table>

<table id="t57" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to a NOTIFY request</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-4-4-3-2"><h5>Refreshing the Subscription</h5>
<p>It is the responsibility of the application initiating the subscription procedure to refresh the subscription according to the “refresh subscription timer” parameter received in the response to the subscription request. Refreshing the subscription SHOULD be performed before the expiry of the refresh timer. A subscription that is not refreshed SHALL be terminated after the expiration of the timer.</p>
<p>The IG SHALL consider a subscription terminated if is not refreshed.</p></section>
<section id="s5-4-4-3-3"><h5>Procedure for Cancellation of a Subscription</h5>
<p>This procedure MAY be invoked at any time.</p>
<p>The procedure for de-registering the IPTV end user SHALL be preceded by the cancellation of any subscription for notification of changes in the user’s IPTV Service Profile.</p>
<p>The procedure for cancellation of the subscription is the same as the procedure for initiating a subscription to the ua-profile event package, except that the X-OITF-Expires header in Table <a href="#t54" class="tableRef">54</a> SHALL be set to 0.</p>
</section>
</section>
</section>
<section id="s5-4-5"><h3>Remote Management</h3>
<section id="s5-4-5-1"><h4>General Procedures on UNI-RMS</h4>
<p>The remote management functions REQUIRED for managed devices are specified in the general framework document TR069 [[!TR069]] by the Broadband Forum. The framework document is associated with a number of Technical Reports that define the CWMP data models that are specific for each device function.</p>
<section id="s5-4-5-1-1"><h5>UNI-RMS for IG, AG and WAN Gateway</h5>
<p>In addition to TR-069, the following specifications SHALL apply:</p><ul>
<li>TR-098 [[!TR098]] that defines the data model for the “internet gateway device” SHALL apply to the WAN Gateway FE (see RMS3 functional block of the “Open IPTV Forum – Functional Architecture” document [[.OIPF_ARCH2]])
<li>TR-106 [[!TR106]] that defines the data model for the generic CWMP-managed device SHALL apply to the IG, AG and WAN-Gateway FEs.
<li>TR-104 [[!TR104]] that defines the data model for the “SIP end-point” SHALL apply to the IG (see RMS2 functional block of the “Open IPTV Forum – Functional Architecture” document [[.OIPF_ARCH2]]).</ul>
</section>
<section id="s5-4-5-1-2"><h5>UNI-RMS for OITF</h5>
<p>Although the remote management functions are specified in the general framework document TR-069 [[!TR069]] by the Broadband Forum, the protocol to remotely manage OITF retail devices is intended to support limited functions mainly for Performance Monitoring and Diagnostics. Consequently, an OITF device doesn't fulfil all the requirements that are requested in TR-069 [[!TR069]]. The limitations outlined in the following sections SHALL apply.</p>
<p><b>OITF RPC Methods Support Requirements</b></p>
<p>An OITF SHALL implement the following RPC methods:</p>
<table class="simple">
<tr><th>Method Name</th><th>OITF requirement</th><th>ACS requirement</th></tr>
<tr><td><i>CPE methods</i></td><td><i>Responding</i></td><td><I>Calling</i></td></tr>
<tr><td>GetRPCMethods</td><td>REQUIRED</td><td>REQUIRED</td></tr>
<tr><td>SetParameterValues</td><td>REQUIRED</td><td>REQUIRED</td></tr>
<tr><td>GetParameterValues</td><td>REQUIRED</td><td>REQUIRED</td></tr>
<tr><td>SetParameterAttributes</td><td>REQUIRED</td><td>OPTIONAL</td></tr>
<tr><td>GetParameterAttributes</td><td>REQUIRED</td><td>OPTIONAL</td></tr>
<tr><td><i>ACS methods</i></td><td><i>Calling</i></td><td><i>Responding</i></td></tr>
<tr><td>Inform</td><td>REQUIRED</td><td>REQUIRED</td></tr>
</table>
<p>As an OITF device doesn't support all the RPC requirements as defined in [[!TR069]], the ACS SHALL implement the GetRPCMethods to discover the limited set of methods supported by the OITF.</p>
<p>The OITF RPC Methods SHALL respect the calling arguments and type as defined in [[!TR069]], with the following definition of the DeviceIdStruct that is used for the DeviceId argument of the Inform method:</p><ul class="nobullet">
<li>the 3 parameters ManufacturerOUI, ProductClass and Serial Number have slightly different semantic meanings in the context of OIPF and are obtained from the deviceID identifier (refer to section <a href="#s6-1-3-2-1" class="sectionRef">6.1.3.2.1</a>, “<a href="#s6-1-3-2-1" class="sectionTitleRef"></a>.”)<ul>
<li>ManufacturerOUI = HEX(first 3 bytes of SHA-1(X))
<li>ProductClass = "OIPF"
<li>SerialNumber = HEX(remaining bytes, from 4th on, of SHA-1(X)) where, X = (MAC address as bytes) + (domain name in ASCII characters).
</ul></ul>
<table class="simple">
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
<tr><td>Manufacturer</td><td>String(64)</td><td>Manufacturer of the device</td></tr>
<tr><td>OUI</td><td>String(6)</td><td>In the context of OIPF, this parameter is the hexadecimal value of the first 3 bytes of SHA-1(X)</td></tr>
<tr><td>ProductClass</td><td>String(64)</td><td>In the context of OIPF, this parameter is always "OIPF"</td></tr>
<tr><td>SerialNumber</td><td>String(64)</td><td>In the context of OIPF, this parameter is the hexadecimal value of the remaining bytes (from 4th on) of SHA-1(X)</td></tr>
</table>

<p><b>OITF Data Model</b></p>
<p>In the framework of the Open IPTV Forum, a specific data model for the Remote Management of a retail OITF device has been defined. The data model has been obtained from TR-135 [[!TR135]] and TR-106 [[!TR106]] with a selection of a reduced set of parameters using the same semantics (with a few exceptions) and the same types. The OITF data model is fully described in Annex <a href="#specific-tr-135-and-106-objects" class="sectionRef">J</a>, “<a href="#specific-tr-135-and-106-objects" class="sectionTitleRef"></a>.”</p>
</section>
<section id="s5-4-5-1-3"><h5>Configuration of the IG via Configuration File</h5>
<p>CPE WAN Management protocol based on Broadband Forum TR-069 [[!TR069]] SHALL be used to configure the IPTV application in the IG. An IPTV configuration file SHALL be used to populate the IG with the list of users with their IMPU, Alias and Passwords and also configure whether user authentication is to be performed by the IG.</p>
<p>If GBA Authentication or HTTP Digest Authentication is supported by the IG, the IG SHALL be configured with the following information:</p><ul>
<li>Whether it has to provide an intended identity or not in the GBA and HTTP Digest authentication procedures as described in [[.OIPF_CSP2]].
<li>The realm, username and password for regular HTTP Digest Authentication.</ul>
<p>The file is downloaded to the IG during the IG power up procedure.</p>
<p>The configuration data SHALL be defined in XML and SHALL include the XML schema to be enforced against the configuration data.</p>
<section id="s5-4-5-1-3-1"><h6>Call Flow</h6>
<p>There are 2 cases to be considered; the first case is when the remote server requests the IG to download the configuration file at power up of the IG. This requires the IG to contact the remote server. The download request is subsequently used by the server to request the IG to download the configuration file. Alternatively, if the server is configured (by some means) with the address of the IG, it can request the IG to contact it using the Connection Request Notification mechanism, if the remote server supports this mechanism.</p>
<p>The second case is when the process is initiated by the IG if it detects a corrupted file or if for some reason it lost the file due to a reboot or an internal error.</p>
<p>Figure <a href="#f4" class="figureRef">4</a> is a call flow depicting the configuration procedure.</p>
<figure id="f4">
<figcaption>Figure ####: Sequence for the Configuration of an IG</figcaption>
<img src="images/sequence-ConfigurationOfAnIG.png" alt="figure 4" style="width:50%"/>
</figure>
<p>The following is a brief description of the flow:</p>
<table class="sequence">
<tr><td class="label">Steps 1-4:</td><td>Normal steps as per TR-069.</td></tr>
<tr><td class="label">Step 5:</td><td>The IG sends an HTTP POST request with no HTTP entity body to the remote server.</td></tr>
<tr><td class="label">Step 6:</td><td>The server returns an HTTP response that includes a Download request in the HTTP entity body. The arguments are set as follows:
<table class="alignment">
<tr><td style="border:0px none transparent;">CommandKey:</td><td style="border:0px none transparent;">Mandatory – set by remote server</td></tr>
<tr><td style="border:0px none transparent;">FileType:</td><td style="border:0px none transparent;">Mandatory – set to 3: Vendor Configuration File. The vendor in this case is Open IPTV Forum</td></tr>
<tr><td style="border:0px none transparent;">URI:</td><td style="border:0px none transparent;">Mandatory – set by remote server</td></tr>
<tr><td style="border:0px none transparent;">Username:</td><td style="border:0px none transparent;">OPTIONAL – If used, MUST be configured in the IG and remote server</td></tr>
<tr><td style="border:0px none transparent;">Password:</td><td style="border:0px none transparent;">OPTIONAL – If used, MUST be configured in the IG and remote server</td></tr>
<tr><td style="border:0px none transparent;">TargetFileName:</td><td style="border:0px none transparent;">Mandatory – IPTV-ConfigurationParameters</td></tr>
<tr><td style="border:0px none transparent;">DelaySeconds:</td><td style="border:0px none transparent;">Mandatory – set to no delay</td></tr>
<tr><td style="border:0px none transparent;">Successful URI:</td><td style="border:0px none transparent;">Not provided</td></tr>
<tr><td style="border:0px none transparent;">Failure URI:</td><td style="border:0px none transparent;">Not provided</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 7:</td><td>Following that, the IG proceeds to download the configuration file.</td></tr>
<tr><td class="label">Steps 8-9:</td><td>Once the download is complete, the IG sends a TransferComplete request to the remote server. The arguments in the request are set as follows:
<table class="alignment">
<tr><td style="border:0px none transparent;">CommandKey:</td><td style="border:0px none transparent;">Mandatory – Set to the value received in the Download request</td></tr>
<tr><td style="border:0px none transparent;">FaultStruct:</td><td style="border:0px none transparent;">Mandatory in case of failure according to TR-069</td></tr>
<tr><td style="border:0px none transparent;">StartTime:</td><td style="border:0px none transparent;">Mandatory – Set according to TR-069</td></tr>
<tr><td style="border:0px none transparent;">FinishTime:</td><td style="border:0px none transparent;">Mandatory – Set according to TR-069</td></tr>
</table>
</td></tr>
</table>
<p>Note that the above sequence is an example and there are other valid sequences that can achieve the same result.</p>
</section>
<section id="s5-4-5-1-3-2"><h6>XML Schema for the IPTV-Configuration file</h6>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:config:ig:2009"
  xmlns:tns="urn:oipf:config:ig:2009"
  xmlns:enum="urn:ietf:params:xml:ns:enum-token-1.0"
  xmlns="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;!—schema filename is config-ig.xsd --&gt;
  &lt;xs:annotation&gt;
    &lt;xs:documentation xml:lang="en"&gt;
      This schema is copyrighted by the Open IPTV Forum ("OIPF") and distributed in conjunction
      with Release 1 of the IPTV Solution Specification.
      Disclaimer
      The Open IPTV Forum members accept no liability whatsoever for any use of this document.
      This specification provides multiple options for some features. The Open IPTV Forum Profiling
      specification will complement the Release 1 specifications by defining the Open IPTV Forum
      implementation and deployment profiles. Any implementation based on Open IPTV Forum
      specifications that does not follow the Profiling specifications cannot claim Open IPTV Forum
      compliance.
      Copyright Notification
      No part MAY be reproduced except as authorized by written permission.
      Any form of reproduction and/or distribution of these works is prohibited.
      Copyright 2009 &copy; Members of the Open IPTV Forum
      All rights reserved.
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;
  &lt;xs:import namespace="http://www.w3.org/XML/1998/namespace"
    schemaLocation="xml.xsd" /&gt;
  &lt;xs:import namespace="urn:ietf:params:xml:ns:enum-token-1.0"
    schemaLocation="imports/enum-token-1.0.xsd /&gt;
  &lt;xs:element name="IGconfiguration" type="tns:IGconfigurationType" /&gt;
  &lt;xs:complexType name="IGconfigurationType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="AuthenticationSet"
        type="tns:AuthenticationSetType" maxOccurs="unbounded" /&gt;
      &lt;xs:element name="GatewayAuthentication" type="xs:boolean"
        minOccurs="0" /&gt;
      &lt;xs:any namespace="##other" processContents="skip"
        minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="AuthenticationSetType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="Identifier" type="tns:IMSPublicIdType" /&gt;
      &lt;xs:element name="Password" type="xs:string" /&gt;
      &lt;xs:element name="Alias" type="xs:string" /&gt;
      &lt;xs:sequence minOccurs="0"&gt;
        &lt;xs:element name="IMPI" type="xs:string" /&gt;
        &lt;xs:element name="SIPDigestPassword" type="xs:string" /&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;!-- ================== Definition for IMSPublicIdType ====================--&gt;
  &lt;xs:complexType name="IMSPublicIdType"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element name="e164Number" type="enum:e164numberType" /&gt;
      &lt;xs:element name="SIPURI" type="tns:SIPURIType" /&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="SIPURIType"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation xml:lang="en"&gt;
        SIP URI pattern is defined based on the SIP URI
        description provided in RFC 3261 (Section 2)
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:pattern
        value="[sS][iI][pP][sS]?:(//([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?" /&gt;
    &lt;xs:restriction&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;
</pre>
<p>The schema establishes a binding between an IMS Public Identity (IMPU), a user alias and a password. If SIP Digest authentication is used for user authentication, the IMPI and SIPDigestPassword SHALL be included. Otherwise, it is assumed that user authentication is based upon IMS AKA.</p>
<p>The schema also supports a mechanism to instruct the IG if user authentication is mandatory in the Consumer Network.</p>
<p>The schema is extensible.</p>
<p>An example of a configuration file that conforms to the above schema is as follows:</p>
<pre class="xml-schema">
&lt;IGconfiguration&gt;
  &lt;AuthenticationSet&gt;
    &lt;Identifier&gt;&lt;SIPURI&gt;sip://operator.example.com/MickJ&lt;/SIPURI&gt;&lt;/Identifier&gt;
    &lt;Password&gt;RollingStones&lt;/Password&gt;
    &lt;Alias&gt;Mick Jagger&lt;/Alias&gt;
    &lt;IMPI&gt;household123@operator.com&lt;/IMPI&gt;
    &lt;SIPDigestPassword&gt;CCXDFGGH&lt;/SIPDigestPassword&gt;
  &lt;/AuthenticationSet&gt;
  &lt;AuthenticationSet&gt;
    &lt;Identifier&gt;&lt;SIPURI&gt;sip://operator.example.com/BruceS&lt;/SIPURI&gt;&lt;/Identifier&gt;
    &lt;Password&gt;TheBoss&lt;/Password&gt;
    &lt;Alias&gt;BruceSpringstein&lt;/Alias&gt;
    &lt;IMPI&gt;household123@operator.com&lt;/IMPI&gt;
    &lt;SIPDigestPassword&gt;CCXDFGGH&lt;/SIPDigestPassword&gt;
  &lt;/AuthenticationSet&gt;
  &lt;GatewayAuthentication&gt;true&lt;/GatewayAuthentication&gt;
&lt;/IGconfiguration&gt;
</pre>

</section>
</section>
</section>
<section id="s5-4-5-2"><h4>Remote Management using DAE APIs</h4>
<p>See DAE Specification [[.OIPF_DAE2]] <a href="volume5.html#remote-management-apis" class="extRef">section 7.11</a>.</p>
</section>
</section>

<section id="s5-4-6"><h3>User Registration and Network Authentication</h3>
<section id="s5-4-6-1"><h4>Procedure for User Registration and Authentication in network relying on IMS on the HNI-IGI Interface – HTTP Option</h4>
<section id="s5-4-6-1-1"><h5>User Registration</h5>
<p>This procedure SHALL be invoked in following cases:</p><ul>
<li>When the OITF is turned on or restarted if the OITF supports the native HNI-IGI function.
<li>When an IPTV end user explicitly logs on at an OITF using an Alias or IMPU or a default IMPU.</ul>
<p>The IG SHALL extract the deviceID from the sip instance feature tag.</p>
<p>If the deviceID and the IMPU match another deviceID and IMPU whose state is held in the IG, the IG SHALL conclude that the OITF has undergone a restart and SHALL proceed to immediately clear all SIP sessions belonging to the OITF. Following that, the IG SHALL de-register all users registered from that OITF.</p>
<p>If GRUU is not requested, the IG SHALL NOT perform IMS registration when the IMPU is already registered; however, the IG SHALL maintain a binding between the Alias/IMPU, the OITF device from which the registration is received (extracted from the sip instance feature tag) and the new contact information including the sip instance feature tag, which provides an easy way to guarantee uniqueness within the Address of Record (AOR).</p>
<p>Following the successful registration of the IMPU as per the procedure below, the IG SHALL maintain a binding between the Alias/IMPU, the OITF device (extracted from the sip instance feature tag described above) from which the registration is received, and the new contact information including the sip instance feature tag, which provides an easy way to guarantee uniqueness within the Address of Record (AOR).</p>
<p>If the identity being registered is the default identity, and if the default identity is not bound to any OITF in the consumer network, then the IG SHALL deregister its contact address for the default identity at the end of this procedure.</p>
<p>If the identity being registered is not the default identity and if the default identity is not bound to any OITF in the consumer network, then the IG SHALL deregister the default identity from the IG point of view at the end of this procedure.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG on the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t58" class="tableRef">58</a>
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers needed for the outgoing registration message, as per Table <a href="#t58" class="tableRef">58</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for the rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>Once the IG completes the IMS registration process, the IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF. The response SHALL include a list of SIP headers as per Table <a href="#t59" class="tableRef">59</a> in additional to the normal HTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>
<p>If the OITF does not support native HNI-IGI, user registration SHALL be done through a DAE application.</p>
</section>
<section id="s5-4-6-1-2"><h5>User De-registration</h5>
<p>This procedure is invoked in the following cases:</p><ul>
<li>The OITF is turned off and the OITF supports native HNI-IGI.
<li>An IPTV end user, who has registered with his own IMPU or a default IMPU, deregisters from an OITF.</ul>
<p>Prior to de-registering the IMPU, the IG SHALL clear all SIP sessions in which the IMPU is engaged on the specific OITF device from which the de-registration occurred and SHALL subsequently remove all bindings between the IMPU and all SIP sessions on the impacted OIPF. Following successful deregistration of the IMPU, the IG SHALL remove the binding between the IMPU and the OITF device from which the de-registration has occurred.</p>
<p>If GRUU is not supported for this registration, the IG SHALL NOT perform IMS deregistration when an IMPU is already registered on multiple OITFs, but the IG SHALL remove the binding between the IMPU and the OITF from which the user has deregistered (extracted from the sip instance feature tag) including the contact information (including the sip instance feature tag).</p>
<p>If GRUU is not supported for this registration, the IG SHALL perform the IMS deregistration procedure if the IMPU was bound to a single OITF.</p>
<p>Following a successful de-registration, the IG SHALL remove the binding between the Alias/IMPU, the OITF device from which the registration is received (extracted from the sip instance feature tag).</p>
<p>Note that if following the successful de-registration of the IMPU, and if there are no more OITFs still turned on in the consumer network, the IG SHALL re-register the default identity from the IG point of view.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send to the IG an HTTP POST request containing an X-OITF-Request-Line header on the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t58" class="tableRef">58</a>
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers needed for the outgoing de-registration message as per Table <a href="#t58" class="tableRef">58</a>. The IG SHALL reject any request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for the rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>Once the IG completes the IMS de-registration process, the IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF. The response SHALL include a list of SIP headers as per Table <a href="#t59" class="tableRef">59</a> in additional to the normal HTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>
<table id="t58" class="mapping">
<caption>Table ####: List of mandatory HTTP extension headers for User Registration/De-Registration (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI is that of the P-CSCF, and is fetched by the OITF as per section 7.1.1 of TS 183 019 [[!TS183019]]. The IG SHALL be responsible for resolving the domain name.</p></td><td>RFC 3261 [[!SIP]], RFC 3265 [[!SIP-EVNT]] and RFC 6080 [[!SIP-CFG]]<p>NOTIFY &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact
<p class="notes-list">Notes:</p><ol class="notes-list">
<li>Contact MUST include Feature Tags parameter.
<li>URI parameter MUST be included.
<li>Expires parameter SHOULD be included
<li>Priority parameter SHOULD be included</ol>
<p>IG adds all the other mandatory parameters that are absent in the X-OITF-Contact. Default values are assigned by the IG to OPTIONAL parameters that are not provided in the X-OITF-Contact.</p>
<ol  class="notes-list" start="5"><li>sip instance feature tag MUST be included according to sections <a href="https://tools.ietf.org/html/rfc5626#section-4.1" class="extRef">4.1</a> and <a href="https://tools.ietf.org/html/rfc5626#section-4.2" class="extRef">4.2</a> of [[!RFC5626]]. Its format SHALL be identical to the format specified in [[!RFC4122]].</ol>
<p>The sip instance feature tag SHALL have the following syntax: +sip.instance="&lt;urn:uuid:Unique-Instance&gt;"</p>
<p>where Unique-Instance SHALL be 128 bits and SHALL conform to the syntax in [[!RFC4122]].</p>
<p>The Node field is a 48 bit field which SHALL be populated with the first 48 bits from the value employed in &lt;deviceID&gt; used at restart or powerup of an OITF device.</p>
<p>The sip instance feature tag MUST be persistent across power cycles of the device.</p>
<p>All OITFs that want to be able to use the session transfer feature SHALL register the g.3gpp.icsi-ref media feature tag containing the IPTV IMS communication service identifier.</p>
<p>In particular the X-OITF-Contact header SHALL have the following media feature tag included:</p><ol class="manual">
<li>g.3gpp.icsi-ref="urn%3Aurn-7%3A3gpp-service.ims.icsi.iptv"</ol>
</td><td>RFC 3261 [[!SIP]] and RFC 3840 [[!RFC3840]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Supported<p>set to “gruu” if the feature is REQUIRED</p></td><td>RFC 3261 [[!SIP]]<p>RFC 5627 [[!RFC5627]]</p></td></tr>
</table>

<table id="t59" class="mapping">
<caption>Table ####: List of HTTP extension headers for User Registration/De-Registration Response (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>SIP header field prefixed with X-OITF</td></tr>
<tr><td>X-OITF-To</td><td>SIP header field prefixed with X-OITF</td></tr>
<tr><td>X-OITF-Expires</td><td>SIP header field prefixed with X-OITF</td></tr>
<tr><td>X-OITF-Contact<p>The returned contact SHALL include the following 3 elements if the GRUU feature is requested by the OITF:<br />pub-gruu, temp-gruu and the sip instance feature tag</p></td><td>SIP header field prefixed with X-OITF<p>RFC 5627 [[!RFC5627]]</p></td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<p>If the OITF does not support native HNI-IGI, user deregistration SHALL be done through a DAE application.</p>
</section>
<section id="s5-4-6-1-3"><h5>Procedure for Refreshing a Registration</h5>
<p>This procedure MAY be initiated by the OITF at any time before the expiry of the registration refresh timer.</p>
<p>The procedure is the same as the procedure for registering a user. A registration SHALL be terminated if it is not refreshed before the expiry of the registration refresh timer.</p>
<p>For an OITF-initiated registration, the IG SHALL consider a registration terminated (that is, the user de-registered) if it is not refreshed. In this case, the IG executed the procedures associated with user deregistration.</p>
</section>
<section id="s5-4-6-1-4"><h5>Procedure for Subscription to the Registration Event Package</h5>
<p>This procedure SHALL be invoked immediately after the successful registration of an IMPU (including the default identity) or an IPTV end-user identity.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG on the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t60" class="tableRef">60</a>
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers for the outgoing subscription request message, as per Table <a href="#t60" class="tableRef">60</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for the rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP SUBSCRIBE to the network, to subscribe to the Registration event, and SHALL wait for the response to the subscription request. The IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the subscription request. The response SHALL include a list of SIP headers as per Table <a href="#t61" class="tableRef">61</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>Following that, the OITF SHALL send an HTTP HNI-IGI PENDING_IG request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionTitleRef"></a>”), and SHALL wait for any response.</td></tr>
<tr><td class="label">Step 5:</td><td>When a SIP NOTIFY is received by the IG, the IG SHALL return a HTTP 200 OK response to the OITF. The response SHALL include the list of SIP headers as per Table <a href="#t62" class="tableRef">62</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]]. The body of the HTTP response SHALL include the SIP body received in the incoming NOTIFY (See also section <a href="#s6-1-3-2-2" class="sectionRef">6.1.3.2.2</a>, “<a href="#s6-1-3-2-2" class="sectionTitleRef"></a>.)”</td></tr>
<tr><td class="label">Step 6:</td><td>Once the OITF accepts the incoming SIP NOTIFY, it SHALL send an HTTP POST PENDING_IG request to the IG. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t63" class="tableRef">63</a>
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 7:</td><td>The IG SHALL send the SIP 200 OK response to the network and then SHALL return to Step 5 to handle any subsequent NOTIFY received from the network.</td></tr>
</table>
<table id="t60" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the HNI-IGI SUBSCRIBE Request for the Registration Event Package</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI SHALL be set to the Public identity of the IPTV end user who has just registered.</p></td><td>RFC 3261 [[!SIP]]<p>SUBSCRIBE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3265 [[!SIP-EVNT]] and RFC 3680 (registration event) [[!SIP-REG]]</td></tr>
<tr><td>X-OITF-Accept</td><td>RFC 3265 [[!SIP-EVNT]] and RFC 3680 [[!SIP-REG]]</td></tr>
<tr><td>X-OITF-Contact
<p class="notes-list">Notes:</p><ol class="notes-list">
<li>URI parameter SHALL be included, and SHALL match what is sent in the Contact header included in the registration request.
<li>Expires parameter SHOULD be included
<li>Priority parameter SHOULD be included</ol>
<p>The IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t61" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the response to an HNI-IGI SUBSCRIBE Request for the Registration Event Package</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>SIP header field prefixed with X-OITF</td></tr>
<tr><td>X-OITF-To</td><td>SIP header field prefixed with X-OITF</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t62" class="mapping">
<caption>Table ####: List of HTTP extension headers for a HNI-IGI NOTIFY request sent IG&rarr;OITF</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The Request URI MUST match the contact URI included in the contact field of the SIP SUBSCRIBE</p></td><td>RFC 3261 [[!SIP]]<p>NOTIFY &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3265 [[!SIP-EVNT]] and RFC 3680 [[!SIP-REG]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3265 [[!SIP-EVNT]] and RFC 3680 [[!SIP-REG]]</td></tr>
<tr><td>X-OITF-Subscription-State</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3265 [[!SIP-EVNT]] and RFC 3680 [[!SIP-REG]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

<table id="t63" class="mapping">
<caption>Table ####: List of HTTP extension headers in the response to a NOTIFY request</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>SIP header field prefixed with X-OITF</td></tr>
<tr><td>X-OITF-To</td><td>SIP header field prefixed with X-OITF</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-4-6-1-5"><h5>Procedure for Terminating a Subscription to the Registration Event Package</h5>
<p>This procedure SHALL be invoked prior to de-registering a user.</p>
<p>The procedure is the same as the procedure for initiating a subscription to the Registration event, however in this case the X-OITF-Expires header in Table <a href="#t60" class="tableRef">60</a> SHALL be set to 0.</p>
<p>For an OITF-initiated registration, the IG SHALL consider a subscription terminated if is not refreshed.</p>
</section>
<section id="s5-4-6-1-6"><h5>Refreshing Subscription to Registration Event</h5>
<p>The procedure is the same as the procedure for initiating a subscription.</p>
<p>It is the responsibility of the application initiating the subscription procedure to refresh the subscription according to the refresh subscription timer information received in the response to the subscription request. Refreshing the subscription SHOULD be performed before the expiry of the refresh timer. A subscription that is not refreshed before the expiration of the refresh timer SHALL be terminated.</p>
</section>
<section id="s5-4-6-1-7"><h5>Registration of DAE/Embedded Applications</h5>
<p>IMS applications, DAE or embedded, that are initiated in the OITF and expect unsolicited incoming messages SHALL register with the IMS network the feature tags and/or the appropriate service URN (ICSI) and /or IMS application reference identifier (IARI) for the initiated application where mandated by the specification governing the application [[!TS183063]], [[!SMPL-IM]], [[!TS124503]], [[!RFC3840]], [[!RFC3841]]. This allows unsolicited incoming SIP messages destined for users and targeted for these applications to be delivered to the appropriate application instance in the OITF.</p>
<p>The procedure used by an application for registering the appropriate feature tags and/or service URN (ICSI) and/or IARI is the same procedure used for user registration.</p>
</section>
</section>
<section id="s5-4-6-2"><h4>GBA Authentication</h4>
<p>Note that GBA authentication can be achieved using either the GBA Authentication using IMS Gateway procedure, specified in [[.OIPF_CSP2]] <a href="volume7.html#gba-authentication-using-ims-gateway" class="extRef">section 5.4.5</a> or the, more general, procedure, HTTP Digest Authentication using IMS Gateway in [[.OIPF_CSP2]] <a href="volume7.html#http-digest-authentication-using-ims-gateway" class="extRef">section 5.4.4</a>. The latter; more general procedure allows the use of different authentication mechanism in a way that is transparent to the OITF, including possible future authentication mechanisms, and should preferably be used. It is expected that GBA Authentication using IMS Gateway procedure will be deprecated and removed in future versions of this specification.</p>
<p>This section describes the HNI-IGI message for the GBA Authentication. For the details of the sequence for GBA Authentication, refer to  <a href="volume7.html#http-digest-authentication-using-ims-gateway" class="extRef">section 5.4.4</a> of [[.OIPF_CSP2]]. Note that GBA authentication applies only for user registration and authentication based on IMS AKA.</p>
<section id="s5-4-6-2-1"><h5>Initial GBA registration</h5>
<p>After IMS registration is successfully performed, and if the IG supports GBA Authentication, OITFs supporting native HNI-IGI SHALL issue following GBA registration request to the IG. OITFs that do not support native HNI-IGI do not support GBA.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-HNI-IGI-Request: GBA-Registration&gt;
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>After the GBA bootstrapping procedure over UNIS-9, the IG returns an HTTP 200 OK response with an empty body.</td></tr>
</table>
</section>
<section id="s5-4-6-2-2"><h5>Credential Retrieval by an OITF for Re-use of GBA Authentication</h5>
<p>The key Ks that is established during the GBA registration MAY be reused later for user authentication and service access by consumer network applications.</p>
<p>Each time an OITF needs to access a service that is offered by an AS (i.e. NAF) that requires GBA Authentication, a specific key Ks_NAF or Ks_ext_NAF SHALL be derived respectively by the IG or by the ISIM in the IG and the server side GBA Single Sign-on function (the BSF). This generated key SHALL be conveyed to the OITF in the consumer network by the IG, and to the AS by the server side GBA Single Sign-on function (the BSF). The key Ks_NAF or Ks_ext_NAF SHALL then be used for authentication between the OITF and the AS, using HTTP Digest authentication as specified by [[!UB-UA]]. The OITF SHALL act as the OIPF as specified in [[!UB-UA]].</p>
<p>As a pre-requisite to this procedure, the GBA procedure MUST have been successfully completed.</p>
<p>The complete procedure for retrieval of credentials by the OITF from the IG is specified in [[.OIPF_CSP2]].</p>
<p>The HNI-IGI procedure for credential retrieval is as follows:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG. The request includes the FQDN of the NAF. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-HNI-IGI-Request&gt; - set to Fetch-GBA-Credentials
<li>&lt;X-HNI-IGI-NAF-FQDN&gt; - set to NAF FQDN extracted from the HTTP authentication realm as specified in [[!UB-UA]].
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>
The IG SHALL generate Ks_NAF or Ks_ext_NAF with the ISIM. For clarity this specific key is named in the rest of the document Ks_(ext)_NAF and will refer to Ks_NAF in case of GBA_ME and Ks_ext_NAF in case of GBA_U and is computed as follows:<ul class="nobullet">
<li>Ks_(ext)_NAF = KDF (Ks, “gba-me”, RAND, IMPI, NAF_ID), where KDF is the key derivation function as specified in Annex B of [[!GAA]] and the key derivation parameters consist of the user's IMPI, the NAF_ID and RAND. The NAF_ID is constructed as follows: NAF_ID = FQDN of the NAF || Ua security protocol identifier as specified in 3GPP TS 33.220 [[!GAA]]. The identifier for Ua security protocol HTTP Digest authentication according to 3GPP TS 33.220 [[!GAA]] is (0x01,0x00,0x00, 0x00,0x02).</ul>
The IG SHALL return an HTTP 200 OK to the OITF that includes the Ks_(ext)_NAF, the B-TID, the lifetime of the key Ks_(ext)_NAF and OPTIONALly the intended identity. The lifetime indicates the expiry time of the key Ks_(ext)_NAF and is equal to the lifetime of the key Ks (which was specified by the BSF during the GBA bootstrapping procedure). The content of the HTTP 200 OK response is as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-HNI-IGI-KS_NAF&gt; - set to the computed Ks_(ext)_NAF
<li>&lt;X-HNI-IGI-B_TID&gt; - set to the B-TID
<li>&lt;X-HNI-IGI-LifeTime&gt; - set to life time of the key Ks_NAF
<li>&lt;X-HNI-IGI-Intended-Identity&gt; - set to the intended identity. This header is OPTIONAL and its use is described in [[.OIPF_CSP2]].
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
</table>
</section>
</section>
<section id="s5-4-6-3"><h4>HTTP Digest Authentication</h4>
This section describes the HNI-IGI messages for the HTTP Digest Authentication using IG. For the details of the sequence for HTTP Digest Authentication using IG, refer to  <a href="volume7.html#http-digest-authentication-using-ims-gateway" class="extRef">section 5.4.4</a> of [[.OIPF_CSP2]].
<section id="s5-4-6-3-1"><h5>HTTP Realm Retrieval by an OITF</h5>
After IMS registration is successfully performed, and if the IG supports HTTP Digest Authentication, OITFs supporting native HNI-IGI SHALL issue an HTTP realm retrieval request to the IG. OITFs that do not support native HNI-IGI do not support HTTP Digest Authentication using IG.
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-HNI-IGI-Request&gt; - set to Fetch-HTTP-Realms
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>
The IG SHALL return an HTTP 200 OK to the OITF that includes the list of supported auth-scheme and realm. The content of the HTTP 200 OK response SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-HNI-IGI-Auth-Realms&gt; - set to a list of comma-separated realm-value, for which HTTP authentication credentials are available in the IG. Realm-values are quoted string as defined in RFC 2617 [[!HTTPAUTH]].
<li>&lt;X-HNI-IGI-User-Agent-Tokens&gt; - set to a list of comma-separated tokens to append to the HTTP User-Agent of the OITF for signalling support of specific authentication schemes. If the IG supports GBA Authentication, the IG SHALL add “3gpp-gba” to the returned User-Agent tokens.
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
</table>
</section>
<section id="s5-4-6-3-2"><h5>HTTP Credential Retrieval by an OITF</h5>
<p>If the OITF has registered to an IG which supports HTTP Digest Authentication using IG, each time the OITF needs to access a service offered by an application server that requires HTTP authentication, the OITF may use credentials retrieved from the IG. The conditions under which an OITF uses HTTP credentials retrieved from the IG are described in [[.OIPF_CSP2]].</p>
<p>The complete procedure for use of HTTP credentials by the OITF retrieved from the IG is specified in [[.OIPF_CSP2]].
<p>The HNI-IGI procedure for HTTP credential retrieval is as follows:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG. The request includes the auth-scheme and realm as defined in RFC 2617 [[!HTTPAUTH]]. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-HNI-IGI-Request&gt; - set to Fetch-HTTP-Credentials
<li>&lt;X-HNI-IGI-User&gt; - set to the IMPU of the currently registered user.
<li>&lt;X-HNI-IGI-Auth-Scheme&gt; - set to auth-scheme as defined in RFC 2617 [[!HTTPAUTH]]
<li>&lt;X-HNI-IGI-Auth-Realm&gt; - set to realm as defined in RFC 2617 [[!HTTPAUTH]]
<li>&lt;X-HNI-IGI-Auth-Nonce&gt; - set to nonce (server nonce) as defined in RFC 2617 [[!HTTPAUTH]]
<li>&lt;X-HNI-IGI-Auth-CNonce&gt; - set to cnonce (client nonce) as defined in RFC 2617 [[!HTTPAUTH]]
<li>&lt;X-HNI-IGI-Auth-Algorithm&gt; - set to algorithm as defined in RFC 2617 [[!HTTPAUTH]]
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL return an HTTP 200 OK to the OITF that includes the user-id and password for the given auth-scheme and realm. The content of the HTTP 200 OK response is as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-HNI-IGI-Auth-Credentials&gt; - this header is set to H(A1) as defined in RFC 2617 [[!HTTPAUTH]]. If this header is empty or not present, there a no credentials available in the IG for this request.
<li>&lt;X-HNI-IGI-Intended-Identity&gt; - set to the intended identity. This header is optional and its use is described in [[.OIPF_CSP2]].
</ul></td></tr>
<tr><td>HTTP Response Body: Empty</td></tr>
</table>
</td></tr>
</table>
</section>
</section>
<section id="s5-4-6-4"><h4>User ID Retrieval for services relying on IMS credentials</h4></section>
The OITF SHALL retrieve a list of user IDs (IMPU and Alias) from the IG for service over the HNI-IGI interface. This procedure SHOULD NOT require user authentication. The IG SHALL at a minimum provide the default identity for the household and MAY provide all available identities. OITFs that do not support native HNI-IGI SHOULD retrieve the User IDs using DAE.
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-HNI-IGI-Request: Fetch-UserIDs&gt;
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG returns a list of user IDs (IMPU and Aliases) as follows:
<table class="http-element">
<tr><td>HTTP Response Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
</ul></td></tr>
<tr><td>HTTP Response Body: a list of IMPUs and Display names (alias). Elements are separated with commas, entries are separates with semi-colon, in the format &lt;IMPU1&gt;,&lt;alias1&gt;;&lt;IMPU2&gt;,&lt;alias2&gt;,... etc. The first entry SHALL be the default identity for the household.</td></tr>
</table>
</td></tr>
</table>
<p>The usage of IMPU and Alias by the OITF is defined by the CSP specification.</p>
<p>Depending on the policy of the IG and service provider, the IG MAY return the default identity only. In this case, the user of the OITF SHALL be REQUIRED to enter a user ID manually.</p>
</section>
</section>

<section id="s5-5"><h2>Protocols for Communications Functions using SIP</h2>
<section id="s5-5-1"><h3>CallerID</h3>
<section id="s5-5-1-1"><h4>Procedure for Instant Message Based Caller ID – HTTP Option</h4>
<section id="s5-5-1-1-1"><h5>Procedure on HNI-IGI</h5>
<p>The OITF supports the following procedure for Caller ID. The incoming message carrying a Caller ID can either be handled by a native application in the OITF, or in a DAE application. The same HNI-IGI message format is used in either case.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG receives an incoming SIP MESSAGE from the network.</td></tr>
<tr><td class="label">Step 2:</td><td>The IG forwards the information in the SIP MESSAGE to the OITF in the HTTP 200 OK response to a PENDING_IG request that was established when the application started. The list of SIP headers to be included in the message to the OITF SHALL be as per Table <a href="#t64" class="tableRef">64</a>. The body of the SIP MESSAGE SHALL be included in the HTTP response body.</td></tr>
<tr><td class="label">Step 3:</td><td>Upon receipt of the message, the OITF SHALL issue an HTTP POST request. The content of the HTTP request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t65" class="tableRef">65</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 4:</td><td>The IG SHALL send SIP 200 OK to the network.</td></tr>
</table>
Note: For handling of new incoming SIP MESSAGE, refer to  <a href="volume5.html#IMS-notifications" class="extRef">section 5.3.2</a> of the DAE specification [[.OIPF_DAE2]] titled “IMS Event Notification Framework”
<table id="t64" class="mapping">
<caption>Table ####: List of HTTP extension headers for an Instant Message Based Caller ID (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the IMS Public Identity (IMPU) of the target of the message</p></td><td>RFC 3261 [[!SIP]]<p>MESSAGE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3428 [[!SIP-IM]], Draft OMA-TS-SIMPLE_IM-V1_0-20080820-D [[!SMPL-IM]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t65" class="mapping">
<caption>Table ####: List of HTTP extension headers for the response to an Instant Message Based Caller ID (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
</section>
<section id="s5-5-1-2"><h4>Procedure for IMS Telephony Based Caller ID (optional)</h4>
<section id="s5-5-1-2-1"><h5>Procedure for HNI-IGI – HTTP Option</h5>
<p>The following procedure MAY be supported in the OITF for Caller ID presentation to the OITF user as a result for an incoming IMS voice call to the IG.</p>
<p>The incoming message, carrying information on the IMS voice call, can either be handled by a native application in the OITF, or by a DAE application. The same HNI-IGI message format is used in either case.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG receives an incoming SIP INVITE.</td></tr>
<tr><td class="label">Step 2:</td><td>The IG forwards the SIP INVITE to the OITF as an HTTP response to a PENDING_IG request. The list of SIP headers to be included in the message to the OITF SHALL be as per Table <a href="#t66" class="tableRef">66</a>. The content of the invite message SHALL also be included.</td></tr>
<tr><td class="label">Step 3:</td><td>Upon receipt of the message, the OITF issues an HTTP POST request indicating that the voice call is not supported by the OITF by response code 415 Unsupported Media Type. Other values MAY be used according to RFC 3261 [[!SIP]]. The content of the HTTP Request is as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per <a href="#t67" class="tableRef">67</a>
</ul></td></tr>
<tr><td>HTTP Request Body: application/sdp</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 4:</td><td>The IG SHALL forward the SIP response to the network.</td></tr>
<tr><td class="label">Step 5:</td><td>When the IG receives the SIP ACK from the network and SHALL forward it to the OITF as an HTTP response to a PENDING_IG request. The list of SIP headers to be included in the message to the OITF SHALL be as per Table <a href="#t68" class="tableRef">68</a>.</td></tr>
</table>
Note: For handling of new incoming INVITE messages for new dialogs, refer to <a href="volume5.html#IMS-notifications" class="extRef">section 5.3.2</a> of the DAE specification [[.OIPF_DAE2]] entitled “IMS Event Notification Framework”
<table id="t66" class="mapping">
<caption>Table ####: List of HTTP extension headers on the HNI-IGI interface (IG&rarr;OITF) for a received SIP INVITE</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the IMS Public User Identity of the target of the message</p></td><td>RFC 3261 [[!SIP]]<p>INVITE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]], ES 283 002 [[!ES283002]]</td></tr>
<tr><td>X-OITF-P-Called-Party-ID</td><td>ES 283 002 [[!ES283002]]</td></tr>
<tr><td>X-OITF-P-Asserted-Identity</td><td>ES 283 002 [[!ES283002]]</td></tr>
</table>
<table id="t67" class="mapping">
<caption>Table ####: List of HTTP extension headers on the HNI-IGI interface (OITF&rarr;IG) for a response to the SIP INVITE</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t68" class="mapping">
<caption>Table ####: List of HTTP headers in the HNI-IGI ACK Message (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the IMS Public User Identity of the target of the message</p></td><td>RFC 3261 [[!SIP]]<p>ACK &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

</section>
</section>
</section>
<section id="s5-5-2"><h3>Instant Messaging</h3>
<section id="s5-5-2-1"><h4>Procedure for Instant Messaging on HGI-INI – HTTP Option</h4>
<p>Instant Messaging on the OITF uses the HNI-IGI functionality, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.”</p>
<p>There are two cases, messages originating from the OITF, and messages terminating in the OITF.</p>
<section id="s5-5-2-1-1"><h5>Procedure for OITF Originating an Instant Messaging</h5>
<p>The following procedure is supported in the OITF to originate instant messages:</p>
<p>An instant message can either originate from a native application in the OITF or from a DAE application. The same HNI-IGI message format is used.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG using the HNI-IGI functionality, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per <a href="#t69" class="tableRef">69</a>
</ul></td></tr>
<tr><td>HTTP Request Body: The content type as per RFC 3428 [[!SIP-IM]]</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers for the message as per Table <a href="#t69" class="tableRef">69</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP MESSAGE to the network. When the IG receives the response, the IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the SIP MESSAGE. The response includes a list of SIP headers as per Table <a href="#t70" class="tableRef">70</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>
<table id="t69" class="mapping">
<caption>Table ####: List of HTTP extension headers for an outgoing Instant Message (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the Public identity of the target of the message</p></td><td>RFC 3261 [[!SIP]]<p>MESSAGE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t70" class="mapping">
<caption>Table ####: List of HTTP extension headers for the response to an outgoing and incoming Instant Message (IG&rarr;OITF and OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-5-2-1-2"><h5>Incoming Instant Messaging Procedure</h5>
<p>The following procedure is supported in the OITF for incoming instant messages.</p>
<p>The incoming message can be handled either by a native application in the OITF, or in a DAE application. The same HNI-IGI message format is used in either case.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG receives an incoming SIP MESSAGE</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL forward the SIP MESSAGE to the OITF as an HTTP response to a PENDING_IG request. The list of SIP headers to be included in the notification forwarded to the OITF SHALL be as per Table <a href="#t71" class="tableRef">71</a>. The body of the SIP MESSAGE SHALL be included in the HTTP body.</td></tr>
<tr><td class="label">Step 3:</td><td>Upon receipt of the message, the OITF SHALL issue an HTTP POST request. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per <a href="#t70" class="tableRef">70</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 4:</td><td>The IG SHALL forward the SIP 200 OK to the network.</td></tr>
</table>
<table id="t71" class="mapping">
<caption>Table ####: List of HTTP extension headers for an Incoming Instant Message (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the Public identity of the target of the message</p></td><td>RFC 3261 [[!SIP]]<p>MESSAGE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]], Draft OMA-TS-SIMPLE_IM-V1_0-20080820-D [[!SMPL-IM]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
</section>
</section>
<section id="s5-5-3"><h3>IM Session (Chat using MSRP)</h3>
<section id="s5-5-3-1"><h4>Procedure for Instant Messaging on HGI-INI – HTTP Option</h4>
To initiate a chatting session using MSRP, the OITF SHALL use the following procedure:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t72" class="tableRef">72</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>If the request is for an Instant Messaging MSRP Chat Session, the IG SHALL validate that the request includes all the mandatory SIP headers as per Table <a href="#t72" class="tableRef">72</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection. The IG SHALL generate the INVITE by mapping the X-OITF headers to the appropriate SIP header. As the IG implements MSRP, the IG SHALL include all the necessary additional SIP headers and the SDP body to initiate the MSRP session as follows:<ul>
<li>The Content-Type header SHALL be added and set to “application/sdp”
<li>The Content-Length header SHALL be added and set to the appropriate value
<li>The message body SHALL include the following information:<ul>
<li>A, c = IN IP4 &lt;IP address&gt; , where &lt;IP address&gt; would contain the IP address of the IG,
<li>An, m = message &lt;tcp port&gt; tcp/msrp, where tcp port is a TCP port could be set to the dummy value “9”
<li>An, a = accept-types:message/cpim, attribute which is mapped from the “X-OITF-Accept:” header value
<li>An a = path msrp://&lt;IP address&gt;:&lt;tcpport&gt;/&lt;session-id&gt;; tcp, where:<ul>
<li>&lt;IP address&gt; would contain the IP address of the IG
<li>&lt;tcpport&gt; would be assigned automatically by the IG
<li>&lt;session-id&gt; would be assigned automatically by the IG and bound to the requesting OITF Chatting application
</ul></ul></ul>
</td></tr>
<tr><td colspan="2">NOTE: In this case the IG is not service agnostic. The IG detects that this session is for MSRP by examining the X-OITF-Accept header which SHALL include message/cpim (See example in Annex <a href="#annex-b-2-1-2" class="sectionRef">B.2.1.2</a>, “<a href="#annex-b-2-1-2" class="sectionTitleRef"></a>.”)</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a HTTP 200 OK response to the OITF when the SIP 200 OK is received as a response to the session invitation. The SIP 200 OK headers are mapped as indicated in Table <a href="#t73" class="tableRef">73</a>, in addition to the normal HTTP 200 OK headers. The IG SHALL NOT forward the body of the SIP 200 OK to the OITF. The IG SHALL establish and maintain the MSRP state information including the binding between the logical entities (indicated in the From and To headers) and the corresponding path (the one initiated by the IG for the OITF and the one indicated by the distant entity for the To:). The IG SHALL maintain a binding between the SIP dialog and the MRSP state information for the duration of the SIP dialog.</td></tr>
<tr><td class="label">Step 4:</td><td>Upon receipt of a 200 OK response, the OITF SHALL send an HTTP PENDING_IG to acknowledge the final response. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t74" class="tableRef">74</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
</table>
<table id="t72" class="mapping">
<caption>Table ####: List of HTTP extension headers for IM INVITE request (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>The request URI SHALL be set to the IMPU of the subscriber with whom the session is requested.</p></td><td>RFC 3261 [[!SIP]]<p>INVITE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>MUST be set to the value of the request URI in the “X-OITF-Request-Line INVITE” header</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p class="notes-list">Notes:</p><ol class="notes-list">
<li>URI parameter SHALL be included and SHALL match what is sent in the Contact header included in the registration request.
<li>Expires parameter SHOULD be included
</ol></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept-Contact</td><td>Set according to [[!SMPL-IM]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept<p>SHALL be set to: “message/cpim”</p></td><td>[[!SMPL-IM]]</td></tr>
</table>
<table id="t73" class="mapping">
<caption>Table ####: List of HTTP extension headers for a 200 OK response received for the INVITE IG&rarr;OITF</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t74" class="mapping">
<caption>Table ####: List of HTTP extension headers in HNI-IGI ACK Request</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the ACK request SHALL be the contact included in the response to the INVITE message</p></td><td>RFC 3261 [[!SIP]]<p>ACK &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p>The URI parameter MUST be included, and MUST match what has been inserted in the INVITE message.</p><p>IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-5-3-2"><h4>MSRP Invocation – HTTP Option</h4>
<p>The OITF SHALL access MSRP capabilities in the IG using the X-HNI-IGI headers.</p>
<section id="s5-5-3-2-1"><h5>Outgoing MSRP Chat Messages</h5>
The OITF SHALL send an outgoing MSRP chat message using the following procedure:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of HNI-IGI headers encoded as HTTP headers&gt; - as per Table <a href="#t75" class="tableRef">75</a>
</ul></td></tr>
<tr><td>HTTP Request Body: The Message in plain text.</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory HNI-IGI headers for the process as per Table <a href="#t75" class="tableRef">75</a>. The IG SHALL reject a request that is missing any mandatory HNI-IGI headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL validate the Call-ID and the Message-ID, if present, and subsequently SHALL send an MSRP SEND message to the network, then wait for the MSRP 200 OK response from the network. The IG SHALL return a HTTP 200 OK response to the OITF when it receives the MSRP 200 OK (or other responses). The HTTP 200 OK response SHALL include the HNI-IGI headers as per Table <a href="#t76" class="tableRef">76</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>
<table id="t75" class="mapping">
<caption>Table ####: List of HNI-IGI HTTP extension headers for an MSRP SEND Request (OITF&rarr;IG)</caption>
<tr><th>X-HNI-IGI HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-HNI-IGI-Request<p>SEND MESSAGE</p></td><td>[[!SMPL-IM]]</td></tr>
<tr><td>X-HNI-IGI-Message-ID</td><td>SHALL be left blank for the first message.</td></tr>
<tr><td>X-HNI-IGI-Call-ID</td><td>SHALL be set to the same value for the INVITE transaction that initiated the session</td></tr>
<tr><td>X-HNI-IGI-From</td><td>SHALL be set to the identity of the originator of the message</td></tr>
<tr><td>X-HNI-IGI-To</td><td>SHALL be set to the identity of the recipient of the message</td></tr>
</table>
<table id="t76" class="mapping">
<caption>Table ####: List of HNI-IGI HTTP extension headers included in the HTTP 200 OK response (IG&rarr;OITF)</caption>
<tr><th>X-HNI-IGI Headers</th><th>Source of Coding Information</th></tr>
<tr><td>X-HNI-IGI-Response<p>MSRP &lt;Response&gt;</p></td><td>[[!SMPL-IM]]</td></tr>
<tr><td>X-HNI-IGI-Message-ID</td><td>[[!SMPL-IM]]</td></tr>
<tr><td>X-HNI-IGI-From</td><td>[[!SMPL-IM]]</td></tr>
<tr><td>X-HNI-IGI-To</td><td>[[!SMPL-IM]]</td></tr>
</table>
</section>
<section id="s5-5-3-2-2"><h5>Sending an MSRP Chat State Message</h5>
The OITF SHALL use the following procedure to indicate the activity of the user (e.g., “Is Composing”):
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of HNI-IGI headers encoded as HTTP headers&gt; - as per Table <a href="#t77" class="tableRef">77</a>
</ul></td></tr>
<tr><td>HTTP Request Body: SHALL contain the appropriate XML document as indicated in RFC 3994 [[!RFC3994]] and OMA-TS-SIMPLE-IM_V1_0-20080820-D [[!SMPL-IM]].</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory HNI-IGI headers for the process as per Table <a href="#t77" class="tableRef">77</a>. The IG SHALL reject a request that is missing any mandatory HNI-IGI headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL validate the Call-ID and the Message-ID, and send an MSRP SEND message to the network after performing the necessary mapping and adding the appropriate tags. The IG SHALL then wait for the MSRP 200 OK response from the network. The IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF when it receives the MSRP 200 OK (or other responses). The response SHALL include a list of HNI-IGI headers as per Table <a href="#t76" class="tableRef">76</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>
<table id="t77" class="mapping">
<caption>Table ####: List of HNI-IGI HTTP extension headers for an MSRP SEND ACTIVITY Request (OITF&rarr;IG)</caption>
<tr><th>X-HNI-IGI HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-HNI-IGI-Request<p>MSRP SEND ACTIVITY</p></td><td>OMA-TS-SIMPLE_IM-V1_0-20080820-D [[!SMPL-IM]]</td></tr>
<tr><td>X-HNI-IGI-Message-ID</td><td>SHALL be set to the appropriate message id</td></tr>
<tr><td>X-HNI-IGI-Call-ID</td><td>SHALL be set to the same value for the INVITE transaction that initiated the session</td></tr>
<tr><td>X-HNI-IGI-From</td><td>[[!SMPL-IM]]</td></tr>
<tr><td>X-HNI-IGI-To</td><td>[[!SMPL-IM]]</td></tr>
</table>
</section>
<section id="s5-5-3-2-3"><h5>Receiving an MSRP Chat Message</h5>
The IG SHALL use the following procedure when receiving an incoming MSRP message:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>In response to a PENDING_IG request, the IG SHALL send an HTTP 200 OK response to the OITF over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The response SHALL include the HNI-IGI headers listed in Table <a href="#t78" class="tableRef">78</a>, in addition to the mandatory HTTP headers in RFC 2616 [[!HTTP]]. The body of the HTTP 200 OK response SHALL include the received text.</td></tr>
<tr><td class="label">Step 2:</td><td>The OITF SHALL respond with an HTTP POST request with its body containing an MSRP 200 OK response. The contents of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of HNI-IGI headers encoded as HTTP headers&gt; - as per Table <a href="#t79" class="tableRef">79</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send the response from the OITF in an MSRP response message to the network after performing the necessary validation.</td></tr>
</table>
<table id="t78" class="mapping">
<caption>Table ####: List of HNI-IGI HTTP extension headers for an incoming MSRP message (IG&rarr;OITF)</caption>
<tr><th>X-HNI-IGI HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-HNI-IGI-Request<p>MSRP RECEIVE MESSAGE</p></td><td>[[!SMPL-IM]]</td></tr>
<tr><td>X-HNI-IGI-Message-ID</td><td>SHALL be set to the appropriate message id</td></tr>
<tr><td>X-HNI-IGI-Call-ID</td><td>SHALL be set to the same value for the INVITE transaction that initiated the session</td></tr>
<tr><td>X-HNI-IGI-From</td><td>SHALL be set to the remote user</td></tr>
<tr><td>X-HNI-IGI-To</td><td>SHALL be set to the recipient of the message</td></tr>
</table>
<table id="t79" class="mapping">
<caption>Table ####: List of HNI-IGI HTTP extension headers for an MSRP 200 OK Response to an incoming MSRP Message (OITF&rarr;IG)</caption>
<tr><th>X-HNI-IGI HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-HNI-IGI-Response<p>MSRP &lt;Response&gt;</p></td><td>Set to the appropriate Response</td></tr>
<tr><td>X-HNI-IGI-Message-ID</td><td>SHALL be set to the appropriate message id</td></tr>
</table>
</section>
<section id="s5-5-3-2-4"><h5>Receiving an MSRP Chat State Message</h5>
The IG SHALL use the following procedure when receiving an incoming MSRP Chat State message:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>In response to a PENDING_IG request, the IG SHALL send an HTTP 200 OK response to the OITF over the HNI-IGI interface, as described in OITF-IG Interface (HNI-IGI). The response SHALL include the HNI-IGI headers listed in Table <a href="#t80" class="tableRef">80</a> in addition to the mandatory HTTP headers in RFC 2616 [[!HTTP]]. The body of the HTTP 200 OK response SHALL contain the appropriate XML document as indicated in RFC 3994 [[!RFC3994]] and OMA-TS-SIMPLE-IM_V1_0-20080820-D [[!SMPL-IM]]</td></tr>
<tr><td class="label">Step 2:</td><td>The OITF SHALL respond with an HTTP POST request with its body containing an MSRP 200 OK response. The contents of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of HNI-IGI headers encoded as HTTP headers&gt; - as per Table <a href="#t79" class="tableRef">79</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send the response from the OITF in an MSRP response message to the network after performing the necessary validation.</td></tr>
</table>
<table id="t80" class="mapping">
<caption>Table ####: List of HNI-IGI HTTP extension headers for an incoming MSRP message (IG&rarr;OITF)</caption>
<tr><th>X-HNI-IGI HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-HNI-IGI-Request<p>MSRP RECEIVE ACTIVITY</p></td><td>OMA-TS-SIMPLE-IM-V1-0-20080820-D [[!SMPL-IM]]</td></tr>
<tr><td>X-HNI-IGI-Message-ID</td><td>SHALL be set to the appropriate message id</td></tr>
<tr><td>X-HNI-IGI-Call-ID</td><td>SHALL be set to the same value for the INVITE transaction that initiated the session</td></tr>
<tr><td>X-HNI-IGI-From</td><td>SHALL be set to the remote user</td></tr>
<tr><td>X-HNI-IGI-To</td><td>SHALL be set to the recipient of the message</td></tr>
</table>
</section>
</section>
<section id="s5-5-3-3"><h4>Terminating an IM Session (MSRP Chat) – HTTP Option</h4>
In order to terminate an MSRP session, the OITF SHALL use the following procedure:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t80" class="tableRef">80</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers for the process as per Table <a href="#t81" class="tableRef">81</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection. The IG SHALL generate the SIP BYE by mapping the X-OITF headers to the appropriate SIP headers.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a HTTP 200 OK response to the OITF when the SIP 200 OK is received as a response to the Chat session termination request. The SIP 200 OK headers are mapped as indicated in Table <a href="#t82" class="tableRef">82</a> in addition to the normal HTTP 200 OK headers.</td></tr>
</table>
<table id="t81" class="mapping">
<caption>Table ####: List of HTTP extension headers for an MSRP BYE request (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line</td><td>RFC 3261 [[!SIP]]<p>BYE &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p>SHALL be set to the value received in the contact of a 200 OK for session termination or SIP INVITE for session origination</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length<p>MUST be set to 0</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t82" class="mapping">
<caption>Table ####: List of HTTP extension headers for a 200 OK response to a BYE (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 200 OK</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length<p>Set to 0</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-5-3-4"><h4>Remote Termination of an IM Session (MSRP Chat) – HTTP Option</h4>
The IG SHALL use the following procedure when receiving an incoming SIP BYE message for an ongoing IM session (MSRP Chat):
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG receives a SIP BYE message from the network.</td></tr>
<tr><td class="label">Step 2:</td><td>The IG forwards the information in the SIP BYE to the OITF over the HNI-IGI interface in the HTTP 200 OK response to a PENDING_IG request. The response SHALL include the list of SIP headers listed in Table <a href="#t83" class="tableRef">83</a>, in addition to the mandatory HTTP headers in RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 3:</td><td>The OITF SHALL respond with an HTTP POST request. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded in HTTP headers&gt; - as per Table <a href="#t84" class="tableRef">84</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 4:</td><td>The IG SHALL send SIP 200 OK to the network.</td></tr>
</table>
<table id="t83" class="mapping">
<caption>Table ####: List of HTTP extension headers for an Incoming SIP BYE (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The Request URI MUST match the contact URI included in the contact field of the SIP INVITE (for outgoing session) or a 200 OK (for incoming session)</p></td><td>RFC 3261 [[!SIP]]<p>BYE &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length<p>MUST be set to 0</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t84" class="mapping">
<caption>Table ####: List of HTTP extension headers for the response to an SIP BYE (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-5-3-5"><h4>Procedure for Reception of a remotely initiated Instant Messaging Session (MSRP Chat) – HTTP Option</h4>
The IG SHALL use the following procedure when receiving an incoming SIP INVITE message for a new IM session (MSRP Chat):
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG receives a SIP INVITE message from the network.</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers as per Table <a href="#t85" class="tableRef">85</a>. This is REQUIRED since the IG MUST send all this information to the OITF. The IG SHALL reject any incoming request that is missing any mandatory parameter. Subsequently, the IG SHALL perform the following checks:<ul>
<li>Ensure that the Content-Type header is present and set to “application/sdp”
<li>Verify that the SDP body includes the following information:<ul>
<li>A c = IN IP4 &lt;IP address&gt;, where &lt;IP address&gt; would contain the remote IP address.
<li>An m = message &lt;tcp port&gt; tcp/msrp, where tcp port is a TCP port and could be set to the dummy value “9”
<li>An a = accept-types:message/cpim, attribute which is mapped from the Accept header value.
<li>A a = path msrp://&lt;IP address&gt;:&lt;tcpport&gt;/&lt;session-id&gt;; tcp, where:<ul>
<li>&lt;IP address&gt; would contain the remote IP address
<li>&lt;tcpport&gt; remote IP port
<li>&lt;session-id&gt; assigned automatically by the remote peer.
</ul></ul></ul></td></tr>
<tr><td class="label">Step 3:</td><td>Following that, the IG retains and stores information in the SDP, and forwards only the information in the SIP INVITE headers to the OITF over the HNI-IGI interface in the HTTP 200 OK response to a PENDING_IG request that was sent by the OITF to the IG when the application was launched. The response SHALL include the list of SIP headers listed in Table <a href="#t85" class="tableRef">85</a>, in addition to the mandatory HTTP headers in RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>The OITF SHALL respond with an HTTP POST request that includes the OITF response to the incoming INVITE. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded in HTTP headers&gt; - as per Table <a href="#t86" class="tableRef">86</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 5:</td><td>The IG SHALL append the SDP to the SIP 200 OK before sending it to the network. The appended SDP SHALL include the following information:<ul>
<li>A c = IN IP4 &lt;IP address&gt; , where &lt;IP address&gt; would contain the IP address of the IG,
<li>An m = message &lt;tcp port&gt; tcp/msrp, where tcp port is a TCP port could be set to the dummy value “9”
<li>An , a = accept-types:message/cpim, attribute which is mapped from the “X-OITF-Accept:” header value
<li>An a = path msrp://&lt;IP address&gt;:&lt;tcpport&gt;/&lt;session-id&gt;; tcp, where:<ul>
<li>&lt;IP address&gt; would contain the IP address of the IG
<li>&lt;tcpport&gt; would be assigned automatically by the IG
<li>&lt;session-id&gt; would be assigned automatically by the IG and bound to the responding OITF Chatting application
</ul></ul>
</td></tr>
<tr><td class="label">Step 6:</td><td>The IG receives a SIP ACK message from the network</td></tr>
<tr><td class="label">Step 7:</td><td>Following that, the IG SHALL send the information in the incoming ACK message to the OITF in a HTTP 200 OK response. The response includes a list of SIP headers as per Table <a href="#t87" class="tableRef">87</a>.
<p><b>Note:</b> Any SDP information is retained in the IG since the IG handles the MSPP protocol</p></td></tr>
<tr><td class="label">Step 8:</td><td>The OITF SHALL send an HTTP HNI-IGI PENDING_IG request to the IG and SHALL wait for any incoming messages.</td></tr>
</table>
<table id="t85" class="mapping">
<caption>Table ####: List of HTTP extension headers for an incoming IM INVITE request (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>The request URI SHALL be set to the IMPU of the subscriber with whom the session is intended</p></td><td>RFC 3261 [[!SIP]]<p>INVITE &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>MUST be set to the value of the request URI in the “X-OITF-Request-Line INVITE” header</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept-Contact</td><td>Set according to [[!SMPL-IM]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept<p>SHALL be set to: “message/cpim”</p></td><td>[[!SMPL-IM]]</td></tr>
</table>
<table id="t86" class="mapping">
<caption>Table ####: List of HTTP extension headers for the response to an Incoming IM INVITE Request (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept<p>SHALL be set to “message/cpim”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p class="notes-list">Notes:</p><ol class="notes-list">
<li>URI parameter SHALL be included and SHALL match what is returned in the contact header includes in the response to the registration process
<li>Expires parameter SHOULD be included</ol></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t87" class="mapping">
<caption>Table ####: Supported HTTP extension headers in HNI-IGI ACK Request for successful IM Session (MSRP Chat) (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the ACK request SHALL be the contact included in the response to the INVITE message</p></td><td>RFC 3261 [[!SIP]]<p>ACK &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p>The URI parameter SHALL be included, and SHALL match what been received in the incoming INVITE message.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
</section>
<section id="s5-5-4"><h3>Presence</h3>
<section id="s5-5-4-1"><h4>Procedures for Subscription to Presence on the HNI-IGI interface – HTTP Option</h4>
The procedure for subscription to the Presence event SHALL be invoked from either a DAE application or an embedded application in the OITF. The procedure is as follows:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded in HTTP headers&gt; - as per Table <a href="#t88" class="tableRef">88</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers for the subscription process as per Table <a href="#t88" class="tableRef">88</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP SUBSCRIBE to the network, to subscribe to the Presence event, and SHALL wait for the response to the subscription request. The IG SHALL then return a HTTP 200 OK response to the OITF to report the response to the subscription request. The response includes a list of SIP headers as per Table <a href="#t89" class="tableRef">89</a>, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>The OITF SHALL send an HTTP HNI-IGI PENDING_IG request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionTitleRef"></a>”), and SHALL wait for any incoming messages.</td></tr>
<tr><td class="label">Step 5:</td><td>When a SIP NOTIFY is received by the IG, the IG SHALL return a HTTP 200 OK response to the OITF containing the information in the incoming NOTIFY message. The response includes a list of SIP headers as per Table <a href="#t90" class="tableRef">90</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]]. The body of the HTTP response SHALL include the SIP body received in the incoming NOTIFY compliant to Annex E of [[!TS183063]].</td></tr>
<tr><td class="label">Step 6:</td><td>Once the OITF accepts the incoming SIP NOTIFY, it SHALL send an HTTP POST PENDING_IG request to the IG to acknowledge the receipt of notification and issue a new pending HTTP request. The content of the HTTP request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded in HTTP headers&gt; - as per Table <a href="#t91" class="tableRef">91</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 7:</td><td>The IG SHALL send the SIP 200 OK response to the network and then SHALL return to Step 5 to handle any subsequent NOTIFY received from the network.</td></tr>
</table>
The OITF SHALL ensure that the presence related data conforms to the appropriate XML schemas.
</section>
<section id="s5-5-4-2"><h4>Procedure for Cancellation of a Subscription to Presence on the HNI-IGI interface – HTTP Option</h4>
<p>This procedure MAY be invoked at any time.</p>
<p>The OITF SHALL de-register the IPTV end user before invoking this procedure.</p>
<p>The procedure is essentially the same as the procedure for initiating a subscription to the Presence event, except that the X-OITF-Expires header in Table 88 SHALL be set to 0.</p>
<table id="t88" class="mapping">
<caption>Table ####: List of HTTP extension headers for a SUBSCRIBE Request (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI SHALL be set to the Public identity of the IPTV end user who has just registered</p></td><td>RFC 3261 [[!SIP]]<p>SUBSCRIBE &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3265 [[!SIP-EVNT]], OMA-ERP-Presence_SIMPLE-V1_1-20080627-A [[!SMPL-PRES]]</td></tr>
<tr><td>X-OITF-Accept</td><td>RFC 3265 [[!SIP-EVNT]], OMA-ERP-Presence_SIMPLE-V1_1-20080627-A [[!SMPL-PRES]]</td></tr>
<tr><td>X-OITF-Contact<p class="notes-list">Notes:</p><ol class="notes-list">
<li>URI parameter MUST be included, and MUST match the Contact header included in the registration request.
<li>Expires parameter SHOULD be included
<li>Priority parameter SHOULD be included</ol>
<p>IG includes all other mandatory parameters that are absent.</p>
</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires<p>Note: If absent a default value SHALL be assumed by the IG</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3265 [[!SIP-EVNT]], OMA-ERP-Presence_SIMPLE-V1_1-20080627-A [[!SMPL-PRES]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t89" class="mapping">
<caption>Table ####: List of HTTP extension headers for the response to a SUBSCRIBE to Presence (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t90" class="mapping">
<caption>Table ####: SupportedList of HTTP extension headers for a SUBSCRIBE Request (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The Request URI MUST match the contact URI included in the contact field of the SIP SUBSCRIBE</p></td><td>RFC 3261 [[!SIP]]<p>NOTIFY &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3265 [[!SIP-EVNT]], OMA-ERP-Presence_SIMPLE-V1_1-20080627-A [[!SMPL-PRES]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Subscription-State</td><td>RFC 3265 [[!SIP-EVNT]], OMA-ERP-Presence_SIMPLE-V1_1-20080627-A [[!SMPL-PRES]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3265 [[!SIP-EVNT]], OMA-ERP-Presence_SIMPLE-V1_1-20080627-A [[!SMPL-PRES]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contac</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t91" class="mapping">
<caption>Table ####: List of HTTP extension headers for a Response to a received SIP NOTIFY (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
NOTE: Cancellation of subscription is not REQUIRED if the X-OITF-Expires header was set to 0 in the initial SUBSCRIBE request
</section>
<section id="s5-5-4-3"><h4>Refreshing the Subscription to the Presence Event – HTTP Option</h4>
<p>It is the responsibility of the application (in the OITF) initiating the subscription procedure to refresh the subscription according to the refresh subscription timer received in the response during the subscription process. Refreshing SHOULD be performed before the expiry of the refresh timer. A subscription that is not refreshed before the expiration of the refresh subscription timer SHALL be terminated by the network.</p>
<p>]The procedure for refreshing the subscription to the Presence event is the same as the procedure for subscribing to Presence.</p>
</section>
<section id="s5-5-4-4"><h4>Procedure for Publishing Presence information – HTTP Option</h4>
This procedure for publishing an event MAY be invoked from either a DAE application or an embedded application in the OITF. The procedure is as follows:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded in HTTP headers&gt; - as per Table <a href="#t92" class="tableRef">92</a>
</ul></td></tr>
<tr><td>HTTP Request Body: As per section <a href="#s5-5-4-6" class="sectionRef">5.5.4.6</a>, “<a href="#s5-5-4-6" class="sectionTitleRef"></a>.”</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers for the publication process as per Table <a href="#t92" class="tableRef">92</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP PUBLISH to the network. When the IG receives the response, the IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the publish request. The response SHALL include a list of SIP headers as per Table <a href="#t93" class="tableRef">93</a>, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
</table>
<table id="t92" class="mapping">
<caption>Table ####: List of HTTP extension headers for the PUBLISH Request (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the IMS Public User Identity of the IPTV end user who has just registered</p></td><td>RFC 3261 [[!SIP]]<p>PUBLISH &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3265 [[!SIP-EVNT]], OMA-ERP-Presence_SIMPLE-V1_1-20080627-A [[!SMPL-PRES]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Expires</td><td>RFC 3261 [[!SIP]], RFC 3903 [[!RFC3903]]</td></tr>
<tr><td>X-OITF-SIP-If-Match</td><td>RFC 3903 [[!RFC3903]]</td></tr>
<tr><td>X-OITF-Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t93" class="mapping">
<caption>Table ####: List of HTTP extension headers for a response to SIP PUBLISH (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-ETag</td><td>RFC 3261 [[!SIP]], RFC 3903 [[!RFC3903]]</td></tr>
<tr><td>X-OITF-Expires</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-5-4-5"><h4>Procedure for Refreshing Published Presence information – HTTP Option</h4>
It is the responsibility of the OITF to refresh the published presence information before the refresh timer expires. A published event that is not refreshed SHALL be deleted in accordance with RFC 3903 [[!RFC3903]].
</section>
<section id="s5-5-4-6"><h4>Presence Notification and Publish Schema</h4>
<p>When the IPTV Presence service is active, the body of the PUBLISH request SHALL include the extended OMA presence schema compliant to section 5.1.6 of [[!TS183063]] “Procedure for IPTV presence service”.
<p>In the extended OMA presence XML document, each service is described by the “service-description” OMA parameter as specified in OMA-ERP-Presence_SIMPLE-V1_1-20080627-A [[!SMPL-PRES]]. New “service-id” values are defined for IPTV with the following values:</p><ul>
<li>IPTV-BC: Scheduled Content service, defined in [[!TS183063]] section 5.1.6.
<li>IPTV-CoD: Content on Demand Service, defined in [[!TS183063]] section 5.1.6.
<li>IPTV-NPVR: Network PVR Service, defined in [[!TS183063]] section 5.1.6.
<li>Broadcast-TV: DVB-T/H/C/S Service, defined in Annex <a href="#presence-xml-schema" class="sectionRef">H</a>, “<a href="#presence-xml-schema" class="sectionTitleRef"></a>”</ul>
<p>When the user has an active IPTV Presence service, the &lt;tuple&gt; element pertaining to the active service SHALL contain the corresponding element as defined in the presence schema.</p>
</section>
</section>
<section id="s5-5-5"><h3>Content Sharing</h3>
<section id="s5-5-5-1"><h4>Procedure for OITF Content Sharing Capability query</h4>
Capability of the other terminal can be queried, i.e. is recipient capable of supporting Content Share session or not. To perform a Capability query, the OITF MAY use the following procedure:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t94" class="tableRef">94</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory HNI-IGI headers for the process as per Table <a href="#t94" class="tableRef">94</a>. The IG SHALL reject a request that is missing any mandatory HNI-IGI headers with a non-200 OK HTTP response, including the reason for rejection. The IG SHALL generate the SIP OPTIONS by mapping the X-OITF headers to the appropriate SIP header.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP OPTIONS to the network. The receiving OITF generates the response base on the black-white list. When the sender is in black list (means the sender has no right to query the receiving OITF’s capability), the receiving OITF MUST reject the request with a non-200 OK response, including the reason for rejection. When the sender is in white list (means the sender has right to query the receiving OITF’s capability), the receiving OITF MUST response the request with a 200 OK, including the information set of the receiving OITF which the sender has right to query.</td></tr>
<tr><td class="label">Step 4:</td><td>
When the IG receives the response, the IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the SIP OPTIONS. The content of the HTTP Response shall be:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t94" class="tableRef">94</a>
</ul></td></tr>
<tr><td>HTTP Request Body: application/sdp</td></tr>
</table>
<p>The response body includes the SDP offer generated by the OITF. SDP SHALL be used as specified in [[!TS124503]]</p><ul>
<li>An m=&lt;media&gt; &lt;port&gt; &lt;transport&gt; &lt;fmt&gt;
<li>An a=rtpmap:&lt;payload type&gt; &lt;encoding name&gt;
</ul>
<p>]The 200 OK body includes the SDP generated by the OITF which is the recipient of the OPTIONS to indicate supports for Content Share service. SDP SHALL be used as specified in [[!TS124503]].</p>
</td></tr>
</table>
<table id="t94" class="mapping">
<caption>Table ####: List of HTTP extension headers on the HNI-IGI interface (OITF&rarr;IG) for a SIP OPTIONS request and response (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>The request URI SHALL be set to the Public identity of the IPTV target end user</p></td><td>RFC 3261 [[!SIP]]<p>PUBLISH &lt;OPTIONS URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>MUST be set to the value of the request URI in the “X-OITF-Request-Line OPTIONS” header</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact
<p class="notes-list">Notes:</p><ol class="notes-list"><li>URI parameter SHALL be included and SHALL match what is sent in the Contact header included in the registration request.<li>Expires parameter SHOULD be included</ol>
</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept<p>Accept: application/sdp</p></td><td>RFC 3261 [[!SIP]], RFC 3903 [[!RFC3903]]</td></tr>
<tr><td>X-OITF-Accept-Contact<p>SHALL be set to +g.3gpp.icsi-ref="urn%3Aurn-7%3A 3gpp-service.ims.icsi.mmtel " and +g.3gpp.iari-ref=" urn%3Aurn-7%3A 3gpp-application.ims.iari.gsma-vs".</p></td><td>[[!VIDEOSHARE]]</td></tr>
<tr><td>X-OITF-Content-Length<p>Set to 0</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-5-5-2"><h4>Invitation Procedure for OITF Originating a Content Sharing</h4>
To initiate a Content Sharing session to another OITF, the OITF SHALL use the following procedure:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t95" class="tableRef">95</a>
</ul></td></tr>
<tr><td>HTTP Request Body: application/sdp</td></tr>
</table>
<p>The request body includes the SDP offer generated by the OITF. SDP SHALL be used as specified in [[!TS124503]].</p><ul>
<li>An m=&lt;media&gt; &lt;port&gt; &lt;transport&gt; &lt;fmt&gt;
<li>A c =&lt;network type&gt; &lt;address type&gt; &lt;connection address&gt; to indicate connection data at media level
<li>One or more a=fmtp lines representing RTSP specific attributes
<li>An “a=” line with a “sendonly”
<li>An a=X -type: videolive/ videoclip , to be used to indicate the receiving user whether the Video is a live feed from the camera or whether the video is from a recorded clip.
<li>One or more a=file-selector lines which parameterize the file to be transferred
<li>An "b=" to indicate the bandwidth for each media stream</ul>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory HNI-IGI headers for the process as per Table <a href="#t95" class="tableRef">95</a>. The IG SHALL reject a request that is missing any mandatory HNI-IGI headers with a non-200 OK HTTP response, including the reason for rejection. The IG SHALL generate the SIP INVITE by mapping the X-OITF headers to the appropriate SIP header.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a SIP INVIE to the network. When the IG receives the response, the IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the SIP INVITE. The response includes a list of SIP headers as per Table <a href="#t96" class="tableRef">96</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>Upon receipt of a 200 OK response, the OITF SHALL send an HTTP PENDING_IG to acknowledge the final response. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t97" class="tableRef">97</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
</table>
<table id="t95" class="mapping">
<caption>Table ####: List of HTTP extension headers on the HNI-IGI interface (OITF&rarr;IG) for a SIP INVITE request</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>The request URI SHALL be set to the IMPU of the subscriber with whom the session is requested.</p></td><td>RFC 3261 [[!SIP]]<p>INVITE &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>MUST be set to the value of the request URI in the “X-OITF-Request-Line INVITE” header</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact
<p class="notes-list">Notes:</p><ol class="notes-list"><li>URI parameter SHALL be included and SHALL match what is sent in the Contact header included in the registration request.<li>Expires parameter SHOULD be included</ol>
</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept-Contact<p>SHALL be set to +g.3gpp.icsi-ref="urn%3Aurn-7%3A 3gpp-service.ims.icsi.mmtel " and +g.3gpp.iari-ref=" urn%3Aurn-7%3A 3gpp-application.ims.iari.gsma-vs".</p></td><td>[[!VIDEOSHARE]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t96" class="mapping">
<caption>Table ####: List of HTTP extension headers for a 200 OK response received for the INVITE IG&rarr;OITF</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]], RFC 3903 [[!RFC3903]]</td></tr>
</table>
<table id="t97" class="mapping">
<caption>Table ####: List of HTTP extension headers in HNI-IGI ACK Request</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>The Request-URI in the ACK request SHALL be the contact included in the response to the INVITE message</p></td><td>RFC 3261 [[!SIP]]<p>ACK &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact<p>The URI parameter MUST be included, and MUST match what has been inserted in the INVITE message.</p><p>IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Accept-Contact<p>SHALL be set to +g.3gpp.icsi-ref="urn%3Aurn-7%3A 3gpp-service.ims.icsi.mmtel " and +g.3gpp.iari-ref=" urn%3Aurn-7%3A 3gpp-application.ims.iari.gsma-vs".</p></td><td>[[!VIDEOSHARE]]</td></tr>
</table>
</section>
<section id="s5-5-5-3"><h4>Procedure for OITF Refresh a Content Sharing Session</h4>It is the responsibility of the OITF application to refresh the Content Sharing session before the session expires. The IG SHALL consider a session terminated if it is not refreshed.</section>
<section id="s5-5-5-4"><h4>Procedure for Modification of a Content Sharing Session</h4>
<p>To perform session modification during an ongoing Content Sharing session, the OITF SHALL generate a re-INVITE request as defined in Table <a href="#t95" class="tableRef">95</a>. The OITF SHALL include a new SDP offer in the session modification request reflecting the purpose of the session modification request.</p>
<p>Examples of events that can lead to session modification include bandwidth changes, putting the ongoing session on hold, sharing of a new content by any peer, etc.</p>
</section>
<section id="s5-5-5-5"><h4>Transferring a Content Sharing Session</h4>
<section id="s5-5-5-5-1"><h5>OITF Target Discovery</h5>
<p>An OITF that wants to locate a target OITF for session transfer purposes SHALL perform the procedures described in section <a href="#s5-4-6-1-4" class="sectionRef">5.4.6.1.4</a>, “<a href="#s5-4-6-1-4" class="sectionTitleRef"></a>”.</p>
<p>Subsequently a target OITF can be selected from the returned information.</p>
</section>
<section id="s5-5-5-5-2"><h5>Transferor OITF Initiating a Session Transfer Request - Push Mode</h5>
<p>The following procedure SHALL be supported for the receiving OITF to select the appropriate OITF for consumption of the content.</p>
<p>A transferor SHALL initiate the request for a Content sharing session to transfer to an appropriate OITF. Upon successful transfer of the session, Content Sharing service will be streamed to the target device.</p>
<p>To initiate a session transfer request, the transferor OITF SHALL follow the following procedure:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>As a pre-requisite it is assumed that the transferor OITF user is receiving a Content sharing session and has selected a target device (transferee OITF) for the session.<p>In this step the transferor OITF SHALL include the transferee identifier; IMS service identifier and SDP in the SIP REFER (as shown in step 2) message.</p></td></tr>
<tr><td class="label">Step 2:</td><td>The transferor OITF SHALL send an HTTP POST request for the session transfer to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>”. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t98" class="tableRef">98</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers as per Table 98 and send SIP REFER to the network, The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection.</td></tr>
<tr><td class="label">Step 4:</td><td>The IG SHALL send a SIP REFER to the network, to setup the request and SHALL wait for the response. At some point in time, the IG SHALL return a HTTP 202 Accept response (or other appropriate responses) to the transferor OITF to report the received response from the transferee to the transfer request. The response SHALL include a list of SIP headers as per Table <a href="#t47" class="tableRef">47</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 5:</td><td>Following that, the transferor OITF SHALL send an HTTP HNI-IGI PENDING_IG request (refer to section <a href="#s5-6-1-1" class="sectionRef">5.6.1.1</a>, “<a href="#s5-6-1-1" class="sectionTitleRef"></a>”), and SHALL wait for any response reporting the outcome of the session transfer procedure.</td></tr>
<tr><td class="label">Step 6:</td><td>At some point in time, the IG SHALL receive an incoming SIP NOTIFY from the remote OITF, reporting the outcome of the session transfer and which it SHALL forward to the transferor OITF in an HTTP 200 OK response. The HTTP response SHALL include the list of SIP headers as per Table <a href="#t99" class="tableRef">99</a> in addition to the normal HTTP headers. The body of the HTTP response SHALL include the SDP body received in the NOTIFY.</td></tr>
<tr><td class="label">Step 7:</td><td>The transferor OITF SHALL return the SIP 200 OK response, acknowledging the SIP NOTIFY, to the IG, in an HTTP POST PENDING_IG request. The content of the HTTP request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t49" class="tableRef">49</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
</table>
<table id="t98" class="mapping">
<caption>Table ####: List of HTTP extension headers for an outgoing SIP REFER from the transferor for initiating up a session transfer request (OITF&rarr;IG) and incoming SIP REFER request to the transferee (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI SHALL be set to the identifier of the transferee (target OITF).</p></td><td>RFC 3261 [[!SIP]]<p>REFER &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To<p>The URI part of X-OITF-To SHALL be set to the value of the Request URI in the “X-OITF-Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Refer-To
<p>SHALL be set to the remote target URI included in the contact header field returned in the SIP 200 OK associated with initial session setup with the transferor and extended with the following URI headers fields:</p><ul>
<li>Replaces header field SHALL include the SIP dialog identifier for the original Content sharing session as per [[!RFC3891]]
<li>Require header field populated with the option tag value “replaces”
<li>To header field SHALL contain the original content identifier copied from the Request URI of the original SIP INVITE request initiated from the transferor.
<li>an Accept-Contact header field SHALL be set to +g.3gpp.icsi-ref="urn%3Aurn-7%3A 3gpp-service.ims.icsi.mmtel” and +g.3gpp.iari-ref=" urn%3Aurn-7%3A 3gpp-application.ims.iari.gsma-vs".
<li>Body header. Contains the SDP body to be included in the SIP request initiated from the transferor OITF. The SDP body SHALL contain the same number of media lines as the SDP used in the original session from the transferor OITF. Each media line SHALL indicate the same media type as its corresponding media component in the SDP used in the original session by the transferor OIPF. The media line for the media to be transferred SHALL include a port number with non zero value.</ul>
</td><td>RFC 3261 [[!SIP]]<p>[[!RFC3515]]</p><p>[[!RFC3891]]</p></td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t99" class="mapping">
<caption>Table ####: Supported HTTP extension headers in the NOTIFY request sent from the transferee OITF (OITF&rarr;IG) to the transferor (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The Request URI MUST match the contact URI included in the contact field of the SIP REFER</p></td><td>RFC 3261 [[!SIP]]<p>REFER &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Event</td><td>RFC 3515 [[!RFC3515]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Subscription-State</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s5-5-5-5-3"><h5>Remote OITF Receiving an Incoming Session Transfer Request – Push Mode</h5>
The remote OITF is having a content sharing session with transferor OITF. The procedure for remote OITF in a push mode is as follows:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>It is assumed that the remote OITF has an HTTP PENDING_IG request. At some point in time, when a REFER request targeted for the transferee OITF is received by the IG, the IG SHALL return a HTTP 200 OK response to the OITF. The response SHALL include the list of SIP headers as per Table <a href="#t98" class="tableRef">98</a>, in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]]. The body of the HTTP response SHALL include the XML structure as per section <a href="#s5-3-13-2" class="sectionRef">5.3.13.2</a>, “<a href="#s5-3-13-2" class="sectionTitleRef"></a>”.</td></tr>
<tr><td class="label">Step 2:</td><td>The remote OITF SHALL examine the incoming REFER request including the security checking and IMS Content Sharing service identifying. In particular, the OITF SHALL extract the body header to use it to later construct its own SDP for the session transfer. If the OITF cannot successfully validate the extracted SDP, it SHALL reject the incoming request. If the OITF successfully validates the extracted SDP it SHOULD accept the incoming request.</td></tr>
<tr><td class="label">Step 3:</td><td>Once the remote OITF accepts the incoming SIP REFER, it SHALL send an HTTP POST PENDING_IG request to the IG. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t47" class="tableRef">47</a> with the exception that the response in this case is a SIP 202 OK
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 4:</td><td>The remote OITF SHALL extract the following information from the incoming REFER request:<ul>
<li>The Content URI extracted from the To header included in the Refer-To header.
<li>The body header
<li>The Dialog ID to be replaced extracted from the Replace header in the Refer-To header
<li>The m line extracted from SDP, m line indicated the multimedia session information of content sharing</ul></td></tr>
<tr><td class="label">Step 5:</td><td>At some point in time, the remote OITF SHALL then construct an SDP that it can used to initiate a new session to the transferee OITF. The remote OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>”.</td></tr>
<tr><td class="label">Step 6:</td><td>The IG SHALL validate that the request includes all the mandatory HNI-IGI headers. The IG SHALL reject a request that is missing any mandatory HNI-IGI headers with a non-200 OK HTTP response, including the reason for rejection. The IG SHALL generate the SIP INVITE by mapping the X-OITF headers to the appropriate SIP header as per Table <a href="#t95" class="tableRef">95</a>, requesting set up a new session with transferee OITF.</td></tr>
<tr><td class="label">Step 7:</td><td>The IG SHALL send a SIP INVIE to the network. When the IG receives the response, the IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the OITF to report the response to the SIP INVITE. The response includes a list of SIP headers as per Table <a href="#t96" class="tableRef">96</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 8:</td><td>Upon receipt of a 200 OK response, the remote OITF SHALL send an HTTP PENDING_IG to acknowledge the final response. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t97" class="tableRef">97</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 9:</td><td>At some point in time, the IG SHALL receive an incoming SIP NOTIFY from the remote OITF, reporting the outcome of the session transfer and which it SHALL forward to the transferor OITF in an HTTP 200 OK response. The HTTP response SHALL include the list of SIP headers as per Table <a href="#t99" class="tableRef">99</a> in addition to the normal HTTP headers. The body of the HTTP response SHALL include the SDP body received in the NOTIFY.</td></tr>
<tr><td class="label">Step 10:</td><td>At some point in time, IG SHALL receiving the SIP 200 OK response from the transferor OITF indicating the acknowledgement of the SIP NOTIFY, in an HTTP POST PENDING_IG request. The content of the HTTP request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t49" class="tableRef">49</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
</table>
</section>
<section id="s5-5-5-5-4"><h5>Transferee OITF Receiving an Incoming Session Transfer Request – Push Mode</h5>
The remote OITF is having a content sharing session with transferor OITF. The procedure at the transferee OITF receiving an incoming session transfer request in a push mode is as follows:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>It is assumed that the transferee OITF has an HTTP PENDING_IG request. At some point in time, when a INVITE request targeted for the transferee OITF is received by the IG, the IG SHALL return a HTTP 200 OK response to the transferee OITF. The response SHALL include the list of SIP headers as per Table <a href="#t95" class="tableRef">95</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 2:</td><td>The transferee OITF SHALL examine the incoming INVITE request including the security checking and IMS Content Sharing service identifying. In particular, the transferee OITF SHALL extract the body header for the session transfer. If the OITF cannot successfully validate the extracted SDP, it SHALL reject the incoming request. If the OITF successfully validates the extracted SDP it SHOULD accept the incoming request.</td></tr>
<tr><td class="label">Step 3:</td><td>When the IG receives the response, the IG SHALL return a HTTP 200 OK response (or other appropriate responses) to the remote OITF to report the response to the SIP INVITE. The response includes a list of SIP headers as per Table <a href="#t96" class="tableRef">96</a> in addition to the normal HTTP headers as per RFC 2616 [[!HTTP]].</td></tr>
<tr><td class="label">Step 4:</td><td>Upon receipt of a 200 OK response, the remote OITF SHALL send an HTTP PENDING_IG to acknowledge the final response. The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t97" class="tableRef">97</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
</table>
</section>
</section>
<section id="s5-5-5-6"><h4>Procedure for OITF Terminating a Content Sharing Session</h4>
In order to terminate a content sharing session, the OITF SHALL use the following procedure:
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF SHALL send an HTTP POST request to the IG over the HNI-IGI interface, as described in section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.” The content of the HTTP Request SHALL be as follows:
<table class="http-element">
<tr><td>HTTP Request Header: Including the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;list of SIP headers encoded as HTTP headers&gt; - as per Table <a href="#t100" class="tableRef">100</a>
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL validate that the request includes all the mandatory SIP headers for the message as per Table <a href="#t100" class="tableRef">100</a>. The IG SHALL reject a request that is missing any mandatory SIP headers with a non-200 OK HTTP response, including the reason for rejection. The IG SHALL generate the SIP BYE by mapping the X-OITF headers to the appropriate SIP headers.</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL send a HTTP 200 OK response to the OITF when the SIP 200 OK is received as a response to the content sharing session termination request. The SIP 200 OK headers are mapped as indicated in Table <a href="#t101" class="tableRef">101</a> in addition to the normal HTTP 200 OK headers.</td></tr>
</table>
<table id="t100" class="mapping">
<caption>Table ####: List of HTTP extension headers for an SIP BYE request (OITF&rarr;IG)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Request-Line<p>Note: The request URI MUST be set to the contact return in the 200 OK for the invite.</p></td><td>RFC 3261 [[!SIP]]<p>BYE &lt;Request URI&gt; SIP/ 2.0</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Length<p>MUST be set to 0</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t101" class="mapping">
<caption>Table ####: List of HTTP extension headers for a 200 OK response to a BYE (IG&rarr;OITF)</caption>
<tr><th>X-OITF HTTP Header</th><th>Source of Coding Information</th></tr>
<tr><td>X-OITF-Response-Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 200 OK</p></td></tr>
<tr><td>X-OITF-From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>X-OITF-CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

</section>
</section>
</section>

<section id="s5-6"><h2>Protocols System Infrastructure Functions</h2>
<section id="s5-6-1"><h3>OITF-IG Interface (HNI-IGI)</h3>
<section id="s5-6-1-1"><h4>HNI-IGI Message Types</h4>
<p>The HTTP protocol is used to exchange information between the IG and the OITF. The IG behaves as an HTTP server and the OITF behaves as an HTTP client. The OITF part MAY be implemented either in native code or in DAE applications.</p>
<p>There are several aspects of information on the HNI-IGI interface.</p><ul>
<li>Normal HTTP headers
<li>Application specific information that is translated by the IG into SIP headers. These are included as HTTP extension headers and have the same name as in the SIP message, but are prefixed with X-OITF.
<li>Application specific information that forms the Body of a SIP message. This corresponds to the SIP message body and is included as a body in the HTTP request or response. An example message body type is SDP.
<li>HNI-IGI auxiliary information that is only used between OITF and IG. These parameters are prefixed with X-HNI-IGI. An example is those parameters related to the fetching of GBA credentials by the OITF for re-use of GBA authentication mechanism for single sign-on (see section <a href="#s5-4-6-2-2" class="sectionRef">5.4.6.2.2</a>, “<a href="#s5-4-6-2-2" class="sectionTitleRef"></a>”).
</ul>
<p>The general format of an HNI-IGI HTTP request is</p><ul class="nobullet">
<li><code>HTTP POST &lt;IG URI&gt;/&lt;HNI-IGI message type&gt;</code>
<li><code>&lt;HTTP headers&gt;</code>
<li><code>&lt;X-OITF extension headers&gt; or &lt;X-HNI-IGI extension headers&gt;</code>
<li><code>Content-Type: &lt;...&gt;</code>
<li><code>Content-Length: &lt;Number&gt;</code>
<li><code>&lt;Message body&gt;</code>
</ul>
<p>The general format of an HNI-IGI HTTP response is</p><ul class="nobullet">
<li><code>HTTP/1.1 &lt;HTTP response&gt;</code>
<li><code>&lt;HTTP headers&gt;</code>
<li><code>&lt;X-OITF extension headers&gt; or &lt;X-HNI-IGI extension headers&gt;</code>
<li><code>Content-Type: &lt;...&gt;</code>
<li><code>Content-Length: &lt;Number&gt;</code>
<li><code>&lt;Message body&gt;</code>
</ul>
<p>The following table lists the HNI-IGI message types</p>
<table id="t102" class="simple">
<caption>Table ####: HNI-IGI Message Types</caption>
<tr><th>HNI-IGI message type</th><th>Meaning</th></tr>
<tr><td>PENDING_IG</td><td>The message is a pending HTTP request, that SHALL only be responded to by the IG when it needs to contact the OITF as a result of an incoming request from the network (e.g. an incoming MESSAGE)</td></tr>
<tr><td>SIP</td><td>The message is an HNI-IGI message corresponding to a SIP message. The IG MUST translate this into a corresponding SIP message by adding and changing the relevant headers.</td></tr>
<tr><td>AUX</td><td>The message is an HNI-IGI message that does not translate to a SIP message. The IG processes this message and responds accordingly.</td></tr>
</table>
<p>Messages over the HNI-IGI interface can be sent in both directions.</p><ul>
<li>Normal HTTP requests are used for requests from the OITF and responses from the IG.
<li>There MUST be a HTTP request from the OITF to the IG with the response pending to allow new (unsolicited) messages from the network to be sent from the IG to the OITF in the response., This is a special kind of HNI-IGI message, called PENDING_IG.</ul>
<p>An example of SIP header that is mapped to an HTTP extension header is: “From: david@oiptv.org” that becomes “X-OITF-From:david@oiptv.org”</p>
<p>Note that only AUX HNI-IGI message types are used by the HNI-IGI SIP option (see section <a href="#s5-6-1-6" class="sectionRef">5.6.1.6</a>, “<a href="#s5-6-1-6" class="sectionTitleRef"></a>”.)</p>
</section>
<section id="s5-6-1-2"><h4>HNI-IGI messages in the OITF to IG direction – HTTP Option</h4>
<p>When the IG receives an HNI-IGI message, it SHALL add or change all SIP headers that are not specific to the application (Tags, Call ID, via, request URI etc.) while translating from HTTP to SIP.</p>
<p>The following table lists header values for the HNI-IGI protocol that the IG and OITF SHALL support and lists the IG action on those headers.</p>
<table class="simple first-nowrap" id="t103">
<caption>Table ####: X-OITF HTTP Extension Headers and IG actions for OITF&rarr;IG messages</caption>
<tr><th>HNI-IGI Header</th><th>Description</th><th>IG Action</th></tr>
<tr><td>X-OITF-Request-Line</td><td>This is a special header which contains the SIP method and request URI for the corresponding SIP message, when the SIP message is a request, e.g. X-OITF-Request-Line PUBLISH sip:david@oiptv.org SIP/2.0</td><td>The IG SHALL map this field to the SIP request line.</td></tr>
<tr><td>X-OITF-Response-Line</td><td>This is a special header which contains the response line of the corresponding SIP message, when the SIP message is a response, e.g. 200 OK</td><td>The IG SHALL map this field to construct the SIP response line.</td></tr>
<tr><td>X-OITF-Call-ID</td><td>Keeps track of sessions and dialogs.</td><td>The IG SHALL use this field internally between an OITF and the IG to keep track of sessions. The IG replaces it with a value maintained in SIP state machine on the SIP side.</td></tr>
<tr><td>X-OITF-Contact</td><td>Each method has its own use of the Contact field.</td><td>The IG SHALL map to the corresponding SIP header. The IG MAY add other parameters.</td></tr>
<tr><td>X-OITF-CSeq</td><td>Used to keep track of requests and responses.</td><td>IG SHALL use this field internally between an OITF and the IG to keep track of requests and responses, and replace it with a value maintained by the IG on the SIP side. The IG SHALL include the same value in subsequent responses to the OITF. The OITF SHALL respond with an error code if the value is incorrect.</td></tr>
<tr><td>X-OITF-From</td><td></td><td>The IG SHALL map to the corresponding SIP header. The IG MAY add information in sub-fields.</td></tr>
<tr><td>X-OITF-Event</td><td></td><td>The IG SHALL map to the corresponding SIP header.</td></tr>
<tr><td>X-OITF-Expires</td><td></td><td>The IG SHALL map to the corresponding SIP header.</td></tr>
<tr><td>X-OITF-To</td><td></td><td>The IG SHALL map to the corresponding SIP header.</td></tr>
<tr><td>X-OITF-Content-Type</td><td></td><td>The IG SHALL map to the corresponding SIP header, and SHALL match it with the actual body included in the HTTP request.</td></tr>
<tr><td>X-OITF-Content-Length</td><td></td><td>The IG SHALL verify the length of the message and insert the value in the SIP message.</td></tr>
<tr><td>X-HNI-IGI-Request</td><td>This header specifies the request type of the HNI-IGI message.</td><td>See appropriate sections.</td></tr>
</table>
<p>The above headers are not present in all HNI-IGI messages, and are not the only headers that can be present.</p>
<p>The OITF SHALL use an IMPU in X-OITF headers where an IMPU is REQUIRED in the SIP header.</p>
<p>The OITF MAY include other headers that are application specific (e.g. X-OITF-Accept-Contact) in which case the IG SHALL include them transparently in the SIP method as long as they comply with the appropriate syntax for the header. Reference SHOULD be made to the various services using the HNI-IGI interface for a list of the headers that MUST be present.</p>
</section>
<section id="s5-6-1-3"><h4>HNI-IGI messages in the IG to OITF direction – HTTP Option</h4>
<p>When the IG translates a SIP message to an HNI-IGI HTTP message, it SHALL remove SIP Headers that SHOULD NOT be transmitted on the HNI-IGI interface, while translating from SIP to HTTP.</p>
<p>The following table lists header values in the SIP protocol that the IG and OITF SHALL support and the action the IG undertakes when mapping to the HNI-IGI protocol.</p>
<table class="simple" id="t104">
<caption>Table ####: Mapping of SIP header to X-OITF HTTP Extension Headers in IG&rarr;OITF</caption>
<tr><th>SIP Header</th><th>Description</th><th>IG Action</th></tr>
<tr><td>Request Line (first line of SIP request message)</td><td>The Request Line contains the method and a SIP URI.</td><td>The IG SHALL use this field to construct the X-OITF-Request-Line</td></tr>
<tr><td>Response Line (first line of SIP response message)</td><td>The Response Line contains the response code and SIP version information.</td><td>The IG SHALL use this field to construct the X-OITF-Response-Line</td></tr>
<tr><td>Call-ID</td><td>Keeps track of sessions and dialogs.</td><td>The IG SHALL replace this with value used between IG and OITF in the X-OITF-Call-ID.</td></tr>
<tr><td>Contact</td><td></td><td>The IG SHALL map to the corresponding HNI-IGI header.</td></tr>
<tr><td>CSeq</td><td></td><td>The IG SHALL use this field to keep track of requests and responses on the HNI interface. The IG SHALL and replace it with a value maintained in the IG. The IG SHALL include the same value in subsequent responses to the OITF. The OITF SHALL respond with an error code if the value is smaller than the previous one.</td></tr>
<tr><td>From</td><td></td><td>The IG SHALL map to corresponding HNI-IGI header. The IG MAY add information in sub-fields.</td></tr>
<tr><td>Event</td><td></td><td>The IG SHALL map to the corresponding HNI-IGI header.</td></tr>
<tr><td>Expires</td><td></td><td>The IG SHALL map to the corresponding HNI-IGI header.</td></tr>
<tr><td>To</td><td></td><td>The IG SHALL map to the corresponding HNI-IGI header.</td></tr>
<tr><td>Content-Type</td><td></td><td>The IG SHALL map to the corresponding HNI-IGI header.</td></tr>
<tr><td>Content-Length</td><td></td><td>The IG SHALL verify the length of the message and insert value in the HNI-IGI message.</td></tr>
</table>
<p>The above headers MAY not be present in all HNI-IGI messages.</p>
<p>The IG SHALL map any other received SIP headers by adding X-OITF- to the specific SIP header. Reference SHOULD be made to the various services using the HNI-IGI interface for a list of the headers that MUST be present.</p>
<p>The IG handles the SIP state machines.</p>
</section>
<section id="s5-6-1-4"><h4>HNI-IGI PENDING_IG Message – HTTP Option</h4>
<p>HNI-IGI PENDING_IG messages are sent by DAE and embedded applications in the OITF whenever these applications are ready to receive any incoming message from the network.</p>
<p>PENDING_IG messages MAY include a SIP Request or a SIP response. In this case, there is typically an ongoing SIP dialog between the OITF application and a peer SIP end-point in the IMS network.</p>
<p>HTTP headers included in a PENDING_IG message that includes a SIP request or a SIP response are the &lt;X-OITF extension headers&gt; that are pertinent to the application. The content of such a message SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Request Header: In includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-OITF Extension headers&gt; Any number of those extension headers depending on the application
</ul></td></tr>
<tr><td>HTTP Request Body: &lt;SIP Message Body if applicable&gt;</td></tr>
</table>
<p>PENDING_IG messages that don’t include a SIP request or a SIP response are typically sent by applications in the OITF that don’t have any ongoing communication with a SIP peer but are prepared to handle incoming requests for the IPTV user associated with any active application running in the OITF, or applications that have an ongoing SIP dialog with a SIP peer and are prepared to receive any SIP messages within that dialog. The content of PENDING_IG messages that don't include a SIP request or a SIP response SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Request Header: In includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-OITF-Call-ID&gt; Set to NULL for applications without an ongoing dialog or set to the proper value for applications with an ongoing SIP dialog.
<li>&lt;X-OITF-From&gt; Set to the IMPU of the target user associated with any active application in the OITF for applications without an ongoing dialog. Not needed for applications with an ongoing SIP dialog.
</ul></td></tr>
<tr><td>HTTP Request Body: Empty</td></tr>
</table>
<p>Note that once the target OITF application accepts an incoming request, the Call-ID in the outgoing response SHALL be set to the value used by the IG in its request to the OITF.</p>
<p>The content of the HTTP response to either of the above requests SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Response Header: In includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-OITF Extension headers&gt; Any number of those extension headers depending on the application
</ul></td></tr>
<tr><td>HTTP Response Body: &lt;Appropriate Message Body if applicable&gt;</td></tr>
</table>

<section id="s5-6-1-4-1"><h5>Refreshing of HNI-IGI PENDING_IG Message</h5>
<p>HNI-IGI PENDING _IG messages SHALL have to be refreshed periodically by the OITF. The refresh time SHALL be maintained in the IG and SHALL NOT exceed a SIP Session Expiry timer, or a SIP subscription Refresh timer for the SIP session under consideration.</p>
<p>To enable an OITF to refresh an HNI-IGI PENDING_IG request, the IG SHALL, upon timer expiry, send an HTTP 200 OK response that does not include any X-OITF-&lt;Extension headers&gt;.</p>
<p>Upon receipt of such a response, the OITF MAY decide to resend a new HNI-IGI PENDING_IG request or simply gracefully terminate the session.</p>
</section>
<section id="s5-6-1-4-2"><h5>Cancelling an HNI-IGI PENDING_IG Message</h5>
<p>The IG considers an HNI-IGI PENDING_IG Request cancelled SHOULD it encounter one of the following events:<ul>
<li>The TCP connection on which the HNI-IGI PENDING_IG Request has been received is explicitly disconnected or timed out
<li>The IG received from the OITF application with an outstanding HNI-IGI PENDING_IG Request an HNI IGI SIP Request to terminate the session (a SIP BYE)
<li>The IG received from the OITF application with an outstanding HNI-IGI PENDING_IG Request an HNI IGI SIP Request to terminate an ongoing subscription (a SIP SUBSCRIBE with X-OITF-Expiry set to 0)</ul>
<p>For the last 2 cases, the IG SHALL send an HTTP 200 OK response that does not include any X-OITF-&lt;Extension-headers&gt; as a response to the PENDING-IG request. OPTIONALly, the IG MAY empty its internal buffers that MAY include in-transit messages destined for the applications.</p>
</section>
</section>
<section id="s5-6-1-5"><h4>HNI-IGI SIP Message – HTTP Option</h4>
<p>HNI-IGI SIP messages are sent by DAE and embedded applications in the OITF whenever these applications are ready to send a SIP Request or a SIP response. The content of such a message SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Request Header: In includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-OITF Extension headers&gt; Any number of those extension headers depending on the application
</ul></td></tr>
<tr><td>HTTP Request Body: &lt;SIP Message Body if applicable&gt;</td></tr>
</table>
<p>The content of the HTTP response SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Response Header: In includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-OITF Extension headers&gt; Any number of those extension headers depending on the application
</ul></td></tr>
<tr><td>HTTP Response Body: &lt;SIP Message Body if applicable&gt;</td></tr>
</table>
</section>
<section id="s5-6-1-6"><h4>HNI-IGI Auxiliary Message</h4>
<p>HNI-IGI auxiliary messages are sent by DAE and embedded applications in the OITF whenever these applications are ready to send messages that are neither SIP type nor PENDING_IG type (for example fetching GBA credentials).</p>
<p>The content of such a message SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Request Header: In includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-HNI-IGI-Request&gt; Identifies the request
<li>&lt;X-HNI-IGI Extension headers&gt; Any number of those extension headers depending on the request
</ul></td></tr>
<tr><td>HTTP Request Body: &lt;Application Message Body if applicable&gt;</td></tr>
</table>
<p>The content of the HTTP response SHALL be as follows:</p>
<table class="http-element">
<tr><td>HTTP Response Header: In includes the following:<ul>
<li>&lt;list of HTTP headers&gt; - as per RFC 2616 [[!HTTP]]
<li>&lt;X-OITF Extension headers&gt; Any number of those extension headers depending on the application
</ul></td></tr>
<tr><td>HTTP Response Body: &lt;Application Message Body if applicable&gt;</td></tr>
</table>
<p>Note that only one auxiliary message, GBA-Registration, applies to both the HTTP and SIP options. All other auxiliary messages apply only to HTTP option.</p>
</section>
<section id="s5-6-1-7"><h4>HNI-IGI Message Body – HTTP Option</h4>The HNI-IGI messages in either direction SHALL include transparently the appropriate SIP body for the different SIP methods in the HTTP message body.</section>
<section id="s5-6-1-8"><h4>Guidelines for Applications using the HNI-IGI interface – HTTP Option</h4>
<p>This section lists some guidelines that apply to DAE application and OITF applications that use the HNI-IGI interface. Both types of application are referred to as Application here:</p><ul>
<li>It is the responsibility of the Application to ensure that it provides all the SIP headers that are REQUIRED for the correct operation of the application.
<li>The IG SHALL absorb “100 Trying” responses received from the network and not return them to the OITF.
<li>The IG SHALL transparently handle X-OITF-SIP headers received over the HNI-IGI interface unless specifically stated in this specification.
<li>It is the responsibility of the Application to generate an ACK as the 2XX final response of an INVITE transaction; for non-2XX responses, the IG SHALL generate the ACK.
<li>Validation (of message structure and XML schema) of received XML data SHALL be the responsibility of the Application.
<li>The Application SHOULD ensure that a SIP method is supported by the IG before using it.
<li>The IG SHALL return a 405 Method Not Allowed error fault if it receives a request over the HNI-IGI that includes a SIP method that it does not support.
<li>The Pending Request SHALL be refreshed as per section <a href="#s5-6-1-4-1" class="sectionRef">5.6.1.4.1</a>, “<a href="#s5-6-1-4-1" class="sectionTitleRef"></a>.”
<li>An HTTP pending request sent to the IG MAY include a SIP response (or SIP request if no response is expected) to be transmitted to the SIP network.
<li>The only identified case where a PENDING-IG request SHALL include a SIP request is the case where the OITF application sends an ACK.
</ul>
</section>
<section id="s5-6-1-9"><h4>Error Recovery in the IG – HTTP Option</h4>
<p>This section covers the handling in the IG for encountered error-cases:<ol>
<li>If the IG detects a timeout, or an explicit disconnection on all TCP links between an OITF application and the IG, the IG SHALL consider the application inactive. The application MAY become active again by re-establishing the TCP link with the IG. Any incoming SIP Messages destined for an application that is inactive SHALL result in an error message 487 Request Terminated (481 Call Leg/Transaction Does Not Exist is also an acceptable response if the IG concludes that the application is permanently inactive) being returned to the network as a response. For an inactive application, the SIP dialog in the IG SHALL eventually time-out and clear all resources in the IG and the network.
<p>In order to cater to the scenario of transient TCP link disconnects, and to allow incoming messages that are received by the IG during the time it takes the OITF to re-establish a TCP link following a disconnection, it is RECOMMENDED that the IG waits no more than 1 second before it responds to the network with a 487 or a 481 error message.</p>
<li>In cases where the WANGW is integrated into the IG (herein referred to as IG-WANGW), the IG-WANGW SHALL detect that an OITF is restarted upon receipt of a DHCP server discovery request (DHCPDISCOVER message) and IP address request (DHCPREQUEST message), and where the IG-WANGW internal state indicates that the OITF is powered on. In such a case, the IG-WANGW SHALL terminate all active SIP sessions, the IG-WANGW SHALL de-register all users that are logged in from the restarted OITF as stored in the IG-WANGW state. Note that the IG-WANGW is able to keep a mapping between the SIP dialogs ongoing, the IMPUs of registered users and the IP addresses and deviceIDs of the devices being used. Following deletion of stale SIP state and de-registration of users, the IG-WANGW SHALL act on the OITF start up high level procedure Requests.
<p>If the IG does not have access to the DHCP information exchanged between the OITF and the WANGW, refer to section <a href="#s5-4-6" class="sectionRef">5.4.6</a>, “<a href="#s5-4-6" class="sectionTitleRef"></a>” in case the OITF undergoes a restart.</p>
<li>The OITF SHALL detect that an IG is restarted when all TCP links to the IG timeout simultaneously, or are explicitly disconnected. If this is the case, the OITF SHALL refrain from sending any message to the IG until such time that the OITF detects that the IG has restarted, using UPnP IG discovery procedure in that regard (polling). Following that, the OITF SHALL execute steps 2-6 of the “<a href="#annex-f-1" class="sectionTitleRef"></a>”.</ol>
<p>For a transition period following an IG restart, active SIP sessions in the network (that will eventually timeout and be cleared) that are no longer active in the IG, will continue to send SIP messages to the IG, to which the IG SHALL respond with error message 481 Call Leg/Transaction Does Not Exist.</p>

</section>
</section>
</section>
<section id="s5-7"><h2>Protocols for Content Preparation</h2>
<section id="s5-7-1"><h3>Reference points NPI-45, NPI-46, NPI-CSPT3 and NPI-CSPG3</h3>
<p>The reference points specified here are introduced in [[.OIPF_ARCH2]].</p>
<section id="s5-7-1-1"><h4>Overview</h4>
<p>This section describes the reference points NPI-45 and NPI-46 between CoD or Scheduled Content Encryption Functions and Key Management Function. Encryption Functions call this interface when managing keys and DRM signaling for CoD and unicast Scheduled Content. For the case of multicast Scheduled Content the appropriate interface is the ECMG &hArr; SCS interface defined in [[!DVB-SC]].</p>
<p>The interface described in this section is exposed by the Key Management Function which is in charge of:</p><ul>
<li>synchronizing content keys between DRM by exposing services allowing:<ul>
<li>the Encryption Functions to retrieve the keys that have to be used to encrypt a content,
<li>the Encryption Functions to provision keys (to Key Management Function), if keys are generated by the Encryption Functions or another entity,</ul>
<li>centralizing the signaling that has to be inserted in the media for each DRM.
</ul>
<p>These interfaces apply in particular when content is used in a multi-DRM mode where the content is encrypted once and the corresponding keys are shared by all the DRM. Signaling specific to every DRM may be inserted in the content.</p>
<p>This interface specification is also applicable to the reference points NPI-CSPT3 and NPI-CSPG3. In this case the interface described in this section is exposed by the CSP-T Server or CSP-G Server, which are in charge of:</p><ul>
<li>retrieving or providing keys used to encrypt a content,
<li>providing the signaling that has to be inserted in the media for a given DRM.
</ul>
</section>
<section id="s5-7-1-2"><h4>Interface implementation</h4>
<p>The interface is implemented as a WEB service. The associated Classification Scheme is provided in section <a href="#s5-7-2" class="sectionRef">5.7.2</a>.</p>
<p>Each reference point identifies a calling entity and a called entity:</p>
<table id="t105" class="simple">
<caption>Table ####: Reference Points calling entity and called entity</caption>
<tr><th>Reference Point</th><th>Calling entity</th><th>Called entity</th></tr>
<tr><td>NPI-45</td><td>CoD Encryption Function</td><td>Key Management Function</td></tr>
<tr><td>NPI-46</td><td>Scheduled Content Encryption Function</td><td>Key Management Function</td></tr>
<tr><td>NPI-CSPT3</td><td>Key Management Function</td><td>CSP-T Server</td></tr>
<tr><td>NPI-CSPG3</td><td>Key Management Function</td><td>CSP-G Server</td></tr>
</table>
<p>Three operations are defined. They are intended to be used according to the role of the functional entities as shown through Table <a href="#t106" class="tableRef">106</a>.</p>
<table id="t106" class="simple">
<caption>Table ####: Operations according to functional entity roles</caption>
<tr><th> </th><th>Key rotation handled by:</th><th>Called Entity</th><th>Calling Entity</th></tr>
<tr><th>Key generation handled by:</th><th>Called Entity</th><td>getKeyScheduleSignaling</td><td>setScheduleAndGetKeySignaling</td></tr>
<tr><th></th><th>Calling Entity</th><td>This case is not supported.</td><td>setKeyScheduleAndGetSignaling</td></tr>
</table>

<section id="s5-7-1-2-1"><h5>getKeyScheduleSignaling operation</h5>
<section id="s5-7-1-2-1-1"><h6>Method and parameters</h6>
<table id="t107" class="simple">
<caption>Table ####: getKeyScheduleSignaling method parameters</caption>
<tr><th colspan="2">Operation Name</th><th>Description</th></tr>
<tr><td colspan="2">getKeyScheduleSignaling</td><td>Operation name</td></tr>
<tr><th>Field Name</th><th>Field Type</th><th>Description</th></tr>
<tr><td>GetKeyScheduleSignalingRequest</td><td>GetKeyScheduleSignalingRequestType</td><td>Input parameter</td></tr>
<tr><td>GetKeyScheduleSignalingResponse</td><td>GetKeyScheduleSignalingResponseType</td><td>Output parameter</td></tr>
</table>
</section>
<section id="s5-7-1-2-1-2"><h6>Input parameter structure definition</h6>
<p>Hereunder is the XML schema of the GetKeyScheduleSignalingRequest message:</p>
<figure id="f5">
<figcaption>Figure ####: GetKeyScheduleSignalingRequest Schema</figcaption>
<img src="images/GetKeyScheduleSignalingRequest-schema.png"/>
</figure>
<table id="t108" class="simple">
<caption>Table ####: GetKeyScheduleSignalingRequestType</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th><th>Reference</th></tr>
<tr><td>contentId</td><td><a href="http://www.w3.org/TR/xmlschema-2/#string" class="extRef">xs:string</a></td><td>1</td><td>Identifier for a content, a content being either a scheduled content service, an event on a scheduled content service (i.e. with access criteria specific to the event) or a CoD asset.<p>It is provided by the Scheduling Function (for Scheduled content) or the Content Management Function (for CoD).</p></td><td> </td></tr>
<tr><td>encryptionProfile</td><td>EncryptionProfileType</td><td>1</td><td>Set of properties for the management of the content key and the signaling.</td><td><a href="#s5-7-1-2-5-6" class="sectionRef">5.7.1.2.5.6</a></td></tr>
<tr><td>drmInfo</td><td>DrmInfoType</td><td>0..N</td><td>Information for addressed DRM systems. This allows the calling entity to provide a set of DRM systems for which the drmSignaling shall be provided. An empty list means that the called entity manages a DRM list from its own configuration.</td><td><a href="#s5-7-1-2-5-2" class="sectionRef">5.7.1.2.5.2</a></td></tr>
<tr><td>pregenerationWindow</td><td>PregenerationWindowType</td><td>1</td><td>The time information for the Key Management Function to know the period it is expected to generate keys for.</td><td><a href="#s5-7-1-2-5-8" class="sectionRef">5.7.1.2.5.8</a></td></tr>
</table>
</section>
<section id="s5-7-1-2-1-3"><h6>Output parameter structure definition</h6>
<p>Hereunder is the XML schema of the GetKeyScheduleSignalingResponse message:</p>
<figure id="f6">
<figcaption>Figure ####: GetKeyScheduleSignalingResponse Schema</figcaption>
<img src="images/GetKeyScheduleSignalingResponse-schema.png"/>
</figure>
<table id="t109" class="simple">
<caption>Table ####: GetKeyScheduleSignalingResponseType</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th><th>Reference</th></tr>
<tr><td>status</td><td>StatusType</td><td>1</td><td>The global status of the request.</td><td><a href="#s5-7-1-2-4-2" class="sectionRef">5.7.1.2.4.2</a></td></tr>
<tr><td>errorCode</td><td><a href="http://www.w3.org/TR/xmlschema-2/#unsignedInt" class="extRef">xs:unsignedInt</a></td><td>0..1</td><td>The code of the error in case the status is not OK. Values are specific to the implementation of the called entity.<p>It is omitted in case the request succeeds.</p></td><td></td></tr>
<tr><td>errorMessage</td><td><a href="http://www.w3.org/TR/xmlschema-2/#string" class="extRef">xs:string</a></td><td>0..1</td><td>Any additional information related to the status in case of errors.<p>It is omitted in case the request succeeds.</p></td><td></td></tr>
<tr><td>timeReference</td><td>TimeReferenceType</td><td>0..N</td><td>The dates and times for which keys have been generated. It is omitted in case the request failed.</td><td><a href="#s5-7-1-2-5-12" class="sectionRef"></a></td></tr>
<tr><td>contentKey</td><td>ContentKeyType</td><td>0..1</td><td>The content key to be used to protect the content. It is omitted in case the request failed.</td><td><a href="#s5-7-1-2-5-1" class="sectionRef"></a></td></tr>
<tr><td>drmSignaling</td><td>DrmSignalingType</td><td>0..N</td><td>The signaling information according to every provided streaming mode. This information allows the CSP client to find the key materials required to decrypt a given content, either locally when the key has already been retrieved or remotely when requested for the first time.<p>Each DRM will provide signaling information for a given [content/content key] pair, such as URL of the CSP server or DRM. The DRM information is DRM specific.</p><p>It is omitted in case the request failed.</p></td><td><a href="#s5-7-1-2-5-4" class="sectionRef"></a></td></tr>
</table>
<p>The called entity generates the keys based on its schedule and provides:</p><ul>
<li>the key (i.e. contentKey element) to use at the requested time (i.e. timeReference element in the pregenerationWindow element of the request) provided by the calling entity,
<li>the signaling (i.e. list of drmSignaling elements) to be inserted by the Encryption Function when using the key,
<li>the times (i.e. timeReference element) for the current and next keys encompassing the window duration (i.e. windowDuration element in pregenerationWindow element of the request). These times should be used to perform the subsequent calls to this method.</ul>
<p>One drmSignaling element is provided for every provided streamingMode. For each streamingMode either a dashSignaling or a privateSignaling element is provided for every addressed DRM. This element holds the drmSystemId and the signaling information (defined by the encryptionProfile). For DASH and CENC, either a manifestHeader (XML fragment) or a PSSH box data or both can be provided. The manifestHeader is to be inserted in the MPD, the psshBox is to be inserted in the content.</p>
<p>In case an error occurs, then no contentKey, no timeReference, and no drmSignaling elements will be provided.</p>
</section>
</section>

<section id="s5-7-1-2-2"><h5>setScheduleAndGetKeySignaling operation</h5>
<section id="s5-7-1-2-2-1"><h6>Method and parameters</h6>
<table id="t110" class="simple">
<caption>Table ####: setScheduleAndGetKeySignaling method parameters</caption>
<tr><th colspan="2">Operation Name</th><th>Description</th></tr>
<tr><td colspan="2">setScheduleAndGetKeySignaling</td><td>Operation name</td></tr>
<tr><th>Field Name</th><th>Field Type</th><th>Description</th></tr>
<tr><td>SetScheduleAndGetKeySignalingRequest</td><td>SetScheduleAndGetKeySignalingRequestType</td><td>Input parameter</td></tr>
<tr><td>SetScheduleAndGetKeySignalingResponse</td><td>SetScheduleAndGetKeySignalingResponseType</td><td>Output parameter</td></tr>
</table>
</section>
<section id="s5-7-1-2-2-2"><h6>Input parameter structure definition</h6>
Hereunder is the XML schema of the SetScheduleAndGetKeySignalingRequest message:
<figure id="f7">
<figcaption>Figure ####: SetScheduleAndGetKeySignalingRequest Schema</figcaption>
<img src="images/SetScheduleAndGetKeySignalingRequest-schema.png"/>
</figure>
<table id="t111" class="simple">
<caption>Table ####: SetScheduleAndGetKeySignalingRequestType</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th><th>Reference</th></tr>
<tr><td>encryptionProfile</td><td>EncryptionProfileType</td><td>1</td><td>Set of properties for the management of the content key and the signaling.</td><td><a href="#s5-7-1-2-5-6" class="sectionRef"></a></td></tr>
<tr><td>drmInfo</td><td>DrmInfoType</td><td>0..N</td><td>Information for addressed DRM systems. This allows the calling entity to provide a set of DRM systems for which the drmSignaling shall be provided. An empty list means that the called entity manages a DRM list from its own configuration.</td><td><a href="#s5-7-1-2-5-2" class="sectionRef"></a></td></tr>
<tr><td>schedule</td><td>ScheduleType</td><td>1..N</td><td>The times provided by the Encryption Function for which the Key Management Function has to generate keys.</td><td><a href="#s5-7-1-2-5-11" class="sectionRef"></a></td></tr>
</table>
</section>
<section id="s5-7-1-2-2-3"><h6>Output parameter structure definition</h6>
Hereunder is the XML schema of the SetScheduleAndGetKeySignalingResponse message:
<figure id="f8">
<figcaption>Figure ####: SetScheduleAndGetKeySignalingResponse Schema</figcaption>
<img src="images/SetScheduleAndGetKeySignalingResponse-schema.png"/>
</figure>
<table id="t112" class="simple">
<caption>Table ####: SetScheduleAndGetKeySignalingRequestType</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th><th>Reference</th></tr>
<tr><td>status</td><td>StatusType</td><td>1</td><td>The global status of the request.</td><td><a href="#s5-7-1-2-4-2" class="sectionRef"></a></td></tr>
<tr><td>errorCode</td><td><a href="http://www.w3.org/TR/xmlschema-2/#unsignedInt" class="extRef">xs:unsignedInt</a></td><td>0..1</td><td>The code of the error in case the status is not OK. Values are specific to the implementation of the called entity.<p>It is omitted in case the request succeeds.</p></td><td></td></tr>
<tr><td>errorMessage</td><td><a href="http://www.w3.org/TR/xmlschema-2/#string" class="extRef">xs:string</a></td><td>0..1</td><td>Any additional information related to the status in case of errors.<p>It is omitted in case the request succeeds.</p></td><td></td></tr>
<tr><td>contentKey</td><td>ContentKeyType</td><td>0..1</td><td>The content key to be used to protect the content.<p>It is omitted in case the request failed.</p></td><td><a href="#s5-7-1-2-5-1" class="sectionRef"></a></td></tr>
<tr><td>drmSignaling</td><td>DrmSignalingType</td><td>0..N</td><td>The signaling information according to every provided streaming mode. This information allows the CSP client to find the key materials required to decrypt a given content, either locally when the key has already been retrieved or remotely when requested for the first time.<p>Each DRM will provide signaling information for a given [content/content key] pair, such as URL of the CSP server or DRM. The DRM information is DRM specific.</p><p>It is omitted in case the request failed.</p></td><td><a href="#s5-7-1-2-5-4" class="sectionRef"></a></td></tr>
<tr><td>keyIdSchedule</td><td>KeyIdScheduleType</td><td>0..N</td><td>The dates and times for which keys have been generated, and the keyId of these keys. It is omitted in case the request failed.</td><td><a href="#s5-7-1-2-5-7" class="sectionRef"></a></td></tr>
</table>
<p>The called entity generates new keys based on the times provided by the calling entity and provides:</p><ul>
<li>the key (i.e. contentKey element) to use at the requested time (i.e. timeReference element in the schedule element of the request, with isCurrentKey set to true) provided by the calling entity,
<li>the signaling (i.e. list of drmSignaling elements) to be inserted by the Encryption Function when using the key,
<li>for the next keys, the key identifiers of the next keys with their times (i.e. keyId and timeReference elements in the schedule element of the request, with isCurrentKey set to false). These times and optionally key identifier should be used to perform the subsequent calls to this method.</ul>
<p>One drmSignaling element is provided for every provided streamingMode. For each streamingMode either a dashSignaling or a privateSignaling element is provided for every addressed DRM. This element holds the drmSystemId and the signaling information (defined by the encryptionProfile). For DASH and CENC, either a manifestHeader (XML fragment) or a PSSH box data or both can be provided. The manifestHeader is to be inserted in the MPD, the psshBox is to be inserted in the content.</p>
<p>In case an error occurs, then no contentKey, no keyIdSchedule, and no drmSignaling elements will be provided.</p>
</section>
</section>
<section id="s5-7-1-2-3"><h5>setKeyScheduleAndGetSignaling operation</h5>
<section id="s5-7-1-2-3-1"><h6>Method and parameters</h6>
<table id="t113" class="simple">
<caption>Table ####: setKeyScheduleAndGetSignaling method parameters</caption>
<tr><th colspan="2">Operation Name</th><th>Description</th></tr>
<tr><td colspan="2">setKeyScheduleAndGetSignaling</td><td>Operation name</td></tr>
<tr><th>Field Name</th><th>Field Type</th><th>Description</th></tr>
<tr><td>SetKeyScheduleAndGetSignalingRequest</td><td>SetKeyScheduleAndGetSignalingRequestType</td><td>Input parameter</td></tr>
<tr><td>SetKeyScheduleAndGetSignalingResponse</td><td>SetKeyScheduleAndGetSignalingResponseType</td><td>Output parameter</td></tr>
</table>
</section>
<section id="s5-7-1-2-3-2"><h6>Input parameter structure definition</h6>
Hereunder is the XML schema of the SetKeyScheduleAndGetSignalingRequest message:
<figure id="f9">
<figcaption>Figure ####: SetKeyScheduleAndGetSignalingRequest Schema</figcaption>
<img src="images/SetKeyScheduleAndGetSignalingRequest-schema.png"/>
</figure>
<table id="t114" class="simple">
<caption>Table ####: SetKeyScheduleAndGetSignalingRequestType</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th><th>Reference</th></tr>
<tr><td>encryptionProfile</td><td>EncryptionProfileType</td><td>1</td><td>Set of properties for the management of the content key and the signaling.</td><td><a href="#s5-7-1-2-5-6" class="sectionRef"></a></td></tr>
<tr><td>drmInfo</td><td>DrmInfoType</td><td>0..N</td><td>Information for addressed DRM systems. This allows the calling entity to provide a set of DRM systems for which the drmSignaling shall be provided. An empty list means that the called entity manages a DRM list from its own configuration.</td><td><a href="#s5-7-1-2-5-2" class="sectionRef"></a></td></tr>
<tr><td>scheduledKey</td><td>ScheduledKeyType</td><td>1..N</td><td>The keys provided by the Encryption Function.</td><td><a href="#s5-7-1-2-5-10" class="sectionRef"></a></td></tr>
</table>
</section>
<section id="s5-7-1-2-3-3"><h6>Output parameter structure definition</h6>
Hereunder is the XML schema of the SetKeyScheduleAndGetSignalingResponse message:
<figure id="f10">
<figcaption>Figure ####: SetKeyScheduleAndGetSignalingResponse Schema</figcaption>
<img src="images/SetKeyScheduleAndGetSignalingResponse-schema.png"/>
</figure>
<table id="t115" class="simple">
<caption>Table ####: SetKeyScheduleAndGetSignalingResponseType</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th><th>Reference</th></tr>
<tr><td>status</td><td>StatusType</td><td>1</td><td>The global status of the request.</td><td><a href="#s5-7-1-2-4-2" class="sectionRef"></a></td></tr>
<tr><td>errorCode</td><td><a href="http://www.w3.org/TR/xmlschema-2/#unsignedInt" class="extRef">xs:unsignedInt</a></td><td>0..1</td><td>The code of the error in case the status is not OK. Values are specific to the implementation of the called entity.<p>It is omitted in case the request succeeds.</p></td><td></td></tr>
<tr><td>errorMessage</td><td><a href="http://www.w3.org/TR/xmlschema-2/#string" class="extRef">xs:string</a></td><td>0..1</td><td>Any additional information related to the status in case of errors.<p>It is omitted in case the request succeeds.</p></td><td></td></tr>
<tr><td>drmSignaling</td><td>DrmSignalingType</td><td>0..N</td><td>The signaling information according to every provided streaming mode. This information allows the CSP client to find the key materials required to decrypt a given content, either locally when the key has already been retrieved or remotely when requested for the first time.<p>Each DRM will provide signaling information for a given [content/content key] pair, such as URL of the CSP server or DRM. The DRM information is DRM specific.</p><p>It is omitted in case the request failed.</p></td><td><a href="#s5-7-1-2-5-4" class="sectionRef"></a></td></tr>
</table>
<p>The calling entity provides both the keys and the times to use them. The called entity stores them and provides the signaling (i.e. list of drmSignaling elements) to be inserted by the Encryption Function when using the current key (i.e. scheduleKey element with isCurrentKey set to true).</p>
<p>One drmSignaling element is provided for every provided streamingMode. For each streamingMode either a dashSignaling or a privateSignaling element is provided for every addressed DRM. This element holds the drmSystemId and the signaling information (defined by the encryptionProfile). For DASH and CENC, either a manifestHeader (XML fragment) or a PSSH box data or both can be provided. The manifestHeader is to be inserted in the MPD, the psshBox is to be inserted in the content.</p>
<p>In case an error occurs, then no drmSignaling element will be provided.</p>
</section>
</section>
<section id="s5-7-1-2-4"><h5>Simple types</h5>
<section id="s5-7-1-2-4-1"><h6>UUIDType</h6>
<p>This type is used for identifiers that need to be unique in time and space; it refers to [[!RFC4122]].</p>
<p>Its main advantage is to not depend on centralized data storage.</p>
<table id="t116" class="simple">
<caption>Table ####: UUIDType</caption>
<tr><th>Base type</th><th>Pattern Restriction</th></tr>
<tr><td><a href="http://www.w3.org/TR/xmlschema-2/#token" class="extRef">xs:token</a></td><td>[\da-fA-F]{8}-[\da-fA-F]{4}-[\da-fA-F]{4}-[\da-fA-F]{4}-[\da-fA-F]{12}</td></tr>
</table>
</section>
<section id="s5-7-1-2-4-2"><h6>StatusType</h6>
<table id="t117" class="simple">
<caption>Table ####: StatusType</caption>
<tr><th>Base type</th><th>Enumeration</th><th>Description</th></tr>
<tr><td rowspan="2"><a href="http://www.w3.org/TR/xmlschema-2/#token" class="extRef">xs:token</a></td><td>OK</td><td>The request succeeded.</td></tr>
<tr><td>ERROR</td><td>An occurred at server level. The type of error is provided by the errorCode in the response.</td></tr>
</table>
</section>
</section>
<section id="s5-7-1-2-5"><h5>Data structures</h5>
<section id="s5-7-1-2-5-1"><h6>ContentKeyType structure</h6>
<table class="simple" id="t118">
<caption>Table ####: ContentKeyType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>keyId</td><td>UUIDType (see <a href="#s5-7-1-2-4-1" class="sectionRef"></a>)</td><td>1</td><td>The unique identifier of the content key, provided as a normalized UUID.</td></tr>
<tr><td>key</td><td><a href="http://www.w3.org/TR/xmlschema-2/#base64Binary" class="extRef">xs:base64binary</a></td><td>1</td><td>The content key used to encrypt content (or part of content in the case of key changes).</td></tr>
</table>

</section>
<section id="s5-7-1-2-5-2"><h6>DrmInfoType structure</h6>
<table class="simple" id="t119">
<caption>Table ####: DrmInfoType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>drmSystemId</td><td><a href="http://www.w3.org/TR/xmlschema-2/#anyURI" class="extRef">xs:anyURI</a></td><td>1</td><td>The unique identifier of the DRM system, typically a DVB URI or an UUID URI.</td></tr>
<tr><td>drmName</td><td><a href="http://www.w3.org/TR/xmlschema-2/#token" class="extRef">xs:token</a></td><td>0..1</td><td>The informative readable name for the DRM system.</td></tr>
<tr><td>drmMetadata</td><td>DrmMetadataType (see <a href="#s5-7-1-2-5-3" class="sectionRef"></a>)</td><td>0..N</td><td>The DRM specific metadata embedding the content related metadata.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-3"><h6>DrmMetadataType structure</h6>
<table class="simple" id="t120">
<caption>Table ####: DrmMetadataType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>contentMetadata</td><td><a href="http://www.w3.org/TR/xmlschema-2/#base64Binary" class="extRef">xs:base64binary</a></td><td>1</td><td>The content related part of the drmMetadata.</td></tr>
<tr><td>contentId</td><td><a href="http://www.w3.org/TR/xmlschema-2/#string" class="extRef">xs:string</a></td><td>1</td><td>Content associated with the metadata.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-4"><h6>DrmSignalingType structure</h6>
<p>Either one of DASH or HAS field will be provided for a given DRM system.</p>
<table class="simple" id="t121">
<caption>Table ####: DrmSignalingType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>streamingMode</td><td><a href="http://www.w3.org/TR/xmlschema-2/#token" class="extRef">xs:token</a></td><td>1</td><td>Provides the way the content is streamed for the actual drmSignaling element:<ul><li>“DASH” for MPEG Dynamic Http Adaptive Streaming.<li>“HAS” for OIPF Http Adaptive Streaming.</ul></td></tr>
<tr><td>dashSignaling</td><td>DashSignalingType (see <a href="#s5-7-1-2-5-5" class="sectionRef"></a>)</td><td>0..N</td><td>DASH signaling as a MPD content protection XML section and/or a PSSH box data.</td></tr>
<tr><td>privateSignaling</td><td>PrivateSignalingType (see <a href="#s5-7-1-2-5-9" class="sectionRef"></a>)</td><td>0..N</td><td>Other signaling, e.g. OIPF HAS.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-5"><h6>DashSignalingType structure</h6>
<table class="simple" id="t122">
<caption>Table ####: DashSignalingType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>drmSystemid</td><td><a href="http://www.w3.org/TR/xmlschema-2/#anyURI" class="extRef">xs:anyURI</a></td><td>1</td><td>The DRM system id for which the below signaling information applies, typically a DVB URI or an UUID URI.</td></tr>
<tr><td>drmName</td><td><a href="http://www.w3.org/TR/xmlschema-2/#token" class="extRef">xs:token</a></td><td>0..1</td><td>Optional readable name of the DRM system.</td></tr>
<tr><td>manifestHeader</td><td><a href="http://www.w3.org/TR/xmlschema-2/#string" class="extRef">xs:string</a></td><td>0..1</td><td>The content protection section to be inserted in the MPD.</td></tr>
<tr><td>psshBox</td><td><a href="http://www.w3.org/TR/xmlschema-2/#base64Binary" class="extRef">xs:base64binary</a></td><td>0..1</td><td>Pssh signaling information. DRM specific full pssh box binary block.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-6"><h6>EncryptionProfileType structure</h6>
<table class="simple" id="t123">
<caption>Table ####: EncryptionProfileType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>distributionMode</td><td><a href="http://www.w3.org/TR/xmlschema-2/#token" class="extRef">xs:token</a></td><td>0..1</td><td>Either VOD or LIVE, informative:<ul><li>“VOD” for Content On Demand.<li>“LIVE” for Scheduled Content.</ul></td></tr>
<tr><td>streamingMode</td><td><a href="http://www.w3.org/TR/xmlschema-2/#token" class="extRef">xs:token</a></td><td>0..N</td><td>Provides the way or ways the content is streamed, helps building the signaling:<ul><li>“DASH” for MPEG Dynamic Http Adaptive Streaming.<li>“HAS” for OIPF Http Adaptive Streaming.</ul></td></tr>
<tr><td>encryptionMode</td><td><a href="http://www.w3.org/TR/xmlschema-2/#token" class="extRef">xs:token</a></td><td>0..1</td><td>Encryption method indicator:<ul><li>“DVB-CSA2” for DVB-CSA2.<li>“ATIS-IDSA” for AES 128-bit key using the CBC encryption mode with the IV setting and the residual termination block process as specified in [[!ATIS-IDSA]].<li>“CENC” for AES 128-bit key in CTR mode (CENC).</ul>If not provided then a default value from the system configuration is assumed.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-7"><h6>KeyIdScheduleType structure</h6>
<table class="simple" id="t124">
<caption>Table ####: KeyIdScheduleType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>timeReference</td><td>TimeReferenceType (see <a href="#s5-7-1-2-5-12" class="sectionRef"></a>)</td><td>1</td><td>The date and time for which a key has been generated.</td></tr>
<tr><td>keyId</td><td>UUIDType (see <a href="#s5-7-1-2-4-1" class="sectionRef"></a>)</td><td>1</td><td>The unique identifier of the generated key, provided as a normalized UUID.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-8"><h6>PregenerationWindowType structure</h6>
<table class="simple" id="t125">
<caption>Table ####: PregenerationWindowType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>timeReference</td><td>TimeReferenceType (see <a href="#s5-7-1-2-5-12" class="sectionRef"></a>)</td><td>1</td><td>The date and time at which the requested key and drmSignaling shall apply.</td></tr>
<tr><td>windowDuration_s</td><td><a href="http://www.w3.org/TR/xmlschema-2/#unsignedInt" class="extRef">xs:unsignedInt</a></td><td>0..1</td><td>The width of the time window for which the called entity has to generate keys. If it is not provided then a default value from the system configuration is assumed.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-9"><h6>PrivateSignalingType structure</h6>
<table class="simple" id="t126">
<caption>Table ####: PrivateSignalingType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>drmSystemid</td><td><a href="http://www.w3.org/TR/xmlschema-2/#anyURI" class="extRef">xs:anyURI</a></td><td>1</td><td>The DRM system id for which the below signaling information applies, typically a DVB URI or an UUID URI.</td></tr>
<tr><td>drmName</td><td><a href="http://www.w3.org/TR/xmlschema-2/#token" class="extRef">xs:token</a></td><td>0..1</td><td>Optional readable name of the DRM system.</td></tr>
<tr><td>privateData</td><td><a href="http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/structures.html#element-any" class="extRef">xs:any</a></td><td>0..N</td><td>Proprietary data block.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-10"><h6>ScheduledKeyType structure</h6>
<table class="simple" id="t127">
<caption>Table ####: ScheduledKeyType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>contentId</td><td><a href="http://www.w3.org/TR/xmlschema-2/#string" class="extRef">xs:string</a></td><td>1</td><td>Identifier for content, a content being either a scheduled content service, an event on a scheduled content service (i.e. with access criteria specific to the event) or a CoD asset.<p>It is provided by the Scheduling Function (for Scheduled content) or the Content Management Function (for CoD).</p></td></tr>
<tr><td>isCurrentKey</td><td><a href="http://www.w3.org/TR/xmlschema-2/#boolean" class="extRef">xs:boolean</a></td><td>1</td><td>Flag to indicate that the requested drmSignaling applies to the period starting according to timeReference. Within a list of elements of type ScheduledKeyType, one and only one occurrence shall have this flag set to true.</td></tr>
<tr><td>timeReference</td><td>TimeReferenceType (see <a href="#s5-7-1-2-5-12" class="sectionRef"></a>)</td><td>1</td><td>The time at which the key will start being used.</td></tr>
<tr><td>contentKey</td><td>ContentKeyType (see <a href="#s5-7-1-2-5-1" class="sectionRef"></a>)</td><td>1</td><td>Content key value and identifier.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-11"><h6>ScheduleType structure</h6>
<table class="simple" id="t128">
<caption>Table ####: ScheduleType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>contentId</td><td><a href="http://www.w3.org/TR/xmlschema-2/#string" class="extRef">xs:string</a></td><td>1</td><td>Identifier for content, a content being either a scheduled content service, an event on a scheduled content service (i.e. with access criteria specific to the event) or a CoD asset.<p>It is provided by the Scheduling Function (for Scheduled content) or the Content Management Function (for CoD).</p></td></tr>
<tr><td>isCurrentKey</td><td><a href="http://www.w3.org/TR/xmlschema-2/#boolean" class="extRef">xs:boolean</a></td><td>1</td><td>Flag to indicate that the requested drmSignaling applies to the period starting according to timeReference. Within a list of elements of type ScheduleType, one and only one occurrence shall have this flag set to true.</td></tr>
<tr><td>timeReference</td><td>TimeReferenceType (see <a href="#s5-7-1-2-5-12" class="sectionRef"></a>)</td><td>1</td><td>The date and time at which the requested key and drmSignaling shall apply.</td></tr>
<tr><td>keyId</td><td>UUIDType (see <a href="#s5-7-1-2-4-1" class="sectionRef"></a>)</td><td>0..1</td><td>Optionally, the unique identifier of an already generated content key to be reused at the time specified, provided as a normalized UUID. If not provided, the called entity decides which key to use based on its schedule and generated keys.</td></tr>
</table>
</section>
<section id="s5-7-1-2-5-12"><h6>TimeReferenceType structure</h6>
<table class="simple" id="t129">
<caption>Table ####: TimeReferenceType structure</caption>
<tr><th>Field name</th><th>Field type</th><th>Multiplicity</th><th>Description</th></tr>
<tr><td>startTime</td><td><a href="http://www.w3.org/TR/xmlschema-2/#dateTime" class="extRef">xs:dateTime</a></td><td>0..1</td><td>For scheduled content, the date and time is an absolute value.</td></tr>
<tr><td>offset_ms</td><td><a href="http://www.w3.org/TR/xmlschema-2/#unsignedInt" class="extRef">xs:unsignedInt</a></td><td>0..1</td><td>For CoD, the time is relative to the beginning of the content. It is in milliseconds.</td></tr>
</table>
</section>
</section>
</section>
</section>
<section id="s5-7-2"><h3>XML Schema for Content Preparation</h3>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" 
  xmlns:tns="urn:oipf:iptv:KeyAndSignaling:2013" 
  targetNamespace="urn:oipf:iptv:KeyAndSignaling:2013" 
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:simpleType name="StatusType"&gt;
    &lt;xs:restriction base="xs:token"&gt;
      &lt;xs:enumeration value="OK"/&gt;
      &lt;xs:enumeration value="ERROR"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:simpleType name="UUIDType"&gt;
    &lt;xs:restriction base="xs:token"&gt;
      &lt;xs:pattern value=
        "[\da-fA-F]{8}-[\da-fA-F]{4}-[\da-fA-F]{4}-[\da-fA-F]{4}-[\da-fA-F]{12}"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:complexType name="ContentKeyType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="keyId" type="tns:UUIDType"/&gt;
      &lt;xs:element name="key" type="xs:base64Binary"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="DrmType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="drmSystemId" type="xs:anyURI"/&gt;
      &lt;xs:element name="drmName" type="tns:DrmNameType" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="DrmSignalingType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="streamingMode" type="xs:token"/&gt;
      &lt;xs:choice&gt;
        &lt;xs:element name="dashSignaling" type="tns:DashSignalingType" 
          maxOccurs="unbounded"/&gt;
        &lt;xs:element name="privateSignaling" type="tns:PrivateSignalingType" 
          maxOccurs="unbounded"/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="EncryptionProfileType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="distributionMode" type="xs:token" minOccurs="0"/&gt;
      &lt;xs:element name="streamingMode" type="xs:token" maxOccurs="unbounded"/&gt;
      &lt;xs:element name="encryptionMode" type="xs:token" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="DashSignalingType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="tns:DrmType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="manifestHeader" type="xs:string" minOccurs="0"/&gt;
          &lt;xs:element name="psshBox" type="xs:base64Binary" minOccurs="0"/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="DrmInfoType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="tns:DrmType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="drmMetadata" type="tns:DrmMetadataType" 
            minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="ContentIdType"&gt;
    &lt;xs:restriction base="xs:string"/&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:complexType name="PrivateSignalingType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="tns:DrmType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="privateData"&gt;
            &lt;xs:complexType&gt;
              &lt;xs:sequence&gt;
                &lt;xs:any namespace="##any" processContents="lax" 
                  minOccurs="0" maxOccurs="unbounded"/&gt;
              &lt;/xs:sequence&gt;
            &lt;/xs:complexType&gt;
          &lt;/xs:element&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="DrmNameType"&gt;
    &lt;xs:restriction base="xs:token"/&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:complexType name="DrmMetadataType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="contentMetadata" type="xs:base64Binary"/&gt;
      &lt;xs:element name="contentId" type="tns:ContentIdType"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="ScheduledKeyType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="contentId" type="tns:ContentIdType"/&gt;
      &lt;xs:element name="timeReference" type="tns:TimeReferenceType"/&gt;
      &lt;xs:element name="contentKey" type="tns:ContentKeyType"/&gt;
      &lt;xs:element name="isCurrentKey" type="xs:boolean"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="GetKeyScheduleSignalingRequestType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="contentId" type="tns:ContentIdType"/&gt;
      &lt;xs:element name="encryptionProfile" type="tns:EncryptionProfileType"/&gt;
      &lt;xs:element name="drmInfo" type="tns:DrmInfoType" 
        minOccurs="0" maxOccurs="unbounded"/&gt;
      &lt;xs:element name="pregenerationWindow" 
        type="tns:PregenerationWindowType"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="SetKeyScheduleAndGetSignalingRequestType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="scheduledKey" type="tns:ScheduledKeyType" 
        maxOccurs="unbounded"/&gt;
      &lt;xs:element name="encryptionProfile" type="tns:EncryptionProfileType"/&gt;
      &lt;xs:element name="drmInfo" type="tns:DrmInfoType" 
        minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="SetScheduleAndGetKeySignalingRequestType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="schedule" type="tns:ScheduleType" 
        maxOccurs="unbounded"/&gt;
      &lt;xs:element name="encryptionProfile" type="tns:EncryptionProfileType"/&gt;
      &lt;xs:element name="drmInfo" type="tns:DrmInfoType" 
        minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="TimeReferenceType"&gt;
    &lt;xs:choice&gt;
      &lt;xs:element name="startTime" type="xs:dateTime"/&gt;
      &lt;xs:element name="offset_ms" type="xs:unsignedInt"/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="ScheduleType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="contentId" type="tns:ContentIdType"/&gt;
      &lt;xs:element name="isCurrentKey" type="xs:boolean"/&gt;
      &lt;xs:element name="timeReference" type="tns:TimeReferenceType"/&gt;
      &lt;xs:element name="keyId" type="tns:UUIDType" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="SetKeyScheduleAndGetSignalingResponseType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="status" type="tns:StatusType"/&gt;
      &lt;xs:element name="errorCode" type="xs:unsignedInt" minOccurs="0"/&gt;
      &lt;xs:element name="errorMessage" type="xs:string" minOccurs="0"/&gt;
      &lt;xs:element name="drmSignaling" type="tns:DrmSignalingType" 
        minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="SetScheduleAndGetKeySignalingResponseType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="status" type="tns:StatusType"/&gt;
      &lt;xs:element name="errorCode" type="xs:unsignedInt" minOccurs="0"/&gt;
      &lt;xs:element name="errorMessage" type="xs:string" minOccurs="0"/&gt;
      &lt;xs:element name="drmSignaling" type="tns:DrmSignalingType" 
        minOccurs="0" maxOccurs="unbounded"/&gt;
      &lt;xs:element name="contentKey" type="tns:ContentKeyType" minOccurs="0"/&gt;
      &lt;xs:element name="keyIdSchedule" type="tns:KeyIdScheduleType" 
        minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="GetKeyScheduleSignalingResponseType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="status" type="tns:StatusType"/&gt;
      &lt;xs:element name="errorCode" type="xs:unsignedInt" minOccurs="0"/&gt;
      &lt;xs:element name="errorMessage" type="xs:string" minOccurs="0"/&gt;
      &lt;xs:element name="drmSignaling" type="tns:DrmSignalingType" 
        minOccurs="0" maxOccurs="unbounded"/&gt;
      &lt;xs:element name="contentKey" type="tns:ContentKeyType" minOccurs="0"/&gt;
      &lt;xs:element name="timeReference" type="tns:TimeReferenceType" 
        minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="KeyIdScheduleType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="timeReference" type="tns:TimeReferenceType"/&gt;
      &lt;xs:element name="keyId" type="tns:UUIDType"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name="PregenerationWindowType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="timeReference" type="tns:TimeReferenceType"/&gt;
      &lt;xs:element name="windowDuration_s" type="xs:unsignedInt" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:element name="GetKeyScheduleSignalingRequest" 
    type="tns:GetKeyScheduleSignalingRequestType"/&gt;
  &lt;xs:element name="SetKeyScheduleAndGetSignalingRequest" 
    type="tns:SetKeyScheduleAndGetSignalingRequestType"/&gt;
  &lt;xs:element name="SetScheduleAndGetKeySignalingRequest" 
    type="tns:SetScheduleAndGetKeySignalingRequestType"/&gt;
  &lt;xs:element name="SetKeyScheduleAndGetSignalingResponse" 
    type="tns:SetKeyScheduleAndGetSignalingResponseType"/&gt;
  &lt;xs:element name="SetScheduleAndGetKeySignalingResponse" 
    type="tns:SetScheduleAndGetKeySignalingResponseType"/&gt;
  &lt;xs:element name="GetKeyScheduleSignalingResponse" 
    type="tns:GetKeyScheduleSignalingResponseType"/&gt;
&lt;/xs:schema&gt;
</pre>
<p>The following WEB Service is introduced according to the protocols defined in section <a href="#s5-7-1-2" class="sectionRef">5.7.1.2</a>.</p>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;wsdl:definitions
  name="IKeyAndSignaling"
  targetNamespace="urn:oipf:iptv:KeyAndSignaling:2013"
  xmlns:tns="urn:oipf:iptv:KeyAndSignaling:2013"
  xmlns:defs="urn:oipf:iptv:KeyAndSignaling:2013"
  xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
  xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"&gt;

  &lt;wsdl:import namespace="urn:oipf:iptv:KeyAndSignaling:2013" 
    location="KeyAndSignaling.wsdl" /&gt;

  &lt;wsdl:binding name="KeyAndSignalingSoapBinding" 
      type="defs:KeyAndSignalingPortType"&gt;
    &lt;soap:binding style="document" 
      transport="http://schemas.xmlsoap.org/soap/http"/&gt;
    
    &lt;wsdl:operation name="getKeyScheduleSignaling"&gt;
      &lt;soap:operation soapAction="ws-keyAndSignaling"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    
     &lt;wsdl:operation name="setKeyScheduleAndGetSignaling"&gt;
      &lt;soap:operation soapAction="ws-keyAndSignaling"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    
    &lt;wsdl:operation name="setScheduleAndGetKeySignaling"&gt;
      &lt;soap:operation soapAction="ws-keyAndSignaling"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
   
  &lt;/wsdl:binding&gt;
  
  &lt;wsdl:service name="KeyAndSignalingService"&gt; 
    &lt;wsdl:port name="KeyAndSignalingSoapPort" 
      binding="tns:KeyAndSignalingSoapBinding"&gt;
      &lt;soap:address location="ws-keyAndSignaling" /&gt;
     &lt;/wsdl:port&gt; 
  &lt;/wsdl:service&gt;
  
&lt;/wsdl:definitions&gt;
</pre>
<p></p>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;wsdl:definitions 
  name="KeyAndSignaling" 
  targetNamespace="urn:oipf:iptv:KeyAndSignaling:2013" 
  xmlns:tns="urn:oipf:iptv:KeyAndSignaling:2013" 
  xmlns:kas="urn:oipf:iptv:KeyAndSignaling:2013" 
  xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" 
  xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;
  
  &lt;wsdl:types&gt;
    &lt;xs:schema &gt;
      &lt;xs:import namespace="urn:oipf:iptv:KeyAndSignaling:2013" 
        schemaLocation="iptv-KeyAndSignaling.xsd"/&gt;
    &lt;/xs:schema&gt;
  &lt;/wsdl:types&gt;
  
  &lt;wsdl:message name="GetKeyScheduleSignalingRequest"&gt;
    &lt;wsdl:part name="body" element="kas:GetKeyScheduleSignalingRequest"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="GetKeyScheduleSignalingResponse"&gt;
    &lt;wsdl:part name="body" element="kas:GetKeyScheduleSignalingResponse"/&gt;
  &lt;/wsdl:message&gt;
  
  &lt;wsdl:message name="SetKeyScheduleAndGetSignalingRequest"&gt;
    &lt;wsdl:part name="body" element="kas:SetKeyScheduleAndGetSignalingRequest"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="SetKeyScheduleAndGetSignalingResponse"&gt;
    &lt;wsdl:part name="body" element="kas:SetKeyScheduleAndGetSignalingResponse"/&gt;
  &lt;/wsdl:message&gt;

  &lt;wsdl:message name="SetScheduleAndGetKeySignalingRequest"&gt;
    &lt;wsdl:part name="body" element="kas:SetScheduleAndGetKeySignalingRequest"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="SetScheduleAndGetKeySignalingResponse"&gt;
    &lt;wsdl:part name="body" element="kas:SetScheduleAndGetKeySignalingResponse"/&gt;
  &lt;/wsdl:message&gt;
    

  &lt;wsdl:portType name="KeyAndSignalingPortType"&gt;
    &lt;wsdl:operation name="getKeyScheduleSignaling"&gt;
      &lt;wsdl:input   message="tns:GetKeyScheduleSignalingRequest" 
        name="GetKeyScheduleSignalingInput"/&gt;
      &lt;wsdl:output message="tns:GetKeyScheduleSignalingResponse" 
        name="GetKeyScheduleSignalingOutput"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="setKeyScheduleAndGetSignaling"&gt;
      &lt;wsdl:input   message="tns:SetKeyScheduleAndGetSignalingRequest" 
        name="SetKeyScheduleAndGetSignalingInput"/&gt;
      &lt;wsdl:output message="tns:SetKeyScheduleAndGetSignalingResponse" 
        name="SetKeyScheduleAndGetSignalingOutput"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="setScheduleAndGetKeySignaling"&gt;
      &lt;wsdl:input   message="tns:SetScheduleAndGetKeySignalingRequest" 
        name="SetScheduleAndGetKeySignalingInput"/&gt;
      &lt;wsdl:output message="tns:SetScheduleAndGetKeySignalingResponse" 
        name="SetScheduleAndGetKeySignalingOutput"/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;
  
&lt;/wsdl:definitions&gt;
</pre>


</section>
</section>
</section>   <!-- end of section 5 -->

<section id="sip"><h1>SIP and SIP/SDP</h1>
<p>Within the architecture there are several interfaces that support the SIP/SDP protocol. They can be functionally grouped as follows:</p><ul>
<li>Between the OITF and the IG over the HNI-IGI interface.
<li>Between the IG and the IMS core network covering the UNIS-8 reference point (residential LAN to core network interface).
<li>Internally within the IMS network in support of various services covering reference points NPI-3, NPI-4 and NPI-30.
<li>Between the IMS and the content delivery network covering reference points NPI-19, and NPI-25.
</ul>
<p>The next sections discuss these interfaces in more detail.  The specification is structured in 2 sub-sections; one sub section covers the SIP/SDP interface in the residential LAN (bullet 1 above), while the other sub-section covers the SIP/SDP interfaces within the managed network relying on SIP (last 3 bullets above). Within each sub-section, the interface details are specified on a per service basis.</p>
<section id="s6-1"><h2>SIP/SDP Reference Points within the Provider Network</h2>
<p>This section defines the protocol for the use of SIP and SIP/SDP within managed networks relying on IMS over the following reference points:</p><ul>
<li>NPI-19
<li>NPI-26
<li>NPI-30
<li>NPI-25
<li>NPI-3
<li>NPI-4
<li>UNIS-8
</ul>
<p>The usage of SIP/SDP for all reference points apart from UNIS-8 is applicable to both the SIP option and the HTTP option for the HNI-IGI interface.</p>
<p>The usage of SIP/SDP for the UNIS-8 interface is described in section <a href="#s6-2" class="sectionRef">6.2</a>.</p>
<section id="s6-1-1"><h3>Generic handling for SIP Requests/Responses</h3>
<section id="s6-1-1-1"><h4>Locating the target OITF device for incoming requests</h4>
<p>For all incoming SIP requests to the IG, that are standalone or dialog initiating the IG SHALL compare the information in the Accept-Contact header in the incoming SIP request, if available, against stored feature tags for the user to select the appropriate OITF device.</p></section>
<section id="s6-1-1-2"><h4>Handling of Incoming and Outgoing SIP Requests</h4>
<p>The IG SHALL support the procedures specified in [[!TS124503]] for originating and terminating sessions.</p>
</section>
</section>
<section id="s6-1-2"><h3>Protocols for IPTV Service Functions</h3>
<section id="s6-1-2-1"><h4>Multicast content streaming with SIP session management</h4>
<section id="s6-1-2-1-1"><h5>Protocol over UNIS-8</h5>
<section id="s6-1-2-1-1-1"><h6>Retrieval of Bandwidth Parameter for FCC/RET enabled multicast content service</h6>
<p>When a request to send  SIP OPTIONS is received from the OITF, the IG SHALL use the mapping specified in section <a href="#s5-3-1-1-2" class="sectionRef">5.3.1.1.2</a>, “<a href="#s5-3-1-1-2" class="sectionTitleRef"></a>”.</p>
<p>When the final response to the SIP OPTIONS message is received from the network as a SIP 200 OK including the SDP, the IG SHALL forward this information to the OITF.</p>
<p>The information REQUIRED in the returned SDP to complete the missing parameters in the SDP offer is:</p><ul>
<li>The total bandwidth for the multicast content service.
</ul>
</section>
<section id="s6-1-2-1-1-2"><h6>Session Initiation and Modification</h6>
<p>Upon receiving a request from the OITF for the initiation of a multicast content service session (see section <a href="#s5-3-1-1-1" class="sectionRef">5.3.1.1.1</a>, “<a href="#s5-3-1-1-2" class="sectionTitleRef"></a>”), the IG SHALL generate an initial INVITE request as specified in [[!TS124503]] for originating sessions.</p>
<p>The IG SHALL forward any received SIP response to the OITF including the information in the SDP.</p>
<p>If the IG receives a 488 error code with warning 370 Insufficient Bandwidth, the IG SHALL send an error message to the OITF.</p>
<p>Session modification procedure is handled by the IG in the same way as a session initiation. See section <a href="#s5-3-1-1-3" class="sectionRef">5.3.1.1.3</a>, “<a href="#s5-3-1-1-3" class="sectionTitleRef"></a>.”</p>
</section>
<section id="s6-1-2-1-1-3"><h6>Session Termination</h6>
<p>On receiving a request from the OITF for the termination of a multicast content service session (see section <a href="#s5-3-1-1-4" class="sectionRef">5.3.1.1.4</a>, “<a href="#s5-3-1-1-4" class="sectionTitleRef"></a>”), the IG SHALL generate a BYE request as specified in [[!TS124503]] for originating sessions.</p>
<p>Alternatively, on receipt of a BYE request from the IPTV Control FE, the IG SHALL forward the request to the OITF as a response to a PENDING_IG request (see section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>”).  The behaviour of the UNIS-8 part of the IG SHALL comply with the procedure specified in [[!TS124503]] for terminating UA.</p>
</section>
<section id="s6-1-2-1-1-4"><h6>Content Reporting and Management of Content Reporting</h6>
<p>Upon receiving a request from the OITF for reporting the watched content for a multicast content service session (see section <a href="#s5-3-1-1-6-1" class="sectionRef">5.3.1.1.6.1</a>, “<a href="#s5-3-1-1-6-1" class="sectionTitleRef"></a>”), the IG SHALL generate a SIP INFO including the Content Reporting Info Package [[!INFO-PKG]].</p>
<p>The IG SHALL forward any received SIP response to the OITF.</p>
<p>Upon receipt of a SIP UPDATE by the IG with an empty Recv-Info header or the unwillingness to receive the Content Reporting Info Package from the IPTV Control FEIPTV Control FE, to stop reporting watched content, the IG SHALL forward the SIP UPDATE to the OITF in an HTTP 200 OK response. The IG SHALL wait for the response from the OITF to forward it to the IPTV Control FEIPTV Control FE.</p>
<p>Upon receipt of a SIP UPDATE, including the Recv-Info header set to Content Reporting Info Package,  by the IG from the IPTV Control FE, to start reporting watched content, the IG SHALL forward the SIP UPDATE to the OITF in an HTTP 200 OK response. The IG SHALL wait for the response from the OITF to forward it to the IPTV Control FE.</p>
</section>
<section id="s6-1-2-1-1-5"><h6>User-initiated Activation/Deactivation of Network-based multicast content streaming Time Shift</h6>
<p>The following procedure is supported in the IG on UNIS-8 in support of user initiated Activation/de-activation of multicast content service time shift:</p><ul>
<li>Upon receiving a request from the OITF for session modification for an activation/de-activation of scheduled content time shift, the IG SHALL generate a SIP re-INVITE as per [[!TS124503]]. 
<li>The IG SHALL forward the received response to the OITF including any SDP information.
</ul>
<p>The IG SHALL generate SIP ACK when requested by the OITF.</p>
</section>
</section>
<section id="s6-1-2-1-2"><h5>Protocol over NPI-4</h5>
<section id="s6-1-2-1-2-1"><h6>Retrieval of Bandwidth Parameter for FCC/RET enabled multicast content service</h6>
<p>The SIP OPTIONS message SHALL conform to [[!TS124503]] and SHALL be forwarded through the ASM, to the IPTV Control FE. If the Request URI in the incoming SIP OPTIONS request is set to the PSI for the multicast content service, the IPTV Control FE SHALL after validating the SIP OPTIONS perform the following:</p><ul>
<li>If the incoming SIP OPTIONS includes the a attribute a=rtcp-fb:&lt;fmt&gt; nack under the m-line, the IPTV Control FE SHALL calculate the total bandwidth for the highest multicast content and the bandwidth for RET and SHALL return the information included in the body of a SIP 200 OK, and which includes the same m-line copied from the incoming request with an additional b-line that includes the total bandwidth.
<li>If the incoming SIP OPTIONS includes the a attribute a=rtcp-fb:&lt;fmt&gt; nack rai under the m-line, the IPTV Control FE SHALL calculate the total bandwidth for the highest multicast content and the bandwidth for FCC and SHALL return the information included in the body of a SIP 200 OK, and which includes the same m-line copied from the incoming request with an additional b-line that includes the total calculated bandwidth.
<li>If the incoming SIP OPTIONS includes the a attribute a=rtcp-fb:&lt;fmt&gt;  nack and the a attribute a=rtcp fb:&lt;fmt&gt;  nack rai  under the m-line, the IPTV Control FE SHALL calculate the total bandwidth for the highest multicast content and  the bandwidth for FCC and RET service combined, and SHALL return the information  included in the body of a SIP 200 OK, and which includes the same m-line copied from the incoming request with an additional b-line that includes the total calculated bandwidth.</ul>
</section>
<section id="s6-1-2-1-2-2"><h6>Session Initiation</h6>
<p>The IPTV Control FE SHALL support the procedures specified in [[!TS183063]] section 5.3.1.1.</p>
<p>The IPTV Control FE SHALL support the procedures specified in [[!TS124503]] that are applicable to an AS acting as a terminating SIP UA.</p>
<p>Upon receipt of a SIP INVITE request, the IPTV Control FE SHALL examine the request-URI to determine that it is a multicast content service session initiation request. The IPTV Control FE SHALL use the IPTV Subscription Profile to check the service rights for the requested broadcast service packages and multicast addresses. The IPTV Control FE SHALL examine the SDP offer parameters, as defined in [[!TS183063]] section 5.3.1.1.</p>
<p>If the SDP parameters are validated successfully, the IPTV Control FE SHALL respond as defined in [[!TS183063]] section 5.3.1.1.</p>
<p>If the SDP also contains m lines for Network Generated Notification stream, the IPTV Control FE SHALL further check the service rights for the requested notification service, using the IPTV Subscription.</p>
<p>If no bc_service_package attributes are included in the SDP offer, the IPTV Control FE SHALL include in the SDP answer one or more a=bc_service_package attributes,  except if it knows that the RACS is or SHALL be pre provisioned with the list of subscribed channels and if all the subscribed channels are allowed for the session. In this case, the inclusion of a=bc_service_package is OPTIONAL.</p>
<p>The service packages SHALL be populated according to the IPTV Subscription Profile to indicate the service packages and scheduled content services.</p>

</section>
<section id="s6-1-2-1-2-3"><h6>Session Modification</h6>
<p>The IPTV Control FE SHALL support the procedures specified in [[!TS183063]] section 5.3.1.2. Network initiated session modification does not apply.</p>
</section>
<section id="s6-1-2-1-2-4"><h6>Session Termination</h6>
<p>The IPTV Control FE SHALL support the procedures specified in [[!TS183063]] section 5.3.1.4.</p>
</section>
</section>
<section id="s6-1-2-1-3"><h5>Content Reporting and Management of Content Reporting</h5>
<p>Upon receipt of SIP INFO including the Info Package Content Reporting for reporting the watched content for a multicast content service session, the IPTV Control FE SHALL examine the body.</p>
<p>If the body is successfully validated as compliant to Annex D of [[!PSS-MBMS]], then the IPTV Control FE SHALL respond to the request with a SIP 200 OK, otherwise an appropriate error message SHALL be returned.</p>
<p>If the IPTV Control FE desires to instruct the OITF to stop reporting watched content, it SHALL send a SIP UPDATE to the IG and where the Recv-Info header is set to remove support for the reception of the Content Reporting Info Package and SHALL wait for the response.</p>
<p>If the IPTV Control FE desires to instruct the OITF to start reporting watched content, it SHALL send a SIP UPDATE to the IG and where the Recv-Info header is set to indicate support for the reception of Content Reporting Info Package and SHALL wait for the response.</p>
</section>
<section id="s6-1-2-1-4"><h5>User-initiated Activation/Deactivation of Network-based multicast content streaming Time Shift</h5>
<p>Upon receipt of a SIP  re-INVITE related to an activation/de-activation of a time shift session, the IPTV Control FE SHALL verify that it does hold a state for the session to be modified.</p>
<p>If the IPTV Control FE does not hold a state for the session, or if the multiparts of the message body including, both, the SDP parameters,  and the XML schema for the OITF-IPTV Commands per section <a href="#s5-3-1-1-7-3" class="sectionRef">5.3.1.1.7.3</a>, “<a href="#s5-3-1-1-7-3" class="sectionTitleRef"></a>” are not successfully validated, the IPTV Control FE SHALL reject the request with a 403 error code.</p>
<p>If the request is for the activation of time shift, the IPTV Control FE SHALL perform the procedure defined in section <a href="#s6-1-2-2-2" class="sectionRef">6.1.2.2.2</a>, “<a href="#s6-1-2-2-2" class="sectionTitleRef"></a>,” and SHALL return to the IG the appropriate response including all mandatory parameters as per the said procedure (note that if the multicast content stream is not stored in the network, the procedure in section <a href="#s6-1-2-2-2" class="sectionRef">6.1.2.2.2</a>, “<a href="#s6-1-2-2-2" class="sectionTitleRef"></a>” SHALL fail and an appropriate error message SHALL be returned to the user).</p>
<p>If the request is for de-activation of time shift, the IPTV Control FE SHALL perform the procedure defined in section <a href="#s6-1-2-2-3" class="sectionRef">6.1.2.2.3</a>, “<a href="#s6-1-2-2-3" class="sectionTitleRef"></a>.” Following the successful completion of the said procedure, the IPTV Control FE SHALL return a SIP 200 OK to the IG.</p>
</section>
</section>
<section id="s6-1-2-2"><h4>Unicast content streaming with SIP session management</h4>
<section id="s6-1-2-2-1"><h5>Retrieving missing parameters in the SDP prior to session setup using SIP OPTIONS</h5>
<section id="s6-1-2-2-1-1"><h6>Protocol over UNIS-8</h6>
<p>When a request to send a SIP OPTIONS is received from the OITF, the IG SHALL use the mapping specified in section <a href="#s5-3-2-1-1" class="sectionRef">5.3.2.1.1</a>, “<a href="#s5-3-2-1-1" class="sectionTitleRef"></a>.”</p>
<p>When the final response to the SIP OPTIONS message is received from the network as a SIP 200 OK including the RTSP SDP, the IG SHALL forward this information to the OITF.</p>
<p>The information REQUIRED in the returned SDP to complete the missing parameters in the SDP offer is:</p><ul>
<li>FEC Information including bandwidth for FEC streams,
<li>Transport protocol.
</ul>
</section>
<section id="s6-1-2-2-1-2"><h6>Protocol over NPI-4, NPI-19, NPI-26</h6>
<p>The SIP OPTIONS message SHALL conform to [[!TS124503]] and SHALL be forwarded through the ASM to the IPTV Control. If, the Request URI in the incoming SIP OPTIONS request is set to the PSI for the unicast content streaming service, the IPTV Control SHALL, after validating the request, forward the SIP OPTIONS to the CDN Controller FE and to the appropriate Cluster Controller, in the same way as for the INVITE message.</p>
<p>In certain cases, the CDN Controller MAY forward the SIP OPTIONS message to a default Cluster Controller.</p>
<p>On receiving the SIP OPTIONS message, the Cluster Controller SHALL issue an RTSP DESCRIBE to the CDF. In certain cases, the Cluster Controller MAY issue an RTSP DESCRIBE to a default CDF.</p>
<p>The DESCRIBE message SHALL conform to the format defined by TS 102 034 [[!TS102034]].</p>
<p>The XML description that complies to TS 102 034 [[!TS102034]] included in the RTSP 200 OK response received from the CDF SHALL be converted by the Cluster Controller to the SDP body in a SIP 200 OK response to the OPTIONS message. The SIP 200 OK message SHALL be forwarded all the way back to the IG.</p>
<p>The explicit mapping between the XML description and the SDP is not subject for formal specification.</p>
<p>This is the only case for which an OPTIONS message will be sent to a Cluster Controller.</p>
<p>Note: If, in a future release, other reasons warrant that the Cluster Controller receive the OPTIONS message, then support for discrimination between the various reasons for sending the OPTION will be REQUIRED.</p>
</section>
</section>
<section id="s6-1-2-2-2"><h5>Procedure for Unicast Service Session Initiation</h5>
<section id="s6-1-2-2-2-1"><h6>Session Initiation</h6>
<p>The IG SHALL support the procedures specified in [[!TS124503]] for initiating unicast sessions.</p>
<p>On receiving a request for a unicast session initiation from the OITF, the IG SHALL generate an initial INVITE request as specified in [[!TS124503]] (for an originating UA). See section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”.</p>
<p>See example messages in Annex <a href="#annex-b-1-1" class="sectionRef">B.1.1</a>, “<a href="#annex-b-1-1" class="sectionTitleRef"></a>.”</p>
</section>
<section id="s6-1-2-2-2-2"><h6>Protocol over NPI-4</h6>
<p>The IPTV Control Function SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a SIP proxy or B2BUA.</p>
<p>When receiving any SIP request, the IPTV Control FE SHALL examine the request to see if it is compatible with the user's subscription profile (e.g. parental control level). If the user is not allowed to initiate a session for the requested content, the IPTV Control FE SHALL reply with an appropriate SIP error response. If the user is allowed to initiate the session, the IPTV Control FE SHALL forward the SIP INVITE to a default CDN Controller.</p>
<p>The IPTV Control Function SHALL NOT change the user-part of the To header in order to retain the content-id in the INVITE request.</p>
<p>Note: this does not apply for the case when the session is related to a user-activated time shift. In case of user-activated time shift, the IPTV Control FE SHALL change the To field to include the requested content ID that corresponds to the shifted multicast content. When the final response is received, the IPTV Control FE SHALL restore the TO field to its original value. In that respect, the IPTV Control FE maintains this information in the session state as long as the session is alive.</p>
</section>
<section id="s6-1-2-2-2-3"><h6>Protocol over NPI-19</h6>
<p>The CDN Controller FE SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a SIP proxy or B2BUA.</p>
<p>When receiving the SIP INVITE from the IPTV Control FE via the Authentication and Session Management FE through the NPI-19 reference point, the CDN Controller SHALL check the content id in the user part of the “To:” header as well as the “From:” and “Via:” fields to determine the most appropriate Cluster Controller FE to serve the User's request.</p>
<p>Once the appropriate Cluster Controller FE is selected, the Content Delivery Network Controller FE SHALL forward the SIP INVITE to it by changing the “Request-URI” accordingly.</p>
<p>The CDN Controller SHALL NOT forward 301 or 302 responses from the Cluster Controller to the IPTV Control Function. The CDN Controller SHALL take one of the following actions on receiving a 301 or 302 response from the Cluster Controller:</p><ul>
<li>Cancel the transaction
<li>Forward to another Cluster Controller
<li>Forward to the suggested CC as indicated in the 301/302 response
<li>Forward to another CDN Controller
</ul>
</section>
<section id="s6-1-2-2-2-4"><h6>Protocol over NPI-25</h6>
<p>On receiving the request from the IPTV Control Function, the CDN Controller MAY decide to forward the request to another CDN Controller. In this case it changes the “Request-URI” accordingly.</p>
</section>
<section id="s6-1-2-2-2-5"><h6>Protocol over NPI-26</h6>
<p>The Cluster Controller FE SHALL support the procedures specified in [[!TS124503]] as applicable to a terminating UA.</p>
<p>When receiving a unicast content streaming session initiation SIP request from the CDN Controller, the Cluster Controller SHALL examine the content identifier present in the user-part of the “To:” header and the media parameters in the received SDP offer and then choose the CDF.</p>
<p>If the requested content is not managed by this Cluster Controller, the Cluster Controller SHALL return a 301 response, or a 302 response for any other reasons (e.g. load-balancing)  The Cluster Controller MAY indicate one or more Cluster Controller addresses in the contact header as indicated in RFC 3261 [[!SIP]].</p>
<p>If the request is not acceptable to the Cluster Controller, it SHALL reply with an appropriate SIP error response.</p>
<p>The Cluster Controller SHALL reply with an appropriate SIP error response if the request is acceptable to the Cluster Controller but none of the Content Delivery Functions can handle the offer.</p>
<p>If the request is acceptable to the Cluster Controller and a CDF can handle the request, the Cluster Controller SHALL initiate an RTSP session using the RTSP SETUP message to the chosen CDF to determine its server ports and the RTSP session ID.</p>
<p>Following the successful conclusion of the RTSP session setup, the Cluster Controller allocates an RTSP server port, binds it to the CDF RTSP server port and answers with a SIP 200 OK, including the SDP answer.</p>
<p>The SDP parameters for the RTSP channel SHALL be set as follows:</p><ul>
<li>An m-line for an RTSP stream with the format:    m=&lt;media&gt; &lt;port&gt; &lt;transport&gt; &lt;fmt&gt; <br />
(ex. <code>m=application 554 tcp iptv_rtsp</code>)
<li>The &lt;media&gt; field SHALL have a value of “application”.
<li>The &lt;port&gt; field SHALL be setup according to RFC 4145 [[!SDP-TCP]]. The port number SHALL be set to the port allocated by the Cluster Controller.
<li>The &lt;transport&gt; field SHALL be identical to the one received in the SDP offer in the initial INVITE.
<li>The &lt;fmt&gt; field SHALL be identical to the one received in the SDP offer in the initial INVITE.
<li>A c-line SHALL include the network type with the value set to “IN”, the address type set to “IP4” and the IP address for the RTSP commands.<br />
(ex: <code>c=IN IP4 &lt;RTSP IP address&gt;</code>)
<li>An “a=setup” attribute SHALL be present and set to “passive”, indicating that the connection is initiated by the other endpoint (OITF), as defined in RFC 4145 [[!SDP-TCP]]. (ex: <code>a=setup:passive</code>)
<li>An “a= connection” attribute SHALL be present and set to “new” as defined in RFC 4145 [[!SDP-TCP]]. (ex: <code>a=connection:new</code>)
<li>One or more a=fmtp lines representing RTSP specific attributes set as follows:<ul>
<li>A “fmtp:iptv_rtsp h-uri” attribute SHALL be set to the RTSP URI of the Cluster Controller to be used in the RTSP requests. The h-uri can be in the form of an absolute or relative URI. If an absolute URI is specified then it SHALL be used in subsequent RTSP requests. If a relative URI is specified in the form of a media path, then the RTSP absolute URI could be constructed by the OITF using the IP Address (from c line) and port (from m-line) as the base followed by h-uri value for the media path. (i.e. fmtp:iptv_rtsp h-uri=&lt;request-uri&gt;)
<p>An absolute URI SHALL have precedence over a c-line if the latter is provided.</p>
<li>The Cluster Controller SHALL include a “fmtp:iptv_rtsp h-session” attribute representing the session-id of the RTSP session to be used by the OITF during media control.  Optionally, a timeout parameter MAY be specified with a numeric timeout interval in seconds for keep-alive (refer to section <a href="#s7-1-1-2-3" class="sectionRef">7.1.1.2.3</a>, “<a href="#s7-1-1-2-3" class="sectionTitleRef"></a>.”)  If the timeout parameter is not specified, then a default value of 60 seconds SHALL be used (refer to section 12.37 of [[!RTSP]])<br />
(i.e. <code>a=fmtp:iptv_rtsp h-session=&lt;rtsp-session&gt;[; timeout=&lt;timeout&gt;]</code>)
<p>Note that if both RTP and RTCP are used in the session, the RTSP server (CDF) can use the received RTCP messages as an indication that the OITF is still connected to the session. This avoids requiring explicit RTSP keep-alive signalling. The RTSP server can easily associate the RTCP messages to the RTSP Session-ID using the RTCP message transport address and the SSRC of the media source. If this method is used and no RTCP messages are received after the default timeout period, the RTSP server MAY tear down the session. Details of this methodology are explained below in the b=RR:&lt;bandwidth-value&gt; line.</p></ul>
<li>An m-line for the actual content which indicates the type of the media, the transport protocol and the port of the related content delivery channel from the response message for the RTSP DESCRIBE.  If a fmt parameter is in the SDP offer it SHALL be completed with the supported format by the CDF.
<li>A c-line SHALL include the network type with the value set to IN, the address type set to IP4 and the unicast address of the stream related to the content delivery channel.<br />
(i.e. <code>c=IN IP4 &lt;IP_ADDRESS&gt;</code>)
<li>A b-line SHALL contain the proposed “session bandwidth” for the COD media stream. Note that this bandwidth value includes the IP and UDP headers (see <a href="https://tools.ietf.org/html/rfc3550#section-6.2" class="extRef">section 6.2</a> of [[!RTP]]).<br />
(ex. <code>b=AS:64, indicating 64kbps</code>)
<li>An a-line with a “sendonly” <br />
(ex. <code>a=sendonly</code>)
<li>A b-line, b=RR:&lt;bandwidth-value&gt;, specifying the agreed bandwidth value (in kbps) the OITF SHALL allocate for sending Receiver Reports (RR) in the COD session.
<li>The Cluster Controller MAY set the bandwidth value in the answer to zero (0) even if a non-zero value is requested by the OITF. In the event a non-zero value is requested by the OITF, the Cluster Controller SHALL NOT change the proposed bandwidth value to a different non-zero value as this could force the OITF to use a bandwidth value it MAY not be able to allocate causing COD session failure. 
<li>Optionally, a b-line b=RS:&lt;bandwidth-value&gt; specifying the amount of bandwidth (in kbps) that the COD session senders (in this case only one COD server) SHALL allocate for RTCP Sender Reports (SR). This value MAY be set to zero (0), b=RS:0. Setting this value to zero (0) is not recommended if several streams will be synchronised.
</ul>
</section>
</section>
<section id="s6-1-2-2-3"><h5>Session Termination</h5>
<p>Session termination for unicast content streaming SHALL follows the same SIP procedures as session termination for the multicast content streaming service.  See section <a href="#s6-1-2-1-1-3" class="sectionRef">6.1.2.1.1.3</a>, “<a href="#s6-1-2-1-1-3" class="sectionTitleRef"></a>.”</p>
</section>
</section>
<section id="s6-1-2-3"><h4>Forced Play Out Control with SIP session management</h4>
<section id="s6-1-2-3-1"><h5>Forced Play Out Controlled by the Cluster Controller</h5>
<p>Note: Client-based play out control is described in [[.OIPF_MEDIA2]] sections <a href="volume2.html#system-mpeg2-ts" class="extRef">4.1</a> and <a href="volume2.html#system-mp4-file-format" class="extRef">4.2</a>, and in [[.OIPF_CSP2]]  <a href="volume7.html#forced-playout-using-media-zones" class="extRef">section 6</a>. The concept there is applicable to downloaded, streamed or stored content where navigation constraints are embedded into the content, i.e. into MP4 files or MPEG-2 transport streams. The [[.OIPF_DAE2]] specification contains language that allows a DAE application to capture navigation input and programmatically decide to honour or ignore the navigation commands, thus providing another way to restrict navigation when content is consumed in a DAE application.</p>
<section id="s6-1-2-3-1-1"><h6>Session Initiation</h6>
<p>Forced Play Out Control session initiation over UNIS-8 is the same procedure as described in section <a href="#s6-1-2-2-2-1" class="sectionRef">6.1.2.2.2.1</a>, “<a href="#s6-1-2-2-2-1" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s6-1-2-3-1-2"><h6>Protocol over NPI-4</h6>
<p>The IPTV Control Function SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a SIP proxy or B2BUA.</p>
<p>When receiving any SIP request, the IPTV Control FE SHALL examine the request to see if it is compatible with the user's subscription profile (e.g. parental control level). If the user is not allowed to initiate a session for the requested content, the IPTV Control FE SHALL reply with an appropriate SIP error response. If the user is allowed to initiate the session, the IPTV Control FE SHALL interact with the IPTV Application to acquire the Forced Play Out control policy per the content identity and/or user’s subscription information.</p>
<p>The IPTV Control FE SHALL add the policy to the SIP INVITE received, and forward the updated SIP INVITE to a default CDN Controller. The IPTV Control Function SHALL NOT change the user-part of the To header in order to retain the content-id in the INVITE request.</p>
<p>The IPTV Control Function SHALL NOT change the existing SDP parameters for the RTSP content control channel and content delivery channel which specified in section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”. Moreover, an additional SDP parameter for the RTSP content control channel to describe Forced Play Out control policy SHALL be included as follows:</p><ul>
<li>one or more “a=unsupport” attributes (see below) as defined in section <a href="#s6-1-2-3-1-6" class="sectionRef">6.1.2.3.1.6</a>, “<a href="#s6-1-2-3-1-6" class="sectionTitleRef"></a>.”
</ul>
<p>Note: this does not apply for the case when the session is related to a user-activated time shift. In case of user-activated time shift, the IPTV Control FE shall change the To field to include the requested content ID that corresponds to the shifted multicast content. When the final response is received, the IPTV Control FE shall restore the TO field to its original value. In that respect, the IPTV Control FE maintains this information in the session state as long as the session is alive.</p>
</section>
<section id="s6-1-2-3-1-3"><h6>Protocol over NPI-19</h6>
<p>Protocol for Forced Play Out Control over NPI-19 is the same as described in section <a href="#s6-1-2-2-2-3" class="sectionRef">6.1.2.2.2.3</a>, “<a href="#s6-1-2-2-2-3" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s6-1-2-3-1-4"><h6>Protocol over NPI-25</h6>
<p>On receiving the request from the IPTV Control Function, the CDN Controller MAY decide to forward the request to another CDN Controller.  In this case, the IPTV Control Function changes the “Request-URI” accordingly.</p>
</section>
<section id="s6-1-2-3-1-5"><h6>Protocol over NPI-26</h6>
<p>The protocol for Forced Play Out Control over NPI-26 is similar to that described in section <a href="#s6-1-2-2-2-5" class="sectionRef">6.1.2.2.2.5</a>, “<a href="#s6-1-2-2-2-5" class="sectionTitleRef"></a>.”
After receiving the session initiation request, if the policy is presented in the request, the Cluster Controller SHALL also store the Forced Play Out Control policy and then choose the CDF.</p>
</section>
<section id="s6-1-2-3-1-6"><h6>Forced Play Out Control Policy Attribute</h6>
<p>The format of the “a=unsupport” attribute is as follows:
<pre class="abnf">
a=unsupport: &lt; RTSP_Operation &gt; &lt; Restriction_Rule &gt;
where
  &lt;RTSP_Operation&gt;  ::= is the RTSP operation that is not permitted by the policy, e.g. fast forward.
  &lt;Restriction_Rule&gt; ::= &lt;time-range-list&gt; | &lt;ContentID-list&gt;
  &lt;ContentID-list&gt; ::= ContentID_list: &lt;contentID&gt; {"|" &lt;contentID&gt;}
  &lt;ContentID &gt; ::= is the identifier of the media content
  &lt;time-range-list&gt;  ::= &lt;npt-range-list&gt; | &lt; utc-range-list&gt; | &lt;smpte-range-list&gt;
  &lt;npt-range-list&gt; ::= npt_range_list: &lt;npt-range&gt; {"|" &lt;npt-range&gt;}
  &lt;utc-range-list&gt; ::= utc_range_list: &lt;utc-range&gt; {"|" &lt;utc-range&gt;}
  &lt;smpte-range-list&gt; ::= smpte_range_list: &lt;smpte-range&gt; {"|" &lt;smpte-range&gt;}
</pre>
</section>
</section>
</section>
<section id="s6-1-2-4"><h4>Purchase of Digital Media Service using SIP</h4>
<section id="s6-1-2-4-1"><h5>Purchase Request for Digital Media</h5>
<section id="s6-1-2-4-1-1"><h5>Protocol over UNIS-8</h5>
<p>Upon receiving a purchase request from the OITF, the IG SHALL send a SIP INFO Request, including the Digital Purchase info package, IPTV Control FE (via the ASM FE).</p>
<p>The IG SHALL forwards any received response to the OITF.</p>
<p>Upon receipt of a SIP UPDATE by the IG with an empty Recv-Info header or unwillingness to receive the Digital Purchase info package from the IPTV Control FE,  to stop sending digital media purchase request, the IG SHALL forward the SIP UPDATE to the OITF in an HTTP 200 OK response. The IG SHALL wait for the response from the OITF to forward it to the IPTV Control FE.</p>
<p>Upon receipt of a SIP UPDATE, including the Recv-Info header set to support the Digital-Purchase Info Package, by the IG from the IPTV Control FE, to start sending digital media purchase request, the IG SHALL forward the SIP UPDATE to the OITF in an HTTP 200 OK response. The IG SHALL wait for the response from the OITF to forward it to the IPTV Control FE.</p>
<p>Note that the IG SHALL be stateful to the SIP UPDATE messages so that it does comply to IPTV Control FE in case an OITF makes an illegal request.</p>
</section>
<section id="s6-1-2-4-1-2"><h5>Protocol over NPI-4</h5>
<p>Upon receipt of SIP INFO request from the IG including the Digital-Purchase info package, the IPTV Control FE SHALL examine the body. If the body is not successfully validated as compliant to section <a href="#s5-3-5-8" class="sectionRef">5.3.5.8</a>, “<a href="#s5-3-5-8" class="sectionTitleRef"></a>”, the IPTV Control FE SHALL issue an appropriate error message. Otherwise, the IPTV Control FE SHALL initiate a purchase request with the Charging FE.</p>
<p>Following the successful completion of the purchase transaction, the IPTV Control FE SHALL inform the IPTV Applications FE so it can update the user profile, and  SHALL wait for a response from the IPTV Applications FE before returning a response to the IG.</p>  
<p>If the IPTV Control FE desires to instruct the OITF to start sending digital media purchase request, it SHALL send a SIP UPDATE to the IG and where the Recv-Info is set to indicate support for the reception of Digital-Purchase Info Package and SHALL wait for the response.</p>
<p>If the IPTV Control FE desires to instruct the OITF to stop sending digital media purchase request, it SHALL send a SIP UPDATE to the IG and where the Recv-Info is empty or removes support for the reception of the Digital-Purchase Info Package and SHALL wait for the response.</p>
</section>
</section>
</section>
<section id="s6-1-2-5"><h4>Pay Per View multicast content service with SIP session management</h4>
<section id="s6-1-2-5-1"><h5>Protocol over UNIS-8</h5>
<section id="s6-1-2-5-1-1"><h6>PPV service initiation without existing multicast content streaming session</h6>
PPV service initiation without an existing multicast content session over UNIS-8 SHALL be the same as multicast content session initiation and modification as described in section <a href="#s6-1-2-1-1-2" class="sectionRef">6.1.2.1.1.2</a>, “<a href="#s6-1-2-1-1-2" class="sectionTitleRef"></a>.”
</section>
<section id="s6-1-2-5-1-2"><h6>Switching from a PPV service to a multicast content service</h6>
Switching from a PPV service to a multicast content service over UNIS-8 SHALL be the same as multicast content streaming session initiation and modification as described in section <a href="#s6-1-2-1-1-2" class="sectionRef">6.1.2.1.1.2</a>, “<a href="#s6-1-2-1-1-2" class="sectionTitleRef"></a>.”
</section>
<section id="s6-1-2-5-1-3"><h6>Switching to a PPV service from a multicast content service or another PPV</h6>
Switching to a PPV service from a multicast content service or another PPV service over UNIS-8 SHALL be the same as multicast content streaming session initiation and modification as described in section <a href="#s6-1-2-1-1-2" class="sectionRef">6.1.2.1.1.2</a>, “<a href="#s6-1-2-1-1-2" class="sectionTitleRef"></a>.”
</section>
<section id="s6-1-2-5-1-4"><h6>Session Termination</h6>
PPV multicast content streaming session termination over UNIS-8 SHALL be the same as Scheduled Content session termination as described in section <a href="#s6-1-2-1-1-3" class="sectionRef">6.1.2.1.1.3</a>, “<a href="#s6-1-2-1-1-3" class="sectionTitleRef"></a>.”
</section>
</section>
<section id="s6-1-2-5-2"><h5>Protocol over NPI-4</h5>
<section id="s6-1-2-5-2-1"><h6>PPV service initiation without existing multicast content streaming session</h6>
<p>The IPTV Control FE SHALL support the procedures specified in [[!TS183063]] section 5.3.1.5.1.</p>
<p>The IPTV Control FE SHALL support the procedures specified in [[!TS124503]] that are applicable to an AS acting as a terminating SIP UA.</p>
<p>Starting watching the PPV service directly SHALL use multicast content session initiation as described in section <a href="#s6-1-2-1-2-2" class="sectionRef">6.1.2.1.2.2</a>, “<a href="#s6-1-2-1-2-2" class="sectionTitleRef"></a>”, with the following differences:</p><ul>
<li>The IPTV Control FE SHALL examine the SDP parameters. In particular it SHALL examine the a=bc_service: parameter which contains the program ID the OITF intends to view. The IPTV Control FE SHALL further check this parameter with the user’s profile: <ul>
<li>If the OITF isn’t allowed to view the program indicated according to the user profile, the IPTV Control FE SHALL NOT accept the offer and SHALL answer with a 403 error code. 
<li>If the program is allowed in the user profile, but has not started, i.e., the current time is earlier than the program start time, the IPTV Control FE SHALL NOT accept the offer and SHALL answer with a 403 error code.
<li>If the program is allowed in the user profile, and has started, i.e., the current time is later than the program start time, the IPTV Control FE SHALL switch to the corresponding PPV service as defined in section <a href="#s6-1-2-5-2-3" class="sectionRef">6.1.2.5.2.3</a> “<a href="#s6-1-2-5-2-3" class="sectionTitleRef"></a>”.</ul>
<li>The IPTV Control FE SHALL process the a=bc_service_package attributes as defined in section <a href="#s6-1-2-1-2-2" class="sectionRef">6.1.2.1.2.2</a>, “<a href="#s6-1-2-1-2-2" class="sectionTitleRef"></a>.”
</ul>
</section>
<section id="s6-1-2-5-2-2"><h6>Switching from a PPV service to a multicast content service</h6>
Switching from a PPV service to a multicast content service over NPI-4 SHALL be the same as multicast content session modification as described in section <a href="#s6-1-2-1-2-3" class="sectionRef">6.1.2.1.2.3</a>, “<a href="#s6-1-2-1-2-3" class="sectionTitleRef"></a>.”
</section>
<section id="s6-1-2-5-2-3"><h6>Switching to a PPV service from a multicast content service or another PPV</h6>
<p>Upon receipt of a PPV session modification request, the IPTV Control FE SHALL follow the procedures defined in ES 283 003 [[!ES283003]] concerning the AS acting as a terminating UA or a B2BUA.</p>
<p>When receiving an SDP offer, the IPTV Control FE MAY modify the SDP answer in accordance with the user subscription as defined in section <a href="#s6-1-2-5-2-1" class="sectionRef">6.1.2.5.2.1</a>, “<a href="#s6-1-2-5-2-1" class="sectionTitleRef"></a>.” If the IPTV Control FE finds a media line not compatible with the user's subscription, it SHALL set the port of this media line to 0. If none of the media lines are acceptable, it SHALL reply with a 403 error response.</p>
</section>
<section id="s6-1-2-5-2-4"><h6>Session Termination</h6>
<p>Upon receipt of a PPV session termination request, the IPTV Control FE SHALL follow the procedures defined in [[!TS124503]] concerning the AS acting as a terminating UA, which is the same as multicast content streaming session termination as described in section <a href="#s6-1-2-1-2-4" class="sectionRef">6.1.2.1.2.4</a>, “<a href="#s6-1-2-1-2-4" class="sectionTitleRef"></a>.”</p>
<p>Upon receipt of an internal indication that a PPV session SHALL be terminated, the IPTV Control FE SHALL generate a BYE request and follow the procedures defined in [[!TS124503]] for an originating OIPF, which is the same as multicast content streaming session termination as described in section <a href="#s6-1-2-1-2-4" class="sectionRef">6.1.2.1.2.4</a>, “<a href="#s6-1-2-1-2-4" class="sectionTitleRef"></a>.”</p>
</section>
</section>
</section>
<section id="s6-1-2-6"><h4>Parental Control for Content using SIP</h4>
<section id="s6-1-2-6-1"><h5>What is on TV – OITF initiated</h5>
<section id="s6-1-2-6-1-1"><h6>Protocol over UNIS-8</h6>
<p>The following SHALL be supported by the IG for subscription to acquire information related to content streamed at an OITF:</p><ul>
<li>An outgoing SUBSCRIBE message for subscription to the Parental Control Watched Content event. Note that the IPTV Control FE SHALL reject a SUBSCRIBE message from a non-authorized user.
<li>An incoming NOTIFY message that complies with section <a href="#s5-3-7-1-4" class="sectionRef">5.3.7.1.4</a>, “<a href="#s5-3-7-1-4" class="sectionTitleRef"></a>” SHALL be proxied to the OITF, otherwise it SHALL be rejected and no further processing SHALL be performed.  
<li>The element ProgrammeId (section <a href="#s5-3-7-1-4" class="sectionRef">5.3.7.1.4</a>, “<a href="#s5-3-7-1-4" class="sectionTitleRef"></a>”) MAY be used.
<li>The OITF contact information SHALL be mapped to DeviceId.
<li>The OITF Call-ID SHALL be mapped to SessionId.
</ul>
</section>
<section id="s6-1-2-6-1-2"><h6>Protocol over NPI-4</h6>
<p>The IPTV Control FE can OPTIONALly use the presence server to support the “What is on TV” feature. In that respect, the IPTV Control FE acts as a publisher for the content being watched on the OITF. The usage of presence server for parental control purposes is distinguished from the usage of presence server for sharing information between users for presence purposes. The later depends on information published directly by presence agents on behalf of users and is under user control, and reflects what the user wants to declare as far as presence information, including what he is currently watching. Information published by the IPTV Control FE is information derived during the session establishment procedures, and is considered as state information.</p>
<p>If the IPTV Control FE uses the presence server to provide parental control service, it SHALL support the SIP PUBLISH request for publishing watched content. The event in this case SHALL be Parental Control Watched Content event as per section <a href="#s5-3-7-1-4" class="sectionRef">5.3.7.1.4</a>, “<a href="#s5-3-7-1-4" class="sectionTitleRef"></a>”.</p>
</section>
</section>
<section id="s6-1-2-6-2"><h5>Parental Control</h5>
<section id="s6-1-2-6-2-1"><h6>Protocol over UNIS-8</h6>
<p>When receiving a request for Parental Control from the OITF as described in section <a href="#s5-3-7-2-1" class="sectionRef">5.3.7.2.1</a>, “<a href="#s5-3-7-2-1" class="sectionTitleRef"></a>,” the IG SHALL generate an initial MESSAGE request as specified in RFC 3428 [[!SIP-IM]]. </p>
<p>When receiving a request for Parental Control from the network as a SIP MESSAGE as described in section <a href="#s5-3-7-2-2" class="sectionRef">5.3.7.2.2</a>, “<a href="#s5-3-7-2-2" class="sectionTitleRef"></a>,” the IG SHALL forward this information to the OITF including the information in the body.</p> 
<p>When the final response to the SIP MESSAGE for Parental Control is received from the network as a SIP 200 OK, the IG SHALL forward this information to the OITF. The IG SHALL forward the final received response from the OITF to the network.</p>
</section>
<section id="s6-1-2-6-2-2"><h6>Protocol over NPI-4</h6>
<p>The IPTV Control Function SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a SIP proxy or B2BUA.</p>
<p>Upon receipt of a SIP MESSAGE request for Parental Control from the IG via the Authorization and Session Management FE, the IPTV Control FE SHALL identify the Content-Type associated with the MESSAGE request to determine that it is a Parental Control request. The IPTV Control FE SHALL check the controlled user in the “To:” header as well as the controller in the “From:” fields to determine whether the controller has the rights to perform Parental Control on the controlled user.</p>
<p>If the controller has the rights to perform Parental Control on the controlled user, the IPTV Control FE SHALL forward the SIP MESSAGE to the controlled user. </p>
<p>Upon receipt of a SIP 200 OK response to the SIP MESSAGE for Parental Control from the OITF via the Authorization and Session Management FE, the IPTV Control FE SHALL forward the SIP 200 OK to the controller.</p>
</section>
</section>
</section>
<section id="s6-1-2-7"><h4>Network-based User Notification Services using SIP</h4>
<section id="s6-1-2-7-1"><h5>Protocol over UNIS-8 for Native HNI-IGI (IMS-based) Notification Request Setup</h5>
<p>Upon receipt by the IG for an HTTP POST to send a SIP MESSAGE, as described in section <a href="#s5-3-8-1-1" class="sectionRef">5.3.8.1.1</a>, “<a href="#s5-3-8-1-1" class="sectionTitleRef"></a>”, the IG SHALL initiate a SIP MESSAGE which SHALL conform to [[!SMPL-IM]].  The response to the SIP MESSAGE SHALL comply with [[!SMPL-IM]].  The IG SHALL NOT retain any state information once the transaction is completed.</p>
</section>
<section id="s6-1-2-7-2"><h5>Protocol over NPI-4 for IMS-based Notification Request Setup</h5>
<p>Upon receipt by the IPTV Control Server FE of a SIP MESSAGE, the IPTV Control FE SHALL first validate that the user is authorized to initiate the request. Following successful validation, the IPTV Control FE SHALL issue a store request to the appropriate IPTV application and SHALL wait for the response.</p>
<p>Upon receipt of a response from the IPTV application, the IPTV Control FE SHALL return a SIP 200 OK response to the IG, or an appropriate error response.</p>
</section>
</section>
<section id="s6-1-2-8"><h4>Content Bookmarking using SIP</h4>
<section id="s6-1-2-8-1"><h5>Protocol for Storing Content Bookmarks over UNIS-8</h5>
<p>Upon receiving a request from the OITF for storing a scheduled content bookmark or a CoD bookmark, (see section <a href="#s5-3-9-1-1" class="sectionRef">5.3.9.1.1</a>, “<a href="#s5-3-9-1-1" class="sectionTitleRef"></a>”), the IG SHALL generate a SIP INFO including the CoD-Bookmark Info Package according to section 2 of [[!PSS-MBMS]]. </p>
<p>The IG SHALL forward any received SIP response to the OITF.</p>
<p>Upon receipt of a SIP UPDATE by the IG with an empty Recv-Info header or unwillingness to receive the CoD Bookmark Info Package from the IPTV Control FE, to stop sending content bookmarks for storage, the IG SHALL forward the SIP UPDATE to the OITF in an HTTP 200 OK response. The IG SHALL wait for the response from the OITF to forward it to the IPTV Control FE.</p>
<p>Upon receipt of a SIP UPDATE, including the Recv-Info header set to support the CoD-Bookmark Info Package,  by the IG from the IPTV Control FE, to start storing content bookmarks, the IG SHALL forward the SIP UPDATE to the OITF in an HTTP 200 OK response. The IG SHALL wait for the response from the OITF to forward it to the IPTV Control FE.</p>
</section>
<section id="s6-1-2-8-2"><h5>Protocol for Storing Content Bookmarks over NPI-4</h5>
<p>Upon receipt of SIP INFO from the IG including the CoD-Bookmark Info Package according to section 2 of [[!PSS-MBMS]] for storing a content bookmark, the IPTV Control FE SHALL examine the body.</p>
<p>If the body is not successfully validated as compliant to section <a href="#s5-3-9-5" class="sectionRef">5.3.9.5</a>, “<a href="#s5-3-9-5" class="sectionTitleRef"></a>”, the IPTV Control FE SHALL issue an appropriate error message. Otherwise, the IPTV Control FE SHALL issue a bookmark store request to the IPTV application responsible for handling bookmarks and SHALL wait for the response before returning a response to the IG. The treatment of the different elements in the body is specified in section <a href="#s5-3-9-5" class="sectionRef">5.3.9.5</a>, “<a href="#s5-3-9-5" class="sectionTitleRef"></a>”.</p> 
<p>If the IPTV Control FE desires to instruct the OITF to stop sending content bookmarks for storage, it SHALL send a SIP UPDATE to the IG where the Recv-Info is empty or removes support for the reception of the CoD-Bookmark Info Package and SHALL wait for the response.</p>
<p>If the IPTV Control FE desires to instruct the OITF to start sending content bookmark for storage, it SHALL send a SIP UPDATE to the IG and where the Recv-Info is set to indicate support for the reception of CoD-Bookmark Info Package and SHALL wait for the response.</p>
</section>
<section id="s6-1-2-8-3"><h5>Content-related bookmark retrieval</h5>
<section id="s6-1-2-8-3-1"><h6>Session Initiation over UNIS-8</h6>
<p>The IG SHALL support the procedures specified in [[!TS124503]] for initiating unicast sessions.</p>
<p>On receiving a request for a unicast session initiation from the OITF, the IG SHALL generate an initial INVITE request as specified in [[!TS124503]] (for an originating UA). See section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”.</p>
<p>When the final response to the SIP INVITE request is received from the network as a SIP 200 OK including the SDP (for content delivery and content control channel) , the IG SHALL forward this information to the OITF.</p>
<p>When the SIP INFO request with the XML body (for content-related bookmark list) is received from the network, the IG SHALL forward this information to the OITF. The IG SHALL forward the received response from the OITF to the network.</p>
</section>
<section id="s6-1-2-8-3-2"><h6>Session Initiation over NPI-4</h6>
<p>The IPTV Control Function SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a SIP proxy or B2BUA.</p>
<p>When receiving the SIP INVITE request, the IPTV Control FE SHALL send an XCAP GET request to the IPTV Service Profile to get the user’s profile and content-related bookmark list with the user ID and content ID which are retrieved from the INVITE request. and then examine whether the user has the right to initiate a unicast session for the content. If the user is not allowed to initiate a session for the requested content, the IPTV Control FE SHALL replies with an appropriate SIP error response. If the user is allowed to initiate the session, the IPTV Control FE SHALL forward the SIP INVITE to a default CDN Controller.</p>
<p>The IPTV Control Function SHALL NOT change the user-part of the To header in order to retain the content-id in the INVITE request and maintains the SDP received from the IG.</p>
<p>When receiving the SIP 200 OK response for the INVITE request, the IPTV Control forwards the SIP 200 OK response to the OITF, and then sends the SIP INFO to the OITF with the XML body for the content-related bookmark list (see section <a href="#s5-3-9-5" class="sectionRef">5.3.9.5</a>, “<a href="#s5-3-9-5" class="sectionTitleRef"></a>”).</p>
<p>Note: this does not apply for the case when the session is related to a user-activated time shift. In case of user-activated time shift, the IPTV Control FE SHALL change the To field to include the requested content ID that corresponds to the shifted multicast content. When the final response is received, the IPTV Control FE SHALL restore the TO field to its original value. In that respect, the IPTV Control FE maintains this information in the session state as long as the session is alive.</p>
</section>
<section id="s6-1-2-8-3-3"><h6>Session Initiation over NPI-19</h6>
<p>The procedure is the same as that defined in section <a href="#s6-1-2-2-2-3" class="sectionRef">6.1.2.2.2.3</a>, “<a href="#s6-1-2-2-2-3" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s6-1-2-8-3-4"><h6>Session Initiation over NPI-25</h6>
<p>The procedure is the same as that defined in section <a href="#s6-1-2-2-2-4" class="sectionRef">6.1.2.2.2.4</a>, “<a href="#s6-1-2-2-2-4" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s6-1-2-8-3-5"><h6>Session Initiation over NPI-26</h6>
<p>The procedure is the same as that defined in section <a href="#s6-1-2-2-2-5" class="sectionRef">6.1.2.2.2.5</a>, “<a href="#s6-1-2-2-2-5" class="sectionTitleRef"></a>”.</p>
</section>
</section>
</section>
<section id="s6-1-2-9"><h4>Local PVR Service using SIP</h4>
<section id="s6-1-2-9-1"><h5>Protocol over UNIS-8</h5>
<section id="s6-1-2-9-1-1"><h6>PVR Service Capture Request/Response</h6>
<p>Upon receiving a request from the OITF for the PVR Service Capture Request (see section <a href="#s5-3-10" class="sectionRef">5.3.10</a>, “<a href="#s5-3-10" class="sectionTitleRef"></a>”), the IG SHALL generate a SIP MESSAGE as specified in [[!TS124503]].</p>
</section>
<section id="s6-1-2-9-1-2"><h6>PVR Record Request/Response</h6>
<p>Upon receiving a request from the OITF for the PVR Service Capture Request (see section <a href="#s5-3-10" class="sectionRef">5.3.10</a>, “<a href="#s5-3-10" class="sectionTitleRef"></a>”), the IG SHALL generate a SIP MESSAGE as specified in [[!TS124503]].</p>
<p>The IG SHALL forward any received SIP response to the OITF including the information.</p>
<p>If the IG receives PVR Record Request initiated from an OITF different than the one used for recording, the IG SHALL forward PVR Record Request to relevant OITF.</p>
</section>
</section>
<section id="s6-1-2-9-2"><h5>Protocol over NPI-4</h5>
<section id="s6-1-2-9-2-1"><h6>PVR Service Capture Request/Response</h6>
<p>The IPTV Control Function SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a SIP proxy or B2BUA.</p>
<p>When receiving SIP MESSAGE for PVR Service Capture from the IG, the IPTV Control Function SHALL perform the following:</p><ul>
<li>Verifies that the user is subscribed to the service.
<li>Verifies that there is no active Capture Order for the same Program. 
<li>Verifies that the user is allowed to set up a Scheduled Recording order in the Local PVR mode. When the Local PVR mode is initiated, the IPTV Control Function verifies the recording capabilities of the target local PVR (i.e. storage of the local PVR).
</ul>
<p>The IPTV Control Function SHALL forwards an appropriate SIP response based on the outcome of the verification process.</p>
</section>
<section id="s6-1-2-9-2-2"><h6>PVR Record Request/Response</h6>
<p>When the IPTV Control Function initiates a SIP MESSAGE request for PVR recording, the Request-URI SHALL be set to the Public Identity of the target user (IMPU). The IPTV Control Function SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a SIP proxy or B2BUA. The content of the SIP MESSAGE SHALL conform to Table <a href="#t44" class="tableRef">44</a> as per step 5 in section <a href="#s5-3-10-1" class="sectionRef">5.3.10.1</a>.</p>
<p>The IPTV Control Function SHALL wait for the received response.</p>
</section>
</section>
</section>
<section id="s6-1-2-10"><h4>Network PVR (nPVR) using SIP</h4>
<section id="s6-1-2-10-1"><h5>OITF-initiated nPVR</h5>
<section id="s6-1-2-10-1-1"><h6>Protocol over UNIS-8</h6>
<section id="s6-1-2-10-1-1-1"><h6>PVR Record Request/Response</h6>
<p>Upon receiving a request from the OITF for the PVR Service Request (see section <a href="#s5-3-11" class="sectionRef">5.3.11</a>, “<a href="#s5-3-11" class="sectionTitleRef"></a>”), the IG SHALL generate a SIP MESSAGE message as specified in [[!TS124503]].  The IG SHALL forward any received SIP response to the OITF.</p>
</section>
</section>
<section id="s6-1-2-10-1-2"><h6>Protocol over NPI-4</h6>
<p>The IPTV Control Function SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a terminating SIP UA.</p>
<p>When receiving any NPVR request, the IPTV Control Function SHALL examine the request to see:</p><ul>
<li>If the user is subscribed to the PVR service.
<li>If the program is allowed to recorded.
<li>If it is compatible with the user's subscription profile (e.g. parental control level).
<li>If the new item to be recorded doesn't exceed the user’s storage quota.
</ul>
<p>If the record request is successful, the IPTV Control Function SHALL create a context for the order, register relevant information and update the user’s profile status for PVR to “Order Captured”, meaning that a recording order is pending execution.
<p>If the record request is not valid, the IPTV Control Function SHALL respond with a non-2XX SIP response and SHALL subsequently issue a SIP MESSAGE compliant to the OITF to report the reason for rejection.
<p>The body of the SIP MESSAGE SHALL include the MIME type “application/vnd.oipf.pvrresult+xml” based upon the XML schema defined in section <a href="#s5-3-11-2" class="sectionRef">5.3.11.2</a>, “<a href="#s5-3-11-2" class="sectionTitleRef"></a>”.
<p>At the start of the scheduled program or the start time of the immediate NPVR request, the IPTV Control Function SHALL find the appropriate CDNC/CC/CDF to setup the content delivery channel for the content recording. It is done by issuing an SIP INVITE to the selected Content Delivery Network Control Function, and SHALL wait for 200 OK response. 
<p>Based on the local policy, the following SHOULD apply to avoid duplicated recording:</p><ul>
<li>Upon receiving a scheduled NPVR record request, the IPTV Control FE check whether the same program (identified by BCServiceID and ProgramID) has been requested to record. If yes, the IPTV Control FE SHOULD NOT issue another NPVR request for the same content.
<li>Upon receiving an immediate NPVR record request, the IPTV Control FE examines the status of the program. If the same program (identified by BCServiceID and ProgramID) is already under recording, the IPTV Control FE SHOULD NOT issue another NPVR request for the same content.
<li>Note: in case of duplicated recording for multiple users, the users will have the same CRID for accessing the recorded content.
</ul>
<p>The content of the SIP INVITE message SHALL be as follows:</p><ul class="nobullet">
<li>The Header: see Table <a href="#t130" class="tableRef">130</a>.
<li>The Body: the message body SHALL Multipart/Related MIME container [[!RFC2837]], containing a SDP of the multicast content to be recorded and a nPVR request XML document, with the “RequestType“ set to “Setup”. The nPVR request XML document SHALL conform to section <a href="#s5-3-11-2" class="sectionRef">5.3.11.2</a>, “<a href="#s5-3-11-2" class="sectionTitleRef"></a>”.
</ul>
<table id="t130" class="mapping">
<caption>Table ####: List of SIP headers for PVR Service Recording Status (CC&rarr;IPTV Control)</caption>
<tr><th>SIP Header</th><th>Source of Coding Information</th></tr>
<tr><td>Request-Line<p>Note: The request URI MUST be set to the SIP URI of the selected CDNC</td><td>RFC 3261 [[!SIP]]<p>INVITE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To<p>The URI part of To SHALL be set to the value of the Request URI in the “Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Type<p>It SHALL be set to “multipart/related”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<p>Upon receiving 200 OK response from the CDNC, the IPTV Control FE SHALL update status of the NPVR request in the users’ profile with “Recording”.</p>
<p>Upon receiving a SIP UPDATE message from the CDNC, the IPTV Control FE SHALL extract the program identifier and the status information, then update the user profiles of all the users whom requested to record the program in the network. Then the IPTV Control FE SHALL generate a BYE request as specified in [[!TS124503]] for originating sessions.</p>
</section>
<section id="s6-1-2-10-1-3"><h6>Protocol over NPI-19</h6>
<p>The CDN Controller FE SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a SIP proxy or B2BUA.</p>
<p>When receiving the SIP INVITE from the IPTV Control FE via the Authentication and Session Management FE through the NPI-19 reference point, the CDN Controller SHALL check the request type and the program id of the NPVR request, and determine the most appropriate Cluster Controller FE to serve the NPVR request.</p>
<p>Once the appropriate Cluster Controller FE is selected, the Content Delivery Network Controller FE SHALL forward the SIP INVITE to it by changing the “Request-URI” accordingly.</p>
<p>The CDN Controller SHALL NOT forward 301 or 302 responses from the Cluster Controller to the IPTV Control Function. The CDN Controller SHALL take one of the following actions on receiving a 301 or 302 response from the Cluster Controller:</p><ul>
<li>Cancel the transaction
<li>Forward to another Cluster Controller
<li>Forward to the suggested CC as indicated in the 301/302 response
<li>Forward to another CDN Controller
</ul>
<p>Upon receiving a SIP UPDATE message from the Cluster Controller, the CDNC SHALL forward the message to the IPTV Control FE.</p>
</section>
<section id="s6-1-2-10-1-4"><h6>Protocol over NPI-25</h6>
<p>On receiving the request from the IPTV Control Function, the CDN Controller MAY decide to forward the request to another CDN Controller. In this case it changes the “Request-URI” accordingly.</p>
</section>
<section id="s6-1-2-10-1-5"><h6>Protocol over NPI-26</h6>
<p>The Cluster Controller FE SHALL support the procedures specified in [[!TS124503]] as applicable to a terminating UA.</p>
<p>Upon receiving a NPVR Request from the CDN Controller, the Cluster Controller SHALL examine the program  identifier present in NPVR request XML document, and the media parameters in the received SDP offer and then choose a CDF.</p>
<p>If all the CDFs lack of storage, the Cluster Controller SHALL return a 301 response, or a 302 response for any other reasons (e.g. load-balancing)  The Cluster Controller MAY indicate one or more Cluster Controller addresses in the contact header as indicated in RFC 3261 [[!SIP]].</p>
<p>If the request is not acceptable to the Cluster Controller, it SHALL reply with an appropriate SIP error response.</p>
<p>The Cluster Controller SHALL reply with an appropriate SIP error response if the request is acceptable to the Cluster Controller but none of the Content Delivery Functions can handle the offer.</p>
<p>If the request is acceptable to the Cluster Controller and a CDF can handle the request, the Cluster Controller SHALL initiate an RTSP session using the RTSP SETUP message to the chosen CDF. the CDF then SHALL join the multicast group, and return 200 OK with the server port and RTSP Session ID to setup the content delivery channel between the CDF and the content source. Then CC sends a RTSP Recording to the CDF to record the content as defined in section <a href="#s7-1-3-1" class="sectionRef">7.1.3.1</a>, “<a href="#s7-1-3-1" class="sectionTitleRef"></a>”.</p>
<p>Following the successful conclusion of the RTSP session setup, the Cluster Controller allocates an RTSP server port, binds it to the CDF RTSP server port and answers with a SIP 200 OK, including the SDP answer and the record status report conforming to section <a href="#s5-3-11-2" class="sectionRef">5.3.11.2</a>, “<a href="#s5-3-11-2" class="sectionTitleRef"></a>”.</p>
<p>When completing the record of the requested program, the Cluster Controller SHALL issue a SIP UPDATE message to the IPTV Control FE with appropriate record status (i.e. “Recording Completed”).</p>
<p>The content of the above two messages SHALL be as follows:</p><ul>
<li>The SIP UPDATE message Header: see Table <a href="#t131" class="tableRef">131</a>.
<li>The SIP UPDATE message Body: The Cluster Controller SHALL include a body associated with the appid “urn:oipf:service:PVR:2011” as defined in section <a href="#s5-3-11-2" class="sectionRef">5.3.11.2</a>, “<a href="#s5-3-11-2" class="sectionTitleRef"></a>”.
</ul>
<table id="t131" class="mapping">
<caption>Table ####: List of SIP headers for PVR Service Recording Status (CC&rarr;IPTV Control)</caption>
<tr><th>SIP Header</th><th>Source of Coding Information</th></tr>
<tr><td>Request-Line<p>Note: The request URI MUST be set to well-known PSI for NPVR</td><td>RFC 3261 [[!SIP]]<p>UPDATE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To<p>The URI part of To SHALL be set to the value of the Request URI in the “Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Type<p>It SHALL be set to “application/vnd.oipf.pvr+xml”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>

</section>
</section>
<section id="s6-1-2-10-2"><h5>6Non-OITF-initiated nPVR</h5>
<p>nPVR service can also be initiated by non-OITF based user equipments so that the IPTV user can consume the multicast content later with an OITF. In this case, the user will send nPVR request to the IPTV Application (or other specific FE in the service provider domain) by means like web browser through internet /SMS through mobile network etc. </p>
<p>Upon receiving such nPVR request, the IPTV application SHALL validate the user and then, on behalf of the user, send the nPVR request to the IPTV Control FE. The IPTV Control FE SHALL validate the request, do recording and update the user profile as defined in section <a href="#s6-1-2-10-1" class="sectionRef">6.1.2.10.1</a>, “<a href="#s6-1-2-10-1" class="sectionTitleRef"></a>”.</p>
<section id="s6-1-2-10-2-1"><h6>Protocol over NPI-19</h6>
<p>The protocol used in NPI-19 for Non-OITF initiate NPVR service SHALL be the same as for OITF Initiated Network PVR service, as defined in section <a href="#s6-1-2-10-1-3" class="sectionRef">6.1.2.10.1.3</a>, “<a href="#s6-1-2-10-1-3" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s6-1-2-10-2-2"><h6>Protocol over NPI-25</h6>
<p>The protocol used in NPI-25 for Non-OITF initiate NPVR service SHALL be the same as for OITF Initiated Network PVR service, as defined in section <a href="#s6-1-2-10-1-4" class="sectionRef">6.1.2.10.1.4</a>, “<a href="#s6-1-2-10-1-4" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s6-1-2-10-2-3"><h6>Protocol over NPI-26</h6>
<p>The protocol used in NPI-26 for Non-OITF initiate NPVR service SHALL be the same as for OITF Initiated Network PVR service, as defined in section <a href="#s6-1-2-10-1-5" class="sectionRef">6.1.2.10.1.5</a>, “<a href="#s6-1-2-10-1-5" class="sectionTitleRef"></a>”.</p>
</section>
</section>
</section>
<section id="s6-1-2-11"><h4>Personalised Channel using SIP</h4>
<section id="s6-1-2-11-1"><h5>Procedure for Network-centric Personalised Channel (unicast only)</h5>
<section id="s6-1-2-11-1-1"><h6>Protocol over UNIS-8, NPI-19, NPI-25 and NPI-26</h6>
<p>The procedures over UNIS-8, NPI-19, NPI-25 and NPI-26 for PCh service SHALL follow those described in section <a href="#s6-1-2-2" class="sectionRef">6.1.2.2</a>, “<a href="#s6-1-2-2" class="sectionTitleRef"></a>”, with the difference that the request URI and the To header in the INVITE request from the OITF SHALL include the indicated Personalised Channel identifier.</p>
</section>
<section id="s6-1-2-11-1-2"><h6>Protocol over NPI-4</h6>
<section id="s6-1-2-11-1-2-1"><h6>PCh session initiation</h6>
<p>The IPTV Control Function SHALL support the procedures specified in [[!TS124503]] as applicable to an AS acting as a SIP B2BUA.</p>
<p>When receiving any SIP request, the IPTV Control FE SHALL examine the request to see if it is compatible with the user's subscription profile (e.g. parental control level). If the user is not allowed to initiate a session for the requested Personalised Channel, the IPTV Control FE SHALL reply with an appropriate SIP error response. </p>
<p>If the user is allowed to initiate the session, the IPTV Control FE SHALL first retrieve the detailed PCh information for the user from the IPTV Application FE via NPI-2 reference point, then it SHALL forward the SIP INVITE to a default CDN Controller with the following modifications:</p><ul>
<li>The request URI SHALL be set to the Public Identity of the CDN Controller FE;
<li>The To header SHALL include the PChId and the content item which is to be played, i.e. PChId: BCServiceId or PChId: COD content Id, which are extracted from the PCh information.
</ul>
<p>The request body includes the SDP identical to the incoming INVITE request, i.e. it SHALL contain the unicast content delivery description for the OITF regardless whether the next PCh item is scheduled content or on-demand content. </p>
</section>
<section id="s6-1-2-11-1-2-2"><h6>PCh content switch</h6>
<p>When it is time for the next PCh content to be played, the IPTV Control FE SHALL initiate SIP INFO based upon the configuration of the retrieved PCh information. The IPTV Control FE SHALL construct the out-going SIP INFO request to the selected CDNC/CC/CDF, as described below:</p><ul>
<li>Request URI SHALL include the PChId and the content item which is to be played, i.e. PChId: BCServiceId or PChId: COD content Id, which are extracted from the PCh information;
<li>The To header SHALL be the same with the Request URI;
<li>The From header SHALL include the Public Identity of the IPTV Control or the well-known PSI of PCh Service;
<li>The Content-Type header SHALL be set to application/vnd.oipf.pchcontentswitch+xml, conforming to RFC 3261 [[!SIP]];
<li>The message body SHALL include one or more “PChContentSwitchControl” elements.
</ul>
<p>Note: The detailed XML schema refers to section <a href="#s6-1-2-11-1-3" class="sectionRef">6.1.2.11.1.3</a>, “<a href="#s6-1-2-11-1-3" class="sectionTitleRef"></a>”.</p>
<p>When the CC receives the SIP MESSAGE, it SHALL respond a SIP 200 OK, and then parse the message body for content switch, i.e. use the ContentId and SwitchTime to initiate the RTSP PLAY towards the CDF for delivery of the next PCh content item as described in section <a href="#s7-1-4-2" class="sectionRef">7.1.4.2</a>, “<a href="#s7-1-4-2" class="sectionTitleRef"></a>.”</p>
</section>
<section id="s6-1-2-11-1-2-3"><h6>PCh session termination</h6>
<p>Session termination for PCh SHALL follow the same SIP procedures as session termination for the COD service.  See section <a href="#s6-1-2-2-3" class="sectionRef">6.1.2.2.3</a>, “<a href="#s6-1-2-2-3" class="sectionTitleRef"></a>”.</p>
</section>
</section>
<section id="s6-1-2-11-1-3"><h6>XML schema for PCh content switch</h6>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:iptv:pchcontentswitch:2011"
  xmlns:tns="urn:oipf:itpv:pchcontentswitch:2011"
  xmlns:ct="urn:oipf:base:CommonTypes:2011"
  xmlns:xs="http://www.w3.org/2001/XMLSchema" 
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;

  &lt;xs:import namespace="urn:oipf:base:CommonTypes:2011" 
    schemaLocation="base-CommonTypes.xsd" /&gt;
  &lt;xs:element name="PChContentSwitchControl"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="PChContentItem" type="tPChContentItem" 
          maxOccurs="unbounded"/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name="PChId" type="xs:anyURI" use="required"/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:complexType name="tPChContentItem"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="ProgramIdentifier" type="ct:ProgramIdType" /&gt;
      &lt;xs:element name="SwitchTime" type="xs:dateTime" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

&lt;/xs:schema&gt;
</pre>
</section>
</section>
<section id="s6-1-2-11-2"><h5>OITF-Centric Personalised Channel</h5>
<section id="s6-1-2-11-2-1"><h6>Protocol over UNIS-8, NPI-4, NPI-19, NPI-25 and NPI-26</h6>
<p>When recording overlapped content, the LPVR or nPVR procedures will be used.</p>
<p>The messaging and procedures for recording the overlapped content on a LPVR SHALL be as specified in section <a href="#s6-1-2-8-3" class="sectionRef">6.1.2.8.3</a>, “<a href="#s6-1-2-8-3" class="sectionTitleRef"></a>.” </p>
<p>The messaging and procedures for recording the overlapped content on a nPVR SHALL be as specified in section <a href="#s6-1-2-10" class="sectionRef">6.1.2.10</a>, “<a href="#s6-1-2-10" class="sectionTitleRef"></a>”.</p>
<p>When a time gap between adjacent content items is detected, the OITF MAY perform the procedures specified in section <a href="#s5-3-12-2" class="sectionRef">5.3.12.2</a>, “<a href="#s5-3-12-2" class="sectionTitleRef"></a>”.</p>
</section>
</section>
</section>
<section id="s6-1-2-12"><h4>Session Transfer with SIP session management</h4>
<section id="s6-1-2-12-1"><h5>Protocol over UNIS-8</h5>
<section id="s6-1-2-12-1-1"><h6>Generic Procedures</h6>
<section id="s6-1-2-12-1-1-1"><h6>Session Initiation Procedures Related to a Session Transfer</h6>
<p>The IG SHALL support the procedures specified in [[!SRVCONT]] for initiating unicast sessions associated with session transfer.</p>
<p>On receiving a request for a unicast session initiation from the transferee OITF, the IG SHALL generate an initial INVITE request as specified in [[!SRVCONT]].</p>
</section>
<section id="s6-1-2-12-1-1-2"><h6>IG initiated Session Modification Procedures</h6>
<p>The IG SHALL support the procedures specified in [[!TS124503]] for putting media subject to transfer, on hold (setting the port to 0 in the m-line in the SDP) and reducing the QoS resources for the transferor OITF down to zero, when it detects that the transferor and the transferee are behind the same IG.</p>
</section>
</section>
<section id="s6-1-2-12-1-2"><h6>Session Transfer Via Push Mode</h6>
<p>The following SHALL be supported by the IG:</p><ul>
<li>An outgoing REFER message associated with transferor OITF SHALL conform to [[!SRVCONT]]
<li>The IG SHALL forward any incoming SIP REFER, for the purpose of session transfer, that conforms to the [[!SRVCONT]] to the transferee OITF. Non-conformant SIP REFER messages SHALL be rejected with the appropriate response code. 
<li>An outgoing SIP NOTIFY message associated with the transferee reporting the outcome of a session transfer associated with a REFER request, SHALL conform to [[!SRVCONT]] and [[!RFC3515]].
<li>The IG SHALL forward any incoming SIP NOTIFY, reporting the outcome of a session transfer associated with a REFER request, that conforms to [[!SRVCONT]] and [[!RFC3515]] to the transferor OITF. Non-conformant SIP REFER messages SHALL be rejected with the appropriate response code. 
</ul>
</section>
</section>
<section id="s6-1-2-12-2"><h5>Protocol over NPI-4</h5>
<section id="s6-1-2-12-2-1"><h6>Generic Procedures</h6>
<section id="s6-1-2-12-2-1-1"><h6>Session Initiation Procedures</h6>
<p>When receiving a SIP INVITE request associated with a session transfer, the IPTV Control FE SHALL first authorize the request. If the user is not authorized or the INVITE is not successfully validated, in accordance with [[!SRVCONT]] the IPTV Control FE SHALL respond with an appropriate SIP error message. If the user is authorized and the INVITE is successfully validated, then the IPTV Control FE behaviour depends on the SDP in the incoming INVITE:</p><ul>
<li>If the same CDF of the transferred session can be used, then the IPTV Control FE SHALL send a SIP UPDATE (or re INVITE) to the selected CNDC to update the SIP session leg with the new SDP.
<li>If the same CDF of the transferred session cannot be used, and a new one is REQUIRED, then the IPTV Control FE SHALL terminate the SIP leg towards the old CDNC/CC/CDF to terminate the content flow sent to the transferor device first. The IPTV Control FE SHALL create a new SIP session leg by forwarding the SIP INVITE to a default CDNC as per section <a href="#s6-1-2-1-1-2" class="sectionRef">6.1.2.1.1.2</a>, “<a href="#s6-1-2-1-1-2" class="sectionTitleRef"></a>”.
</ul>
</section>
<section id="s6-1-2-12-2-1-2"><h6>IG initiated Session Modification Procedures</h6>
<p>When receiving a SIP UPDATE (or re-INVITE) request associated with a session transfer, and related to an ongoing session, the IPTV Control FE SHALL first validate the request. If the SIP UPDATE (or re-INVITE) is successfully validated, then the IPTV Control FE behaviour SHALL release the resources based on the incoming SIP UPDATE (or re-INVITE), SHALL put the media on hold, and SHALL return the received response to the IG.</p>
</section>
</section>
<section id="s6-1-2-12-2-2"><h6>Session Transfer Via Push Mode</h6>
<p>When receiving a SIP REFER request, the IPTV Control FE SHALL authorize the request. If the user is not authorized to perform session transfer, an appropriate SIP error response is returned. If the user is authorized, the IPTV Control FE SHALL forward the SIP REFER to the ASM for delivery to its destination (transferee OITF). The IPTV Control FE SHALL be stateful to the session transfer procedure.</p>
<p>When receiving a SIP NOTIFY associated with a SIP REFER request, the IPTV Control FE SHALL validate the SIP NOTIFY as per [[!SRVCONT]].  If not successfully validated, an appropriate SIP response SHALL be returned. If successfully validated, the IPTV Control FE SHALL forward the SIP NOTIFY to the ASM for delivery to the destination (transferor OITF).</p>
</section>
</section>
</section>
</section>
<section id="s6-1-3"><h3>Protocols for Service Access and Control Functions</h3>
<section id="s6-1-3-1"><h4>Service Provider Discovery</h4>
<section id="s6-1-3-1-1"><h5>Protocol over UNIS-8 and NPI-30</h5>
<p>The IPTV Service Provider Discovery FE SHALL generate and/or provide the Service Provider Discovery information.</p>
<p>The IG SHALL follow the following procedure to retrieve Service Provider Discovery information:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG SHALL send a SIP SUBSCRIBE to the network, to subscribe to the “ua-profile” event, and SHALL wait for the response to the subscription request. </td></tr>
<tr><td class="label">Step 2:</td><td>When a SIP NOTIFY is received by the IG for a “ua-profile” event, the IG SHALL store the body of the SIP NOTIFY. </td></tr>
<tr><td class="label">Step 3a:</td><td>If the IG receives a HTTP GET for the Service Provider information, it SHALL return the body of the SIP NOTIFY (from step 2) in the HTTP response body.</td></tr>
<tr><td class="label">Step 3b:</td><td>If the IG receives a HTTP POST on the HNI-IGI interface from the OITF which includes a SIP SUBSCRIBE with a message body associated with the appid “urn:oipf:application:iptv-SP-discovery”, the IG SHALL send a SUBSCRIBE to the network with the following capabilities:</td></tr>
</table>
<p>The message body SHALL include what was received from the OITF, which are the capabilities of the OITF which are sent to the Service Provider Discovery FE.  The details of the SIP SUBSCRIBE are as specified in [[!TS183063]] section 5.1.2.2.1.  To wit:</p><ul>
<li>The Content Type header SHALL be set to “application/vnd.oipf.ueprofile+xml”
<li>The UserEquipmentID is a unique global identifier of the device.
<li>The User Equipment Class SHALL take values “TV-OITF”, “STB-OITF”, according to the implementation options in [[.OIPF_ARCH2]] <a href="architecture.html#s5-3-4" class="extRef">section 5.3.4</a>.
</ul>
<p>When the Service Provider Discovery FE receives a SUBSCRIBE request, it MAY check the user’s IPTV subscription profile and provide a personalized Service Provider Discovery information to the OITF. Filtering MAY also be performed if device capabilities are available to the SDF.</p>
<p>If the Service Provider Discovery FE receives a SIP SUBSCRIBE message body from the IG carrying OIPF capabilities, the Service Provider Discovery FE SHALL process the SIP request as specified below.</p>
<p>On successful subscription, the Service Provider Discovery FE SHALL generate a 200 OK response. The Service Provider Discovery FE SHALL then send a NOTIFY request to the OITF in accordance with RFC 3265 [[!SIP-EVNT]]. </p>
<p>The contents of the SIP NOTIFY request SHALL be as follows:</p><ul>
<li>Extend the existing “ua-profile” event package for SIP NOTIFY as follows:
<li>The Event header SHALL be set to the “ua-profile” event package.
<li>The “effective-by” parameter for the event header SHALL be set to 0.
<li>The content type SHALL be set to “application/vnd.oipf.spdiscovery+xml”.
</ul>
<p>The Service Provider Discovery Information SHALL be delivered in the message body and SHALL conform to the schema defined in [[.OIPF_META2]].</p>
<p>Note: If the above extension is not accepted by the IETF, then the use of a new method (New Event package) SHOULD be re examined. (See Annex <a href="#new-event-package-format" class="sectionRef">K</a>)</p>
<p>When the IPTV Service Provider Discovery FE knows of a change to the Service Discovery, Service Provider or Selection Information, the IPTV Service Provider Discovery FE SHALL inform the OITF of this change by sending a SIP NOTIFY message.</p>
</section>
</section>
<section id="s6-1-3-2"><h4>User Registration and Network Authentication</h4>
<section id="s6-1-3-2-1"><h5>User Identity Modelling</h5>
<p>Every IMS Subscription SHALL be allocated a single unique default IMS Pubic Identity by the Service Platform Provider. This SHALL be the identity that is registered in the IMS domain when an OITF is turned on.</p>
<p>Every IPTV end-user in an IMS Subscription MAY be associated with an IMS Public User Identity by the Service Platform Provider.</p>
<p>This release complies with option 1 in <a href="architecture.html#annex-d-4" class="extRef">Annex D.4</a> in [[.OIPF_ARCH2]].</p>
</section>
<section id="s6-1-3-2-2"><h5>Procedure for User Registration and Authentication in a network relying on IMS on UNIS 8</h5>
<p>The following SHALL be supported by the IG on the UNIS-8 interface for user registration:</p><ul>
<li>Upon receipt of a registration request from the OITF, the IG SHALL maintain a binding between the sip instance feature tags and other feature tags declared in the registration request against the registered user, and the OITF device.
<p>Furthermore if the incoming registration request from the OITF includes a request for a GRUU, the IG SHALL allocate a new user name to the username (IMPU) portion of the URI (username@host) in the contact header information (see Annex N why the IG needs to do that). The new username will replace the existing username (IMPU) in the URI contact header information before the IG registers the user with the network.</p>
<p>The IG SHALL maintain a binding between the IMPU included by the OITF in the incoming HNI-IGI request, the new username created by the IG, and the actual OITF device (extracted from the sip instance feature tag) from which the request came.</p>
<li>The IG SHALL support the 3GPP IMS registration procedure as per TS 124 503 [[!TS124503]]. This includes handling of user authentication and authorization. This procedure SHALL be invoked when the IG powers up (in this case the default identity SHALL be registered) or upon receipt of an HTTP POST from the OITF with the REGISTER method.
<li>The IG SHALL report to the OITF the final outcome of any OITF-initiated registration or de-registration.
<li>The IG SHALL be stateful for all successful registrations until de-registration occurs.
<li>For IG-initiated registration procedures, the IG is responsible for refreshing the registration before the registration expiry time.
</ul>
<p>The following SHALL be supported by the IG on the UNIS-8 interface for user de-registration:</p><ul>
<li>The IG SHALL support the 3GPP IMS de-registration procedure as per TS 124 503 [[!TS124503]]. This procedure SHALL be invoked upon receipt of an HTTP POST from the OITF with the REGISTER method and when the IG shuts down. Following the successful de-registration process, the IG SHALL remove all bindings related to the de-registered IMPU.
</ul>
<p>The following SHALL be supported in the IG on UNIS-8 for subscription to the Registration event:</p><ul>
<li>For OITF-initiated registrations, the IG SHALL support subscription to the registration-state event package as per TS 124 503 [[!TS124503]].
<li>For IG-initiated registrations, and following a successful registration process, the IG SHALL SUBSCRIBE to the registration event package in accordance with TS 124 503 [[!TS124503]].
<li>The IG SHALL always validate the XML schema associated with the registration event package for both OITF and IG initiated registrations.
<li>On request from the OITF, as well as for IG-initiated registrations, the IG SHALL refresh the registration-state event package subscription in accordance with TS 124 503 [[!TS124503]].
<li>For OITF-initiated registrations, the IG SHALL NOT store any registration event related data, but SHALL be stateful of the subscription. For IG-initiated registrations, the IG SHALL store registration event related data.
<li>For OITF-initiated registrations, the IG SHALL support terminating a subscription to the registration-state event package as per TS 124 503 [[!TS124503]].
<li>For IG-initiated deregistration, and following the successful deregistration process, the IG SHALL terminate the subscription to the registration event package, as per TS 124 503 [[!TS124503]].
</ul>
<p>The appropriate procedure (SIP Digest or IMS AKA) SHALL be followed by the IG for user registration and authentication.</p>

</section>
</section>
<section id="s6-1-3-3"><h4>Notification of Service Profile changes</h4>
<section id="s6-1-3-3-1"><h5>Protocol over UNIS-8</h5>
<section id="s6-1-3-3-1-1"><h6>Subscription to Notifications of Service Profile changes</h6>
<p>If subscription to notification of changes is requested by the OITF, the IG SHALL send a SUBSCRIBE request to the IPTV Service Profile FE in accordance with RFC 5875 [[!XCAP-EVT]] and RFC 5874 [[!XCAP-DFF]].</p>
<p>The IG will process the request from the OITF and will generate a SUBSCRIBE request, that SHALL be as specified in [[!TS183063]] section 5.1.5.1.</p>
<p>A well-known PSI mechanism SHALL be used in the request URI of the SUBSCRIBE request.</p>
<p>Note: For changes that apply to a very large number of subscribers, it is up to Service Provider to set up proper rules in the ‘notifier function’ to make the notification procedure scalable.</p>
</section>
<section id="s6-1-3-3-1-2"><h6>Processing of notifications</h6>
<p>Refer to [[!TS183063]] section 5.1.5.2</p>
</section>
</section>
</section>
</section>
<section id="s6-1-4"><h3>Protocols for Communication Services using SIP</h3>
<section id="s6-1-4-1"><h4>CallerID</h4>
<section id="s6-1-4-1-1"><h5>Procedures for Caller ID on UNIS-8</h5>
<section id="s6-1-4-1-1-1"><h6>Instant Message based Caller ID</h6>
<p>Instant Message based Caller ID is identical to Instant Messaging where the incoming message includes the caller id. For further details reference SHOULD be made to section <a href="#s6-1-4-2-1" class="sectionRef">6.1.4.2.1</a>, “<a href="#s6-1-4-2-1" class="sectionTitleRef"></a>.”</p>
</section>
<section id="s6-1-4-1-1-2"><h6>IMS telephony service based caller identification</h6>
<p>IMS telephony service based caller identification is based on the reception of the regular SIP session INVITE request. The incoming session request message includes the caller identification.</p>
<p>Support of this feature by the IG is OPTIONAL.</p>
</section>
</section>

</section>
<section id="s6-1-4-2"><h4>Instant Messaging</h4>
<section id="s6-1-4-2-1"><h5>Procedure for Instant Messaging on UNIS-8</h5>
<p>Instant Messaging complies with the page mode of operation. The following SHALL be supported by the IG:</p><ul>
<li>Incoming SIP MESSAGE messages to the IG MUST conform to OMA Instant Messaging using SIMPLE Draft OMA-TS-SIMPLE_IM-V1_0-20080820-D [[!SMPL-IM]] to be acceptable for processing by the IG. Non-conformant SIP MESSAGE messages SHALL be rejected in accordance with [[!SMPL-IM]] with the appropriate response code.
<li>For an incoming SIP MESSAGE to the IG that is conformant to [[!SMPL-IM]], the IG SHALL forward the message to the OITF using HNI-IGI Notification procedure and SHALL send a 202 Accepted to the originating end.
<li>An outgoing SIP MESSAGE SHALL conform to [[!SMPL-IM]].  The response to the SIP MESSAGE SHALL comply with [[!SMPL-IM]].
<li>The IG SHALL NOT retain any state information once the transaction is completed.
</ul>
</section>
</section>
<section id="s6-1-4-3"><h4>Presence</h4>
<section id="s6-1-4-3-1"><h5>Procedure for Presence on UNIS-8</h5>
<p>The following SHALL be supported by the IG for subscription to Presence:</p><ul>
<li>An outgoing SUBSCRIBE message for a subscription to the Presence event, or cancellation of an existing subscription SHALL comply with [[!SMPL-PRES]].
<li>An incoming NOTIFY messages that does not comply with [[!SMPL-PRES]] SHALL be rejected with the appropriate error code in accordance with [[!SMPL-PRES]], and no further processing SHALL be performed.
<li>On request from the OITF, the IG SHALL refresh the Presence subscription in accordance with [[!SMPL-PRES]].
<li>The IG SHALL NOT store any presence related data, but SHALL be stateful to the subscription.
<li>The IG SHALL consider a subscription terminated if it is not renewed by the OITF.
</ul>
</section>
<section id="s6-1-4-3-2"><h5>Procedure for Publishing Presence Information on UNIS-8</h5>
<p>When requested by the OITF, the IG SHALL support the SIP PUBLISH request and response in accordance with [[!SMPL-PRES]] for publishing presence information.</p>
</section>
</section>
<section id="s6-1-4-4"><h4>Chatting</h4>
<section id="s6-1-4-4-1"><h5>IM Session using MSRP over UNIS–8</h5>
<p>The IG SHALL conform to the Client Procedure as described in OMA-TS-SIMPLE_IM-V1_0-20080820-D [[!SMPL-IM]].</p>
<p>The IG SHALL perform path mapping between Chatting peers as indicated in section <a href="#s5-5-3" class="sectionRef">5.5.3</a>, “<a href="#s5-5-3" class="sectionTitleRef"></a>.”</p>
<p>The IG SHALL handle translation of Chat session initiation and teardown procedures when requested by the OITF as per section <a href="#s5-4-5" class="sectionRef">5.4.5</a>, “<a href="#s5-4-5" class="sectionTitleRef"></a>.”</p>
<p>The IG SHALL handle translation of outgoing and incoming MSRP chat message as per section <a href="#s5-5-3" class="sectionRef">5.5.3</a>, “<a href="#s5-5-3" class="sectionTitleRef"></a>.”</p>
</section>
<section id="s6-1-4-4-2"><h5>IM Session using MSRP over NPI–3</h5>
<p>The P2P Chatting communication enablers FE SHALL confirm to the IM Server procedures described in OMA TS SIMPLE_IM-V1_0-20080820-D [[!SMPL-IM]].</p>
</section>
</section>
<section id="s6-1-4-5"><h4>Content Sharing</h4>
<section id="s6-1-4-5-1"><h5>Procedures for Content Sharing on UNIS–8</h5>
<p>Incoming SIP OPTIONS be acceptable for processing by the IG. Non-conformant SIP OPTIONS SHALL be rejected in with the appropriate response code.</p>
<p>When requested by the OITF, the IG SHALL support the SIP OPTIONS request and response in accordance with [[!SIP]] for Capability querying.</p>
<p>Incoming SIP INVITE be acceptable for processing by the IG. Non-conformant SIP INVITE SHALL be rejected in with the appropriate response code.</p>
<p>Content Sharing is based on the reception of the regular SIP session INVITE request. The incoming session request message includes the SDP body.</p>
<p>Incoming SIP REFER be acceptable for processing by the IG. Non-conformant SIP REFER SHALL be rejected in with the appropriate response code.</p>
<p>Incoming SIP UPDATE be acceptable for processing by the IG. Non-conformant SIP UPDATE SHALL be rejected in with the appropriate response code.</p>
</section>
</section>
</section>
</section>
<section id="s6-2"><h2>SIP/SDP Reference Points within the Residential Network</h2>
<section id="s6-2-1"><h3>IG as a B2BUA</h3>
<p>The IG acts as a transparent B2BUA. The following defines the behaviour of the B2BUA of the IG:</p><ul>
<li>The IG SHALL handle all IMS specific SIP headers; storing what is received from the network for re-insertion during outgoing requests (e.g. P-Preferred-Identity) according to [[!TS124503]], and stripping those headers, before a request/response is sent to the OITF.
<li>The IG, being service aware, SHALL support the algorithm defined in Annex P for all OITF-initiated sessions. The IG SHALL insert the appropriate SIP headers matching the requested service from the OITF conforming to the appropriate service specification in that regard. For undefined services any additional information, if required, SHALL be configured in the IG.<p>
The IG SHALL be service aware as well for all incoming sessions from the network. Services supported by the IG SHALL be identical to the ones supported for OITF-initiated sessions</p>
<li>The IG SHALL behave transparently to all SIP headers defined in [[!SIP]], that are received from the network, and SHALL NOT alter them before being sent to the OITF. The same applies to SIP headers sent from the OIT to the network. The only exception being Call-ID, and where the IG SHALL insert its own, and SHALL bind it to the Call-ID of the OITF for the duration of the session.
<li>The IG SHALL validate SIP requests/responses before accepting them. The various services specify the validation to perform by the IG.
<li>The IG SHALL only validate compliance to XML schemas associated with event packages. 
<li>The IG SHALL validate SDP syntax for correctness. 
<li>In regard IMS registration, the IG SHALL perform the IMS registration when requested by the OITF. The IG is therefore stateful to IMS registration. However, graceful de-registration and re-registration SHALL be triggered by the OITF.  The IG SHALL deal with all non-graceful circumstances
<li>The specific sections on IMS registration specify detailed behaviour for the OITF and IG. 
<li>The IG SHALL be stateful, to all IMS sessions.  Session initiation, termination, and session refresh can be triggered by the OITF or the network, depending on the specific service. The IG SHALL deal with non-graceful circumstances.
</ul>
</section>

<section id="s6-2-2"><h3>Protocols for IPTV Service Functions</h3>
<section id="s6-2-2-1"><h4>Multicast content streaming with SIP session management</h4>
<p>The IG SHALL support the procedures specified in [[!TS124503]] for originating sessions.</p>
<section id="s6-2-2-1-1"><h5>Session Initiation</h5>
<p>To initiate a multicast content streaming session, the OITF SHALL initiate a SIP INVITE to the IG that includes all the SIP headers in Table <a href="#t5" class="tableRef">5</a> and any other mandatory headers as per [[!SIP]] (e.g. Via, Max-Forwards). The OITF SHALL also include an SDP offer conformant to step 1 in section <a href="#s5-3-1-1-1" class="sectionRef">5.3.1.1.1</a>, “<a href="#s5-3-1-1-1" class="sectionTitleRef"></a>”.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP INVITE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t5" class="tableRef">5</a>. Following a successful validation, the IG SHALL generate an initial SIP INVITE request as specified in [[!TS124503]] for originating sessions.</p>
<p>The IG SHALL forward any received SIP response to the OITF including the information in the SDP. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t6" class="tableRef">6</a> and all mandatory headers as per [[!SIP]].</p>
<p>When the OITF receives the response to the SIP INVITE, it SHALL examine the media parameters in the received SDP. The OITF SHALL restrict the multicast content services that it joins according to the parameter (the a=bc_service_package attribute). received from the IPTV Control FE. However, if the OITF retrieved the IPTV user profile prior to session initiation, then it MAY ignore the=bc_service_package attribute.</p>
<p>If the OITF receives an error code with an Insufficient Bandwidth indication in the response from the IG, the OITF MAY perform a new SIP INVITE with a reduced maximum bandwidth for the multicast content service. This procedure MAY be repeated. If no agreement can be reached, the OITF MAY display a failure message to the user.</p>
<p>Finally to complete the SIP INVITE transaction, the OITF SHALL send a SIP ACK to the IG. The SIP ACK SHALL include the SIP headers defined in Table <a href="#t7" class="tableRef">7</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-1-2"><h5>Session Modification</h5>
<p>To join a service outside the set of channels negotiated at session initiation, or to perform a bandwidth modification, the OITF SHALL generate a SIP re-INVITE request that includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t5" class="tableRef">5</a>.</p>
<p>The OITF SHALL include an SDP offer in the session modification request. The format of this request SHALL be the same as for a session initiation.</p>
<p>The IG SHALL handle session modification similar to session initiation.</p>
</section>
<section id="s6-2-2-1-3"><h5>Session Termination</h5>
<p>To terminate a session, the OITF SHALL send a SIP BYE request to the IG that includes all headers listed in Table <a href="#t8" class="tableRef">8</a> and any other mandatory headers as per [[!SIP]].</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP BYE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t8" class="tableRef">8</a>. Following a successful validation, the IG SHALL generate a SIP BYE as specified in [[!TS124503]] for originating sessions. The IG SHALL forward the received response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t9" class="tableRef">9</a> and all mandatory headers as per [[!SIP]].</p>
<p>Alternatively, on receipt of a SIP BYE request from the IPTV Control FE, the IG, after validating the request, SHALL forward the request to the OITF. The OITF SHALL respond with a SIP 200 OK response, which the IG forwards to the IPTV Control FE.</p>
</section>
<section id="s6-2-2-1-4"><h5>Session Refresh</h5>
<p>It is the responsibility of the OITF to refresh the multicast content streaming session, as per [[!SES-TIMR]] before the session expires. The IG SHALL consider a session terminated if it is not refreshed.</p>
</section>
<section id="s6-2-2-1-5"><h5>Content Reporting by an OIPF</h5>
<p>To report watched content, the OITF SHALL send a SIP INFO request to the IG based one the SIP INFO framework, The SIP INFO request SHALL include all headers listed in Table <a href="#t10" class="tableRef">10</a> and all mandatory headers as per [[!SIP]].</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP INFO includes all mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t10" class="tableRef">10</a>. Following a successful validation, the IG SHALL generate a SIP INFO as specified in [[!TS124503]] for originating sessions. The IG SHALL forward the received response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t11" class="tableRef">11</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-1-6"><h5>Management of Content Reporting</h5>
<p>At any time, the IG can receive a SIP UPDATE to order the OITF to stop or start the reporting of watched multicast content.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP UPDATE includes all mandatory headers as per [[!SIP]] headers listed in Table <a href="#t12" class="tableRef">12</a>. Following a successful validation, the IG SHALL forward the SIP UPDATE to the OITF. The IG SHALL forward the received response to the network. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t13" class="tableRef">13</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-1-7"><h5>User-Initiated Activation of Network-Based multicast content streaming Time Shift</h5>
<p>To activate time shift for a watched multicast content service, the OITF SHALL initiate a SIP re-INVITE to the IG that includes all the SIP headers in Table <a href="#t5" class="tableRef">5</a> and any other mandatory headers as per [[!SIP]] (e.g. Via, Max-Forwards). The OITF SHALL also include an SDP offer conformant to step 1 in section <a href="#s5-3-1-1-7-1" class="sectionRef">5.3.1.1.7.1</a>, “<a href="#s5-3-1-1-7-1" class="sectionTitleRef"></a>”.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP INVITE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t5" class="tableRef">5</a>. Following a successful validation, the IG SHALL generate an initial SIP INVITE request as specified in [[!TS124503]] for originating sessions.</p>
<p>The IG SHALL forward any received SIP response to the OITF including the information in the SDP. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t6" class="tableRef">6</a> and all mandatory headers as per [[!SIP]].</p>
<p>When the OITF receives the response to the SIP re-INVITE, it SHALL examine the media parameters in the received SDP. The OITF SHALL conform to step 3 in section <a href="#s5-3-1-1-7-1" class="sectionRef">5.3.1.1.7.1</a>, “<a href="#s5-3-1-1-7-1" class="sectionTitleRef"></a>.” The OITF SHALL store the parameters a:fmtp:iptv rtsp h-session, a:fmtp:iptv rtsp h-offset, and a:fmtp:iptv rtsp h-uri  for later usage.</p>
<p>Finally to complete the SIP INVITE transaction, the OITF SHALL send a SIP ACK to the IG. The SIP ACK SHALL include the SIP headers defined in Table <a href="#t7" class="tableRef">7</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-1-8"><h5>User-Initiated De-activation of Network-Based multicast content streaming Time Shift</h5>
<p>To de-activate a time shift for a watched multicast content service, the OITF SHALL initiate a SIP re-INVITE to the IG that includes all the SIP headers in Table <a href="#t5" class="tableRef">5</a> and any other mandatory headers as per [[!SIP]] (e.g. Via, Max-Forwards). The OITF SHALL also include an SDP offer conformant to step 1 in section <a href="#s5-3-1-1-7-2" class="sectionRef">5.3.1.1.7.2</a>, “<a href="#s5-3-1-1-7-2" class="sectionTitleRef"></a>”.
The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP INVITE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t5" class="tableRef">5</a>. Following a successful validation, the IG SHALL generate an initial SIP INVITE request as specified in [[!TS124503]] for originating sessions.
The IG SHALL forward any received SIP response to the OITF including the information in the SDP. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t6" class="tableRef">6</a> and all mandatory headers as per [[!SIP]].
Finally to complete the SIP INVITE transaction, the OITF SHALL send a SIP ACK to the IG. The SIP ACK SHALL include the SIP headers defined in Table <a href="#t7" class="tableRef">7</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-1-9"><h5>Retrieval of bandwidth parameter for FCC and/or RET enabled multicast content service</h5>
<p>If the OITF intends to use FCC and/or RET,  when the multicast content service is FCC and/or RET enabled,  the OITF SHALL use the  procedure defined in section <a href="#s5-3-2-1-1" class="sectionRef">5.3.2.1.1</a> “<a href="#s5-3-2-1-1" class="sectionTitleRef"></a>” with the following modifications:</p><ul>
<li>The Request-URI in the method line is set to well-known PSI for the multicast content service 
<li>The OITF SHALL include an HTTP body that SHALL include an SDP that includes one m line that matches the m line associated with the multicast content service the OITF intends to join first (see section <a href="#s5-3-1-1-1" class="sectionRef">5.3.1.1.1</a>, “<a href="#s5-3-1-1-1" class="sectionTitleRef"></a>”) with the following exceptions:<ul>
<li>No b-line is included.
<li>The following additional a attribute SHALL be included when the OITF intends to use RET:<ul>
<li>a=rtcp-fb:&lt;fmt&gt;  nack<br />where &lt;fmt&gt; indicates the RTP payload type of the IP multicast stream that carries the content service.</ul>
<li>The following additional a attribute SHALL be included when the OITF intends to use FCC:<ul>
<li>a=rtcp-fb:&lt;fmt&gt;  nack rai<br />where &lt;fmt&gt; indicates the RTP payload type of the IP multicast stream that carries the content service.</ul>
</ul></ul>
<p>The returned response SHALL include total bandwidth of the multicast content service with the highest bandwidth and the overhead bandwidth required for FCC and/or RET. </p>
</section>
</section>

<section id="s6-2-2-2"><h4>Unicast content streaming with SIP session management</h4>
<section id="s6-2-2-2-1"><h5>Retrieving missing parameters in the SDP prior to session setup using SIP OPTIONS</h5>
<p>If the OITF does not have all the necessary parameters, namely the FEC information including bandwidth for FEC streams and the transport protocol, to form the SDP for a unicast content streaming session, the OITF SHALL retrieve missing SDP parameters using the following procedure:</p>
<p>The OITF SHALL initiate a SIP OPTIONS request to the IG that includes all the SIP headers in Table <a href="#t14" class="tableRef">14</a> and any other mandatory headers as per [[!SIP]].</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP OPTIONS includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t14" class="tableRef">14</a>. Following a successful validation, the IG SHALL generate an initial SIP OPTIONS request as specified in [[!TS124503]] for originating UA.</p>
<p>The IG SHALL forward any received SIP response to the OITF including the information in the SDP. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t15" class="tableRef">15</a> and all mandatory headers as per [[!SIP]]. The SDP included in the SIP 200 OK response SHALL include the missing parameters according to section <a href="#s6-1-2-2-1-2" class="sectionRef">6.1.2.2.1.2</a>, “<a href="#s6-1-2-2-1-2" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s6-2-2-2-2"><h5>Session Initiation</h5>
<p>To initiate a unicast content streaming session, the OITF SHALL initiate a SIP INVITE to the IG that includes all the SIP headers in Table <a href="#t16" class="tableRef">16</a> and any other mandatory headers as per [[!SIP]] (e.g. Via, Max-Forwards). The OITF SHALL also include an SDP offer conformant to step 1 in section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP INVITE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t16" class="tableRef">16</a>. Following a successful validation, the IG SHALL generate an initial SIP INVITE request as specified in [[!TS124503]] for originating sessions.</p>
<p>The IG SHALL forward any received SIP response to the OITF including the information in the SDP. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t17" class="tableRef">17</a> and all mandatory headers as per [[!SIP]]. For a description of the received SDP answer, refer to section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”.</p>
<p>When parsing the b=RR:&lt;bandwidth-value&gt; line in the received SDP answer: if the bandwidth value agreed is non-zero, then the OITF SHALL send RTCP RRs and SHALL NOT send RTSP keep-alive messages. If the bandwidth value received is zero, then the OITF SHALL NOT send RTCP RRs but instead it SHALL send RTSP keep-alive messages.</p>
<p>If the OITF receives an error code with an Insufficient Bandwidth indication in the response from the IG, the OITF MAY perform a new SIP INVITE with a reduced maximum bandwidth for the content. This procedure MAY be repeated. If no agreement can be reached, the OITF MAY display a failure message to the user.</p>
<p>Finally to complete the SIP INVITE transaction, the OITF SHALL send a SIP ACK to the IG. The SIP ACK SHALL include the SIP headers defined in Table <a href="#t18" class="tableRef">18</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-2-3"><h5>Session Termination</h5>
<p>To terminate a session, the OITF SHALL send a SIP BYE request to the IG that includes all headers listed in Table <a href="#t19" class="tableRef">19</a> and any other mandatory headers as per [[!SIP]].</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP BYE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t19" class="tableRef">19</a>. Following a successful validation, the IG SHALL generate a SIP BYE as specified in [[!TS124503]] for originating sessions. The IG SHALL forward the received response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t20" class="tableRef">20</a> and all mandatory headers as per [[!SIP]].</p>
<p>Alternatively, on receipt of a SIP BYE request from the IPTV Control FE, the IG, after validating the request, SHALL forward the request to the OITF. The OITF SHALL respond with a SIP 200 OK response, which the IG forwards to the IPTV Control FE.</p>
</section>
<section id="s6-2-2-2-4"><h5>Refresh</h5>
<p>It is the responsibility of the OITF to refresh the unicast content streaming session, as per [[!SES-TIMR]] before the session expires. The IG SHALL consider a session terminated if it is not refreshed.</p>
</section>
</section>
<section id="s6-2-2-3"><h4>Pay Per View multicast content service with SIP session management</h4>
<section id="s6-2-2-3-1"><h5>PPV service initiation without existing multicast content streaming session</h5>
The OITF SHALL follow the same procedure for multicast content service in section <a href="#s6-2-2-1-1" class="sectionRef">6.2.2.1.1</a>, “<a href="#s6-2-2-1-1" class="sectionTitleRef"></a>” to initiate a PPV session. The SDP SHALL conform to sections <a href="#s6-2-2-1-1" class="sectionRef">6.2.2.1.1</a>, “<a href="#s6-2-2-1-1" class="sectionTitleRef"></a>” and <a href="#s5-3-6-1-1" class="sectionRef">5.3.6.1.1</a>, “<a href="#s5-3-6-1-1" class="sectionTitleRef"></a>”.
</section>
<section id="s6-2-2-3-2"><h5>Switching from a PPV service to a multicast content service</h5>
<p>To join a multicact content service outside the set of negotiated channels for the ongoing scheduled session, the OITF SHALL request session modification as per section <a href="#s6-2-2-1-2" class="sectionRef">6.2.2.1.2</a>, “<a href="#s6-2-2-1-2" class="sectionTitleRef"></a>.”</p>
<p>If the channel the OITF intends to joins is already negotiated, the OITF SHALL follow the normal procedures for leaving and joining multicast channels.</p>
</section>
<section id="s6-2-2-3-3"><h5>Switching to a PPV service from a multicact content service or another PPV</h5>
<p>If the PPV service the OITF intends to join is outside the set of channels negotiated within the ongoing scheduled session, the OITF SHALL request session modification as per section <a href="#s6-2-2-1-2" class="sectionRef">6.2.2.1.2</a>, “<a href="#s6-2-2-1-2" class="sectionTitleRef"></a>.”</p>
<p>If the channel the OITF intends to joins is already negotiated, the OITF SHALL follow the normal procedures for leaving and joining multicast channels.</p>
</section>
<section id="s6-2-2-3-4"><h5>Session Termination</h5>
Session termination is identical to session termination of a multicast content service as depicted in section <a href="#s6-1-2-1-1-2" class="sectionRef">6.1.2.1.1.3</a>, “<a href="#s6-1-2-1-1-2" class="sectionTitleRef"></a>.”
</section>
</section>
<section id="s6-2-2-4"><h4>Parental Control for Scheduled Content using SIP</h4>
<section id="s6-2-2-4-1"><h5>What is on TV – OITF initiated</h5>
<section id="s6-2-2-4-1-1"><h6>Procedure for Subscription to Parental Control Watched Content Event Package (OITF Initiated)</h6>
<p>To subscribe to the event package related to parental control watched content for a registered IMPU, the OITF with the appropriate parental control authority over the user SHALL issue a SIP SUBSCRIBE request to the IG that includes the SIP headers as per Table <a href="#t27" class="tableRef">27</a>. In addition, the OITF SHALL include all mandatory SIP headers as per [[!SIP]] and that are missing from the table (e.g. Via, Max-Forwards).</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP SUBSCRIBE request includes all mandatory SIP headers as per [[!SIP]] and the headers listed in Table <a href="#t27" class="tableRef">27</a>. Following successful validation, the IG SHALL support the 3GPP IMS subscription to the event package as per [[!TS124503]]. This includes inserting any additional mandatory SIP headers as REQUIRED by [[!TS124503]].</p>
<p>The IG SHALL return to the OITF the response received from the network.</p>
<p>The IG SHALL ensure that the OITF is synchronized with the timer for refreshing the subscription as desired by the network.</p>
<p>When a SIP NOTIFY is received by the IG, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the body of the incoming SIP NOTIFY is compliant to XML schema associated with the event package before sending it to the OITF. The incoming NOTIFY SHALL include the SIP headers depicted in Table <a href="#t29" class="tableRef">29</a> and any other mandatory SIP headers as per [[!SIP]].</p>
<p>The OITF SHALL validate that the body of SIP NOTIFY is compliant to the XML schema associated with the parental control watched content event package. Following a successful validation, the OITF SHALL send a SIP 200 OK response to the IG. The SIP 200 OK response SHALL include the SIP headers depicted in Table <a href="#t30" class="tableRef">30</a> and any other mandatory SIP headers as per [[!SIP]].</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL first validate the SIP 200 OK response (or any other received response) before sending it to the network.</p>
<p>For all subsequent SIP NOTIFY requests received using the same SIP dialog, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL perform the same processing. The IG SHALL consider a subscription terminated if it is not renewed by the OITF.</p>
</section>
<section id="s6-2-2-4-1-2"><h6>Procedure for Refreshing an existing Subscription to Parental Control Watched Content Event Package (OITF Initiated)</h6>
The procedure for refreshing a subscription is the same as the procedure for initiating a subscription.
</section>
</section>
<section id="s6-2-2-4-2"><h5>Parental Control</h5>
<section id="s6-2-2-4-2-1"><h6>Parental Control Blocking Request – OITF Initiated</h6>
<p>An OITF with proper parental control authority that desires to block a watched content for an IPTV end user under its authority SHALL initiate an instant message for that purpose by sending to the IG a SIP MESSAGE that includes all the SIP headers in Table <a href="#t31" class="tableRef">31</a> and any other mandatory SIP headers as per [[!SIP]]. The content of the SIP MESSAGE SHALL include the body associated with “urn:oipf:application:iptv-parental-control”.</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP MESSAGE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t31" class="tableRef">31</a>. Following a successful validation, the IG SHALL generate a SIP MESSAGE request to the network conformant to [[!SIP-IM]] and [[!TS124503]].</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward any received SIP response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t32" class="tableRef">32</a> and any other mandatory SIP headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-4-2-2"><h6>IPTV End-user OITF Reception of a Blocking Request related to Parental Control</h6>
<p>When the IG receives any SIP MESSAGE related to parental control, as indicated by the content type (being set to “urn:oipf:application:iptv-parental-control”) and destined for a user, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the incoming SIP MESSAGE is conformant to [[!SIP-IM]] and [[!TS124503]] and includes all the mandatory headers as per [[!SIP]], [[!TS124503]] and all the headers listed in Table <a href="#t33" class="tableRef">33</a>. Following the successful validation, the IG SHALL forward the SIP MESSAGE to the appropriate OITF.</p>
<p>The OITF SHALL act on the incoming SIP MESSAGE in accordance with section <a href="#s5-3-7-2-2" class="sectionRef">5.3.7.2.2</a>, “<a href="#s5-3-7-2-2" class="sectionTiteRef"></a>” before it sends a response back to the IG.</p>
<p>When the SIP response is received from the OITF, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward it to the network. The response SHALL include the SIP headers as per [[!SIP]] and SHALL be validated by the IG before being sent to the network.</p>
</section>
</section>
</section>
<section id="s6-2-2-5"><h4>Network-based User Notification Services using SIP</h4>
<section id="s6-2-2-5-1"><h5>Notification Request Setup</h5>
<p>To initiate a notification request, the OITF SHALL initiate a SIP MESSAGE to the IG that includes all the SIP headers in Table <a href="#t34" class="tableRef">34</a> and any other mandatory SIP headers as per [[!SIP]] (e.g. Via, Max-Forwards). The body of the SIP MESSAGE SHALL include the MIME type defined in section <a href="#s5-3-8-6" class="sectionRef">5.3.8.6</a>, “<a href="#s5-3-8-6" class="sectionTitleRef"></a>”.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP MESSAGE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t34" class="tableRef">34</a>. Following a successful validation, the IG SHALL generate a SIP MESSAGE request as specified in [[!TS124503]] for originating UA.</p>
<p>The IG SHALL forward any received SIP response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t35" class="tableRef">35</a> and any other mandatory SIP headers as per [[!SIP]].</p>
</section>
</section>
<section id="s6-2-2-6"><h4>Content Bookmarking using SIP</h4>
<section id="s6-2-2-6-1"><h5>Storing Content Bookmarks</h5>
<p>If the OITF decides to store a content bookmark for watched content during a multicast of unicast content streaming session, and if permitted by the network to do so, the OITF SHALL initiate a SIP INFO request to the IG based on the SIP INFO framework. The SIP INFO request SHALL include all the SIP headers in Table <a href="#t38" class="tableRef">38</a> and any other mandatory SIP headers as per [[!SIP]] (e.g. Via, Max-Forwards). The body of the SIP INFO message SHALL include the MIME type defined in section <a href="#s5-3-9-5" class="sectionRef">5.3.9.5</a>, “<a href="#s5-3-9-5" class="sectionTitleRef"></a>”.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP INFO includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t38" class="tableRef">38</a>. Following a successful validation, the IG SHALL generate a SIP INFO request as specified in [[!TS124503]] for originating UA.</p>
<p>The IG SHALL forward any received SIP response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t39" class="tableRef">39</a> and any other mandatory SIP headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-6-2"><h5>Network Management of Bookmark Storage Requests</h5>
<p>At any time, the IG can receive a SIP UPDATE request from the network to remove or re-instate support for the reception of the CoD-Bookmark Info Package, according to section 12 of [[!PSS-MBMS]] from an OITF.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP UPDATE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t40" class="tableRef">40</a>. Following a successful validation, the IG SHALL forward the SIP UPDATE request to the OITF. The IG SHALL forward the received response to the network. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t41" class="tableRef">41</a> and any other mandatory SIP headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-6-3"><h5>Content-related bookmark retrieval</h5>
<p>The OITF SHALL follow the procedure defined in section <a href="#s6-2-2-2-2" class="sectionRef">6.2.2.2.2</a>, “<a href="#s6-2-2-2-2" class="sectionTitleRef"></a>” for establishing a unicact streaming session. Following that, the IG SHALL receive a SIP INFO request from the network, based on the SIP INFO framework, and that includes the bookmarks list related to the requested content. The body of the SIP INFO request SHALL include the XML schema depicted in section <a href="#s5-3-9-5" class="sectionRef">5.3.9.5</a>, “<a href="#s5-3-9-5" class="sectionTitleRef"></a>” and related to the CoD-Bookmark Info Package.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP INFO request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t36" class="tableRef">36</a>. Following a successful validation, the IG SHALL forward the SIP INFO request to the OITF. The IG SHALL forward the received response to the network.</p>
</section>
</section>
<section id="s6-2-2-7"><h4>Local PVR Service using SIP</h4>
<section id="s6-2-2-7-1"><h5>OIPF Initiated PVR Service Capture Request</h5>
<p>To initiate a local PVR capture request, the OITF SHALL initiate a SIP MESSAGE to the IG that includes all the SIP headers in Table <a href="#t42" class="tableRef">42</a> and any other mandatory SIP headers as per [[!SIP]] (e.g. Via, Max-Forwards). The body of the SIP MESSAGE SHALL include the MIME type defined in section <a href="#s5-3-10-2" class="sectionRef">5.3.10.2</a>, “<a href="#s5-3-10-2" class="sectionTitleRef"></a>”.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP MESSAGE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t42" class="tableRef">42</a>. Following a successful validation, the IG SHALL generate a SIP MESSAGE request as specified in [[!TS124503]] for originating UA.</p>
<p>The IG SHALL forward any received SIP response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t43" class="tableRef">43</a> and any other mandatory SIP headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-7-2"><h5>PVR Service Capture Validation</h5>
<p>At any time, the IG can receive a SIP MESSAGE request from the network related to an outstanding local PVR request.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP MESSAGE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t44" class="tableRef">44</a>. The body of the SIP MESSAGE request SHALL include the XML schema defined in section <a href="#s5-3-10-2" class="sectionRef">5.3.10.2</a>, “<a href="#s5-3-10-2" class="sectionTitleRef"></a>”. Following a successful validation, the IG SHALL forward the SIP INFO request to the OITF. The IG SHALL forward the received response to the network.</p>
</section>
</section>
<section id="s6-2-2-8"><h4>Network PVR (nPVR) using SIP</h4>
<section id="s6-2-2-8-1"><h5>OIPF Initiated PVR Service Capture Request</h5>
<p>To initiate a network PVR capture request, the OITF SHALL initiate a SIP MESSAGE to the IG that includes all the SIP headers in Table <a href="#t42" class="tableRef">42</a> and any other mandatory SIP headers as per [[!SIP]] (e.g. Via, Max-Forwards). The body of the SIP MESSAGE SHALL include the MIME type defined in section <a href="#s5-3-10-2" class="sectionRef">5.3.10.2</a>, “<a href="#s5-3-10-2" class="sectionTitleRef"></a>” with the qualifications listed in section <a href="#s5-3-11-1" class="sectionRef">5.3.11.1</a>, “<a href="#s5-3-11-1" class="sectionTitleRef"></a>”.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP MESSAGE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t42" class="tableRef">42</a>. Following a successful validation, the IG SHALL generate a SIP MESSAGE request as specified in [[!TS124503]] for originating UA.</p>
<p>The IG SHALL forward any received SIP response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t43" class="tableRef">43</a> and any other mandatory SIP headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-8-2"><h5>PVR Service Capture Outcome</h5>
<p>At any time, the IG can receive a SIP MESSAGE request from the network reporting the outcome of a network PVR.
The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP MESSAGE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t44" class="tableRef">44</a>. The body of the SIP MESSAGE request SHALL include the XML schema defined in section <a href="#s5-3-11-2" class="sectionRef">5.3.11.2</a>, “<a href="#s5-3-11-2" class="sectionTitleRef"></a>”. Following a successful validation, the IG SHALL forward the SIP MESSAGE request to the OITF. The IG SHALL forward the received response to the network.</p>
</section>
</section>
<section id="s6-2-2-9"><h4>Session Transfer using SIP</h4>
<section id="s6-2-2-9-1"><h5>Generic Procedures</h5>
<section id="s6-2-2-9-1-1"><h6>Transferee Session Initiation Procedures Related to a Transferred Session</h6>
<p>To initiate a session related to a transferred session, the transferee OITF SHALL initiate a SIP INVITE to the IG that includes all the headers as per Table <a href="#t16" class="tableRef">16</a> and other mandatory headers as per [[!SIP]] with the following additions:</p><ul>
<li>An additional SIP header - Replace header is included in the SIP INVITE request and is set to the appropriate information depending on the deployed mode. For the push mode, the information is retrieved from the incoming REFER request to the transferee as per step 4 in section <a href="#s5-3-13-1-2-3" class="sectionRef">5.3.13.1.2.3</a>, “<a href="#s5-3-13-1-2-3" class="sectionTitleRef"></a>”.
<li>In the Request Line, the wild card part (*) representing the content instance identifier to be transferred is constructed differently than specified in the table. In the push mode, this field is extracted from the To header field embedded in the Refer-To header in the incoming REFER request as per step 4 in section <a href="#s5-3-13-1-2-3" class="sectionRef">5.3.13.1.2.3</a>, “<a href="#s5-3-13-1-2-3" class="sectionTitleRef"></a>”.</ul>
<p>The OITF SHALL also include an SDP conformant to step 1 as defined in section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”. The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the request includes all the mandatory SIP headers as per [[!SIP]] and headers listed in Table <a href="#t16" class="tableRef">16</a>. Furthermore, the IG perform the steps depicted in section <a href="#s6-2-2-9-1-2" class="sectionRef">6.2.2.9.1.2</a>, “<a href="#s6-2-2-9-1-2" class="sectionTitleRef"></a>”.</p>
<p>Following that, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL generate an initial SIP INVITE request to the network as specified in [[!TS124503]] for originating sessions.</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward any received SIP response to the OITF including the information in the SDP. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t17" class="tableRef">17</a> and all mandatory headers as per [[!SIP]]. For a description of the received SDP answer, refer to section <a href="#s5-3-2-1-2" class="sectionRef">5.3.2.1.2</a>, “<a href="#s5-3-2-1-2" class="sectionTitleRef"></a>”.</p>
<p>When parsing the b=RR:&lt;bandwidth-value&gt; line in the received SDP answer: if the bandwidth value agreed is non-zero, then the transferee OITF SHALL send RTCP RRs and SHALL NOT send RTSP keep-alive messages. If the bandwidth value received is zero, then the transferee OITF SHALL NOT send RTCP RRs but instead it SHALL send RTSP keep-alive messages.</p>
<p>If the transferee OITF receives an error code with an Insufficient Bandwidth indication in the response from the IG, the OITF MAY perform a new SIP INVITE with a reduced maximum bandwidth for the content. This procedure MAY be repeated. If no agreement can be reached, the OITF MAY display a failure message to the user.</p>
<p>Finally to complete the SIP INVITE transaction, the transferee OITF SHALL send a SIP ACK to the IG. The SIP ACK SHALL include the SIP headers defined in Table <a href="#t18" class="tableRef">18</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-9-1-2"><h6>IG handling of session transfers when the transferor and transferee are behind the same IG</h6>
<p>Upon receipt by the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> of a SIP INVITE related to a session transfer (as indicated by the presence of the Replace header), if the transferor and the transferee are behind the same IG, then during the session transfer procedure, the transferor OITF SHALL receive a SIP re-INVITE request from the IG and where the SIP headers are conformant to Table <a href="#t16" class="tableRef">16</a> with the qualification in step 1 in section <a href="#s5-3-13-1-1-2" class="sectionRef">5.3.13.1.1.2</a>, “<a href="#s5-3-13-1-1-2" class="sectionTitleRef"></a>”. The SDP SHALL conform to step 1 in section <a href="#s5-3-13-1-1-2" class="sectionRef">5.3.13.1.1.2</a>, “<a href="#s5-3-13-1-1-2" class="sectionTitleRef"></a>” as well.</p>
<p>The OITF SHALL conform to step 2 in section <a href="#s5-3-13-1-1-2" class="sectionRef">5.3.13.1.1.2</a>, “<a href="#s5-3-13-1-1-2" class="sectionTitleRef"></a>” and subsequently SHALL send a SIP 200 OK response, and where the SIP headers are set according to Table <a href="#t17" class="tableRef">17</a> with the qualification in step 2 in section <a href="#s5-3-13-1-1-2" class="sectionRef">5.3.13.1.1.2</a>, “<a href="#s5-3-13-1-1-2" class="sectionTitleRef"></a>”.</p>
<p>Subsequently, the transferor OITF SHALL receive a SIP ACK form the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> conforming to Table <a href="#t14" class="tableRef">14</a> with the exception that the SIP headers are populated appropriately given that the ACK is sent from the IG to the OITF.</p>
<p>Following that, the IG SHALL perform steps 4 and 5 as depicted in section <a href="#s5-3-13-1-1-2" class="sectionRef">5.3.13.1.1.2</a>, “<a href="#s5-3-13-1-1-2" class="sectionTitleRef"></a>”.</p>
<p>Note that this entire procedure is bypassed if the transferor and transferee are not behind the same IG.</p>
</section>
</section>
<section id="s6-2-2-9-2"><h5>Session Transfer via Push Mode</h5>
<section id="s6-2-2-9-2-1"><h6>Target discovery by the Transferor OITF</h6>
<p>An OITF that wants to locate a target OITF for session transfer purposes SHALL perform the procedures described in section <a href="#s6-2-3-2-4" class="sectionRef">6.2.3.2.4</a>, “<a href="#s6-2-3-2-4" class="sectionTitleRef"></a>”.</p>
<p>Subsequently a target OITF (transferee OITF) can be selected from the returned information.</p>
</section>
<section id="s6-2-2-9-2-2"><h6>Transferee OITF Initiating a session transfer</h6>
<p>A transferor OITF that desires to transfer a session to a transferee OITF SHALL initiate a SIP REFER request to the IG that includes all the SIP headers in Table <a href="#t46" class="tableRef">46</a> and any other mandatory headers as per [[!SIP]] (e.g. Via, Max-Forwards). The body of the SIP REFER message SHALL include the MIME type defined in section <a href="#s5-3-13-2" class="sectionRef">5.3.13.2</a>, “<a href="#s5-3-13-2" class="sectionTitleRef"></a>”.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP REFER includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t46" class="tableRef">46</a>. Following a successful validation, the IG SHALL generate a SIP REFER request as specified in [[!TS124503]] for originating UA.</p>
<p>The IG SHALL forward any received SIP response to the OITF. A SIP 202 OK response SHALL include the SIP headers defined in Table <a href="#t47" class="tableRef">47</a> and any other mandatory SIP headers as per [[!SIP]].</p>
<p>Later at some point in time, the IG the SHALL receive a SIP NOTIFY request that reports the outcome of the session transfer request.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP NOTIFY request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t48" class="tableRef">48</a>. Following a successful validation, the IG SHALL forward the SIP NOTIFY request to the OITF. The IG SHALL forward the received response to the network. The SIP 200 OK response SHALL include the SIP headers in Table <a href="#t49" class="tableRef">49</a>.</p>
</section>
<section id="s6-2-2-9-2-3"><h6>Transferee OITF Handling of an Incoming Transfer</h6>
<p>At some point in time, during a session transfer, the IG the SHALL receive a SIP REFER request destined for a transferee OITF.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP REFER includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t46" class="tableRef">46</a>. The body of the SIP MESSAGE request SHALL include the XML schema defined in section <a href="#s5-3-13-2" class="sectionRef">5.3.13.2</a>, “<a href="#s5-3-13-2" class="sectionTitleRef"></a>”. Following a successful validation, the IG SHALL forward the SIP REFER request to the transferee OITF.</p>
<p>The transferee OITF SHALL examine the incoming SIP REFER request as per step 2 in section <a href="#s5-3-13-1-2-3" class="sectionRef">5.3.13.1.2.3</a>, “<a href="#s5-3-13-1-2-3" class="sectionTitleRef"></a>”.</p>
<p>Once the transferee OITF accepts the incoming SIP REFER request, it SHALL send a SIP 202 OK response to the IG. The SIP 202 OK response SHALL include the SIP headers defined in Table <a href="#t47" class="tableRef">47</a> and all mandatory headers as per [[!SIP]]. The IG SHALL validate the SIP 202 OK response before forwarding it to the network for delivery to the transferor OITF.</p>
<p>The transferee OITF SHALL then follow step 4 in section <a href="#s5-3-13-1-2-3" class="sectionRef">5.3.13.1.2.3</a>, “<a href="#s5-3-13-1-2-3" class="sectionTitleRef"></a>”, and proceed to initiate a new session according to the procedure in section <a href="#s6-2-2-9-1-1" class="sectionRef">6.2.2.9.1.1</a>, “<a href="#s6-2-2-9-1-1" class="sectionTitleRef"></a>”.</p>
<p>Once the session setup outcome is determined, the transferee OITF SHALL initiate a SIP NOTIFY request to the IG that includes all the SIP headers in Table <a href="#t48" class="tableRef">48</a> and any other mandatory headers as per [[!SIP]] (e.g. Via, Max-Forwards).</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP NOTIFY includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t48" class="tableRef">48</a>. Following a successful validation, the IG SHALL generate a SIP NOTIFY request as specified in [[!TS124503]] for originating UA.</p>
<p>The IG SHALL forward any received SIP response to the transferee OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t49" class="tableRef">49</a> and all mandatory headers as per [[!SIP]].</p>
</section>
</section>
</section>
<section id="s6-2-2-10"><h4>Purchase of Digital Media service using SIP</h4>
<section id="s6-2-2-10-1"><h5>Request Initiation for Purchase of Digital Media Service</h5>
<p>To initiate a request to purchase digital media selected by an end-user within a unicast content streaming session, the OITF SHALL initiate a SIP INFO request to the IG, based on SIP INFO framework, that includes all the SIP headers in Table <a href="#t21" class="tableRef">21</a> and any other mandatory SIP headers as per [[!SIP]] (e.g. Via, Max-Forwards). The SIP INFO request body SHALL include an XML document as defined in section <a href="#s5-3-5-8" class="sectionRef">5.3.5.8</a>, “<a href="#s5-3-5-8" class="sectionTitleRef"></a>”, which is associated with the Digital-Media-Purchase Info Package. The initiation of the SIP INFO request assumes that the IPTV Control FE indicated its willingness to receive the Digital-Media-Purchase Info Package.</p>
<p>The IG, acting as a B2BUA SHALL validate that the SIP INFO request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t21" class="tableRef">21</a>. Following a successful validation, the IG SHALL generate a SIP INFO request as specified in [[!TS124503]] for originating UA.</p>
<p>The IG SHALL forward any received SIP response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t22" class="tableRef">22</a> and any other mandatory SIP headers as per [[!SIP]].</p>
</section>
<section id="s6-2-2-10-2"><h5>Network Management of purchase requests of Digital Media</h5>
<p>At any time, the IG can receive a SIP UPDATE request from the network to remove or re-instate support for the reception of the Digital-Media-Purchase Info package from an OITF.</p>
<p>The IG, acting as a B2B UA SHALL validate that the SIP UPDATE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t23" class="tableRef">23</a>. Following a successful validation, the IG SHALL forward the SIP UPDATE request to the OITF. The IG SHALL forward the received response to the network. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t24" class="tableRef">24</a> and any other mandatory SIP headers as per [[!SIP]].</p>
</section>
</section>
<section id="s6-2-2-11"><h4>Personalized Channel (Network Centric Model) using SIP</h4>
<section id="s6-2-2-11-1"><h5>Request Initiation for Personal Channel</h5>
<p>To initiate a session for a personalized channel, the OITF SHALL follow section <a href="#s6-2-2-2-2" class="sectionRef">6.2.2.2.2</a>, “<a href="#s6-2-2-2-2" class="sectionTitleRef"></a>” with the difference that the content identifier in this case for both the Request-URI and the To fields is set to the personalized channel identifier.</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL follows as well the same steps in section <a href="#s6-2-2-2-2" class="sectionRef">6.2.2.2.2</a>.</p>
</section>
</section>
</section>

<section id="s6-2-3"><h3>Protocols for Service Access and Control Functions</h3>
<section id="s6-2-3-1"><h4>Service Provider Discovery</h4>
<p>To retrieve the list of Service Providers, the OITF SHALL issue a SIP SUBSCRIBE request to the IG that includes the SIP headers as per Table <a href="#t50" class="tableRef">50</a>. In addition, the OITF SHALL include all mandatory SIP headers as per [[!SIP]] and that are missing from the table (e.g., Via, Max-Forwards).</p>
<p>The OITF SHALL include a message body associated with the appid “urn:oipf:application:iptv-SP-discovery” representing the capabilities of the OITF.</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP SUBSCRIBE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t50" class="tableRef">50</a>. Following a successful validation, the IG SHALL follow the procedure in section <a href="#s6-1-3-1" class="sectionRef">6.1.3.1</a>, “<a href="#s6-1-3-1" class="sectionTitleRef"></a>”, when it comes to initiating a SIP SUBSCRIBE towards the Service Provider.</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL return to the OITF the response received from the network as per step 3b in section <a href="#s6-1-3-1" class="sectionRef">6.1.3.1</a>, “<a href="#s6-1-3-1" class="sectionTitleRef"></a>”.</p>
<p>The IG SHALL ensure that the OITF is synchronized with the timer for refreshing the subscription as desired by the network.</p>
<p>The OITF is responsible for refreshing the subscription based on the received timer from the network. The IG SHALL consider a subscription terminated if it is not refreshed by the OITF before expiry.</p>
<p>The procedure for refreshing a subscription is the same as the procedure for initiating a subscription.</p>
</section>
<section id="s6-2-3-2"><h4>User Registration and Network Authentication</h4>
<section id="s6-2-3-2-1"><h5>Procedure for User Registration</h5>
<p>This procedure SHALL be invoked in the following cases:</p><ul>
<li>When the OITF is turned on
<li>When an IPTV end user explicitly logs on at an OITF using an Alias or IMPU.</ul>
<p>The IG SHALL extract the deviceID from the sip instance feature tag.</p>
<p>If the deviceID and the IMPU match another deviceID and IMPU whose state is held in the IG, the IG SHALL conclude that the OITF has undergone a restart and SHALL proceed to immediately clear all SIP sessions belonging to the OITF. Following that, the IG SHALL de-register all users registered from that OITF.</p>
<p>If GRUU is not requested, the IG SHALL NOT perform IMS registration when the IMPU is already registered; however, the IG SHALL maintain a binding between the Alias/IMPU, the OITF device from which the registration is received (extracted from the sip instance feature tag), and the new contact information including the sip instance feature tag, which provides an easy way to guarantee uniqueness within the Address of Record (AOR).</p>
<p>If the identity being registered is not the default identity and if the default identity is not bound to any OITF in the consumer network, then the IG SHALL deregister the default identity at the end of this procedure.</p>
<p>If the identity being registered is the default identity, and if the default identity is not bound to any OITF in the consumer network, then the IG SHALL deregister its contact address for the default identity at the end of this procedure.</p>
<p>To register an identity, the OITF SHALL issue a SIP REGISTER request to the IG that includes the SIP headers as per Table <a href="#t58" class="tableRef">58</a>. In addition, the OITF SHALL include all mandatory SIP headers as per [[!SIP]] and that are missing from the table (e.g., Via, Max-Forwards).</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP REGISTER request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t58" class="tableRef">58</a>. Following a successful validation, the IG SHALL support the 3GPP IMS registration procedure as per TS 124 503 [[!TS124503]]. This includes handling of user authentication and authorization., and including any additional SIP headers that are mandatory based on TS 124 503 [[!TS124503]].</p>
<p>Once the IG completes the IMS registration procedure, it SHALL return a SIP 200 OK to the OITF that includes the SIP headers listed in Table <a href="#t59" class="tableRef">59</a>.</p>
<p>Following a successful registration, the IG SHALL maintain a binding between the Alias/IMPU, the OITF device from which the registration is received (extracted from the sip instance feature tag), and the new contact information including the sip instance feature tag for the duration of the registration.</p>

</section>
<section id="s6-2-3-2-2"><h5>Procedure for User Deregistration</h5>
<p>This procedure is invoked in the following cases:</p><ul>
<li>The OITF is turned off
<li>An IPTV end user, who has registered with his own IMPU, deregisters from an OITF</ul>
<p>If GRUU is not supported for this registration, the IG SHALL NOT perform IMS deregistration when an IMPU is already registered on multiple OITFs, but the IG SHALL remove the binding between the IMPU and the OITF from which the user has deregistered (extracted from the sip instance feature tag) including the contact information (including the sip instance feature tag).</p>
<p>If GRUU is not supported for this registration, the IG SHALL perform the IMS deregistration procedure if the IMPU was bound to a single OITF.</p>
<p>Note that if following the successful de-registration of the IMPU, and if there are no more OITFs still turned on in the consumer network, the IG SHALL re-register the default identity from the IG point of view.</p>
<p>To de-register an identity, the OITF SHALL issue a SIP REGISTER request to the IG that includes the SIP headers as per Table <a href="#t58" class="tableRef">58</a>. The OITF SHALL set the expires parameter to 0 for the contact to be de-registered. In addition, the OITF SHALL include all mandatory SIP headers as per [[!SIP]] and that are missing from the table (e.g., Via, Max-Forwards).</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP REGISTER request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t58" class="tableRef">58</a>. Following a successful validation, the IG SHALL support the 3GPP IMS de-registration procedure as per TS 124 503 [[!TS124503]]. Once the IG completes the IMS de-registration procedure, it SHALL return a SIP 200 OK to the OITF that includes the SIP headers listed in Table <a href="#t59" class="tableRef">59</a>.</p>
<p>Note that the OITF SHALL tear down and release all SIP sessions involving the contact to be de-registered prior to de-registering that contact. If the OITF does not tear down those SIP sessions before initiating the de-registration request to the IG, the IG SHALL tear down those sessions before performing the deregistration procedure described above.</p>
<p>Following a successful de-registration, the IG SHALL remove the binding between the Alias/IMPU, the OITF device from which the registration is received (extracted from the sip instance feature tag).</p>
</section>
<section id="s6-2-3-2-3"><h5>Procedure for Refreshing a Registration</h5>
<p>This procedure SHALL be initiated by the OITF at any time before the expiry of the registration refresh timer.</p>
<p>The procedure is the same as the procedure for registering a user. A registration SHALL be terminated if it is not refreshed before the expiry of the registration refresh timer.</p>
<p>For an OITF-initiated registration, the IG SHALL consider a registration terminated (that is the user de-registered) if it is not refreshed. In this case, the IG executes the procedures associated with user deregistration.</p>
</section>
<section id="s6-2-3-2-4"><h5>Procedure for Subscription to the Registration-State Event Package</h5>
<p>This procedure SHALL be invoked by the OITF immediately after the successful registration of an IMPU.</p>
<p>To subscribe to the registration-state event package for the successfully registered IMPU, the OITF SHALL issue a SIP SUBSCRIBE request to the IG that includes the SIP headers as per Table <a href="#t60" class="tableRef">60</a>. In addition, the OITF SHALL include all mandatory SIP headers as per [[!SIP]] and that are missing from the table (e.g., Via, Max-Forwards).</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP SUBSCRIBE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t60" class="tableRef">60</a>. Following a successful validation, the IG SHALL support the 3GPP IMS subscription to registration-event package as per TS 124 503 [[!TS124503]]. This includes inserting any additional SIP headers that are mandatory based on TS 124 503 [[!TS124503]].</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL return to the OITF the response received from the network.
<p>The IG SHALL ensure that the OITF is synchronized with the timer for refreshing the subscription as desired by the network.</p>
<p>When a SIP NOTIFY request is received by the IG, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate the incoming NOTIFY request before sending it to the OITF. The incoming NOTIFY request SHALL include the SIP headers depicted in Table <a href="#t62" class="tableRef">62</a> and any other mandatory headers as per [[!SIP]].</p>
<p>The OITF SHALL validate that the SIP body is compliant to the XML schema associated with the registration-state event package. Following a successful validation, the OITF SHALL send a SIP 200 OK response to the IG. The SIP 200 OK response SHALL include the SIP headers depicted in Table <a href="#t63" class="tableRef">63</a>. The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL first validate the SIP 200 OK response (or any other received response) before sending it to the network.</p>
<p>For all subsequent SIP NOTIFY requests using the same SIP dialog, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL perform the same processing.</p>
</section>
<section id="s6-2-3-2-5"><h5>Procedure for Terminating a Subscription to the Registration-State Event Package</h5>
<p>The OITF is responsible for refreshing the subscription based on the received timer from the network. The IG SHALL consider a subscription terminated if it is not refreshed by the OITF before expiry.</p>
<p>The procedure for refreshing a subscription is the same as the procedure for initiating a subscription.</p>
</section>
</section>
<section id="s6-2-3-3"><h4>Notification of Service Profile changes</h4>
<section id="s6-2-3-3-1"><h5>Subscription to Notifications of Service Profile changes (xcap-diff)</h5>
<p>To subscribe for the purpose of receiving notification of changes in a service profile, the OITF SHALL issue a SIP SUBSCRIBE request to the IG that includes the SIP headers as per Table <a href="#t54" class="tableRef">54</a>. In addition, the OITF SHALL include all mandatory SIP headers as per [[!SIP]] and that are missing from the table (e.g., Via, Max-Forwards). The body of the SIP SUBSCRIBE request SHALL include the list of the requested URIs associated with the XCAP resources for which the subscription is issued. The MIME Type of the document inserted in the body will be signalled by the Content-Type header set to “application/vnd.oipf.userprofile+xml”.</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP SUBSCRIBE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t54" class="tableRef">54</a>. Following successful validation, the IG SHALL support the 3GPP IMS subscription to event packages and SHALL send a SUBSCRIBE request to the IPTV Service Profile FE in accordance with [[!TS124503]], [[!SIP-EVNT]] and [[!XCAP-EVT]].</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL return to the OITF the response received from the network.
<p>The IG SHALL ensure that the OITF is synchronized with the timer for refreshing the subscription as desired by the network.
<p>When a SIP NOTIFY request is received by the IG, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate the incoming NOTIFY request includes the SIP headers depicted in Table <a href="#t56" class="tableRef">56</a> and any other mandatory headers as per [[!SIP]].</p>
<p>The OITF SHALL validate that the SIP body is compliant to the XML schema associated with application/XCAP-diff+xml as defined in [[!XCAP-EVT]] and [[!XCAP-DFF]]. Following a successful validation, the OITF SHALL send a SIP 200 OK response to the IG. The SIP 200 OK response SHALL include the SIP headers depicted in Table <a href="#t57" class="tableRef">57</a>. The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL first validate the SIP 200 OK response (or any other received response) before sending it to the network.</p>
<p>For all subsequent SIP NOTIFY requests received using the same SIP dialog, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL perform the same processing. The IG SHALL consider a subscription terminated if it is not renewed by the OITF.</p>
</section>
<section id="s6-2-3-3-2"><h5>Procedure for Refreshing a Subscription to receive notifications of Service Profile changes over the HNI-IGI SIP option</h5>
The procedure for refreshing a subscription is the same as the procedure for initiating a new subscription.
</section>
</section>
</section>

<section id="s6-2-4"><h3>Protocols for Communication Services using SIP</h3>
<section id="s6-2-4-1"><h4>Procedure for Instant Message Based CallerID</h4>
The procedure for caller id is identical to the reception of an instant message as depicted in section <a href="#s6-2-4-2-2" class="sectionRef">6.2.4.2.2</a>, “<a href="#s6-2-4-2-2" class="sectionTitleRef"></a>”.
</section>
<section id="s6-2-4-2"><h4>Instant Messaging</h4>
<section id="s6-2-4-2-1"><h5>Procedure for Outgoing Instant Messaging</h5>
<p>To initiate an instant message, the OITF SHALL send a SIP MESSAGE to the IG that includes all the SIP headers in Table <a href="#t69" class="tableRef">69</a> and any other mandatory headers as per [[!SIP]]. The content of the SIP MESSAGE SHALL be conformant to RFC 3428 [[!SIP-IM]].</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP MESSAGE includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t69" class="tableRef">69</a>. Following a successful validation, the IG SHALL generate a SIP MESSAGE request to the network conformant to [[!SMPL-PRES]].</p>
<p>The IG SHALL forward any received SIP response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t70" class="tableRef">70</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-4-2-2"><h5>Procedure for Incoming Instant Messaging</h5>
<p>When the IG receives any SIP MESSAGE destined for a user, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the incoming SIP MESSAGE is conformant to [[!SMPL-PRES]] and includes all the mandatory headers as per [[!SIP]] and all the headers listed in Table <a href="#t71" class="tableRef">71</a>. Following the successful validation, the IG SHALL forward the SIP MESSAGE to the appropriate OITF.</p>
<p>When the SIP response is received from the OITF, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward it to the network. The response SHALL include the SIP headers in Table <a href="#t70" class="tableRef">70</a> and SHALL be validated by the IG before being sent to the network.</p>
</section>
</section>
<section id="s6-2-4-3"><h4>Presence</h4>
<section id="s6-2-4-3-1"><h5>Procedure for Subscribing to Presence Information</h5>
<p>To subscribe to the presence event package for any registered IMPU, the OITF SHALL issue a SIP SUBSCRIBE request to the IG that includes the SIP headers as per Table <a href="#t88" class="tableRef">88</a>. In addition, the OITF SHALL include all mandatory SIP headers as per [[!SIP]] and that are missing from the table (e.g. Via, Max-Forwards).</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP SUBSCRIBE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t88" class="tableRef">88</a>. Following successful validation, the IG SHALL support the 3GPP IMS subscription to presence event package as per [[!SMPL-PRES]]. This includes inserting any additional SIP headers that are mandatory.</p>
<p>The IG SHALL return to the OITF the response received from the network.</p>
<p>The IG SHALL ensure that the OITF is synchronized with the timer for refreshing the subscription as desired by the network.</p>
<p>When a SIP NOTIFY request is received by the IG, the IG SHALL validate the incoming NOTIFY request being compliant to [[!SMPL-PRES]] before sending it to the OITF. The incoming NOTIFY request SHALL include the SIP headers depicted in Table <a href="#t90" class="tableRef">90</a> and any other mandatory headers as per [[!SIP]].</p>
<p>The OITF SHALL validate that the SIP body is compliant to the XML schema associated with the presence event package. Following a successful validation, the OITF SHALL send a SIP 200 OK response to the IG. The SIP 200 OK response SHALL include the SIP headers depicted in Table <a href="#t91" class="tableRef">91</a>. The IG SHALL first validate the SIP 200 OK response (or any other received response) before sending it to the network.</p>
<p>For all subsequent SIP NOTIFY requests received using the same SIP dialog, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL perform the same processing. The IG SHALL consider a subscription terminated if it is not renewed by the OITF.</p>
</section>
<section id="s6-2-4-3-2"><h5>Procedure for Terminating a Subscription to Presence Information</h5>The procedure for refreshing a subscription is the same as the procedure for initiating a subscription.</section>
<section id="s6-2-4-3-3"><h5>Procedure for Publishing Presence Information</h5>
<p>To publish presence information, the OITF SHALL send a SIP PUBLISH request to the IG that includes all the SIP headers in Table <a href="#t92" class="tableRef">92</a> and other mandatory headers as per [[!SIP]]. The content of the SIP PUBLSIH SHALL be based on section <a href="#s5-5-4-6" class="sectionRef">5.5.4.6</a>, “<a href="#s5-5-4-6" class="sectionTitleRef"></a>”.</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP PUBLISH request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t92" class="tableRef">92</a>. Following a successful validation, the IG SHALL generate a SIP PUBLISH request to the network conformant to [[!SMPL-PRES]].</p>
<p>The IG SHALL forward any received SIP response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t93" class="tableRef">93</a> and all mandatory headers as per [[!SIP]].</p>
</section>
</section>
<section id="s6-2-4-4"><h4>Chatting</h4>
For IM sessions, the OITF SHALL implement the MSRP stack conformant to [[!SMPL-IM]].
<section id="s6-2-4-4-1"><h5>IM Session Initiation</h5>
<p>To initiate an IM session, the OITF SHALL initiate a SIP INVITE request to the IG that includes all the SIP headers in Table <a href="#t72" class="tableRef">72</a>. However, the body of the SIP INVITE SHALL be populated with the following information to initiate the MSRP session:</p><ul>
<li>A c = IN IP4 &lt;IP address&gt; , where &lt;IP address&gt; would contain the IP address of the OITF,
<li>An m = message &lt;tcp port&gt; tcp/msrp, where tcp port is a TCP port could be set to the dummy value “9”
<li>An a = accept-types:message/cpim, attribute which is mapped from the “X-OITF-Accept:” header value
<li>An a = path msrp://&lt;IP address&gt;:&lt;tcpport&gt;/&lt;session-id&gt;; tcp, where:<ul>
<li>&lt;IP address&gt; would contain the IP address of the OITF
<li>&lt;tcpport&gt; would be assigned automatically by the OITF
<li>&lt;session-id&gt; would be assigned by the OITF and bound to the requesting OITF IM SIP Chatting application
</ul></ul>
<p>The OITF SHALL also include any other mandatory headers as per [[!SIP]] (e.g. Via, Max-Forwards).</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP INVITE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t72" class="tableRef">72</a>. Following a successful validation, the IG SHALL generate an initial INVITE request as specified in [[!SMPL-IM]].</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward any received SIP response to the OITF including the information in the SDP. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t73" class="tableRef">73</a> and all mandatory headers as per [[!SIP]].</p>
<p>The OITF SHALL save the information returned in the SDP for the purpose of MSRP.</p>
<p>Finally to complete the INVITE transaction, the OITF SHALL then send a SIP ACK to the IG. The SIP ACK SHALL include the SIP headers defined in Table <a href="#t74" class="tableRef">74</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-4-4-2"><h5>Incoming IM Session</h5>
<p>When the IG receives a SIP INVITE request related to an IM session and destined for a user, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the incoming SIP INVITE is conformant to [[!SMPL-IM]] and includes all the mandatory headers as per [[!SIP]] and all the headers listed in Table <a href="#t85" class="tableRef">85</a>. Following the successful validation, the IG SHALL forward the SIP INVITE to the appropriate OITF including the received SDP.</p>
<p>The OITF SHALL validate that the SDP includes all the necessary and mandatory parameters per [[!RFC4975]]. The OITF SHALL store the necessary information and SHALL send its response to the IG. The SDP included in the response SHALL include the following information:</p><ul>
<li>A c = IN IP4 &lt;IP address&gt; , where &lt;IP address&gt; would contain the IP address of the OITF
<li>An m = message &lt;tcp port&gt; tcp/msrp, where tcp port is a TCP port could be set to the dummy value “9”
<li>An a = accept-types:message/cpim, attribute
<li>An a = path msrp://&lt;IP address&gt;:&lt;tcpport&gt;/&lt;session-id&gt;; tcp, where:<ul>
<li>&lt;IP address&gt; would contain the IP address of the OITF
<li>&lt;tcpport&gt; would be assigned automatically by the OITF
<li>&lt;session-id&gt; would be assigned by the OITF and bound to the responding OITF SIP Chatting application
</ul></ul>
<p>When the SIP response is received from the OITF, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward it to the network. The response SHALL include the SIP headers in Table <a href="#t86" class="tableRef">86</a> and SHALL be validated by the IG before being sent to the network.</p>
<p>Finally to complete the INVITE transaction, the IG SHALL forward the received SIP ACK from the network to the OITF. The SIP ACK SHALL include the SIP headers defined in Table <a href="#t87" class="tableRef">87</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-4-4-3"><h5>Session Termination</h5>
<p>To terminate a session, the OITF SHALL send a SIP BYE request to the IG that includes all headers listed in Table <a href="#t81" class="tableRef">81</a> and any other mandatory headers as per [[!SIP]].</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP BYE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t81" class="tableRef">81</a>. Following a successful validation, the IG SHALL generate a SIP BYE request as specified in [[!SMPL-IM]]. The IG SHALL forward the received response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t82" class="tableRef">82</a> and all mandatory headers as per [[!SIP]].</p>
<p>Alternatively, on receipt of a SIP BYE request from the IPTV Control FE, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a>, after validating the request, to include all headers listed in Table <a href="#t83" class="tableRef">83</a> and any other mandatory headers as per [[!SIP]], SHALL forward the request to the OITF. The OITF SHALL respond with a SIP 200 OK response, which the IG forward to the IPTV Control FE.</p>
</section>
<section id="s6-2-4-4-4"><h5>Session Refresh</h5>
It is the responsibility of the OITF to refresh the IM session, as per [[!SES-TIMR]] before the session expires. The IG SHALL consider a session terminated if it is not refreshed, and SHALL clear its internal state accordingly.
</section>
<section id="s6-2-4-4-5"><h5>Outgoing/Incoming MSRP Chat and Chat State Messages</h5>
Following the successful establishment of an incoming or outgoing IM session, the OITF is ready to receive or send any MSRP chat message or MSRP chat state message based on [[!RFC4975]] and [[!SMPL-IM]].
</section>
</section>
<section id="s6-2-4-5"><h4>Content Sharing</h4>
<section id="s6-2-4-5-1"><h5>Procedure for Outgoing Content Sharing</h5>
<p>The OITF can initiate a content sharing session and can initiate a change request to transfer the session to other OITF or to maintain an existing session between two sides.</p>
<p>To initiate a content sharing session, the OITF SHALL send a SIP INVIVE to the IG that includes all the SIP headers and any other mandatory headers as per [[!SIP]]. SDP shall be used as specified in [[!TS124503]].</p>
<p>The IG SHALL validate that the SIP INVITE includes all the mandatory headers as per [[!SIP]]. Following a successful validation, the IG SHALL generate a SIP INVITE request to the network conformant to [[!SIP]].</p>
<p>A REFER message associated with transferor OITF SHALL be sent to the IG that includes all the SIP headers and any other mandatory headers as per [[!SIP]].</p><ul>
<li>The IG SHALL forward any incoming SIP REFER, for the purpose of session transfer, that conforms to the [[!SRVCONT]] to the transferee OITF. Non-conformant SIP REFER messages SHALL be rejected with the appropriate response code.
<li>An outgoing SIP NOTIFY message associated with the transferee reporting the outcome of a session transfer associated with a REFER request, SHALL conform to [[!RFC3515]].
<li>The IG SHALL forward any incoming SIP NOTIFY, reporting the outcome of a session transfer associated with a REFER request, that conforms to [[!RFC3515]] to the transferor OITF. Non-conformant SIP REFER messages SHALL be rejected with the appropriate response code.</ul>
<p>When receiving a SIP REFER request, the IPTV Control FE SHALL authorize the request. If the user is not authorized to perform session transfer, an appropriate SIP error response is returned. If the user is authorized, the IPTV Control FE SHALL forward the SIP REFER to the ASM for delivery to its destination (transferee OITF). The IPTV Control FE SHALL be stateful to the session transfer procedure.</p>
<p>When receiving a SIP NOTIFY associated with a SIP REFER request, the IPTV Control FE SHALL validate the SIP NOTIFY. If not successfully validated, an appropriate SIP response SHALL be returned. If successfully validated, the IPTV Control FE SHALL forward the SIP NOTIFY to the ASM for delivery to the destination (transferor OITF).</p>
</section>
<section id="s6-2-4-5-2"><h5>Procedure for Incoming Content Sharing</h5>
<p>When the IG receives a SIP INVITE request related to a content sharing session and destined for a user, the IG SHALL validate that the incoming SIP INVITE is conformant to [[!SMPL-IM]] and includes all the mandatory headers as per [[!SIP]]. Following the successful validation, the IG SHALL forward the SIP INVITE to the appropriate OITF including the received SDP</p><ul>
<li>The OITF SHALL validate that the SDP includes all the necessary and mandatory parameters per [[!TS124503]]. The OITF SHALL store the necessary information and SHALL send its response to the IG.</ul>
<p>When the SIP response is received from the OITF, the IG SHALL forward it to the network.</p>
</section>
<section id="s6-2-4-5-3"><h5>Procedure for Terminating Content Sharing</h5>
<p>To terminate a session, the OITF SHALL send a SIP BYE request to the IG that includes all the mandatory headers as per [[!SIP]].</p>
<p>The IG, acting as a B2B UA SHALL validate that the SIP BYE request includes all the mandatory headers as per [[!SIP]]. Following a successful validation, the IG SHALL generate a SIP BYE request as specified in [[!SIP]].The IG SHALL forward the received response to the OITF. A SIP 200 OK response SHALL include all the mandatory headers as per [[!SIP]].</p>
<p>Alternatively, on receipt of a SIP BYE request from the IPTV Control FE, the IG, after validating the request, to include all the mandatory headers as per [[!SIP]], SHALL forward the request to the OITF. The OITF SHALL respond with a SIP 200 OK response, which the IG forward to the IPTV Control FE.</p>
</section>
</section>
<section id="s6-2-4-6"><h4>Multimedia (MM) Telephony</h4>
<section id="s6-2-4-6-1"><h5>OITF initiated Multimedia Telephony Session Initiation</h5>
<p>To initiate a MM telephony session, the OITF SHALL initiate a SIP INVITE request to the IG that includes all the SIP headers in Table <a href="#t132" class="tableRef">132</a>. The body of the SIP INVITE SHALL be populated in accordance with [[!SDP]] reflecting the appropriate description for each media, and corresponding codecs for MM session. Section <a href="#s6-2-4-6-8" class="sectionRef">6.2.4.6.8</a> entitled “<a href="#s6-2-4-6-8" class="sectionTitleRef"></a>” details the SDP representation for codecs that can be used by the OITF.</p>
<p>The OITF SHALL also include any other mandatory headers as per [[!SIP]] (e.g. Via, Max-Forwards).</p>
<p>The IG, being service aware, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP INVITE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t132" class="tableRef">132</a>. From the included codecs and requested media, the IG SHALL be able to conclude that the requested session is for MMTEL. Following a successful validation, and detection of the implied MMTEL service for the incoming session, the IG SHALL generate an initial INVITE request towards the ASM as specified in [[!TS124503]] and [[!TS181005]] and SHALL include all mandatory headers.</p>
<p>The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward any received SIP response to the OITF including the information in the SDP. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t133" class="tableRef">133</a> and all mandatory headers as per [[!SIP]].</p>
<p>Finally to complete the INVITE transaction, the OITF SHALL then send a SIP ACK to the IG. The SIP ACK SHALL include the SIP headers defined in Table <a href="#t134" class="tableRef">134</a> and all mandatory headers as per [[!SIP]]. The IG acting as a B2BUA, in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a>, SHALL forward the SIP ACK to the ASM.</p>
</section>
<section id="s6-2-4-6-2"><h5>Incoming Multimedia Telephony Session Initiation</h5>
<p>When the IG receives a SIP INVITE request related to an MMTEL session and destined for a user, the IG SHALL validate that the incoming SIP INVITE is conformant to [[!TS124503]] and [[!TS181005]] and includes all the mandatory headers as per [[!SIP]] and all the headers listed in Table <a href="#t135" class="tableRef">135</a>. Following the successful validation, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward the SIP INVITE to the appropriate OITF including the received SDP.<p>
<p>The OITF SHALL validate that the SDP includes all the necessary and mandatory parameters per [[!TS124503]] and [[!TS181005]] and the mandatory information pertinent to the chosen codecs in accordance with section <a href="#s6-2-4-6-8" class="sectionRef">6.2.4.6.8</a> entitled “<a href="#s6-2-4-6-8" class="sectionTitleRef"></a>”. The OITF SHALL store the necessary information and SHALL send its response to the IG. The SDP included in the response SHALL include what is acceptable to the OITF based on the received SDP per [[!TS124503]] and [[!TS181005]].<p>
<p>When the SIP response is received from the OITF, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a>, SHALL forward it to the network. The response SHALL include the SIP headers in Table <a href="#t136" class="tableRef">136</a> and SHALL be validated by the IG before being sent to the network.<p>
<p>Finally to complete the INVITE transaction, the IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward the received SIP ACK from the network to the OITF. The SIP ACK SHALL include the SIP headers defined in Table <a href="#t137" class="tableRef">137</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-4-6-3"><h5>OITF-initiated Session Termination</h5>
<p>To terminate a session, the OITF SHALL send a SIP BYE request to the IG that includes all headers listed in Table <a href="#t138" class="tableRef">138</a> and any other mandatory headers as per [[!SIP]].</p>
<p>The IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL validate that the SIP BYE request includes all the mandatory headers as per [[!SIP]] and the headers listed in Table <a href="#t138" class="tableRef">138</a>. Following a successful validation, the IG SHALL generate a SIP BYE request as specified in [[!TS124503]] and [[!TS181005]] towards the ASM. The IG acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward the received response to the OITF. A SIP 200 OK response SHALL include the SIP headers defined in Table <a href="#t139" class="tableRef">139</a> and all mandatory headers as per [[!SIP]].</p>
</section>
<section id="s6-2-4-6-4"><h5>Incoming Session Termination</h5>
<p>Upon receipt of a SIP BYE request from the network, the IG, after validating the request to include all headers listed in Table <a href="#t140" class="tableRef">140</a> and any other mandatory headers as per [[!SIP]], and acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward the request to the OITF.</p>
<p>The OITF SHALL respond with a SIP 200 OK response. The SIP 200 OK response SHALL include the headers in Table <a href="#t141" class="tableRef">141</a>, and which the IG, acting as a B2BUA in accordance with section <a href="#s6-2-1" class="sectionRef">6.2.1</a> SHALL forward to the network.</p>
</section>
<section id="s6-2-4-6-5"><h5>Session Modification</h5>
OITF initiated session modification or an incoming session modification request is essentially identical to session initiation and an incoming session initiation respectively from a handling prospective, both for the OITF and the IG.
</section>
<section id="s6-2-4-6-6"><h5>Session Refresh</h5>
It is the responsibility of the OITF to refresh the MM session, as per [[!SES-TIMR]] before the session expires. The IG SHALL consider a session terminated if it is not refreshed, and SHALL clear its internal state accordingly.
</section>
<section id="s6-2-4-6-7"><h5>Tables of Message elements</h5>
<table id="t132" class="mapping">
<caption>Table ####: Supported SIP headers in the HNI-IGI INVITE Request message for an outgoing MM Telephony session setup (OITF&rarr;IG)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Request Line<p>The Request-URI in the INVITE request SHALL be set to the called identity</p></td><td>RFC 3261 [[!SIP]]<p>INVITE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To<p>The URI part of To SHALL be set to the value of the Request URI in the “Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Contact<p>If GRUU has not been requested at registration, then the URI parameter and the sip.instance feature tag MUST be included and MUST match what is sent in the contact header included in the registration request.</p>
<p>If GRUU has been requested at registration, then the OITF SHALL include in the contact header the returned GRUU during the registration process.</p>
<p>The IG includes all other mandatory parameters that are absent.</p>
<p>Expires parameter SHOULD be included</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Type</td><td>RFC 3261 [[!SIP]] (application/sdp)</td></tr>
<tr><td>Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Supported<p>If GRUU is used, Supported SHALL also be set to “gruu”</p></td><td>RFC 3261 [[!SIP]] set to timer</td></tr>
<tr><td>Session-Expires</td><td>RFC 4028 [[!SES-TIMR]]</td></tr>
</table>
<table id="t133" class="mapping">
<caption>Table ####: Supported SIP headers in the response message to an HNI-IGI INVITE request message for an outgoing MM Telephony Session setup (IG&rarr;OITF)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Response Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Session-Expires</td><td>RFC 4028 [[!SES-TIMR]]</td></tr>
<tr><td>Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t134" class="mapping">
<caption>Table ####: Supported SIP headers in the HNI-IGI ACK message for a successful MM Telephony Session setup (OITF&rarr;IG)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Request Line<p>The Request-URI in the ACK request SHALL be the contact included in the response to the INVITE message</p></td><td>RFC 3261 [[!SIP]]<p>ACK &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To<p>The URI part of To SHALL be set to the value of the Request URI in the “Request-Line” of the initial request</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Contact<p>The URI parameter MUST be included, and MUST match what has been inserted in the INVITE message. The IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Type</td><td>RFC 3261 [[!SIP]] (application/sdp)</td></tr>
<tr><td>Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Supported<p>If GRUU is used, Supported SHALL also be set to “gruu”</p></td><td>RFC 3261 [[!SIP]] set to timer</td></tr>
<tr><td>Session-Expires</td><td>RFC 4028 [[!SES-TIMR]]</td></tr>
</table>
<table id="t135" class="mapping">
<caption>Table ####: Supported SIP headers in the HNI-IGI INVITE Request message for an incoming MM Telephony session setup (IG&rarr;OITF)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Request Line<p>The Request-URI in the INVITE request SHALL be set to the called identity (the user logged in user IMPU on an OITF)</p></td><td>RFC 3261 [[!SIP]]<p>INVITE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To<p>The URI part of To SHALL be set to the value of the Request URI in the “Request-Line”</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Type</td><td>RFC 3261 [[!SIP]] (application/sdp)</td></tr>
<tr><td>Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Supported</td><td>RFC 3261 [[!SIP]] set to timer, and/or GRUU if supported by remote user</td></tr>
<tr><td>Session-Expires</td><td>RFC 4028 [[!SES-TIMR]]</td></tr>
</table>
<table id="t136" class="mapping">
<caption>Table ####: Supported SIP headers in the response message to an HNI-IGI INVITE request message for an incoming MM Telephony Session setup (OITF&rarr;IG)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Response Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Contact<p>If GRUU has not been requested at registration, then the URI parameter and the sip.instance feature tag MUST be included and MUST match what is sent in the contact header included in the registration request.</p>
<p>If GRUU has been requested at registration, then the OITF SHALL include in the contact header the returned GRUU during the registration process.</p>
<p>Expires parameter SHOULD be included.</p>
<p>The IG includes all other mandatory parameters that are absent.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Session-Expires</td><td>RFC 4028 [[!SES-TIMR]]</td></tr>
<tr><td>Content-Type</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Length</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t137" class="mapping">
<caption>Table ####: Supported SIP headers in the HNI-IGI ACK message for a successful incoming MM Telephony Session setup (IG&rarr;OITF)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Request Line<p>The Request-URI in the ACK request SHALL be the contact included in the response to the INVITE message</p></td><td>RFC 3261 [[!SIP]]<p>ACK &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To<p>The URI part of To SHALL be set to the value of the Request URI in the “Request-Line” of the initial request</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Contact<p>The URI parameter MUST be included, and MUST match what has been included in the initial INVITE message.</p></td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t138" class="mapping">
<caption>Table ####: List of SIP headers for an Outgoing SIP BYE (OITF&rarr;IG)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Request Line<p>Note: The Request URI MUST match the contact URI included in the contact field of the SIP INVITE (for outgoing session) or a 200 OK (for incoming session)</p></td><td>RFC 3261 [[!SIP]]<p>BYE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Length<p>MUST be set to 0</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t139" class="mapping">
<caption>Table ####: List of SIP headers for the response to an Outgoing SIP BYE (IG&rarr;OITF)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Response Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t140" class="mapping">
<caption>Table ####: List of SIP headers for an Incoming SIP BYE (IG&rarr;OITF)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Request Line<p>Note: The Request URI MUST match the contact URI included in the contact field of the SIP INVITE (for outgoing session) or a 200 OK (for incoming session)</p></td><td>RFC 3261 [[!SIP]]<p>BYE &lt;Request URI&gt; SIP/2.0</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Content-Length<p>MUST be set to 0</p></td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Contact</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
<table id="t141" class="mapping">
<caption>Table ####: List of SIP headers for the response to an Incoming SIP BYE (OITF&rarr;IG)</caption>
<tr><th>SIP Header</th><th>Source of Information for Coding purposes</th></tr>
<tr><td>Response Line</td><td>RFC 3261 [[!SIP]]<p>SIP/2.0 &lt;response&gt;</p></td></tr>
<tr><td>From</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>To</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>Call-ID</td><td>RFC 3261 [[!SIP]]</td></tr>
<tr><td>CSeq</td><td>RFC 3261 [[!SIP]]</td></tr>
</table>
</section>
<section id="s6-2-4-6-8"><h5>SDP Media Type parameters for media description</h5>
<p>This section describes the media configuration in SDP for all audio and video codecs defined in [[.OIPF_MEDIA2]] for multimedia telephony services.</p><ul>
<li>Media type parameters to configure H.264 video RTP payload types SHALL comply with [[!RFC3984]].
<li>Media type parameters to configure MPEG-4 Part-2 video RTP payload types SHALL comply with [[!RFC3016]].
<li>Media type parameters to configure H.263 video RTP payload types SHALL comply with [[!RFC4629]].
<li>Media type parameters to configure G.711 or G.722 audio RTP payload types SHALL comply with [[!RFC3551]].
<li>Media type parameters to configure AMR-NB or AMR-WB RTP payload types SHALL comply with [[!RFC4867]].
<li>Media type parameters to configure G.719 payload types SHALL comply with [[!RFC5404]].
<li>Media type parameters to configure MPEG-4 AAC-LD/-ELD payload types SHALL comply with [[!RFC3640]].</ul>
<p>Note: RFC 3640 [[!RFC3640]] defines transport and signalling for all MPEG-4 media types. To use it for MPEG-4 AAC-LD/ELD audio the “streamType” is set to “5” to signal an audio stream and the “mode“ is either set to “aac-hbr” or “aac-lbr”. The hexadecimal value of the “config” parameter is the AudioSpecificConfig(), as defined in [[!AAC]]. The AudioSpecificConfig() contains the audioObjectType, that shall be set to “39” for AACELD and “23” for AACLD.</p>
<p>Example SDP for AACLD, stereo 48kHz:</p><ul class="nobullet">
<li><code>m=audio 49230 RTP/AVP 96</code>
<li><code>a=rtpmap:96 mpeg4-generic/48000/2</code>
<li><code>a=fmtp:96 streamtype=5; profile-level-id=52; mode=AAC-hbr; config=11B0; sizeLength=13; </code>
<li><code>indexLength=3; indexDeltaLength=3; constantDuration=1024</code>
<li>Note: The a=fmtp line comprises a single line in the SDP file.</ul>
<p>Example SDP for G.719, stereo 48kHz:</p><ul class="nobullet">
<li><code>m=audio 49230 RTP/AVP 96</code>
<li><code>a=rtpmap:96 G719/48000/2</code>
</ul>
</section>
</section>
</section>
</section>
</section>


<section id="rtsp"><h1>RTSP</h1>
<section id="s7-1"><h2>Protocols for IPTV Service Functions</h2>
<section id="s7-1-1"><h3>Use of RTSP for unicast content streaming services</h3>
<section id="s7-1-1-1"><h4>RTSP Profile without SIP session management over UNIS-11 and NPI-10</h4>
<p>The RTSP protocol SHALL be used on UNIS-11 and NPI-10 for unicast service setup and delivery. The OITF SHALL obtain an RTSP request URL from the content guide, prior to delivery of the media from a Cluster Controller. The use of RTSP SHALL comply with RFC 2326 [[!RTSP]] and with the following profile.</p>
<p>The following describes the RTSP Profile for this Release. The functionalities not identified in this section are out of scope of OIPF:</p><ul>
<li>NPT Range time format SHALL be supported by clients and servers, section 3.6 of [[!RTSP]].
<li>The extension mechanism using option tags in section 3.8 of [[!RTSP]] SHALL NOT be used.
<li>Since in this Release is constraint to one media stream per session (one m= line of audio/video data), then:<ul>
<li>This profile is not multi-server capable (section 1.4 of [[!RTSP]])
<li>This profile does not support aggregate control. Aggregated support allows to control several associated streams (e.g., video and sound track) using one RTSP URI.
<li>This profile does not support “pipelining” of RTSP messages, see section 9.1 of [[!RTSP]], “Pipelining.”
<li>This profile SHALL support the following MIME types:<ul>
<li>SDP (application/sdp) as the normative session description format, and
<li>The MIME type text/parameters for GET_PARAMETER 
</ul></ul>
<li>Servers SHALL NOT use RTSP proxy features 
<li>Servers SHALL NOT use encryption or authentication
</ul>
<p>The RTSP client SHALL understand the class of each status code, i.e., 1xx Information, 2xx Success, 3xx Redirection, 4xx Client Error, and 5xx Server Error. Additionally, a client SHALL understand the following status codes:</p><ul>
<li>“200”      ; OK
<li>“301”      ; Moved Permanently
<li>“302”      ; Moved Temporarily
<li>“400”      ; Bad Request
<li>“404”      ; Not Found
<li>“405”      ; Method Not Allowed
<li>“408”      ; Request Time-out
<li>“462”      ; Destination Unreachable
<li>“500”      ; Internal Server Error
<li>“501”      ; Not Implemented
</ul>
<p>Servers SHALL NOT use interleaved RTP and RTSP over TCP, as per section 10.12, “Embedded (Interleaved) Binary Data” of [[!RTSP]].</p>
<p>Clients SHALL NOT use PLAY messages in the PLAY state as keep-alives (section 10.5 of [[!RTSP]]).</p>
<p>Servers SHALL NOT use RTSP over UDP, see Appendix G of [[!RTSP]] and related functionality like the rtspu URI scheme in section 22.14.3 of [[!RTSP]].</p>
<p>Regarding the RTSP Header definitions, the client SHALL support the following headers:</p><ul>
<li>Accept, Allow, Content-Type, CSeq, Location, Public, Range, RTP-Info, Scale, Session, Transport
</ul>
<p>Additionally, the following clarifications and best practices are added:</p><ul>
<li>RTSP URIs SHALL comply to the encodings and escape conventions defined in [[!RFC3986]], which extends the encodings and conventions that were hinted at but not specified in [[!RTSP]].
<li>Regarding section 9, “Connections” of [[!RTSP]], it is RECOMMENDED that servers use persistent TCP connections. This reduces session management complexity (keep-alive, tear down, etc) in the clients and the servers. Clients SHOULD use persistent connections.
</ul>
<p>Regarding keep-alive mechanisms, the following mechanisms are RECOMMENDED in this order:</p><ul>
<li>If the OITF has agreed to send RTCP packets, it is RECOMMENDED that these be re-used to keep the RTSP session alive.
<li>If not, it is RECOMMENDED that the same empty RTP packets with payload type value 20 used for NAT traversal (see Annex F.6.2, “NAT Traversal and keep-alive messages for unicast content streaming services”) be re-used to keep the RTSP session alive.
<li>Otherwise, the SET_PARAMETER Method (or GET_PARAMETER, whichever is supported) with an empty body SHOULD be used.
</ul>
<p>Finally, the RTSP OPTIONS Method SHOULD be used.</p>
<p>Regarding section 12.17, “CSeq” of [[!RTSP]], the current best practice rules and clarifications are added were not clear in RTSP, in particular:</p><ul>
<li>If a server returns a “400 Bad Request” response because the client did not include a CSeq header, then the response SHALL NOT include a CSeq header.
<li>The CSeq header value MUST be increased by one for each new RTSP request
<li>It is RECOMMENDED that CSeq value starts at “1” (one)
</ul>
<p>Regarding non-seekable streams, Annex C.1.5 of [[!RTSP]], these are indicated by using open-ended time intervals via  a=range attribute in SDP. E.g., a=range:npt=0-</p> 
<p>Regarding Content-Length, an RTSP message with a message body SHALL include the Content-Length header. This can be misinterpreted from sections 4.3 and 12.14 of [[!RTSP]], because section 4.3 of [[!RTSP]] refers to HTTP/1.1 (which only recommends it) while section 12.14 of [[!RTSP]] clearly says that it MUST be included.</p>
<p>Regarding RTP-Info, section 12.33 of [[!RTSP]]: </p><ul>
<li>The client SHALL NOT use the RTP SSRC parameter (“ssrc:”) in a SETUP request. This is deprecated because it incompatible with the specification of RTP in RFC 3550 [[!RTP]].
<li>The URL values in the “url=” parameter SHALL be quoted, e.g.: RTP-Info: url="rtsp://live.example.com/concert/audio". This allows the URL to contain “;” and “,” characters. 
<li>If the value of the “url” parameter in RTP-Info header is a relative URI, then the Request-URI is used as base URI. If it is an absolute URI, then this URI is the same as in the SETUP message.
</ul>
<section id="s7-1-1-1-1"><h5>RTSP Session Setup</h5>
<p>When performing RTSP session setup, the OITF SHALL use the request URL to send a DESCRIBE message to the Cluster Controller to obtain a media SDP. The DESCRIBE message SHALL include the Accept header with the application/sdp content type.  The Cluster Controller or CDF SHALL return a Content-Type header with application/sdp and the format of the body SHALL be according to RFC 4566 [[!SDP]] unless there is redirection of DESCRIBE or SETUP. The OITF SHALL then issue a SETUP request to the Cluster Controller.</p>
<p>If the Cluster Controller can handle the request, the DESCRIBE and SETUP messages SHALL be forwarded to the most appropriate CDF.</p>
<p>If the Cluster Controller cannot handle the request, the Cluster Controller SHALL reply with a redirect response (Moved) message containing a URL of another Cluster Controller. The redirection MAY occur when receiving either a DESCRIBE or a SETUP.</p>
<p>If the Cluster Controller sends a redirect response to the SETUP request, the OITF MAY send a new DESCRIBE request.</p>
<p>If the setup is successful the CDF SHALL reply with a 200 OK message that SHALL be proxied by the Cluster Controller to the OITF. After receiving the setup response the OITF MAY send PLAY and PAUSE messages to the Cluster Controller.</p>
<p>The Cluster Controller SHALL modify the RTSP URL to forward the RTSP messages to the chosen CDF function, when the messages are initiated from the OITF.</p>
<p>When receiving error messages from the CDF, the Cluster Controller SHALL either forward them to the OITF or try another CDF.</p>
<p>When the OITF receives an error message, it MAY display appropriate messages to the end user. The error messages MAY also be handled by the downloaded DAE or native application before being displayed to the user.</p>
</section>
<section id="s7-1-1-1-2"><h5>RTSP Control for media delivery</h5>
<section id="s7-1-1-1-2-1"><h6>Handling of Media Control for Starting Playback</h6>
<p>On receiving a request from the user to start playback, the OITF SHALL send an RTSP PLAY message to the Cluster Controller.</p>
<p>The RTSP fields in the RTSP PLAY message SHALL be filled as follows:</p><ul>
<li>On receiving a request from the user to modify the playback, the OITF SHALL send an RTSP PLAY message with a request to modify the position, speed and/or direction of playback. The OITF indicates the direction and/or speed of playback by including a Scale header or changes the position of playback by including a Range header.
</ul>
<p>The Scale header SHALL be set as follows:</p><ul>
<li>1 indicates normal play;
<li>If not 1, the value corresponds to the rate with respect to normal viewing rate;
<li>A negative value indicates reverse direction.
</ul>
<p>If the request is to pause the playback, the OITF SHALL send an RTSP PAUSE message.</p>
<p>On receipt of a RTSP PLAY or PAUSE request, the Cluster Controller SHALL forward the message to the chosen CDF.</p>
<p>The CDF SHALL respond with a 200 OK message. The contents of the 200 OK response SHALL be as follows:</p><ul>
<li>CSeq SHALL be set to the same value as that in the request.
</ul>
</section>
<section id="s7-1-1-1-2-2"><h6>Handling of Media Control for Retrieving Playback Information</h6>
<p>For OITF devices that require retrieving the position and the duration parameter from the server for operational reasons, the OITF SHALL support the method GET_PAREMETER message for that purpose.</p>
<p>All OITF devices SHALL support the retrieval from the server of the scales parameter through the GET_PARAMETER message.</p>
<p>Any other parameter not supported by the Cluster Controller used in the GET_PARAMETER request SHALL be rejected by the Cluster Controller with an appropriate error code. An empty body SHALL be allowed for the RTSP keep-alive message.</p>
<p>If RTSP is used as a keep-alive, then the timeout for sending the request is based on the timeout parameter specified in the session header in the RTSP SETUP response. If timeout parameter is not specified then a default value of 60 seconds SHALL be used.</p>
<p>On receipt of the RTSP GET_PARAMETER request, the Cluster Controller SHALL forward the message to the chosen CDF.</p>
<p>The CDF SHALL respond with a 200 OK message with the requested values or empty in the case of a keep-alive message. The message SHALL be forwarded to the OITF.</p>
</section>
<section id="s7-1-1-1-2-3"><h6>Handling of Beginning and End of Stream</h6>
<p>On receipt of the beginning-of-stream or end-of-stream indication from the CDF, the Cluster Controller MAY send an RTSP ANNOUNCE to the OITF with an indication that the beginning-of-stream or end-of-stream has been reached. The Notice header SHALL be included with the notice code value set to “2104 Start-of-Stream Reached” or “2101 End of Stream Reached”.</p>
<p>Note: The header and code is based on [[!RTSP2-AN]].</p>
<p>On receipt of the RTSP ANNOUNCE with an end-of-stream or beginning-of-stream indication, the OITF MAY take relevant actions to handle the event (e.g. terminating the session, rewinding the media stream, etc.). The OITF SHALL respond with a RTSP 200 OK.</p>
</section>
<section id="s7-1-1-1-2-4"><h6>Handling by the CDF for multiple PLAY messages in Play state</h6>
<p>The CDF SHALL NOT queue successive PLAY messages for processing while in a play state. An incoming new PLAY message SHALL result in an immediate termination by the CDF of the processing associated with a previous pending PLAY message if applicable.</p></section>
<section id="s7-1-1-1-2-5"><h6>Handling of CDF-initiated session termination</h6>
<p>If the CFD detects an event that leads it to have to terminate a user session, the CDF SHALL send an RTSP ANNOUNCE to the cluster controller with an indication that the session SHALL be terminated. The Notice header SHALL be included with the notice code value set to “5402 Client Session Terminated”.  The cluster controller SHALL forward the message to the OITF, and return an RTSP 200 OK to the CDF.</p>
<p>Note: The header and code is based on [[!RTSP2-AN]].</p>
<p>On receipt of the RTSP ANNOUNCE with a client session terminate indication, the OITF SHALL return an RTSP 200 OK then proceed to terminate the session in accordance with section <a href="#s7-1-1-1-3" class="sectionRef">7.1.1.1.3</a>, “<a href="#s7-1-1-1-3" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s7-1-1-1-2-6"><h6>Handling of Cluster Controller-initiated session termination</h6>
<p>If the Cluster controller detects an event that leads it to have to terminate a user session, the cluster controller SHALL send an RTSP ANNOUNCE to the OITF with an indication that the session SHALL be terminated. The Notice header SHALL be included with the notice code value set to “5402 Client Session Terminated”.  </p>
<p>Note: The header and code is based on [[!RTSP2-AN]].</p>
<p>On receipt of the RTSP ANNOUNCE with a client session terminate indication, the OITF SHALL return an RTSP 200 OK then proceed to terminate the session in accordance with section <a href="#s7-1-1-1-3" class="sectionRef">7.1.1.1.3</a>, “<a href="#s7-1-1-1-3" class="sectionTitleRef"></a>”.</p>
</section>
</section>
<section id="s7-1-1-1-3"><h5>RTSP Session Teardown</h5>
<p>To tear down a unicast session, the OITF SHALL use a RTSP TEARDOWN message and SHALL wait for a 200 OK response from the Cluster Controller. The Cluster Controller SHALL relay the RTSP TEARDOWN message to the CDF and relay the 200 OK message to the OITF.</p>
</section>
<section id="s7-1-1-1-4"><h5>Supported RTSP Messages</h5>
<p>The OITF acting as an RTSP Client and the Cluster Controller acting as an RTSP Server SHALL support at least the following messages: RTSP SETUP, RTSP TEARDOWN, RTSP DESCRIBE, RTSP PLAY, RTSP PAUSE, RTSP GET_PARAMETER, RTSP ANNOUNCE, and RTSP OPTIONS.</p>
<p>The CDF as an RTSP server SHALL support at least the following messages: RTSP SETUP, RTSP TEARDOWN, RTSP DESCRIBE, RTSP PLAY, RTSP PAUSE, RTSP OPTIONS, and RTSP GET_PARAMETER.</p>
</section>
</section>
<section id="s7-1-1-2"><h4>RTSP profile with SIP session management over UNIS-11 and NPI-10</h4>
<p>The RTSP protocol SHALL be used on NPI-10 for unicast content streaming session setup and UNIS-11 and NPI-10 for unicast content streaming service delivery.</p>
<p>The OITF SHALL obtain the appropriate RTSP request URI, RTSP session ID, and the RTP media parameters, prior to content delivery from the assigned Cluster Controller.</p>
<p>If the OITF supports RTSP/RTCP monitoring, it SHALL also include the a=OIPF-QoS-Metrics line, the a=rtcp-xr line and the b=RR line prior to content delivery from the assigned CC, where:</p><ul>
<li>The a=OIPF-QoS-Metrics line includes information on the cumulative performance metrics the Service Provider requests from the client for that session (see section <a href="#s7-2-1" class="sectionRef">7.2.1</a>, “<a href="#s7-2-1" class="sectionTitleRef"></a>.”).
<li>The a=rtcp-xr line includes information on the sample performance metrics the Service Provider requests from the client for that session (see section <a href="#s9-2-1" class="sectionRef">9.2.1</a>, “<a href="#s9-2-1" class="sectionTitleRef"></a>.”)
<li>Finally, the b=RR line specifies the reporting bandwidth assigned to the OITF in bits per second, see <a href="https://tools.ietf.org/html/rfc3556#section-2" class="extRef">section 2</a> of RFC 3556 [[!SDP-RTCP]].  If this line is not retrieved via SIP OPTIONS, then the OITF SHALL use the RTP default of 5% of the stream bandwidth for RTCP reports.
</ul>
<p>The use of RTSP SHALL comply with RFC 2326 [[!RTSP]] with modifications defined by this specification.</p>
<p>Guidelines for specifying cumulative metrics to be conveyed using the RTSP Headers defined in [[.OIPF_PROT_EX2]]. Similarly to the RTCP case, “OIPF-BasicPerfMonCumulSubset1” is used in this specification as a placeholder and for illustrative purposes.</p>

<section id="s7-1-1-2-1"><h5>Missing SDP parameters Retrieval</h5>
<p>When the Cluster controller receives a SIP OPTIONS message to retrieve missing parameters, it SHALL send an RTSP DESCRIBE message to an appropriate CDF. The “Accept” header SHALL be set to “application/sdp”.</p>
<p>The CDF SHALL reply with a RTSP 200 OK message with the Content-type header set to “application/sdp”.</p>
<p>If the CDF replied with a redirection response, the Cluster Controller SHALL send a new RTSP DESCRIBE to the new CDF.</p>
<p>If the Cluster Controller failed to successfully complete the RTSP DESCRIBE transaction, it SHALL return an appropriate error message to the SIP OPTIONS message.</p>
</section>
<section id="s7-1-1-2-2"><h5>RTSP Session Setup</h5>
<p>The OITF SHALL NOT use the RTSP SETUP message. The RTSP session setup is initiated with a SIP INVITE.</p>
<p>When receiving a COD session initiation SIP request from the CDN Controller, the Cluster Controller SHALL choose the appropriate CDF and issue an RTSP SETUP message with the following parameters:</p><ul>
<li>The RTSP URI SHALL have a path that is compatible with the requested content indicated in the user part of the “To:” header of the SIP message.
<li>The Transport header SHALL contain a “Destination” sub header indicating the IP address of the OITF.
The CDF SHALL reply with an RTSP 200 OK message to the Cluster Controller.
<li>The message SHALL contain an RTSP session ID.
<li>The CSeq SHALL be set to the same value as in the RTSP SETUP request
</ul>
<p>If the Cluster Controller receives an error message from the CDF, it MAY try another CDF. It MAY also reply with the appropriate SIP error message to the CDN Controller (see section <a href="#s6-1-2-1-3" class="sectionRef">6.1.2.1.3</a>, “<a href="#s6-1-2-1-3" class="sectionTitleRef"></a>.”)</p>
<p>The Cluster Controller SHALL issue a SETUP request for each media line (if the content is FEC protected).</p>
<p>If the new CDF sends a redirect response to the SETUP request, the Cluster Controller SHALL send a new SETUP request to the new CDF.</p>
<p>If the Cluster Controller failed to successfully complete the RTSP SETUP transaction, it SHALL return an appropriate error message to the SIP INVITE.</p>
</section>
<section id="s7-1-1-2-3"><h5>RTSP Control for media delivery</h5>
<section id="s7-1-1-2-3-1"><h6>Handling of Media Control for Starting Playback</h6>
<p>On receiving a request from the user to start playback, the OITF SHALL follow the procedures defined in [[!TS183063]] section 7.1.1.2 with the OITF acting as a UE and the Cluster Controller acting as a MCF.</p>
</section>
<section id="s7-1-1-2-3-2"><h6>Handling of Media Control for Modifying Playback</h6>
<p>On receiving a request from the user to modify playback, the OITF SHALL follow the procedures defined in [[!TS183063]] section 7.1.1.3 with the OITF acting as a UE and the Cluster Controller acting as a MCF.</p>
<p>On receipt of a RTSP PLAY or PAUSE request, the Cluster Controller SHALL forward the message to the chosen CDF.</p>
<p>The CDF SHALL respond with a 200 OK message. The contents of the 200 OK response SHALL be as follows:</p><ul>
<li>CSeq SHALL be set to the same value as that in the request.
</ul>
</section>
<section id="s7-1-1-2-3-3"><h6>Handling of Media Control for Retrieving Playback Information</h6>
<p>On receiving a request from the user to retrieve playback information, the OITF MAY send an RTSP GET_PARAMETER message. The OITF MAY retrieve the following information:</p><ul>
<li>position<br />The position in the media in seconds.
<li>scales<br />The allowed scales that can be used in the PLAY request. Syntax SHALL be a comma separated array of allowed scales.
<li>duration
</ul>
<p>The total duration in seconds of the media to be played.</p>
<p>Any other parameter not supported by the Cluster Controller used in the RTSP GET_PARAMETER request SHALL be rejected by the Cluster Controller with an appropriate error code. An empty body SHALL be allowed for the RTSP keep alive message.</p>
<p>On receipt of the RTSP GET_PARAMETER request, the Cluster Controller SHALL forward the message to the chosen CDF.</p>
<p>The CDF SHALL respond with a 200 OK message with the requested values. The message SHALL be forwarded to the OITF.</p>
</section>
<section id="s7-1-1-2-3-4"><h6>Handling of Beginning and End of Stream</h6>
<p>On receipt of the beginning-of-stream or end-of-stream indication from the CDF, the Cluster Controller MAY send an RTSP ANNOUNCE to the OITF with an indication that the beginning-of-stream or end-of-stream has been reached. The “Notice” header SHALL be included with the notice code value set to “2104 Start-of-Stream-Reached” or “2101 End-of-Stream Reached”.</p>
<p>Note: The header and code is based on [[!RTSP2-AN]]. Note that the RTSP version used in this specification is “1.0” and not “2.0” as in the examples in [[!RTSP2-AN]].</p>
<p>On receipt of the RTSP ANNOUNCE with a beginning of stream or an end-of-stream indication, the OITF MAY take relevant actions to handle the end of stream event (e.g. terminating the session, rewinding the media stream, etc.). The OITF SHALL respond with a RTSP 200 OK.</p>
</section>
<section id="s7-1-1-2-3-5"><h6>Handling of CDF-initiated session termination</h6>
<p>If the CDF detects an event that leads it to have to terminate a user session, the CDF SHALL send an RTSP ANNOUNCE to the cluster controller with an indication that the session SHALL be terminated. The Notice header SHALL be included with the notice code value set to “5402 Client Session Terminated”.  The cluster controller SHALL perform the following:</p><ul>
<li>Return an RTSP 200 OK to the CDF,
<li>Proceed to tear down the RTSP session in accordance with section <a href="#s7-1-1-1-3" class="sectionRef">7.1.1.1.3</a>, “<a href="#s7-1-1-1-3" class="sectionTitleRef"></a>” and where the cluster controller plays the role of the OITF,
<li>Proceed to tear down the IMS session with the CDNCF.
</ul>
</section>
<section id="s7-1-1-2-3-6"><h6>Handling of Cluster Controller-initiated session termination</h6>
<p>If the Cluster controller detects an event that leads it to have to terminate a user session, the Cluster controller SHALL perform the following:</p><ul>
<li>Proceed to tear down the RTSP session in accordance with section <a href="#s7-1-1-1-3" class="sectionRef">7.1.1.1.3</a>, “<a href="#s7-1-1-1-3" class="sectionTitleRef"></a>” and where the cluster controller plays the role of the OITF,
<li>Proceed to tear down the IMS session with the CDNCF.
</ul>
</section>
</section>
<section id="s7-1-1-2-4"><h5>RTSP Session Teardown</h5>
<p>The OITF SHALL NOT use the RTSP TEARDOWN message. The RTSP session teardown is initiated via SIP.</p>
<p>When the Cluster Controller receives a SIP BYE message to teardown a SIP unicast content streaming session, the Cluster Controller SHALL send a RTSP TEARDOWN message to the CDF. The CDF SHALL reply with a 200 OK.</p>
<p>The Cluster Controller SHALL issue an RTSP TEARDOWN request for each media line (if the content is FEC protected).</p>
</section>
<section id="s7-1-1-2-5"><h5>RTSP Messages supported</h5>
<p>The OITF acting as an RTSP Client SHALL support RTSP PLAY, RTSP PAUSE, RTSP GET_PARAMETER, RTSP ANNOUNCE, and RTSP OPTIONS.</p>
<p>The Cluster Controller acting as an RTSP Proxy and RTSP Client SHALL support at least the following messages: RTSP SETUP, RTSP TEARDOWN, RTSP DESCRIBE, RTSP PLAY, RTSP PAUSE, RTSP OPTIONS, and RTSP GET_PARAMETER.</p>
<p>The CDF acting as an RTSP server SHALL support at least the following messages: RTSP SETUP, RTSP TEARDOWN, RTSP DESCRIBE, RTSP PLAY, RTSP PAUSE, RTSP OPTIONS, and RTSP GET_PARAMETER.</p>
</section>
</section>
</section>
<section id="s7-1-2"><h3>Use of RTSP for Forced Play Out Control</h3>
<section id="s7-1-2-1"><h4>RTSP for managed model over UNIS-11 and NPI-10</h4>
<p>The RTSP/RTCP monitoring, RTSP session setup and teardown procedures are unchanged by Forced Play Out and SHALL follow the description in section <a href="#s7-1-1" class="sectionRef">7.1.1</a>, “<a href="#s7-1-1" class="sectionTitleRef"></a>”.</p>
<section id="s7-1-2-1-1"><h5>RTSP Control for media delivery</h5>
<section id="s7-1-2-1-1-1"><h6>Forced Play Out Controlled by the Cluster Controller</h6>
<p>On receiving a request from the user to control the playback (e.g. RTSP PLAY, PAUSE, etc), the OITF SHALL follow the procedures specified in section <a href="#s7-1-1-2-3" class="sectionRef">7.1.1.2.3</a>, “<a href="#s7-1-1-2-3" class="sectionTitleRef"></a>.”</p>
<p>On receiving a request from the user to control the playback (e.g. RTSP PLAY, PAUSE, etc), the Cluster Controller SHALL examine the request to see whether the playback operation is permitted based on the Forced Play Out Control policy. If the requested playback operation is forbidden by the policy -- for example, the user tries to fast forward when an advertisement is showing -- the Cluster Controller SHALL disable the request and respond with a RTSP 405 message. If the playback is permitted, the Cluster Controller SHALL forward the request to the selected CDF.</p>
<p>The CDF SHALL respond with a 200 OK message. The contents of the 200 OK response SHALL be as follows:</p><ul>
<li>CSeq SHALL be set to the same value as that in the request.
</ul>
<p>Handling of Media Control for Retrieving Playback Information is the same as specified in section <a href="#s7-1-1-2-3" class="sectionRef">7.1.1.2.3</a>, “<a href="#s7-1-1-2-3" class="sectionTitleRef"></a>.”</p>
<p>Handling of End of Stream is not affected by Forced Play Out and is the same as specified in section <a href="#s7-1-1-2-3" class="sectionRef">7.1.1.2.3</a>, “<a href="#s7-1-1-2-3" class="sectionTitleRef"></a>.”</p>
</section>
</section>
</section>
</section>
<section id="s7-1-3"><h3>Use of RTSP for Network PVR (nPVR)</h3>
<section id="s7-1-3-1"><h4>RTSP Session Setup</h4>
<p>When performing recording, the Cluster Controller SHALL first retrieve from the incoming request the SDP of the scheduled content program and then issue a DESCRIBE messages to the most appropriate CDF. The DESCRIBE message SHALL include the Accept header with the application/sdp content type.  The CDF SHALL return a Content-Type header with application/sdp and the format of the body SHALL be according to RFC 4566 [[!SDP]]. The Cluster Controller SHALL then issue a SETUP request to CDF. The CDF then SHALL join the multicast group as defined in section <a href="#s8-1-3-1" class="sectionRef">8.1.3.1</a>, “<a href="#s8-1-3-1" class="sectionTitleRef"></a>”.</p>
<p>If the setup is successful the CDF SHALL reply with a 200 OK message to the Cluster Controller. </p><ul>
<li>The message SHALL contain a RTSP Server port and a RTSP session ID.
<li>The CSeq SHALL be set to the same value as in the RTSP SETUP request
</ul>
<p>After receiving the setup response, the Cluster Controller SHALL send RECORD message to the CDF. Then the CDF start recording the content. When receiving error messages from the CDF, the Cluster Controller SHALL try another CDF.</p>
</section>
<section id="s7-1-3-2"><h4>Handling of End of Recording</h4>
<p>When finishing the recording, the CDF SHALL issue a RTSP ANNOUNCE message to the Cluster Controller to report the record result.</p> 
<p>Within the message body, the CDF SHALL include a body associated with the appid “urn:oipf:npvr:report:2009”. The parameters SHALL be set:</p><ul>
<li>Result: the result of the recording (i.e. Completed, Error).
<li>CRID: the identifier reference to the recorded content, for OITF to request later.
<li>Spare: the spare storage existing in the CDF.
</ul>
</section>
<section id="s7-1-3-3"><h4>RTSP Session Teardown</h4>
<p>When the Cluster Controller receives a SIP BYE message to tear down a SIP nPVR session, the Cluster Controller SHALL issue a RTSP TEARDOWN message to the CDF. The CDF SHALL reply with a 200 OK.</p>
</section>
</section>
<section id="s7-1-4"><h3>Use of RTSP for Personalized Channel</h3>
<section id="s7-1-4-1"><h4>RTSP Session Setup for PCh</h4>
<p>When receiving a PCh session initiation SIP INVITE from the CDN Controller, the Cluster Controller SHALL choose the appropriate CDF and SHALL issue an RTSP SETUP message with the following parameters:</p><ul>
<li>The RTSP URI SHALL contain a path that is compatible with the requested PCh item indicated in the user part of the “To:” header of the SIP message.
<li>The Transport header SHALL contain a “Destination” sub header indicating the IP address of the OITF if the content item is unicast content service, if the content item is multicast content service, this header SHALL indicate the multicast address related to the content service.
</ul>
<p>On reception of RTSP SETUP message, the CDF SHALL reply with an RTSP 200 OK message to the Cluster Controller.</p><ul>
<li>The message SHALL contain an RTSP session ID.
<li>The CSeq SHALL be set to the same value as in the RTSP SETUP request
</ul>
<p>If the requested PCh item is a multicast content service and the CDF doesn’t cache the content, the CDF MAY fetch the content, e.g., join the associated multicast group and fetch the content using IGMPv3 as described in RFC 3376 [[!IGMP3]].</p>
</section>
<section id="s7-1-4-2"><h4>RTSP PLAY for PCh content switch</h4>
<p>When receiving a PCh content switch request SIP MESSAGE from the CDN Controller, the Cluster Controller SHALL issue an RTSP PLAY message to the same CDF as selected in the PCh session initiation, with the following parameters:</p><ul>
<li>The RTSP URI SHALL contain a path that is compatible with the ContentId that is carried in the SIP INFO message body.
<li>The session ID SHALL be set to identically to that of the RTSP SETUP request.
<li>The Transport header SHALL contain a “Destination” sub header indicating the IP address of the OITF if the content item is unicast content service, if the content item is multicast content service, this header SHALL indicae the multicast address related to the content service.
</ul>
<p>On reception of RTSP PLAY message, the CDF SHALL reply with an RTSP 200 OK message to the Cluster Controller.</p><ul>
<li>The message SHALL contain the same session ID as the RTSP SETUP.
<li>The CSeq SHALL be set to the same value as in the RTSP SETUP request
</ul>
<p>If the requested PCh item is multicast content service and the CDF doesn’t cache the content, the CDF MAY fetch the content, e.g., join the associated multicast group and fetch the content using IGMPv3 as described in RFC 3376 [[!IGMP3]].</p>
</section>
</section>
<section id="s7-1-5"><h3>Content Streaming Post Session Transfer</h3>
<p>The following procedure SHALL be undertaken by a transferee OITF to view the unicast content service, once it has successfully established the unicast content service session to handle the transfer:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>If the transferee OITF has the content bookmark, it SHALL send the RTSP PLAY to the CC/CDF and the bookmark SHALL be added in the Range header to indicate the content start time to be played. The CC/CDF SHALL send the related content through the content delivery channel established in the unicast content service session to the transferee OITF. The procedures in sections <a href="#s7-1-1-2-3" class="sectionRef">7.1.1.2.3</a>, “<a href="#s7-1-1-2-3" class="sectionTitleRef"></a>” and <a href="#s7-1-1-2-4" class="sectionRef">7.1.1.2.4</a>, “<a href="#s7-1-1-2-4" class="sectionTitleRef"></a>” for media control purposes can be reused and this procedure terminates.</td></tr>
<tr><td class="label">Step 2:</td><td>If the transferee OITF does not have the content bookmark, it can use the procedure defined in section <a href="#s5-3-9-4-1" class="sectionRef">5.3.9.4.1</a>, “<a href="#s5-3-9-4-1" class="sectionTitleRef"></a>” to retrieve the content bookmark, and subsequently it can use the procedure defined in Step 1.</td></tr>
</table>
</section>
</section>
<section id="s7-2"><h2>Protocols for Service Access and Control</h2>
<section id="s7-2-1"><h3>Performance Monitoring over UNIT-18</h3>
<p><i>QoS metrics</i> can be classified as those that need to be reported regularly, i.e. ‘sample metrics’, and those that are typically REQUIRED when the service ends, i.e., ‘cumulative metrics’. Periodic RTCP reports are more appropriate for transport of sample metrics (see section <a href="#s9-2-1" class="sectionRef">9.2.1</a>, “<a href="#s9-2-1" class="sectionTitleRef"></a>”), while on-demand or scheduled RTSP reports are especially suitable for transport of cumulative metrics. In general, an IPTV service might need a combination of both.</p>
<p>This section specifies the OPTIONAL RTSP mechanisms for performance monitoring of unicast content streaming services.</p>
<p>If the OITF supports QoS metrics and has been suitably configured to use them, then the unicast content streamign session initiation request over HNI-IGI interface SHALL include the selected (i.e. accepted by client) or modified (for re-negotiation) QoS metrics for either the session level or media level.</p>
<p>The <i>QoS metrics</i> negotiation SHALL start at the Cluster Controller (CC) on reception of a response to an RTSP DESCRIBE including metrics information embedded in the session description. The RTSP DESCRIBE at the CC is triggered by a SIP OPTIONS request for missing parameters from the CDN Controller, as per section <a href="#s7-1-1-2-2" class="sectionRef">7.1.1.2.2</a>, “<a href="#s7-1-1-2-2" class="sectionTitleRef"></a>.”</p>
<p>On receiving this SETUP request, the Content Delivery Function (CDF) SHALL return the RTSP 200 OK response with the “accepted” QoS metrics (i.e. metrics and reporting values which are identical to the ones in the client’s request and accepted by the CDF) and the “re-negotiation” QoS metrics (i.e. metrics and reporting values which are not identical to the ones in the client’s request and modified for re-negotiation by the CDF). The echoing of the “accepted” QoS metrics is for re-acknowledging the client’s request.</p>
<p>The CDF MAY also reject the changes made by the client, i.e. reject the “re-negotiation” of QoS metrics. If the CDF rejects the changes, it SHALL either set new values and resend the modified metrics back to the client, or it SHALL ignore the “re-negotiation” metrics and not re-acknowledge them. Any QoS metric that has been acknowledged as “accepted” by the CDF SHALL NOT be re-negotiated, i.e., it SHALL NOT be resent in the “OIPF-QoS-Metrics” header in the next RTSP request and SHALL NOT be re-acknowledged in the next RTSP response.</p>
<p>If the CDF does not approve the modifications made by the client, they SHOULD continue to re-negotiate. However, negotiations SHOULD NOT exceed 4 round trips, in order to minimize the potential delay of the negotiation process. The negotiation process MAY delay the start-up of the service and it MAY be avoided by carefully selecting the value of the <i>Metrics-Set</i> parameter in the service information. It MUST be noted that each time the “QoS-Metrics” header field is sent in an RTSP request, it SHALL also be present in the response corresponding to that particular request. Otherwise, the receiver of the response SHALL assume that the other end does not support QoS metrics.</p>
<p>If there is no DESCRIBE request-response pair sending at the beginning of the RTSP session between the CC and the CDF, it means that the session description is received by other means. If such a description contains the “OIPF QoS Metrics” attribute, the negotiation starts at the CC with a SETUP request containing the “OIPF QoS Metrics” header.</p>
<p>If the session description does not contain the “OIPF-QoS-Metrics” attribute and the CDF would still like to check whether the client supports the QoS Protocol or not, the CDF SHALL include the “OIPF-QoS-Metrics” header containing the initial QoS metrics in the SETUP response. If the OITF sends the QoS metrics information in the next request (indicating that it supports the QoS Protocol), the negotiation SHALL continue until a mutual agreement is reached or the negotiation limit of 4 round-trips is reached.</p>
<p>To inform the client of the CDF’s desire to receive reports for the session, a new SDP attribute is specified to convey the QoS metrics. This attribute is defined inline with section 5.3.3.6 of TS26.234v750 [[!PSS]].</p>
<p>The ABNF definition (See RFC 4234 [[ABNF]]) is as follows:</p>
<pre class="abnf">
OIPF-QoS-Metrics-Att = “a=” “OIPF-QoS-Metrics” “:”  Measure-Spec *(“,” Measure-Spec) CRLF
  Measure-Spec = ”Metrics “;” Sending-rate [”;” Measure-Range] *([”;” Parameter-Ext])
  Metrics = “cumul-metrics” “=” Metrics-Set / (“{” Metrics-Name *(“|” Metrics-Name) “}”)
  Metrics-Name =  1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a) / 0x7e) ;VCHAR except “;”, “,”, “{“ or ”}”
  Metrics-Set = 1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a) / 0x7e) ;VCHAR except “;”, “,”, “{“ or ”}”
  Sending-Rate = “rate” “=” 1*DIGIT / “End”
  Measure-Range = “range” “:” Ranges-Specifier
  Parameter-Ext = “On”/”Off”/ (1*DIGIT [“.” 1*DIGIT]) / (1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a)
                   / 0x7c / 0x7e))
  Ranges-Specifier = as defined in RFC 2326 [RTSP]
  CRLF = %d13.10
</pre>
<p>This specification defines two new RTSP Headers to negotiate and report the ‘cumulative metrics’ during session setup. These new RTSP headers follow the semantics of [[!PSS]], and are accordingly called <i>OIPF-QoS-Metrics</i> and <i>OIPF-QoS-Feedback</i>. They SHALL be used as follows:</p><ul>
<li><i>OIPF-QoS-Metrics</i> SHALL be used for setting up and controlling the reporting of cumulative metrics, i.e. turn on/off reporting, negotiate the set of metrics, its frequency and the report range. This header can be sent in requests and responses of the RTSP Methods SETUP, SET_PARAMETER, OPTIONS (with Session ID) and PLAY. The OITF SHOULD use the OPTIONS (with Session ID) or SET_PARAMETER RTSP methods to turn off the QoS feedback.
<p>The ABNF [[ABNF]] definition is as follows:</p>
<pre class="abnf">
QoS-Header = “OIPF-QoS-Metrics” “:” (“Off” / Measure-Spec *(“,” Measure-Spec)) CRLF
  Measure-Spec = Stream-URL ”;” ((Metrics “;” Sending-rate [”;” 
                   Measure-Range] *([”;” Parameter-Ext])) / “Off”)
  Stream-URL = “url” “=”  &lt;”&gt;Rtsp-URL&lt;”&gt;
  Metrics = “cumul-metrics” “=” Metrics-Set / (“{” Metrics-Name *(“|” Metrics-Name) “}”)
  Metrics-Set = 1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a) / 0x7e) ;VCHAR except “;”, “,”, “{“ or ”}”
  Metrics-Name = 1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a) / 0x7e) ;VCHAR except “;”, “,”, “{“ or ”}”
  Sending-Rate = “rate” “=” 1*DIGIT / “End”
  Measure-Range = “range” “:” Ranges-Specifier
  Parameter-Ext = “On”/”Off”/ (1*DIGIT [“.” 1*DIGIT]) / (1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a) /
                    0x7c / 0x7e))
  Ranges-Specifier = as defined in RFC 2326 [RTSP]
  Rtsp-URL = as defined in RFC 2326 [RTSP]
  CRLF = %d13.10
</pre>
<li><i>OIPF-QoS-Feedback</i> SHALL be used for sending (or requesting) the actual QoS metrics feedback to (or from) the CDF. This header can be sent in requests and responses of the following RTSP Methods: SET_PARAMETER (or GET_PARAMETER), or PAUSE Methods.
<p>The ABNF [[ABNF]] definition is as follows:</p>
<pre class="abnf">
Feedback-Header = “OIPF-QoS-Feedback” “:” Feedback-Spec *(“,” Feedback-Spec) CRLF
  Feedback-Spec = Stream-URL “;” 1*(“;” Parameters) [”;” Measure-Range]
  Stream-URL =  “url” “=”  &lt;”&gt;Rtsp-URL&lt;”&gt;
  Metrics-Set = 1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a) / 0x7e) ;VCHAR except “;”, “,”, “{“ or ”}”
  Parameters = Metrics-Name “=” “{” SP / (Measure *(“|” Measure)) “}”
  Metrics-Name = “1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a) / 0x7e) ;VCHAR except “;”, “,”, “{“ or ”}”
  Rtsp-URL = as defined in RFC 2326 [RTSP]
  Measure-Range =  “range” “:” Ranges-Specifier
  Ranges-Specifier = as defined in RFC 2326 [RTSP]
  Measure = Value [SP Timestamp]
  Value = ([”-“]1*DIGIT [”.” *DIGIT]) /  1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a)  / 0x7e) 
            ; VCHAR except “;”, “,”, “{“ or ”}”
  Timestamp = NPT-Time
  NPT-Time = as defined in RFC 2326 [RTSP]
  CRLF = %d13.10
</pre>
</ul>
<p>The OITF SHALL use the SET_PARAMETER method for cumulative QoS metrics reporting, using the OIPF-QoS-Feedback Header defined in this specification. However, in some cases, the RTSP method MAY also be used:</p><ul>
<li>When the client wants to pause the streaming flow, the QoS information SHOULD be embedded into a PAUSE method. The OITF SHOULD NOT send any QoS reports to the CDF when the media stream is paused, as no media is being exchanged.
</ul>
<p>The reporting CDF SHALL use the GET_PARAMETER method for retrieving cumulative QoS metrics from the OITF on-demand, using the OIPF-QoS-Feedback Header defined in this specification.</p>
<p>The RTSP header and attribute definitions above are almost identical to those in [[!PSS]]. The semantics SHALL comply with section 5.3.2.3 except for the differences in naming and the following Open IPTV Forum specific changes:</p><ul>
<li>There is a possibility to simplify the request and reporting of a (potentially large) set of metrics by introducing a <i>Metrics-Set</i> attribute in the <i>OIPF-QoS-Metrics</i> and <i>OIPF-QoS-Feedback</i> headers. i.e., the <i>Metrics-Set</i> attribute MAY be used instead of listing each metric explicitly, as these would have empty values during the metrics negotiation phase anyway; this makes messages more compact when the number is large.
</ul>
<p>Note the commonalities between the definition of the RTSP Header OIPF-QoS-Metrics and the SDP attribute above. Note also, that the Stream-URL is not present in the SDP attribute; this is because the value of the Stream-URL is present in the session description and is thus known by the CC at the time of issuing the RTSP SETUP for each media line.</p>
</section>
</section>
</section>



<section id="igmp"><h1>IGMP and Multicast Protocol</h1>
<p>This section defines the protocol for the use of IGMP and Multicast over the following reference points:</p><ul>
<li>UNIS-13
<li>UNIS-7
<li>UNIS-15
<li>UINS-RMS
<li>UNIS-6
<li>UNIS-12
<li>NPI-40
</ul>
<section id="s8-1"><h2>Protocols for IPTV Service Functions</h2>
<section id="s8-1-1"><h3>Multicast content streaming service on UNIS-13</h3>
<p>The OITF SHALL support IGMPv3 as described in RFC 3376 [[!IGMP3]]. If the Transport Processing Function supports a lower IGMP version, the backward compatibility rules between the OITF and the Transport Processing Function SHALL conform to [[!IGMP3]] <a href="https://tools.ietf.org/html/rfc3376#section-7" class="extRef">section 7</a>.</p>
<section id="s8-1-1-1"><h4>Procedure for multicast content streaming with SIP session management</h4>
<p>The use of IGMP on UNIS-13 with SIP session management SHALL be as defined in [[!TS183063]] sections 8.1.2 and 8.2, where the OITF replaces the UE, the Transport Processing Function replaces the Transport Functions, the BTF replaces the ECF/EFF and the Service Discovery FE/IPTV Metadata Control FE replaces the SSF.</p>
</section>
<section id="s8-1-1-2"><h4>Procedure for multicast content streaming</h4>
<p>The use of IGMP on UNIS-13 without session initiation SHALL be as defined in section <a href="#s8-1-1-1" class="sectionRef">8.1.1.1</a>, “<a href="#s8-1-1-1" class="sectionTitleRef"></a>”.
In the case there is no session initiation, the procedures described in section 8.1.2 of [[!TS183063]] to set the Group/Multicast Address Records will not retrieve any channel or source address information from the session initiation step.</p>
</section>
<section id="s8-1-1-3"><h4>Procedure for multicast RET</h4>
<p>The use of IGMP on UNIS-13 SHALL be defined as in section <a href="#s8-1-1-1" class="sectionRef">8.1.1.1</a>, “<a href="#s8-1-1-1" class="sectionTitleRef"></a>” or as defined in section <a href="#s8-1-1-2" class="sectionRef">8.1.1.2</a>, “<a href="#s8-1-1-2" class="sectionTitleRef"></a>”.</p>
<p>In this context, the IP Multicast group and source address are not related to a “channel” but to an associated RET IP Multicast, as defined in Annex F of TS 102 034 [[!TS102034]] and Annex <a href="#annex-m-1-3" class="sectionRef">M.1.3</a>, “<a href="#annex-m-1-3" class="sectionTitleRef"></a>” in this specification.</p>
</section>
</section>
<section id="s8-1-2"><h3>Pay Per View multicast content service with SIP session management</h3>
<p>PPV multicast content service session initiation over UNIS-13 SHALL be same as multicast content streaming session initiation as described in section <a href="#s8-1-1" class="sectionRef">8.1.1</a>, “<a href="#s8-1-1" class="sectionTitleRef"></a>.”</p>
</section>
<section id="s8-1-3"><h3>nPVR</h3>
<section id="s8-1-3-1"><h4>Protocol over NPI-40</h4>
<p>The controlling protocol of CDN for nPVR is IGMP. The use of IGMP on NPI-40 SHALL be as defined in section <a href="#s8-1-1-1" class="sectionRef">8.1.1.1</a>, “<a href="#s8-1-1-1" class="sectionTitleRef"></a>”. In this case, the CDF in the CDN acts as an OITF for the multicast content service.</p>
<p>When the CDF receives the request to record a program, it SHALL send an IGMP Join to the Transport Processing Functions.</p>
</section>
</section>
<section id="s8-1-4"><h3>Network Generated Notification Service</h3>
<p>Whenever the network generated notification event was detected, the IPTV Application SHALL send the notification message as well as the destination multicast group identifier to the MCDF over NPI-42. The destination multicast group identifier indicates the multicast group used for the network generated notification service which differs from the related multicast content service.</p>
<p>Upon receiving the notification message, the MCDF SHALL distribute the notification message to the multicast group identified by destination multicast group identifier, as defined in <mark class="error">section <a href="#s9-1-3" class="sectionRef">9.1.3</a>, “<a href="#s9-1-3" class="sectionTitleRef"></a>”. </p>
<div class="editor-note">reviewer: this should probably refer to <a href="#s14-1-2" class="sectionRef">14.1.2</a></div>
<p>For the OITF, Network Generated Notification session initiation over UNIS-13 SHALL be the same as multicast content streaming session initiation as described in section <a href="#s8-1-1" class="sectionRef">8.1.1</a>, “<a href="#s8-1-1" class="sectionTitleRef"></a>”.</p>
</section>
<section id="s8-1-5"><h3>Emergency Notification Service</h3>
<p>Upon receiving an emergency notification from Emergency Services, the Notification Services SHALL send the emergency notification message as well as the destination multicast group identifier to the MCDF over NPI-38. </p>
<p>Upon receiving the notification message, the MCDF SHALL distribute the emergency notification message to the multicast group identified by destination multicast group identifier, as defined in <mark class="error">section <a href="#s9-1-3" class="sectionRef">9.1.3</a>, “<a href="#s9-1-3" class="sectionTitleRef"></a>”. </mark></p><div class="editor-note">reviewer: this should probably refer to <a href="#s14-1-1" class="sectionRef">14.1.1</a></div>
<p>Emergency Notifications are delivered to an OITF over UNIS-13, when the OITF joins the corresponding multicast group with the access parameters derived from SD&amp;S as defined in [[.OIPF_META2]].</p>
</section>
</section>
<section id="s8-2"><h2>Protocols for Service Access and Control Functions</h2>
<section id="s8-2-1"><h3>Service Discovery and Content Selection</h3>
<section id="s8-2-1-1"><h4>Protocol over UNIS-15 and UNIS-7</h4>
<p>DVB SD&amp;S Transport Protocol (DVBSTP) specified in section 5.4.1 of [[!TS102034]] SHALL be used to transport the Service Discovery and Content Metadata related information over multicast.</p>
</section>
<section id="s8-2-1-2"><h4>Protocol over UNIS-13</h4>
<p>The use of IGMP on UNIS-13 for Service Discovery and Content Selection SHALL be as defined in [[!TS183063]] section 8.1.1 where the OITF replaces the OIPF, the Service Provider Discovery FE replaces the SDF and the Service Discovery FE/Metadata Control FE replaces SSF.</p>
</section>
</section>
<section id="s8-2-2"><h3>Remote Management</h3>
<section id="s8-2-2-1"><h4>Protocol over UNIS-RMS</h4>
<p>The UNI-RMS provides the functions for the remote management of the OITF devices. This interface SHALL be based on Broadband Forum TR-069 Remote Management Framework [[!TR069]].</p>
</section>
</section>
</section>
<section id="s8-3"><h2>Protocols for System Infrastructure Functions</h2>
<section id="s8-3-1"><h3>Interactive application delivery</h3>
<section id="s8-3-1-1"><h4>Protocol over UNIS-6 and UNIS-12</h4>
<p>The use of multicast is an OPTIONAL feature for reducing network and server traffic when DAE and PAE applications are delivered to the OITF and AG respectively.</p>
<p>FLUTE [[!RFC3926]] SHALL be used when DAE and PAE applications are delivered through multicast. The FDT Instance XML Schema defined in [[!RFC3926]] is extended with two additional attributes: Tags and Priority.  The Tags attribute contains a list of tags that the content is associated with. The optional Priority attribute is used by the OITF to determine which content items can be discarded when there is a need to recover memory.  The Priority attribute takes values between 1 and 10, with 10 being the highest priority.  </p>
<p>The detailed schema extensions are described in Annex <a href="#flute-fdt-extension-schema" class="sectionRef"></a>.</p>
<p>The Content-Location element in the FDT-Instance SHALL be the same URI which is used to fetch the object with unicast, e.g., <code>http://server/DAE_pictures/background.jpg</code>. If the OITF has stored an object, it SHALL NOT download the object again using unicast unless it has expired.</p>
<p>If certain parts of the file are lost, the OITF MAY fetch the missing parts using HTTP with range headers.</p>
</section>
</section>
</section>
</section>
<section id="rtp"><h1>RTP/RTCP</h1>
<p>This section defines the protocol for the use of RTP and RTCP over the following reference points:</p><ul>
<li>UNIT-17
<li>UNIT-18
<li>NPI-41
</ul>
<section id="s9-1"><h2>Protocols for IPTV Service Functions</h2>
<section id="s9-1-1"><h3>Multicast content streaming service</h3>
<p>Scheduled content may be delivered as a multicast stream over UNIT-17.</p>
<section id="s9-1-1-1"><h4>Protocol over UNIT-17</h4>
<p>The use of RTP on this reference point SHALL comply with [[!TS102034]] section 7.1 and subsection 7.1.1.</p>
</section>
</section>
<section id="s9-1-2"><h3>Unicast content streaming service</h3>
<p>Streamed Scheduled Content or Content on Demand may bedelivered as a unicast stream over UNIT-17. RTP and HTTP MAY be used. This section specifies the use of RTP.</p>
<section id="s9-1-2-1"><h4>Protocol over UNIT-17</h4>
<p>RTP SHALL be used on this reference point and SHALL comply with [[!TS102034]] section 7.1 and subsection 7.1.1.</p>
<p>The use of RTCP SHALL be compliant to section <a href="#s9-2-1" class="sectionRef">9.2.1</a>.</p>
</section>
</section>
<section id="s9-1-3"><h3>nPVR</h3>
<section id="s9-1-3-1"><h4>Protocol over NPI-41</h4>
<p>This interface is used for multicast delivery from the Transport Processing Functions to the CDF in the CDN for the purposes of nPVR.  RTP SHALL be used on NPI-41 and SHALL comply with [[!TS102034]] section 7.1 and subsection 7.1.1.</p>
</section>
</section>
</section>
<section id="s9-2"><h2>Service Access and Control</h2>
<section id="s9-2-1"><h3>Performance Monitoring over UNIT-18</h3>
<p>This section specifies the OPTIONAL setup and reporting of sample metrics for unicast content streaming services.</p>
<p>The setup is initiated when the SDP session parameters are retrieved. A CDF requesting sample metrics reports via RTCP SHALL include the performance reporting information in the retrieved SDP information using the a=rtcp-xr SDP attribute as defined below.</p>
<p>RTCP SHALL be used as per subsection 7.1.1.1 of [[!TS102034]] with the following additions:</p><ul>
<li>RTCP Receiver Reports defined by RFC 3550 [[!RTP]] SHALL be used to include RTCP XR extended reports following the rules of RFC 3611 [[!RTCP-XR]] and as defined further below.
<li>The RTP default value for RTCP bandwidth of 5% MAY be overridden by using the SDP bandwidth modifiers as specified in RFC 3556 [[!SDP-RTCP]]. See section <a href="#s7-1-1-2" class="sectionRef">7.1.1.2</a> for details.
</ul>
<p>Unlike the case of cumulative metrics, the sample metrics are not present in the OIPF-QoS-Metrics  RTSP Header as there is already a framework for reporting metrics using RTCP, namely the RTCP XR extended report as per RFC 3611 [[!RTCP-XR]]. A consequence of this is that the sample metrics cannot be negotiated, as RTSP cannot negotiate parameters present in the SDP.</p>
<p>The SDP attributes to define the REQUIRED sample metrics in accordance with <a href="https://tools.ietf.org/html/rfc3611#section-5.1" class="extRef">section 5.1</a> of RFC 3611 [[!RTCP-XR]] are as follows:</p>
<pre class="anbf">
rtcp-xr-attrib = “a=” “rtcp-xr” “:” [xr-format *(SP xr-format)] CRLF
  xr-format = default-OIPF-xr-report / new-OIPF-xr-report
  default-OIPF-xr-report = “OIPF-BasicPerfMonSampleSubset1”
  new-OIPF-xr-report = non-ws-string   ; non-white-space string
  non-ws-string = 1*(%x21-FF)
  CRLF = %d13.10
</pre>

<p>An OITF using RTCP reporting SHALL support the extended report blocks defined in future versions of this specification. Guidelines for specifying RTCP XR Extended Report containing sample metrics are provided in [[.OIPF_PROT_EX2]]. <i>OIPF-BasicPerfMonSampleSubset1</i> is used in this specification as a formal placeholder and for illustrative purposes.<p>
<p>The OITF MAY support other RTCP XR extended reports as defined in RFC 3611 [[!RTCP-XR]] (e.g., pkt-loss-rle, pkt dup-rle, pkt-rcpt-times, etc...) but these are not REQUIRED for the performance monitoring to work correctly.</p>
</section>
</section>
<section id="s9-3"><h2>Application Layer Forward Error Correction</h2>
<p>This section specifies the protocol for Application Layer FEC (AL-FEC) protection of streaming media for multicast content services carried over RTP transport.</p>
<p>The Application Layer FEC is conforming to [[!TS102034]] Annex E. Only the base layer of DVB-IP AL-FEC is supported in this specification, the enhancement layer support is out of scope.</p>
<p>DVB AL FEC base layer is signalled in DVB SD&amp;S, as defined in [[!TS102034]] section 5.2.6.2.</p>
</section>
<section id="s9-4"><h2>Application Layer Retransmission (RET)</h2>
<p>This section specifies the RTP retransmission solution both for multicast content services and unicast content services transported over RTP, to provide for packet loss repair service. The solution SHALL be conformant to the application layer retransmission (RET) solution as specified in Annex F of [[!TS102034]].</p>
<section id="s9-4-1"><h3>Protocol over UNIT-17</h3>
<p>The unicast RTP retransmission data associated with multicast content service or unicast content service is transferred over the UNIT-17, in conformance with [[!TS102034]].</p>
<p>For unicast content services, RTP retransmission packets SHALL be SSRC multiplexed with the original RTP packets.</p>
<p>For multicast content services, in addition to unicast RTP retransmission data, there MAY also be multicast RTP retransmission data and related multicast RTCP retransmission information (such as RTCP FeedForward NACK message) transferred over UNIT-17, as specified in [[!TS102034]].</p>
</section>
<section id="s9-4-2"><h3>Protocol over UNIT-18</h3>
<p>Unicast RTCP SHALL be used on this reference point for RET requesting -by means of the RTCP FeedBack NACK message- and reporting for both multicast content service and unicast content service and SHALL comply with the Annex F of [[!TS102034]].</p>
</section>
</section>
<section id="s9-5"><h2>Fast Channel Change (FCC)</h2>
<p>This section specifies the fast channel change solution for multicast scheduled content services transported over RTP. The solution SHALL be conformant to the server-based fast channel change solution as specified in [[!FCC]].</p>
<section id="s9-5-1"><h3>Protocol over UNIT-17</h3>
<p>The unicast Fast Channel Change RTP burst data is transferred over the UNIT-17, in conformance with [[!FCC]].</p>
</section>
<section id="s9-5-2"><h3>Protocol over UNIT-18</h3>
<p>RTCP SHALL be used on this reference point and SHALL comply with [[!FCC]].</p>
</section>
</section>
<section id="s9-6"><h2>Protocols for Multimedia Telephony Services</h2>
<section id="s9-6-1"><h3>Protocol over UNIT-17</h3>
<p>The use of RTP on this reference point SHALL comply with [[!RFC3550]] and [[!RFC3551]].</p>
<section id="s9-6-1-1"><h4>RTP payload formats for video streams</h4>
<p>The RTP payload format defined in [[!RFC3984]] SHALL be used for the transport of H.264 video streams according to the video media type AVC_VDC as defined in [[.OIPF_MEDIA2]]. The following restrictions on the usage of [[!RFC3984]] SHALL apply:</p><ul>
<li>the interleaved packetization mode SHALL NOT be used, 
<li>the single NAL unit and the non-interleaved packetization modes SHALL both be supported.
</ul>
<p>The RTP payload format defined in [[!RFC3016]] SHALL be used for the transport of MPEG-4 Part-2 video streams according to the video media type MP4V as defined in [[.OIPF_MEDIA2]].</p>
<p>The RTP payload format defined in [[!RFC4629]] SHALL be used for the transport of H.263 video streams according to the video media type H263 as defined in [[.OIPF_MEDIA2]].</p>
</section>
<section id="s9-6-1-2"><h4>RTP payload formats for audio streams</h4>
<p>The RTP payload formats defined in [[!RFC3551]] SHALL be used for the transport of G.711 and G.722 speech audio streams according to the audio media type G711 and G722 as defined in [[.OIPF_MEDIA2]].</p>
<p>The RTP payload format defined in [[!RFC4867]] and further specified in chapter 7.4.2 of [[!TS26114]] SHALL be used for the transport of AMR-NB and AMR-WB speech audio streams according to the audio media types AMR and AMRWB as defined in [[.OIPF_MEDIA2]].</p>
<p>The RTP payload format defined in [[!RFC4749]] SHALL be used for the transport of G.729.1 speech audio streams according to the audio media type G7291 as defined in [[.OIPF_MEDIA2]].</p>
<p>The RTP payload format defined in [[!RFC5404]] SHALL be used for the transport of G.719 audio streams according to the audio media type G719 as defined in [[.OIPF_MEDIA2]].</p>
<p>The RTP payload format defined in [[!RFC3640]] SHALL be used for the transport of MPEG-4 audio streams according to the audio media types AACLD and AACELD as defined in [[.OIPF_MEDIA2]].</p>
</section>
</section>
</section>
</section>


<section id="upnp"><h1>UPnP</h1>
<section id="s10-1"><h2>Protocols for System Infrastructure Functions</h2>
<section id="s10-1-1"><h3>UPnP Discovery</h3>
<p>OITFs that do not support native HNI-IGI do not support UPnP-based IG discovery.</p>
<section id="s10-1-1-1"><h4>Procedure for IG Discovery</h4>
<section id="s10-1-1-1-1"><h5>Discovery Sequence</h5>
<p>When an OITF powers up, the OITF SHALL automatically discover the IG using the UPnP Discovery Mechanism defined by UPnP Device Architecture [[!UPNP]]. A summary of the steps are as follows:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>An OITF sends the UPnP search request with the search target (urn:oipf-org:device:ig:1) to the specific multicast IP/Port address (239.255.255.250:1900)</td></tr>
<tr><td class="label">Step 2:</td><td>When an IG receives the search request, the IG sends the response message with its UPnP device description location (URL, e.g. http://IGAddress/Description.xml) to the requester’s IP address by HTTP-U protocol</td></tr>
<tr><td class="label">Step 3:</td><td>The OITF sends the HTTP GET request for retrieving the UPnP device description from the location (e.g. http://IGAddress/Description.xml)</td></tr>
<tr><td class="label">Step 4:</td><td>The IG sends the response with its UPnP device description, which holds the IG description.</td></tr>
</table>
</section>
<section id="s10-1-1-1-2"><h5>urn:oipf-org:device:ig:1 device definitions</h5>
<p>This section defines the urn:oipf-org:device:ig:1 deviceType.</p>
<table class="simple">
<tr><th>deviceType</th><th>Root</th><th>R/O</th><th>ServiceType</th><th>R/O</th><th>ServiceID</th></tr>
<tr><td>urn:oipf-org:device:ig:1</td><td>Root or Embedded</td><td>REQUIRED</td><td>see below</td><td>n/a</td><td>n/a</td></tr>
</table>
<p>As described above, the urn:oipf-org:device:ig:1 deviceType does not have any specific definition for the serviceType it supports. It MAY have services of any serviceType.</p>
</section>
<section id="s10-1-1-1-3"><h5>IG Description</h5>
<p>To interact with the IG, the OITF MUST know the IG URI and possibly a set of supported methods. The device element of the device description document for the urn:oipf-org:device:ig:1 deviceType SHALL contain this information, IG description, which is described as an XML fragment. The XML schema for the IG description is as follows:</p>
<figure><img src="images/igDescription.png" alt="igDescription.png"/></figure>
<pre class="xml-schema">
&lt;xs:schema targetNamespace="urn:oipf-org:device:ig:1"
  xmlns:tns="urn:oipf-org:device:ig:1"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;

  &lt;xs:element name="igDescription"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="igURL" type="xs:anyURI" /&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name="SupportedMethod"
        type="tns:Hexadecimal16bit" use="optional" /&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  &lt;xs:simpleType name="Hexadecimal16bit"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:pattern value="[0-9a-fA-F]{1,4}" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;
</pre>
<table class="simple">
<tr><th>Element/Attribute Name</th><th>Description</th></tr>
<tr><td>igDescription</td><td>The root element of the IG Description XML fragment</td></tr>
<tr><td>@SupportedMethod</td><td>Hexadecimal16bit to describe the methods supported by the IG over the HNI-IGI interface (section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>”), which correspond to SIP methods and other functionality. Each bit represents a supported method as follows: <ul class="nobullet">
<li>0001 : REGISTER
<li>0002 : INVITE
<li>0004 : BYE
<li>0008 : CANCEL
<li>0010 : SUBSCRIBE
<li>0020 : NOTIFY
<li>0040 : PUBLISH
<li>0080 : MESSAGE
<li>0100 : OPTIONS
<li>0200 : GBA Authentication
<li>0400 : HTTP Digest Authentication
</ul>
<p>(0800~8000 : Upper 5 bits are currently not assigned but these bits could be used for other methods defined later)</p>
<p>The value of this attribute is the result of a 16 bit OR operation with representative values of supported methods. If the SupportedMethod attribute is not described, the IG SHALL support all methods.</p>
</td></tr>
<tr><td>igURL</td><td><p>IG  URL for the HNI-IGI (refer to section <a href="#s5-6-1" class="sectionRef">5.6.1</a>, “<a href="#s5-6-1" class="sectionTitleRef"></a>.”)</p>
<p>It MAY be relative to base URL (URLBase of uPnP device description if it exists or the URL from which the device description was retrieved).</p>
<p>It SHALL NOT exceed 256 bytes in URI-escapes UTF-8 encoded form.</p>
</td></tr>
</table>
<p>Note that GBA authentication can be achieved using either the GBA Authentication using IMS Gateway procedure, specified in [[.OIPF_CSP2]] <a href="volume7.html#gba-authentication-using-ims-gateway" class="extRef">section 5.4.5</a> or the, more general, procedure, HTTP Digest Authentication using IMS Gateway in [[.OIPF_CSP2]] <a href="volume7.html#http-digest-authentication-using-ims-gateway" class="extRef">section 5.4.4</a>. The latter; more general procedure allows the use of different authentication mechanism in a way that is transparent to the OITF, including possible future authentication mechanisms, and should preferably be used. It is expected that GBA Authentication using IMS Gateway procedure will be deprecated and removed in future versions of this specification.</p>
<p>The namespace of this fragment is “urn:oipf-org:device:ig:1”.</p>
<p>Example:</p><pre>
&lt;ig:igDescription xmlns:ig="urn:oipf-org:device:ig:1" SupportedMethod="01ff"&gt;
&lt;ig:igURL&gt;
  http://192.168.0.2/IG/
&lt;/ig:igURL&gt;
&lt;/ig:igDescription&gt;
</pre>
</section>
</section>
<section id="s10-1-1-2"><h4>Procedure for AG Discovery</h4>
<section id="s10-1-1-2-1"><h5>Discovery Sequence</h5>
<p>When an OITF powers up, the OITF SHALL automatically discover the AG using the UPnP Discovery Mechanism defined by UPnP Device Architecture [[!UPNP]]. A summary of the steps are as follows:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>An OITF sends the UPnP search request with the search target (urn:oipf-org:device:ag:1) to the specific multicast IP/Port address (239.255.255.250:1900)</td></tr>
<tr><td class="label">Step 2:</td><td>When an AG receives the search request, the AG sends the response message with its UPnP device description location (URL, e.g. http://AGAddress/Description.xml) to the requester’s IP address by HTTP-U protocol</td></tr>
<tr><td class="label">Step 3:</td><td>The OITF sends the HTTP GET request for retrieving the UPnP device description from the location (e.g. http://AGAddress/Description.xml)</td></tr>
<tr><td class="label">Step 4:</td><td>The AG sends the response with its UPnP device description, which holds the AG description.</td></tr>
</table>
</section>
<section id="s10-1-1-2-2"><h5>urn:oipf-org:device:ag:1 device definitions</h5>
<p>This section defines the urn:oipf-org:device:ag:1 deviceType.</p>
<table class="simple">
<tr><th>deviceType</th><th>Root</th><th>R/O</th><th>ServiceType</th><th>R/O</th><th>ServiceID</th></tr>
<tr><td>urn:oipf-org:device:ag:1</td><td>Root or Embedded</td><td>REQUIRED</td><td>see below</td><td>n/a</td><td>n/a</td></tr>
</table>
<p>As described above, the urn:oipf-org:device:ag:1 deviceType does not have any specific definition for the serviceType it supports. It MAY have services of any serviceType.</p>
</section>
<section id="s10-1-1-2-3"><h5>AG Description</h5>
<p>The OITF MAY interact with the AG in one of two ways.</p>
<p>The applications running in the AG MAY provide remote UI as defined by the XML UI listing in CEA-2014-A [[!CEA-2014-A]].</p>
<p>The applications running in the AG MAY provide non-UI based services, for example listening for XML HTTP Requests from DAE applications. No specific methods or services are defined.</p>
<p>To interact with the AG, the OITF MUST know the AG URL and possibly a set of supported methods. The device element of the device description document for the urn:oipf-org:device:ag:1 deviceType SHALL contain this information, AG description, which is described as an XML fragment. The XML schema for the AG description is as follows:</p>
<pre class="xml-schema">
&lt;xs:schema targetNamespace="urn:oipf-org:device:ag:1"
  xmlns:tns="urn:oipf-org:device:ag:1"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:element name="agDescription"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="agDefaultURL" type="xs:anyURI" /&gt;
        &lt;xs:element name="agUIServerURL" type="xs:anyURI" minOccurs="0" /&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;
</pre>
<table class="simple">
<tr><th>Element/Attribute Name</th><th>Description</th></tr>
<tr><td>agDescription</td><td>The root element of the AG Description XML fragment</td></tr>
<tr><td>agDefaultURL</td><td>URL describing default address of AG, e.g. http://10.1.1.2</td></tr>
<tr><td>agUIServerURL</td><td>URL or URLs for remote UI provided by applications running on the AG</td></tr>
</table>
<p>The namespace of this fragment is “urn:oipf-org:device:ag:1”.</p>
</section>
</section>
<section id="s10-1-1-3"><h4>Procedure for CSPG-DTCP Discovery</h4>
<section id="s10-1-1-3-1"><h5>Discovery Sequence</h5>
<p>When an OITF powers up, the OITF SHALL automatically discover the CSPG-DTCP using the UPnP Discovery Mechanism defined by UPnP Device Architecture [[!UPNP]]. A summary of the steps are as follows:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>An OITF sends the UPnP search request with the search target (urn:oipf-org:device:cspg-dtcp:1) to the specific multicast IP/Port address (239.255.255.250:1900)</td></tr>
<tr><td class="label">Step 2:</td><td>When a CGPG-DTCP  receives the search request, the CGPG-DTCP sends the response message with its UPnP device description location (URL, e.g. http://CSPGDTCPAddress/Description.xml) to the requester’s IP address by HTTP-U protocol</td></tr>
<tr><td class="label">Step 3:</td><td>The OITF sends the HTTP GET request for retrieving the UPnP device description from the location (e.g. http://CSPGDTCPAddress/Description.xml)</td></tr>
<tr><td class="label">Step 4:</td><td>The CSPG-DTCP sends the response with its UPnP device description, which holds the CSPG-DTCP description.</td></tr>
</table>
</section>
<section id="s10-1-1-3-2"><h5>urn:oipf-org:device:cspg-dtcp:1 device definitions</h5>
<p>This section defines the urn:oipf-org:device:cspg-dtcp:1 deviceType.</p>
<table class="simple">
<tr><th>deviceType</th><th>Root</th><th>R/O</th><th>ServiceType</th><th>R/O</th><th>ServiceID</th></tr>
<tr><td>urn:oipf-org:device:cspg-dtcp:1</td><td>Root or Embedded</td><td>REQUIRED</td><td>see below</td><td>n/a</td><td>n/a</td></tr>
</table>
<p>As described above, the urn:oipf-org:device:cspg-dtcp:1 deviceType does not have any specific definition for the serviceType it supports. It MAY have services of any serviceType.</p>
</section>
<section id="s10-1-1-3-3"><h5>CSPG-DTCP Description</h5>
<p>To interact with the CSPG-DTCP, the OITF MUST know which DRM system is supported, the port number used for DTCP key exchange and on which port the different content access protocols are proxied. The device element of the urn:oipf-org:device:cspg-dtcp:1 deviceType SHALL contain this information, and is described based on the following XML schema:</p>
<pre class="xml-schema">
&lt;xs:schema targetNamespace="urn:oipf-org:device:cspg-dtcp:1"
  xmlns:tns="urn:oipf:device:cspg-dtcp:1"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:element name="cspgdtcpDescription"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="DtcpPort" type="xs:integer" /&gt;
        &lt;xs:element name="HttpProxyPort" type="xs:integer" /&gt;
        &lt;xs:element name="RtspProxyPort" type="xs:integer" /&gt;
        &lt;xs:element name="DRMSystemID" type="xs:anyURI"
          maxOccurs="unbounded" /&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;
</pre>
<table class="simple">
<tr><th>Element/Attribute Name</th><th>Description</th></tr>
<tr><td>cspgdtcpDescription</td><td>The root element of CSPG-DTCP Description XML fragment</td></tr>
<tr><td>DtcpPort</td><td>TCP port number for DTCP-AKE</td></tr>
<tr><td>HttpProxyPort</td><td>TCP port number for HTTP proxy in CSPG-DTCP</td></tr>
<tr><td>RtspProxyPort</td><td>TCP port number for RTSP proxy in CSPG-DTCP</td></tr>
<tr><td>DRMSystemID  Supported DRM system.</td><td>The format of this attribute complies with DRMSystemId as defined in DRMControlInformation extension in [[.OIPF_META2]].</td></tr>
</table>
<p>The namespace of this fragment is “urn:oipf-org:device:cspg-dtcp:1”.</p>
<p>Example:</p>
<pre>
&lt;cg:cspgdtcpDescription xmlns:cg="urn:oipf-org:device:cspg-dtcp:1"&gt;
  &lt;cg:DtcpPort&gt;12345&lt;/cg:DtcpPort&gt;
  &lt;cg:HttpProxyPort&gt;12346&lt;/cg:HttpProxyPort&gt;
  &lt;cg:RtspProxyPort&gt;12347&lt;/cg:RtspProxyPort&gt;
  &lt;cg:DRMSystemID&gt;urn:dvb:casystemid:12348&lt;/cg:DRMSystemID&gt;
  &lt;cg:DRMSystemID&gt;urn:dvb:casystemid:12349&lt;/cg:DRMSystemID&gt;
&lt;/cg:cspgdtcpDescription&gt;
</pre>
</section>
</section>
<section id="s10-1-1-4"><h4>Procedure for OITF Discovery</h4>
<section id="s10-1-1-4-1"><h5>Discovery Sequence</h5>
<p>When an OITF powers up, the IG SHALL automatically discover the OITF using the UPnP Discovery Mechanism defined by UPnP Device Architecture [[!UPNP]]. A summary of the steps are as follows:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG sends the UPnP search request with the search target (urn:oipf-org:device:oitf:1) to the specific multicast IP/Port address (239.255.255.250:1900)</td></tr>
<tr><td class="label">Step 2:</td><td>When an OITF receives the search request, the OITF sends the response message with its UPnP device description location (URL, e.g. http://OITFAddress/Description.xml) to the requester’s IP address</td></tr>
<tr><td class="label">Step 3:</td><td>The IG sends the HTTP GET request for retrieving the UPnP device description from the location (e.g. http://OITFAddress/Description.xml)</td></tr>
<tr><td class="label">Step 4:</td><td>The OITF sends the response with its UPnP device description, which holds the OITF description.</td></tr>
</table>
</section>
<section id="s10-1-1-4-2"><h5>OITF Description</h5>
<p>This section defines the urn:oipf-org:device:oitf:1 deviceType. </p>
<p>The OITF can act as either a Media Renderer or a Media Server, and these two kinds of devices are defined in UPnP DCP (Device Control Protocol) related specifications ([[!UPNP-MR]], [[!UPNP-MS]]). Detailed descriptions and schemas of the ServiceTypes are defined in these specifications.</p>
<table class="simple">
<tr><th>deviceType</th><th>Root</th><th>R/O</th><th>ServiceType</th><th>R/O</th><th>ServiceID</th></tr>
<tr><td rowspan=3>MediaRenderer:1</td><td rowspan=3>Root or Embedded</td><td rowspan=3>REQUIRED</td><td>RenderingControl:1.0</td><td>REQUIRED</td><td>RenderingControl</td></tr>
<tr><td>ConnectionManager:1.0</td><td>REQUIRED</td><td>ConnectionManager</td></tr>
<tr><td>AVTransport:1.0</td><td>OPTIONAL</td><td>AVTransport</td></tr>
<tr><td rowspan=3>MediaServer:1</td><td rowspan=3>Root or Embedded</td><td rowspan=3>REQUIRED</td><td>ContentDirectory:1.0</td><td>REQUIRED</td><td>ContentDirectory</td></tr>
<tr><td>ConnectionManager:1.0</td><td>REQUIRED</td><td>ConnectionManager</td></tr>
<tr><td>AVTransport:1.0</td><td>OPTIONAL</td><td>AVTransport</td></tr>
</table>
<p>The OITF can also act as a Digital Media Player, but this device type is not discoverable so no device description is needed.</p>
</section>
</section>
</section>
</section>
</section>

<section id="dlna"><h1>DLNA</h1>
<section id="s11-1"><h2>DLNA function</h2>
<p>DLNA Function is an OPTIONAL gateway function which serves IPTV content to other DLNA devices in a consumer network. It converts the IPTV protocols, such as metadata access and media delivery protocols, to DLNA protocols. It MAY also convert media format and content protection schemes, if necessary. The interface between the DLNA Function of the OITF and DLNA devices SHALL be compliant with [[!DLNA]].</p>
</section>
</section>
<section id="dhcp"><h1>DHCP</h1>
<p>This section defines the protocol for the use of DHCP over the following reference points:</p><ul>
<li>UNIT-16
</ul>
<section id="s12-1"><h2>Protocols for System Infrastructure Functions</h2>
<section id="s12-1-1"><h3>Network Attachment</h3>
<p>Network attachment provides IP addresses and configuration information to elements in the Consumer Domain prior to any other action regarding IPTV services. The provision and management of IP addresses has two main aspects.</p>
<p><b>IP address management within the Consumer Network</b>: Deals with the attachment of the IG, AG and OITF to the WAN Gateway. The WAN Gateway SHALL act as a DHCP Server and a NAT. This type of attachment allows the IG, AG and OITF to communicate with each other within the consumer network. This allows the OITF to send and receive messages to and from the Internet.</p>
<p><b>IP address management for communication with the Provider Network</b>: 2 cases are supported.</p><ul>
<li>MANDATORY: The WAN Gateway translates the in-home IP address to an IP address recognizable to the provider's addressing plan. In this case a NAT SHALL be supported.
<li>OPTIONAL: The WAN Gateway assigns an IP address to the IG, AG and OITF from the managed network’s IP addressing pool. In this case, NAT is not REQUIRED.
</ul>
<p>Configuration information (e.g. DNS server) SHALL be provided to the OITF, AG and IG</p>
<p>At power up all devices in the consumer network (OITF, IG, AG and other devices) SHALL request an IP address and network configuration parameters from the WAN gateway using DHCP.</p>
<section id="s12-1-1-1"><h4>DHCP Option Usage</h4>
<section id="s12-1-1-1-1"><h5>Common Options</h5>
<p>The following is the minimum set of DHCP options defined in RFC 3442 [[!CLSLESS]] and RFC 2132 [[!DHCP-OPT]] that SHALL be used by the OITF, IG and AG when requesting DHCP configuration information from the WAN Gateway:<ul>
<li>Option 1: Subnet Mask
<li>Option 6: DNS
<li>Option 61: Client identifier. In this specification, the DHCP Client Identifier used in OITF devices is the deviceID, defined as follows:<ul>
<li>deviceID – Identifies the device. It SHALL be unique within the home network and SHALL NOT change between restarts. The deviceID SHALL be the SHA-1 hash of the MAC address of the interface used to connect to the IPTV service as bytes concatenated with the domain name received via DHCP option 15 in ASCII characters:<ul>
<li>deviceID = SHA-1(X)<br />
where: X = (MAC address as bytes) + (domain name in ASCII characters) and the ‘+’ denotes the concatenation operation.  SHA-1 SHALL be used as specified in [[!SHA-1]]. The domain name SHALL be set to the domain name received via DHCP option 15 (see section <a href="#s12-1-1-1-2" class="sectionRef">12.1.1.1.2</a>, “<a href="#s12-1-1-1-2" class="sectionTitleRef"></a>.”)
</ul></ul></ul>
<p>For the IG and AG to support TR-069 based remote management, the following SHALL be supported:</p><ul>
<li>Option 43: Vendor Specific Information is used to retrieve the Remote Management Server IP address or fully qualified domain name (FQDN). This information SHALL be provided by the DHCP server.
<li>Option 60: Vendor Class identifier is used to indicate to the DHCP server that it is compliant with the Broadband Forum TR-069 specification. The vendor-class identifier SHALL be set to “IG_IPTV” or “AG_IPTV” by the IG or AG, respectively.
</ul>
<p>If the OITF supports TR-069 based remote management, the following SHALL be supported:</p><ul>
<li>Option 43: Vendor Specific Information is used to retrieve the Remote Management Server IP address or fully qualified domain name (FQDN). This information SHALL be provided by the DHCP server.
<li>Option 60: Vendor Class identifier is used to indicate to the DHCP server that it is compliant with the Broadband Forum TR-069 specification. The vendor-class identifier SHALL be set to “OITF_IPTV” by the OITF.
</ul>
<p>For managed networks relying on IMS, the following SHALL be supported:</p><ul>
<li>Option 120: The address of the P-CSCF as per section 7.1.1 of TS 183 019 [[!TS183019]].
</ul>
</section>
<section id="s12-1-1-1-2"><h5>Option 15</h5>
Option 15 SHALL be used by the OITF to request the domain name used to generate the device identity (deviceID) as per section <a href="#s6-1-3-2-1" class="sectionRef">6.1.3.2.1</a>, “<a href="#s6-1-3-2-1" class="sectionTitleRef"></a>”.
</section>
<section id="s12-1-1-1-3"><h5>Option 124/125</h5>
<p>The OITF SHALL send a Vendor–Identifying Vendor Class option 124 as specified in RFC 3925 [[!DHCP-VND]] when it requests a DHCP lease from the WAN Gateway. The option is specified with an enterprise number of 37339 and the vendor class data identifier as “OITF_IPTV”.</p>
<p>The DHCP server delivers the Service Provider Discovery entry point via Vendor-Identifying Vendor-Specific Information DHCP option 125 as defined in RFC 3925 [[!DHCP-VND]], with the enterprise number and vendor class data identified from option 124.</p>
<p>In this specification, the Service Provider Discovery entry points used are either:</p><ul>
<li>The FQDN/IP address of the IG, as per Annex F.1, “OITF Start up High-Level Procedure”, or
<li>The FQDN/IP address of the Service Provider Discovery Functional Entity (SP Discovery FE), as per section <a href="#s6-1-3-1" class="sectionRef">6.1.3.1</a>, “<a href="#s6-1-3-1" class="sectionTitleRef"></a>”.
</ul>
<p><b>Format of DHCP payload</b></p>
<p>The format of the vendor-specific binary buffer containing addresses returned by the DHCP server is a list of sub options starting with sub-option number (one byte), sub-option length  (one byte) and sub-option value (list of bytes).</p>
<p>The following vendor-specific sub-options are defined:</p><ul>
<li>Sub-Option: IPTV-ENTRYPOINT: Code=0x01. This option carries either an IP Address or a fully-qualified domain name, as determined by a one byte “enc” field is used to indicate the type of encoding.<ul>
<li>If the “enc” field has a value of 0x01, then this indicates an IP Address. The “enc” field is followed by 4 bytes corresponding to the IP Address. This value is used for the Service Provider Discovery Entry point function.
<li>If the “enc” field has a value of 0x02, then this indicates a FQDN (Fully-Qualified Domain Name).  This value is used for the Service Provider Discovery Entry point function.
<li>The code of 0xFF is used to indicate end of the buffer.
</ul>
<li>Sub-Option: FCC/RET server location: Code=0x02. This option carries either a comma delimited list of IP Addresses or a comma delimited list of fully-qualified domain names, as determined by a one byte “enc” field is used to indicate the type of encoding.<ul>
<li>If the “enc” field has a value of 0x01, then this indicates a list of comma-delimited IP Addresses.
<li>If the “enc” field has a value of 0x02, then this indicates a list of comma-delimited FQDNs (Fully-Qualified Domain Name).
<li>The code of 0xFF is used to indicate end of the buffer.
<li>In either case, the servers SHALL be in the order of priority from first to last server to connect to.
</ul>
<li>In conformance with [[!FCC]], the values for the FCC/RET server location(s) retrieved with DHCP are overruled by the SD&amp;S elements “/BroadcastDiscovery/ServiceList/SingleService/ServiceLocation/IPMulticastAddress/Server-based LMB Enhancement Service/RTCPReporting@DestinationAddress” providing the address of the FCC/RET server per each channel, when present.
</ul>
<p>Note: for this release it is not defined how to configure the DHCP server on the WAN gateway for FCC/RET server location.</p>
</section>
</section>
</section>
</section>
</section>
<section id="udp"><h1>UDP</h1>
<section id="s13-1"><h2>Protocols for IPTV Service Functions</h2>
<section id="s13-1-1"><h3>Multicast content streaming service</h3>
<section id="s13-1-1-1"><h4>Protocol over UNIT-17</h4>
<p>When MPEG2-TS are encapsulated directly in UDP (User Datagram Protocol), the encapsulation SHALL conform to TS 102 034 [[!TS102034]] section 7.1.2.</p>
<p>The use of RTP or direct UDP encapsulation SHALL be signalled by Service Discovery and Selection for multicast streaming. The use of RTP or direct UDP encapsulation SHALL be signalled in the SDP for unicast streaming.</p>
<p>In addition, it SHOULD be possible for an OITF to detect the usage of RTP or direct UDP encapsulation by looking for the value 0x47 in the first byte after the UDP header. In case of Direct UDP encapsulation this is the first byte of a 188 byte MPEG2-TS packet which always have the value 0x47 (synchronization byte of transport stream header. For any other value then RTP encapsulation is used).</p>
</section>
</section>
<section id="s13-1-2"><h3>Unicast content streaming service</h3>
<section id="s13-1-2-1"><h4>Protocol over UNIT-17</h4>
<p>The use of UDP on this reference point SHALL be as specified in section <a href="#s13-1-1-1" class="sectionRef">13.1.1.1</a>, “<a href="#s13-1-1-1" class="sectionTitleRef"></a>.”</p>
</section>
</section>
<section id="s13-1-3"><h3>nPVR</h3>
<section id="s13-1-3-1"><h4>Protocol over UNIT-17</h4>
<p>The use of UDP on this reference point SHALL be as specified in section <a href="#s13-1-1-1" class="sectionRef">13.1.1.1</a>, “<a href="#s13-1-1-1" class="sectionTitleRef"></a>.”</p>
</section></section>
</section>
</section>
<section id="flute"><h1>FLUTE</h1>
<p>This section defines the protocol for the use of FLUTE over the following reference points:</p><ul>
<li>UNIT-19
</ul>
<section id="s14-1"><h2>Protocols for IPTV Service Functions</h2>
<section id="s14-1-1"><h3>Emergency Notification</h3>
<p>Emergency notification is delivered in a multicast session over UNIT-19.</p>
<section id="s14-1-1-1"><h4>Protocol over UNIT-19</h4>
<p>The use of FLUTE SHALL comply with [[!RFC3926]]. When transported, an emergency notification message SHALL be carried in the FLUTE session as a TO (transport object), while FDT (File Delivery Table) SHALL be used to describe the notification message. The schema of FDT Instance SHALL conform to [[!RFC3926]] with the extension defined in section <a href="#s8-3-1-1" class="sectionRef">8.3.1.1</a>, “<a href="#s8-3-1-1" class="sectionTitleRef"></a>.” The FDT shall comply to the schema defined in Annex <a href="#fdt-schema-extensions" class="sectionRef">O</a>, “<a href="#fdt-schema-extensions" class="sectionTitleRef"></a>”.</p>
</section>
</section>
<section id="s14-1-2"><h3>Network Generated Notification</h3>
<p>Network generated notification is delivered via a multicast session over UNIT-19. When the network generated notification is not tightly synchronized with a scheduled multicast content service, FLUTE SHALL be used.</p>
<section id="s14-1-2-1"><h4>Protocol over UNIT-19</h4>
<p>The use of FLUTE SHALL comply with [[!RFC3926]]. When transported, a network generated notification message SHALL be carried in the FLUTE session as a TO (transport object), while FDT (File Delivery Table) SHALL be used to describe the notification message. The schema of FDT Instance SHALL conform to [[!RFC3926]] with the extension defined in section <a href="#s8-3-1-1" class="sectionRef">8.3.1.1</a>, “<a href="#s8-3-1-1" class="sectionTitleRef"></a>.” The FDT shall comply to the schema defined in Annex <a href="#fdt-schema-extensions" class="sectionRef">O</a>, “<a href="#fdt-schema-extensions" class="sectionTitleRef"></a>”.</p>
</section>
</section>
</section>
</section>

<section id="diameter"><h1>Diameter</h1>
<p>This section defines the protocol for the use of Diameter protocol [[!RFC3588]] over following referenced points.</p><ul>
<li>NPI-11
</ul>
<section id="s15-1"><h2>Protocols for IPTV Service Functions</h2>
<section id="s15-1-1"><h3>Purchase of Digital Media</h3>
<section id="s15-1-1-1"><h4>Protocol over NPI-11</h4>
<p>The use of Diameter protocol SHALL comply with [[!DIAMCHG]] and [[!RFC3588]]. Two messages will be used, Accounting-Request (ACR) message and Accounting-Answer (ACA) message. The ACR message format is defined according to [[!RFC3588]] (see section 6.2.2 of  [[!DIAMCHG]] to get more information about ACR). The ACA message format is defined according to [[!RFC3588]] (see section 6.2.3 of [[!DIAMCHG]] to get more information about ACA):</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IPTV Control FE sends ACR message to Charging FE to charge for the selected Digital Media. The ACR message is defined in section 6.2.2 of [[!DIAMCHG]].</td></tr>
<tr><td class="label">Step 2:</td><td>The Charging FE returns ACA message to IPTV Control FE with purchase result. The ACA message is defined in section 6.2.3 of [[!DIAMCHG]].</td></tr>
</table>
</section>
</section>
</section>
</section>




<section class="appendix" id="change-history"><!--annex A --><h1>Change History (informative)</h1>
<p>This Annex is intentionally left blank.</p>
</section>
<section class="appendix" id="example-messages"><!--annex B --><h1>Example Messages (informative)</h1>
<section id="annex-b-1"><h2>IPTV Service Functions Message Examples</h2>
<section id="annex-b-1-1"><h3>Example Messages for unicast content streaming session setup with SIP session management</h3>
<figure id="cod-session-setup-sequence">
<figcaption>Figure ####: COD Session Set Up Sequence</figcaption>
<img alt="FIGURE 11" src="images/CoDSessionSetupSequence.png" />
</figure>
<p>Note: The IG had received in the response to the REGISTER the service route e.g. &lt;sip:pcscf.orange.com:5060;lr;comp=sigcomp&gt;  &lt;sip:scscf.orange.com:5060;lr; comp=sigcomp&gt;</p>
<p>The following Request_URI example is for the HD version of the movie “Twister”.  In the BCG, Twister is signalled with the CRID: “CRID://warnerbros.com/Twister” and the HD instance is signalled with the IMI: “imi:HD”.</p>
<p>Note: One or more of the characters “.”, “/” and “#” in the example below MAY need to be escaped as %2E (“.”), %2F (“/”) and %23 (“#”) depending on the restrictions imposed by the SIP Request URI.</p>
<p>In the call flows below, unchanged information (after the = sign) in any step are left blank.</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>Alice IG to P-CSCF:
<pre class="sip-signalling-example">
INVITE sip: OIPF_IPTV_COD_SERVICE_warnerbros.com/Twister#HD@orange.com SIP/2.0 //CRID before @
Via: SIP/2.0/UDP  172.102.12.5:5061 //where to send the response
Max-Forwards: 70
Route: &lt;sip:pcscf.orange.com:5060;lr;comp=sigcomp&gt;,
  &lt;sip:scscf.orange.com:5060;lr;comp=sigcomp&gt;
From: AliceIG &lt;sip:aliceIG@orange.com&gt;;tag=1928301774 // tag for integrity verification
To: sip: OIPF_IPTV_COD_SERVICE_warnerbros.com/Twister#HD@orange.com //same as request URI
CSeq: 314159 INVITE
Contact: &lt;sip: 172.102.12.5:5061;transport=UDP&gt;
Content-Type: application/sdp
Content-Length: (..)

v=0
o=AliceIG 2890844527 2890844527 IN IP4 172.102.12.5
s=Streaming Session
i=A Streaming session declared within the session description protocol
t=0
m=application 9 TCP iptv_rtsp // media line for RTSP control protocol
c=IN IP4 172.102.12.5
a=connection:new  
a=setup:active

m=video 6666 RTP/AVP 33  // video
c=IN IP4 172.102.12.5
b= AS:4000
a=rcvonly
</pre>
</td></tr>
<tr><td class="label">Step 2:</td><td>P-CSCF to S-CSCF in ASM
<pre class="sip-signalling-example">
INVITE
Via: SIP/2.0/UDP pcscf.orange.com:5060, SIP/2.0/UDP  172.102.12.5:5061
Max-Forwards: 69
Route: &lt;sip:scscf.orange.com:5060;lr&gt;
Record-Route: &lt;sip:pcscf.orange.com:5060;lr;comp=sigcomp&gt;
From:
To:
CSeq:
Contact:
Content-Type:
Content-Length: (..)

v=
o=
s=
i=
t=
m=
c=
a=
a=

m=
c=
b=
a=
</pre>
</td></tr>
<tr><td class="label">Step 3:</td><td>S-CSCF to IPTV Control
<pre class="sip-signalling-example">
INVITE
Via: SIP/2.0/UDP scscf.orange.com:5060, SIP/2.0/UDP pcscf.orange.com:5060,
  SIP/2.0/UDP  172.102.12.5:5061,
Max-Forwards: 68
Record-Route: &lt;sip:scscf.orange.com:5060;lr,comp=sigcomp&gt;
  &lt;sip:pcscf.orange.com:5060;lr;comp=sigcomp&gt;
From:
To:
CSeq:
Contact:
Content-Type:
Content-Length: (..)
v=
o=
s=
i=
t=
m=
c=
a=
a=

m=
c=
b=
a=
</pre>
</td></tr>
<tr><td class="label">Steps 4-5:</td><td>IPTV Control to CDN Controller via S-CSCF
<pre class="sip-signalling-example">
INVITE sip: CDN_Controller@orange.com SIP/2.0

Max-Forwards: 66
Route: &lt;sip:CDN_Controller.orange.com:5060;lr&gt;
Record-Route: &lt;sip:scscf.orange.com:5060;lr;comp=sigcomp&gt;,
  &lt;sip:IPTV_SCSCF.orange.com:5060;lr;comp=sigcomp&gt;,
  &lt;sip:scscf.orange.com:5060;lr;comp=sigcomp&gt;,
  &lt;sip:pcscf.orange.com:5060;lr;comp=sigcomp&gt;

From:
To:
CSeq:
Contact:
Content-Type:
Content-Length: (..)
v=
o=
s=
i=
t=
m=
c=
a=
a=

m=
c=
b=
a=
</pre>
</td></tr>
<tr><td class="label">Step 6:</td><td>CDN Controller to Rennes Cluster Controller
<pre class="sip-signalling-example">
INVITE sip:Rennes_Cluster_Controller@orange.com SIP/2.0

Record-Route: &lt;sip:CDN_Controller.orange.com:5060;lr,comp=sigcomp&gt;,
  &lt;sip:scscf.orange.com:5060;lr,comp=sigcomp&gt;,
  &lt;sip:IPTV_SCSCF.orange.com:5060;lr,comp=sigcomp&gt;,
  &lt;sip:scscf.orange.com:5060;lr, comp=sigcomp&gt;,
  &lt;sip:pcscf.orange.com:5060;lr;comp=sigcomp&gt;
Max-Forwards: 65
Route: &lt;sip:Rennes_Cluster_Controller.orange.com;lr&gt;

From:
To:
CSeq:
Contact:
Content-Type:
Content-Length: (..)
v=
o=
s=
i=
t=
m=
c=
a=
a=
m=
c=
b=
a=
</pre>
</td></tr>
<tr><td class="label">Step 7:</td><td>Cluster Controller Reply to the CDN Controller
<pre class="sip-signalling-example">
SIP/2.0 200 OK

Via: SIP/2.0/UDP CDN_Controller.orange.com
Record-Route:  &lt;Rennes_Cluster_Controller.orange.com;lr,comp=sigcomp&gt;

From:
To:
CSeq:
Contact:
Content-Type:
Content-Length: (..)

v=0
o= Rennes_Cluster_Controller IN IP4 Rennes_Cluster_Controller.orange.com
s=
i=
c=IN IP4 Rennes_Cluster_Controller.orange.com
t=0

m=application 999 TCP iptv_rtsp // media line for RTSP control protocol chosen by CC
a=connection:new
a=setup:passive
a=fmtp:iptv_rtsp h-uri=rtsp://Rennes_Cluster_Controller.orange.com/Twister ;
  h-session = 940211290776250

m=video 7777 RTP/AVP 33  // server video port
a=sendonly
</pre>
</td></tr>
<tr><td class="label">Steps 8-12:</td><td>200 OK sent back to Alice IG using the same route</td></tr>
</table>
</section>
</section>
<section id="annex-b-2"><h2>Communication Services Message Examples</h2>
<section id="annex-b-2-1"><h3>Examples of HNI-IGI Message mapping to SIP</h3>
<p>The sample mappings provided in this section are focused on Chat and Presence. They are not exhaustive.</p>
<p>The main use cases described in the Open IPTV Functional Architecture document are covered:</p><ul>
<li>Presence
<li>Publication
<li>Subscription
<li>Notification
<li>Chat
<li>Init
<li>Outgoing message (standard)
<li>Outgoing message (isComposing)
<li>Incoming message
<li>Teardown
</ul>
<p>As an illustration, a typical IMS presence document is also presented at the end of the section.</p>
<section id="annex-b-2-1-1"><h4>Presence</h4>
<section id="annex-b-2-1-1-1"><h5>Initial Publication</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>SIP equivalent</th></tr>
<tr><td>POST <i>IG_URI</i>/SIP<br />
X-OITF-Request-Line: PUBLISH sip:david@oiptv.org SIP/2.0<br />
Host : 192.168.1.1<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:david@oiptv.org<br />
X-OITF-Expires: 3600<br />
X-OITF-Event: presence<br />
X-OITF-Call-Id: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF-CSeq: 1 PUBLISH<br />
X-OITF-Content-Type: application/pidf+xml<br />
X-OITF-Content-length: (...)<br />
<br />
Content-Type: application/pidf+xml<br />
Content-Length: (...)<br />
<br />
&lt;?xml version='1.0' encoding='UTF-8' ?&gt;<br />
&lt;presence xmlns='urn:ietf:params:xml:ns:pidf' entity='sip:david@oiptv.org'&gt;<br />
...<br />
&lt;/presence&gt;<br />
</td><td>
PUBLISH sip:david@oiptv.org SIP/2.0<br />
Via: SIP/2.0/UDP 10.194.56.134:5060;branch=z9h4bK61C529E16989<br />
From: sip:david@oiptv.org;tag=48240713<br />
To: sip:david@oiptv.org<br />
CSeq: 1 PUBLISH<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Max-forwards: 10<br />
Expires: 3600<br />
Event: presence<br />
Content-Type: application/pidf+xml<br />
Content-Length: (...)<br />
<br />
&lt;?xml version='1.0' encoding='UTF-8' ?&gt;<br />
&lt;presence xmlns='urn:ietf:params:xml:ns:pidf' entity='sip:david@oiptv.org'&gt;<br />
...<br />
&lt;/presence&gt;<br />
</td></tr>
</table>

<table class="hni-igi-mapping">
<tr><td>
HTTP/1.1 200 OK<br />
X-OITF-Response-Line: SIP/2.0 200 OK<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:david@oiptv.org<br />
X-OITF-Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF- CSeq: 1 PUBLISH<br />
X-OITF- SIP-ETag: 1514024804<br />
X-OITF- Expires: 6002<br />
X-OITF-Content-Length: 0<br />
Content-Length: 0<br />
</td><td>
SIP/2.0 200 OK<br />
Via: SIP/2.0/UDP 10.194.56.134:5060;branch=z9h4bK61C529E16989<br />
From: sip:david@oiptv.org;tag=48240713<br />
To: sip:david@oiptv.org;tag=12ba5d-287-55-1366522802<br />
CSeq: 1 PUBLISH<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Expires: 6002<br />
SIP-ETag: 1514024804<br />
Content-Length: 0<br />
</td></tr>
</table>
<p><b>Notes:</b></p>
<p>Specifying both a ‘From’ and a ‘To’ allows an identity to publish on behalf of another identity</p>
<p>Here the server has requested a shorter expiration time that will be handled internally by the IG</p>

</section>
<section id="annex-b-2-1-1-2"><h5>Updated Publication</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>SIP equivalent</th></tr>
<tr><td>
POST <i>IG_URI</i>/SIP<br />
X-OITF-Request-Line: PUBLISH sip:david@oiptv.org SIP/2.0<br />
Host : 192.168.1.1<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:david@oiptv.org<br />
X-OITF-Expires: 3600<br />
X-OITF-Event: presence<br />
X-OITF- CSeq: 2 PUBLISH<br />
X-OITF- Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF- SIP-if-match: 15140248043<br />
X-OITF- Content-Type: application/pidf+xml<br />
X-OITF- Content-length: (...)<br />
<br />
Content-Type: application/pidf+xml<br />
Content-Length: (...)<br />
&lt;?xml version='1.0' encoding='UTF-8' ?&gt;<br />
&lt;presence xmlns='urn:ietf:params:xml:ns:pidf' entity='sip:david@oiptv.org'&gt;<br />
...<br />
&lt;/presence&gt;<br />
</td><td>
PUBLISH sip:david@oiptv.org SIP/2.0<br />
Via: SIP/2.0/UDP 10.194.56.134:5060;branch=z9h4bK61C529E16989<br />
From: sip:david@oiptv.org;tag=48240713<br />
To: sip:david@oiptv.org<br />
CSeq: 2 PUBLISH<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Max-forwards: 10<br />
SIP-if-match: 15140248043<br />
Expires: 3600<br />
Event: presence<br />
Content-Type: application/pidf+xml<br />
Content-Length: (...)<br />
&lt;?xml version='1.0' encoding='UTF-8' ?&gt;<br />
&lt;presence xmlns='urn:ietf:params:xml:ns:pidf' entity='sip:david@oiptv.org'&gt;<br />
...<br />
&lt;/presence&gt;<br />
</td></tr>
</table>
<table class="hni-igi-mapping">
<tr><td>
HTTP/1.1 200 OK<br />
X-OITF-Response-Line: SIP/2.0 200 OK<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:david@oiptv.org<br />
X-OITF-Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF- CSeq: 2 PUBLISH<br />
X-OITF- SIP-ETag: 7816034523<br />
X-OITF- Expires: 600<br />
X-OITF-Content-Length: 0<br />
Content-Length: 0<br />
</td><td>
SIP/2.0 200 OK<br />
Via: SIP/2.0/UDP 10.194.56.134:5060;branch=z9h4bK61C529E16989<br />
From: sip:david@oiptv.org;tag=48240713<br />
To: sip:david@oiptv.org;tag=12ba5d-287-55-1366522802<br />
CSeq: 2 PUBLISH<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Expires: 600<br />
SIP-ETag: 7816034523<br />
Content-Length: 0<br />
</td></tr>
</table>
<p><b>Notes:</b></p>
<p>SIP-IF-Match As retrieved from the previous publication acknowledgment</p>
</section>
<section id="annex-b-2-1-1-3"><h5>End of Publication</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>SIP equivalent</th></tr>
<tr><td>POST <i>IG_URI</i>/SIP<br />
Host : 192.168.1.1<br />
X-IOTF-Request-Line: PUBLISH sip:david@oiptv.org SIP/2.0<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:david@oiptv.org<br />
X-OITF-Expires: 0<br />
X-OITF-Event: presence<br />
X-OITF-CSeq: 3 PUBLISH<br />
X-OITF- Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF- SIP-if-match: 78160345234<br />
X-OITF- Content-Type: application/pidf+xml<br />
X-OITF- Content-length: 0<br />
Content-Type: application/pidf+xml<br />
Content-Length: 0
</td><td>
PUBLISH sip:david@oiptv.org SIP/2.0<br />
Via: SIP/2.0/UDP 10.194.56.134:5060;branch=z9h4bK61C529E16989<br />
From: sip:david@oiptv.org;tag=48240713<br />
To: sip:david@oiptv.org<br />
CSeq: 3 PUBLISH<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Max-forwards: 10<br />
SIP-if-match: 78160345234<br />
Expires: 0<br />
Event: presence<br />
Content-Type: application/pidf+xml<br />
Content-Length: 0
</td>
</table>
<table class="hni-igi-mapping">
<tr><td>HTTP/1.1 200 OK<br />
X-OITF-Response-Line: SIP/2.0 200 OK<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:david@oiptv.org<br />
X-OITF-Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF-CSeq: 3 PUBLISH<br />
X-OITF-Content-Length: 0<br />
Content-Length: 0
</td><td>
SIP/2.0 200 OK<br />
Via: SIP/2.0/UDP 10.194.56.134:5060;branch=z9h4bK61C529E16989<br />
From: sip:david@oiptv.org;tag=48240713<br />
To: sip:david@oiptv.org;tag=12ba5d-287-55-1366522802<br />
CSeq: 3 PUBLISH<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Content-Length: 0
</td></tr>
</table>
<p><b>Notes:</b></p>
<p>Sip-if-match as retrieved from the previous publication acknowledgment</p>
</section>
<section id="annex-b-2-1-1-4"><h5>Initial subscription</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>SIP equivalent</th></tr>
<tr><td>
POST <i>IG_URI</i>/SIP<br />
X-OITF-Request-Line: SUBSCRIBE sip:fouz@oiptv.org SIP/2.0<br />
Host : 192.168.1.1<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:fouz@oiptv.org<br />
X-OITF-Expires: 3600<br />
X-OITF-Event: presence<br />
X-OITF-Accept: application/pidf+xml<br />
X-OITF- CSeq: 4 SUBSCRIBE<br />
X-OITF- Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF- Content-length: 0<br />
Content-length: 0
</td><td>
SUBSCRIBE sip:fouz@oiptv.org SIP/2.0<br />
Via: SIP/2.0/UDP 10.193.106.81:5060;branch=z9hG4bK1AD46E5D1E1<br />
From: sip:david@oiptv.org;tag=2764425547<br />
To: sip:fouz@oiptv.org<br />
CSeq: 4 SUBSCRIBE<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Contact: &lt;sip:david@10.193.106.81:5060;transport=UDP&gt;<br />
Expires: 3600<br />
Event: presence<br />
Accept: application/pidf+xml<br />
Content-length: 0
</td></tr>
</table>
<table class="hni-igi-mapping">
<tr><td>
HTTP/1.1 200 OK<br />
X-OITF-Response-Line: SIP/2.0 200 OK<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip: fouz@oiptv.org<br />
X-OITF-Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF-CSeq: 4 SUBSCRIBE<br />
X-OITF-Expires: 6005<br />
X-OITF-Content-Length: 0<br />
Content-Length: 0
</td><td>
SIP/2.0 200 OK<br />
Via: SIP/2.0/UDP 10.194.56.134:5060;branch=z9h4bK61C529E16989<br />
From: sip:david@oiptv.org;tag=2764425547<br />
To: sip:fouz@oiptv.org;tag=12ba5d-287-55-1366522802<br />
CSeq: 4 SUBSCRIBE<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Expires: 6005<br />
Content-Length: 0
</td></tr>
</table>
<p><b>Notes:</b></p>
<p>Here the server has requested a shorter expiration time that will be handled internally by the IG</p>
</section>
<section id="annex-b-2-1-1-5"><h5>Notification (individual)</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>SIP equivalent</th></tr>
<tr><td>
HTTP 200 OK<br />
X-OITF-Response-Line: NOTIFY sip:david@10.193.106.72:5060;transport=UDP SIP/2.0<br />
X-OITF-From: sip:fouz@oiptv.org<br />
X-OITF-To: sip:david@oiptv.org<br />
X-OITF-Event: presence<br />
X-OITF-CSeq: 1001 NOTIFY<br />
X-OITF-Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF-Subscription-State: active; expires=600<br />
X-OITF-Content-Type: application/pidf+xml<br />
X-OITF-Content-Length: (...)<br />
Content-Type: application/pidf+xml<br />
Content-Length: (...)<br />
&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />
&lt;presence xmlns="urn:ietf:params:xml:ns:pidf" entity="sip:fouz@oiptv.org"&gt;<br />
...<br />
&lt;/presence&gt;
</td><td>
NOTIFY sip:david@10.193.106.72:5060;transport=UDP SIP/2.0<br />
Via: SIP/2.0/UDP 10.194.117.18:5060;branch=z9hG4bK0014c262ba5d-2<br />
From: sip:fouz@oiptv.org;tag=10014c262ba5d<br />
To: sip:david@oiptv.org;tag=2764425547<br />
CSeq: 1001 NOTIFY<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Subscription-State: active; expires=600<br />
Contact: &lt;sip:10.194.117.18:5060;transport=UDP&gt;<br />
Event: presence<br />
Content-Type: application/pidf+xml<br />
Content-Length: (...)<br />
&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />
&lt;presence xmlns="urn:ietf:params:xml:ns:pidf" entity="sip:fouz@oiptv.org"&gt;<br />
...<br />
&lt;/presence&gt;
</td></tr>
</table>
</section>
<section id="annex-b-2-1-1-6"><h5>Subscription Refresh</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>SIP equivalent</th></tr>
<tr><td>
POST <i>IG_URI</i>/SIP<br />
X-OITF-Request-Line: SUBSCRIBE sip:fouz@oiptv.org SIP/2.0<br />
Host: 192.168.1.1<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:fouz@oiptv.org<br />
X-OITF-Expires: 3600<br />
X-OITF-Event: presence<br />
X-OITF-Accept: application/pidf+xml<br />
X-OITF-CSeq: 5 SUBSCRIBE<br />
X-OITF-Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF-Contact: &lt;sip:david@10.193.106.81:5060;transport=UDP&gt;<br />
X-OITF-Content-length: 0<br />
Content-length: 0
</td><td>
SUBSCRIBE sip:fouz@oiptv.org SIP/2.0<br />
Via: SIP/2.0/UDP 10.193.106.81:5060;branch=z9hG4bK1AD46E5D1E1<br />
From: sip:david@oiptv.org;tag=2764425547<br />
To: sip:fouz@oiptv.org<br />
CSeq: 5 SUBSCRIBE<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Contact: &lt;sip:david@10.193.106.81:5060;transport=UDP&gt;<br />
Expires: 3600<br />
Event: presence<br />
Accept: application/pidf+xml<br />
Content-length: 0
</td></tr>
</table>
<table class="hni-igi-mapping">
<tr><td>
HTTP/1.1 200 OK<br />
X-OITF-Response-Line: SIP/2.0 200 OK<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip: fouz@oiptv.org<br />
X-OITF-Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF-CSeq: 5 SUBSCRIBE<br />
X-OITF-Expires: 6005<br />
X-OITF-Content-Length: 0<br />
Content-Length: 0
</td><td>
SIP/2.0 200 OK<br />
Via: SIP/2.0/UDP 10.194.56.134:5060;branch=z9h4bK61C529E16989<br />
From: sip:david@oiptv.org;tag=2764425547<br />
To: sip:fouz@oiptv.org;tag=12ba5d-287-55-1366522802<br />
CSeq: 5 SUBSCRIBE<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Expires: 6006<br />
Content-Length: 0
</td></tr>
</table>
<p>Note that from the OITF’s point-of-view, both initial and refresh subscription requests are identical.</p>
<p>Here the server has requested a shorter expiration time, which will be handled internally by the IG.</p>
</section>
<section id="annex-b-2-1-1-7"><h5>End of subscription</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>SIP equivalent</th></tr>
<tr><td>
POST <i>IG_URI</i>/SIP<br />
X-OITF-Request-Line: SUBSCRIBE sip:fouz@oiptv.org SIP/2.0<br />
Host: 192.168.1.1<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:fouz@oiptv.org<br />
X-OITF-Expires: 0<br />
X-OITF-Event: presence<br />
X-OITF-Accept: application/pidf+xml<br />
X-OITF-CSeq: 6 SUBSCRIBE<br />
X-OITF-Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF-Contact: &lt;sip:david@10.193.106.81:5060;transport=UDP&gt;<br />
X-OITF-Content-length: 0<br />
Content-length: 0
</td><td>
SUBSCRIBE sip:fouz@oiptv.org SIP/2.0<br />
Via: SIP/2.0/UDP 10.193.106.81:5060;branch=z9hG4bK1AD46E5D1E1<br />
From: sip:david@oiptv.org;tag=2764425547<br />
To: sip:fouz@oiptv.org<br />
CSeq: 6 SUBSCRIBE<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Contact: &lt;sip:david@10.193.106.81:5060;transport=UDP&gt;<br />
Expires: 0<br />
Event: presence<br />
Accept: application/pidf+xml<br />
Content-length: 0
</td></tr>
</table>
<table class="hni-igi-mapping">
<tr><td>
HTTP/1.1 200 OK<br />
X-OITF-Response-Line: SIP/2.0 200 OK<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip: fouz@oiptv.org<br />
X-OITF-Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
X-OITF-CSeq: 5 SUBSCRIBE<br />
X-OITF-Expires: 6005<br />
X-OITF-Content-Length: 0<br />
<br />
Content-Length: 0
</td><td>
SIP/2.0 200 OK<br />
Via: SIP/2.0/UDP 10.194.56.134:5060;branch=z9h4bK61C529E16989<br />
From: sip:david@oiptv.org;tag=2764425547<br />
To: sip:fouz@oiptv.org;tag=12ba5d-287-55-1366522802<br />
CSeq: 6 SUBSCRIBE<br />
Call-ID: 78A0g080Ca3502i6414m360Bt38A6b2E4Fx61C8x<br />
Content-Length: 0
</td></tr>
</table>
</section>
</section>
<section id="annex-b-2-1-2"><h4>Chat</h4>
<section id="annex-b-2-1-2-1"><h5>Chat session setup</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>SIP equivalent</th></tr>
<tr><td>
POST <i>IG_URI</i>/SIP<br />
Host: 192.168.1.1<br />
X-OITF-Request-Line: INVITE sip:sports.room@chat.oiptv.org SIP/2.0<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:sports.room@chat.oiptv.org<br />
X-OITF-Accept: message/cpim<br />
X-OITF-Call-ID: 3413an89KU<br />
X-OITF-Content-Type: application/sdp<br />
X-OITF-Content-length: (...)<br />
<br />
Content-length: 0
</td><td>
INVITE sip:sports.room@chat.oiptv.org SIP/2.0<br />
To: sip:sports.room@chat.oiptv.org<br />
From: sip:david@oiptv.org;tag=786<br />
Call-ID: 3413an89KU<br />
Content-Type: application/sdp<br />
Content-length: (...)<br />
c=IN IP4 10.194.52.13<br />
m=message 7654 TCP/MSRP *<br />
a=accept-types:message/cpim<br />
a=path:msrp://10.194.52.13:7654/jshA7weztas;tcp
</td></tr>
</table>
<table class="hni-igi-mapping">
<tr><td>
HTTP/1.1 200 OK<br />
X-OITF-Response-Line: SIP/2.0 200 OK<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:sports.room@chat.oiptv.org<br />
X-OITF-Call-ID: 3413an89KU<br />
X-OITF-Content-Type: application/sdp<br />
X-OITF-Accept: message/cpim<br />
X-OITF-Content-length: (...)<br />
<br />
Content-Length: 0
</td><td>
SIP/2.0 200 OK<br />
To: sip:sports.room@chat.oiptv.org;tag=087js<br />
From: sip:david@oiptv.org;tag=786<br />
Call-ID: 3413an89KU<br />
Content-Type: application/sdp<br />
Content-length: (...)<br />
c=IN IP4 chat.oiptv.org<br />
m=message 12763 TCP/MSRP *<br />
a=accept-types:message/cpim<br />
a=path:msrp://chat.oiptv.org:12763/kjhd37s2s20w2a;tcp
</td></tr>
</table>
<p>Note that a final acknowledgment from the IG to the network is REQUIRED, but not described here.</p>
</section>
<section id="annex-b-2-1-2-2"><h5>Chat outgoing message (standard)</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>MSRP equivalent</th></tr>
<tr><td>
POST <i>IG_URI</i>/AUX<br />
X-HNI-IGI-Request: MSRP SEND MESSAGE<br />
X-HNI-IGI-Message-ID:<br />
X-HNI-IGI-From: sip:david@oiptv.org<br />
X-HNI-IGI-To: sip:sports.room@chat.oiptv.org<br />
<br />
Who else thinks this late penalty was a disgrace?
</td><td>
MSRP a786hjs2 SEND<br />
To-Path: msrp://chat.oiptv.org:12763/kjhd37s2s20w2a;tcp8<br />
From-Path: msrp://10.194.52.13:7654/jshA7weztas;tcp8<br />
Message-ID: 87652491<br />
Byte-Range: (...)<br />
Content-Type: message/cpim<br />
To: sip:sports.room@chat.oiptv.org<br />
From: David &lt;sip:david@oiptv.org&gt;<br />
DateTime: 2008-06-15T15:02:31-03:00<br />
Content-Type: text/plain<br />
Who else thinks this late penalty was a disgrace?<br />
-------a786hjs2$
</td></tr>
</table>
<table class="hni-igi-mapping">
<tr><td>
HTTP/1.1 200 OK<br />
X-HNI-IGI-Response-Line: MSRP 200 OK<br />
X-HNI-IGI-Message-ID: 87652491<br />
X-HNI-IGI-From: sip:david@oiptv.org<br />
X-HNI-IGI-To: sip:sports.room@chat.oiptv.org<br />
Content-Length: 0
</td><td>
MSRP a786hjs2 200 OK<br />
To-Path: msrp://chat.oiptv.org:12763/kjhd37s2s20w2a;tcp<br />
From-Path: msrp://10.194.52.13:7654/jshA7weztas;tcp<br />
-------a786hjs2$
</td></tr>
</table>
<p>The IG is responsible for mapping the caller and callee URIs to the actual MSRP paths exchanged during the chat setup</p>
</section>
<section id="annex-b-2-1-2-3"><h5>Chat outgoing message (isComposing)</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>MSRP equivalent</th></tr>
<tr><td>
POST <i>IG_URI</i>/AUX<br />
X-HNI-IGI-Request: MSRP SEND ACTIVITY<br />
X-OITF-Message-ID: 87653492<br />
X-HNI-IGI-From: sip:david@oiptv.org<br />
X-HNI-IGI-To: sip:sports.room@chat.oiptv.org<br />
&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />
&lt;isComposing xmlns="urn:ietf:params:xml:ns:im-iscomposing"<br />
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />
xsi:schemaLocation="urn:ietf:params:xml:ns:im-composing<br />
iscomposing.xsd"&gt;<br />
&lt;state&gt;active&lt;/state&gt;<br />
&lt;contenttype&gt;text/plain&lt;/contenttype&gt;<br />
&lt;refresh&gt;90&lt;/refresh&gt;<br />
&lt;/isComposing&gt;
</td><td>
MSRP a786hjs2 SEND<br />
To-Path: msrp://chat.oiptv.org:12763/kjhd37s2s20w2a;tcp9<br />
From-Path: msrp://10.194.52.13:7654/jshA7weztas;tcp9<br />
Message-ID: 87652492<br />
Byte-Range: (...)<br />
Content-Type: message/cpim<br />
Content-Length: (..)<br />
To: sip:sports.room@chat.oiptv.org<br />
From: David &lt;sip:david@oiptv.org&gt;<br />
DateTime: 2008-06-15T15:02:31-03:00<br />
Content-Type: application/im-iscomposing+xml<br />
&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />
&lt;isComposing xmlns="urn:ietf:params:xml:ns:im-iscomposing"<br />
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />
xsi:schemaLocation="urn:ietf:params:xml:ns:im-composing<br />
&nbsp;&nbsp;iscomposing.xsd"&gt;<br />
&lt;state&gt;active&lt;/state&gt;<br />
&lt;contenttype&gt;text/plain&lt;/contenttype&gt;<br />
&lt;refresh&gt;90&lt;/refresh&gt;<br />
&lt;/isComposing&gt;<br />
-------a786hjs2$
</td></tr>
</table>
<table class="hni-igi-mapping">
<tr><td>
HTTP/1.1 200 OK<br />
X-HNI-IGI-Response-Line: MSRP 200 OK<br />
X-HNI-IGI-Message-ID: 87652491<br />
X-HNI-IGI-From: sip:david@oiptv.org<br />
X-HNI-IGI-To: sip:sports.room@chat.oiptv.org<br />
Content-Length: 0
</td><td>
MSRP a786hjs2 200 OK<br />
To-Path: msrp://chat.oiptv.org:12763/kjhd37s2s20w2a;tcp<br />
From-Path: msrp://10.194.52.13:7654/jshA7weztas;tcp<br />
-------a786hjs2$
</td></tr>
</table>
<p>The IG is responsible for mapping the caller and callee URIs to the actual MSRP paths exchanged during the chat setup</p>
</section>
<section id="annex-b-2-1-2-4"><h5>Chat incoming message</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>MSRP equivalent</th></tr>
<tr><td>
HTTP/1.1 200 OK<br />
X-HNI-IGI-Request: MSRP RECEIVED MESSAGE<br />
X-OITF-From: sip:sports.room@chat.oiptv.org<br />
X-OITF-To: sip:david@oiptv.org<br />
X-OITF-Message-ID: 56712483<br />
<br />
I don't care: we won anyway!
</td><td>
MSRP a786hjs2 SEND<br />
To-Path: msrp://10.194.52.13:7654/jshA7weztas;tcp10<br />
From-Path: msrp://chat.oiptv.org:12763/kjhd37s2s20w2a;tcp10<br />
Message-ID: 56712483<br />
Byte-Range: (...)<br />
Content-Type: message/cpim<br />
Content-Length: (...)<br />
To: sip:sports.room@chat.oiptv.org<br />
From: Fouz &lt;sip:fouz@oiptv.org&gt;<br />
DateTime: 2008-06-15T15:02:31-03:00<br />
Content-Type: text/plain<br />
I don't care: we won anyway!<br />
-------a786hjs2$
</td></tr>
</table>
<p>Note that an acknowledgment from the IG to the network is REQUIRED, but not described here.</p>
<p>The IG SHALL be responsible for mapping the MSRP paths exchanged during the chat setup to the actual caller and callee URIs</p>
</section>
<section id="annex-b-2-1-2-5"><h5>Chat session teardown</h5>
<table class="hni-igi-mapping">
<tr><th>HNI-IGI Interface</th><th>SIP equivalent</th></tr>
<tr><td>
POST <i>IG_URI</i>/SIP<br />
X-OITF-Request-Line:  BYE sip:sports.room@chat.oiptv.org SIP/2.0<br />
Host: 192.168.1.1<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:sports.room@chat.oiptv.org<br />
X-OITF-Call-ID: 3413an89KU11<br />
X-OITF-CSeq:  231 BYE<br />
X-OITF-Content-Length: 0<br />
Content-length: 0
</td><td>
BYE sip:sports.room@chat.oiptv.org SIP/2.0<br />
Via: SIP/2.0/UDP 192.0.2.4;branch=z9hG4bKnashds10<br />
Max-Forwards: 70<br />
To: sip:sports.room@chat.oiptv.org;tag=087js<br />
From: sip:david@oiptv.org;tag=786<br />
Call-ID: 3413an89KU11<br />
CSeq: 231 BYE<br />
Content-Length: 0
</td></tr>
</table>
<table class="hni-igi-mapping">
<tr><td>
HTTP/1.1 200 OK<br />
X-OITF-Response-Line: SIP/2.0 200 OK<br />
X-OITF-From: sip:david@oiptv.org<br />
X-OITF-To: sip:sports.room@chat.oiptv.org<br />
X-OITF-Call-ID: 3413an89KU<br />
X-OITF-CSeq: 231 BYE<br />
X-OITF-Content-Length: 0<br />
Content-Length: 0
</td><td>
SIP/2.0 200 OK<br />
To: sip:sports.room@chat.oiptv.org;tag=087js<br />
From: sip:david@oiptv.org;tag=786<br />
Call-ID: 3413an89KU<br />
CSeq: 231 BYE<br />
Content-length: 0
</td></tr>
</table>
</section>
</section>
<section id="annex-b-2-1-3"><h4>Presence Document</h4>
<section id="annex-b-2-1-3-1"><h5>Presence Schema</h5>
<p>See Annex <a href="#presence-xml-schema" class="sectionRef">H</a> for the <a href="#presence-xml-schema" class="sectionTitleRef"></a>.</p>
</section>
<section id="annex-b-2-1-3-2"><h5>Presence Schema examples</h5>
<p>Examples of how the Presence information semantics are described in a typical Presence Information XML schema are shown below.</p>
<section id="annex-b-2-1-3-2-1"><h6>Example of Open IPTV Presence for Broadcast TV service</h6>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;presence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:iptv="urn:oipf:service:oitfpresence:2011"
  xmlns:oma="urn:oma:xml:prs:pidf:oma-pres"
  xmlns:pdm="urn:ietf:params:xml:ns:pidf:data-model"
  xmlns="urn:ietf:params:xml:ns:pidf" entity="sip:someone@example.com"&gt;
  &lt;tuple id="abcde"&gt;
    &lt;status&gt;
      &lt;basic&gt;open&lt;/basic&gt;
    &lt;/status&gt;

    &lt;oma:service-description&gt;
      &lt;oma:service-id&gt;Broadcast-TV&lt;/oma:service-id&gt;
      &lt;oma:version&gt;1.0&lt;/oma:version&gt;
      &lt;oma:description&gt;Broadcast TV service&lt;/oma:description&gt;
    &lt;/oma:service-description&gt;
    &lt;iptv:BroadcastTVService&gt;
      &lt;iptv:BroadcastTV Technology="DVB-T"&gt;
        &lt;iptv:currentChannel&gt;BCC&lt;/iptv:currentChannel&gt;
        &lt;iptv:currentProgram&gt;News&lt;/iptv:currentProgram&gt;
        &lt;iptv:serviceID&gt;BBC_ID&lt;/iptv:serviceID&gt;
      &lt;/iptv:BroadcastTV&gt;
    &lt;/iptv:BroadcastTVService&gt;

    &lt;timestamp&gt;2008-07-08T12:34:21Z&lt;/timestamp&gt;
  &lt;/tuple&gt;

  &lt;pdm:device id="aa111"&gt;
    &lt;pdm:deviceID&gt;
      urn:uuid:11162e19-5fbf-43fc-a2fd-d23002787599
    &lt;/pdm:deviceID&gt;
    &lt;pdm:timestamp&gt;2008-07-08T12:34:21Z&lt;/pdm:timestamp&gt;
  &lt;/pdm:device&gt;

&lt;/presence&gt;
</pre>
</section>
</section>
</section>
</section>
</section>
</section>
<section class="appendix" id="user-profile-description"><!--annex C --><h1>User Profile Description (informative)</h1>
<section id="annex-c-1"><h2>IPTV Subscription Profile</h2>
<p>IPTV Subscription Profile encompasses relevant information REQUIRED to operate an IPTV service. This includes user settings regarding:</p><ul>
<li>Global settings (Language preference, user action recordable).
<li>Broadcast settings, with List of subscribed Schedueld Content service packages. 
</ul>
<p>Broadcast service refers to Scheduled Content services. Accordingly, Broadcast settings refer to the Scheduled Content settings.</p>
<p>A Schedueld Content service package is a set of elementary Schedueld Content TV services, along with a description. These Schedueld Content services have the same authorization and charging policy.</p>
<p>A Schedueld Content IPTV service is for instance a multicast IPTV channel, interactive channel, mosaic that a user MAY subscribe to.</p>
<p>NOTE: The Broadcast settings only provide a reference to service package and/or associated services that a given IPTV user has subscribed to, and is not meant to be a complete description of the service package and/or service. The complete service package and/or service description SHOULD be available in an associated IPTV Service Profile definition. If the list of elementary IPTV services associated with a given service package are not explicitly listed in the IPTV subscription profile, then it implies that the IPTV user has implicitly subscribed to all of the IPTV services within that service package.</p>
<ul>
<li>Content on demand settings (Parental control level).
<li>PVR settings (PVR preferences network/local, PVR user restrictions, PVR storage limit).
<li>User Equipment information (OITF) which uniquely identifies the user’s OITF, classifies it as a device type (OITF-STV, OITF-TV) and provides relevant device capabilities. An IPTV user MAY be associated with one or more OITF(s) and every OITF is uniquely identified with a Unique Identifier (tUEID). The OITF capabilities associated with an IPTV user profile MAY be used for customization of IPTV service selection data that is provided by the IPTV Service Discovery to the IPTV user (based on capabilities of the OITF with which the IPTV user is currently associated). For instance, an IPTV user on a SD-only device would not be provided with information related to HD services. The OITF settings is not intended to cover all information related to the OITF and currently holds only the OITF capabilities attribute since this information MAY be used by the IPTV service discovery  for personalized service selection.
</ul>
<p>Note that detailed information about the OITF MAY be located elsewhere and can be referenced by the IPTV Subscription Profile using the tUEID element.</p>
<section id="annex-c-1-1"><h3>XML Schema for the IPTV Subscription Profile</h3>
<p>XML Schema for the IPTV profile, based on [[!TS183063]] Annex C:</p>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="org:oipf:iptv:IPTVProfile:2011
  xmlns:tns="org:oipf:iptv:IPTVProfile:2011"
  xmlns:ueprofile="org:oipf:iptv:UEProfile:2010"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified"
  attributeFormDefault="unqualified"&gt;

  &lt;xs:import namespace="org:oipf:iptv:UEProfile:2010"
    schemalocation="iptv-UEProfile.xsd" /&gt;
  &lt;xs:element name="IPTVProfile"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        XML Schema for representing the IPTV Profile object
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="UEProfile" type="ueprofile:tUEProfile" minOccurs="0" /&gt;
        &lt;xs:element name="GlobalSettings" type="tns:tGlobalSettings" /&gt;
        &lt;xs:element name="BCProfile" type="tns:tBCProfile" minOccurs="0" /&gt;
        &lt;xs:element name="CoDProfile" type="tns:tCoDProfile" minOccurs="0" /&gt;
        &lt;xs:element name="PVRProfile" type="tns:tPVRProfile" minOccurs="0" /&gt;
        &lt;xs:element name="Extension" type="tns:tExtension" minOccurs="0" /&gt;
        &lt;xs:any namespace="##other" processContents="lax" minOccurs="0"
          maxOccurs="unbounded" /&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name="ProfileId" type="xs:ID" /&gt;
      &lt;xs:anyAttribute/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:complexType name="tBCProfile"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="BCServicePackage" type="tns:tBCServicePackage"
        maxOccurs="unbounded" /&gt;
      &lt;xs:element name="Extension" type="tns:tExtension" minOccurs="0" /&gt;
      &lt;xs:any namespace="##other" processContents="lax" minOccurs="0"
        maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="tBCServicePackage"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="BCPackageId" type="tns:tBCServicePackageID" /&gt;
      &lt;xs:element name="Description" type="tns:tBCServicePackageDescription"
        minOccurs="0" /&gt;
      &lt;xs:element name="BCService" type="tns:tBCService" minOccurs="0"
        maxOccurs="unbounded" /&gt;
      &lt;xs:element name="Extension" type="tns:tExtension" minOccurs="0" /&gt;
      &lt;xs:any namespace="##other" processContents="lax" minOccurs="0"
        maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="tBCServicePackageID" final="list restriction"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:minLength value="0" /&gt;
      &lt;xs:maxLength value="16" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="tBCServicePackageDescription" final="list restriction"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:minLength value="0" /&gt;
      &lt;xs:maxLength value="64" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:complexType name="tBCService"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="ParentalControl" type="tns:tParentalControlLevel"
        minOccurs="0" /&gt;
      &lt;xs:element name="BCServiceId" type="tns:tBCServiceID" minOccurs="1" /&gt;
      &lt;xs:element name="QualityDefinition" type="tns:tQualityDefinition"
        minOccurs="0" /&gt;
      &lt;xs:element name="Extension" type="tns:tExtension" minOccurs="0" /&gt;
      &lt;xs:any namespace="##other" processContents="lax" minOccurs="0"
        maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="tBCServiceID" final="list restriction"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:minLength value="0" /&gt;
      &lt;xs:maxLength value="16" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="tQualityDefinition" final="list restriction"&gt;
    &lt;xs:restriction base="xs:unsignedByte"&gt;
      &lt;xs:minInclusive value="0" /&gt;
      &lt;xs:maxInclusive value="1" /&gt;
      &lt;xs:enumeration value="0"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;SD&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;Standard Definition&lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
      &lt;xs:enumeration value="1"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;HD&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;High Definition&lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:complexType name="tCoDProfile"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="ParentalControl" type="tns:tParentalControlLevel"
        minOccurs="0"/&gt;
      &lt;xs:element name="Extension" type="tns:tExtension" minOccurs="0"/&gt;
      &lt;xs:any namespace="##other" processContents="lax" minOccurs="0"
        maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="tParentalControlLevel" final="list restriction"&gt;
    &lt;xs:restriction base="xs:unsignedByte"&gt;
      &lt;xs:minInclusive value="0"/&gt;
      &lt;xs:maxInclusive value="5"/&gt;
      &lt;xs:enumeration value="0"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;ALL&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;All contents&lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
      &lt;xs:enumeration value="1"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;Level 1&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;Level 1 contents&lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
      &lt;xs:enumeration value="2"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;Level 2&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;Up to level 2&lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
      &lt;xs:enumeration value="3"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;Level 3&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;Up to level 3&lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
      &lt;xs:enumeration value="4"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;Level 4&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;Up to level 4&lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
      &lt;xs:enumeration value="5"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;Level 5&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;Up to level 5&lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:complexType name="tPVRProfile"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:annotation&gt;
        &lt;xs:documentation&gt;
          Unit of the StorageLimitInVolume element is the GigaOctet
        &lt;/xs:documentation&gt;
      &lt;/xs:annotation&gt;
      &lt;xs:element name="PVRPreference" type="tns:tPVRPreference"/&gt;
      &lt;xs:element name="StorageLimitInTime" type="tns:tStorageLimitInTime"
        minOccurs="0"/&gt;
      &lt;xs:element name="StorageLimitInVolume" type="tns:tStorageLimitInVolume"
        minOccurs="0"/&gt;
      &lt;xs:element name="Extension" type="tns:tExtension" minOccurs="0"/&gt;
      &lt;xs:any namespace="##other" processContents="lax" minOccurs="0"
        maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="tPVRPreference" final="list restriction"&gt;
    &lt;xs:restriction base="xs:unsignedByte"&gt;
      &lt;xs:minInclusive value="0"/&gt;
      &lt;xs:maxInclusive value="1"/&gt;
      &lt;xs:enumeration value="0"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;Network&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;
              Recording is done in the network
            &lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
      &lt;xs:enumeration value="1"&gt;
        &lt;xs:annotation&gt;
          &lt;xs:documentation&gt;
            &lt;xs:label xml:lang="en"&gt;User_Equipment&lt;/xs:label&gt;
            &lt;xs:definition xml:lang="en"&gt;
              Recording is done on the user equipment
            &lt;/xs:definition&gt;
          &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
      &lt;/xs:enumeration&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="tNPVRStorageLimitInTime"&gt;
    &lt;xs:restriction base="xs:duration"&gt;
      &lt;xs:minInclusive value="PT0H"/&gt;
      &lt;xs:maxInclusive value="PT1000000000H"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="tNPVRStorageLimitInVolume"&gt;
    &lt;xs:restriction base="xs:nonNegativeInteger"/&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:complexType name="tGlobalSettings"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="LanguagePreference" type="tns:tLanguage" minOccurs="0"/&gt;
      &lt;xs:element name="UsersActionRecodable" type="tns:tUserActionRecordable"/&gt;
      &lt;xs:element name="Extension" type="tns:tExtension" minOccurs="0"/&gt;
      &lt;xs:any namespace="##other" processContents="lax" minOccurs="0"
        maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="tLanguage"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:annotation&gt;
        &lt;xs:documentation&gt;
          &lt;xs:definition xml:lang="en"&gt;ISO 639-2 Language code&lt;/xs:definition&gt;
        &lt;/xs:documentation&gt;
      &lt;/xs:annotation&gt;
      &lt;xs:minLength value="3"/&gt;
      &lt;xs:maxLength value="3"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:complexType name="tExtension"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:any processContents="lax" minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="tUserActionRecordable"&gt;
    &lt;xs:restriction base="xs:boolean"/&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre>
</section>

</section>
<section id="annex-c-2"><h2>XML Schema for the OIPF Profile</h2>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="org:oipf:iptv:UEProfile:2010"
  xmlns:tns="org:oipf:itpv:UEProfile:2010"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:tva="urn:tva:metadata:2011" 
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;

  &lt;xs:import namespace="urn:tva:metadata:2011"
    schemaLocation="imports/tva_metadata_3-1_v171.xsd" /&gt;
  &lt;xs:annotation&gt;
    &lt;xs:documentation xml:lang="en"&gt;
      Defines the capabilities of the OIPF that is currently
      associated with the user
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name="UEInformation" type="tns:tUEProfile" /&gt;
  &lt;xs:complexType name="tUEProfile"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="UserEquipmentID" type="tns:tUEID" /&gt;
      &lt;xs:element name="UserEquipmentClass" type="tns:tUserEquipmentClass" /&gt;
      &lt;xs:element name="Resolution" type="tns:tResolution"
        minOccurs="0" /&gt;
      &lt;xs:element name="SupportedEncodings" type="tns:tSupportedEncodings"
        minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;xs:element name="SupportedProtocols" type="tns:tSupportedProtocols"
        minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;xs:element name="SupportedContentProtection"
        type="tns:tSupportedContentProtection"
        minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;xs:element name="SupportedCSPG" type="tns:tCSPG"
        minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;xs:element name="IPEncapsulations" type="tns:tIPEncapsulations"
        minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;xs:element name="Extension" type="tns:tExtension"
        minOccurs="0" /&gt;
      &lt;xs:any namespace="##other" processContents="lax"
        minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="tUEID"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;User Equipment ID&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Unique Identifier for the OIPF(to be specified)
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;

    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:minLength value="0" /&gt;
      &lt;xs:maxLength value="16" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="tUserEquipmentClass"
    final="list restriction"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;User Equipment class&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Specifies the type of OIPF
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;

    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="OITF-TV" /&gt;
      &lt;xs:enumeration value="OITF-STB" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:complexType name="tResolution"&gt;
    &lt;xs:attribute name="HorizontalSize" type="xs:integer"&gt;
      &lt;xs:annotation&gt;
        &lt;xs:documentation&gt;
          horizontal size in pixels of the screen
        &lt;/xs:documentation&gt;
      &lt;/xs:annotation&gt;
    &lt;/xs:attribute&gt;
    &lt;xs:attribute name="VerticalSize" type="xs:integer"&gt;
      &lt;xs:annotation&gt;
        &lt;xs:documentation&gt;
          vertical size in pixels of the screen
        &lt;/xs:documentation&gt;
      &lt;/xs:annotation&gt;
    &lt;/xs:attribute&gt;
    &lt;xs:attribute name="Rotate" type="xs:boolean"&gt;
      &lt;xs:annotation&gt;
        &lt;xs:documentation&gt;
          set to TRUE if the screen can be rotated (horizontal
          becomes vertical)
        &lt;/xs:documentation&gt;
      &lt;/xs:annotation&gt;
    &lt;/xs:attribute&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="tSupportedEncodings"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;encodings&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Specifies the supported audio and video encodings
          (eg. MPEG2,H264 AC3, AAC etc)
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="AudioEncoding" type="tns:tAudioEncoding"
        minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;xs:element name="VideoEncoding" type="tns:tVideoEncoding"
        minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="tAudioEncoding"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;Audio Encoding&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Specifies supported audio encoding Properties
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="Encoding" type="tva:ControlledTermType" /&gt;
      &lt;xs:element name="Extension" type="tns:tExtension"
        minOccurs="0" /&gt;
      &lt;xs:any namespace="##other" processContents="lax"
        minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="tVideoEncoding"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;Video Encoding&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Specifies supported video encoding properties
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="Encoding" type="tva:ControlledTermType" /&gt;
      &lt;xs:element name="SupportedFrameRate" type="tva:FrameRateType"
        minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;xs:element name="Extension" type="tns:tExtension"
        minOccurs="0" /&gt;
      &lt;xs:any namespace="##other" processContents="lax"
        minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="tSupportedProtocols"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;Protocols&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Specifies a list of supported protocols ('OIPF-HTTP-AS' for HTTP
          Adaptive Streaming as defined in OIPF, 'HTTP-PDL' for Progressive
          Download, 'HTTP-DL' for HTTP Download)
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="OIPF-HTTP-AS" /&gt;
      &lt;xs:enumeration value="HTTP-PDL" /&gt;
      &lt;xs:enumeration value="HTTP-DL" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:complexType name="tSupportedContentProtection"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;Content Protection&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Specifies the supported content protection system (e.g.,
          "urn:dvb:casystemid:19188") with optionally the gateway (e.g., "CI+" or
          "DTCP-IP") and supported protected formats
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="ProtectedFormat" type="tProtectedFormat"
        minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;xs:any namespace="##any" processContents="lax"
          minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
    &lt;xs:attribute name="ContentProtectionSystemID"
      type="xs:string" use="required" /&gt;
    &lt;xs:attribute name="CSPG" type="tns:tCSPG" use="optional" /&gt;
    &lt;xs:anyAttribute namespace="##any" processContents="lax"
      minOccurs="0" maxOccurs="unbounded" /&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="tCSPG"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;CSPG type&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Specifies the type of CSPG
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="OIPF-CI+" /&gt;
      &lt;xs:enumeration value="OIPF-DTCP-IP" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="tProtectedFormat"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;Protected Format&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Specifies the supported Protected Format
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="BBTS" /&gt;
      &lt;xs:enumeration value="PF" /&gt;
      &lt;xs:enumeration value="PDCF" /&gt;
      &lt;xs:enumeration value="MPIMP" /&gt;
      &lt;xs:enumeration value="DCF" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="tIPEncapsulations" final="list restriction"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        &lt;xs:label xml:lang="en"&gt;encapsulation&lt;/xs:label&gt;
        &lt;xs:definition xml:lang="en"&gt;
          Specifies the IP encapsulation that is supported on
          the device (UDP/RTP, UDP/M2TS, UDP/RTP/M2TS)
        &lt;/xs:definition&gt;
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="UDP/RTP" /&gt;
      &lt;xs:enumeration value="UDP/M2TS" /&gt;
      &lt;xs:enumeration value="UDP/RTP/M2TS" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:complexType name="tExtension"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:any processContents="lax" minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre>
</section>
<section id="annex-c-3"><h2>IPTV Subscription Profile Elements classification</h2>
<p>In this section, IPTV Subscription Profile elements are classified according to the desired visibility to the user:</p><ul>
<li>User visible and manageable data
<li>User visible, but not user-manageable data
<li>Data neither visible nor manageable by the user (service parameters that remain in the network, etc.)
</ul>
<p>Elements MAY remain without classification (that would mean that it is not determined if the data SHOULD remain in the network or visible to the user.)<ul class="nobullet">
<li>element="IPTVProfile"
<li>attribute ="ProfileId"
</ul>
<section id="annex-c-3-1"><h3>User visible and manageable data</h3>
<p><b>CoD Profile:</b></p>
<p>In complexType ="tCoDProfile"</p><ul class="nobullet">
<li>element ="ParentalControl" type="tParentalControlLevel
</ul>
<p><b>Global Settings:</b></p>
<p>In complexType ="tGlobalSettings"</p><ul class="nobullet">
<li>element="LanguagePreference"  type=tLanguage
</ul>
</section>
<section id="annex-c-3-2"><h3>User visible, but not manageable data</h3>
<p>The term UE (User Equipment) is equivalent to the Open IPTV Forum term OITF.</p>
<p>In complexType="tUEProfile"</p><ul class="nobullet">
<li>element ="UserEquipmentID" type="tUEID"
<li>element ="UECapabilities" type="tUECapabilities"
</ul>
<p>In complexType="tUECapabilities"</p><ul class="nobullet">
<li>element ="UserEquipmentClass" type="UserEquipmentClass"
</ul>
<p><b>N-PVR:</b></p>
<p>In complexType="tPVRProfile"</p><ul class="nobullet">
<li>element="PVRPreference"  type ="tPVRPreference"
<li>element ="StorageLimitInTime" type="tNPVRStorageLimitInTime"
<li>element ="StorageLimitInVolume" type="tNPVRStorageLimitInVolume"
</ul>
</section>
<section id="annex-c-3-3"><h3>Data neither visible nor manageable by the user</h3>
<p><b>BC Profile:</b></p>
<p>In complexType ="tBCProfile"</p><ul class="nobullet">
<li>element ="BCServicePackage" type="tBCServicePackage"
</ul>
<p>In complexType ="tBCServicePackage"</p><ul class="nobullet">
<li>element name="BCPackageId" type="tBCServicePackageID"
<li>element name="Description" type="tBCServicePackageDescription"
<li>element name="BCService" type="tBCService"
</ul>
<p>In complexType ="tBCService"</p><ul class="nobullet">
<li>element name="BCServiceId" type="tBCServiceID"
<li>element name="QualityDefinition" type="tQualityDefinition"
</ul>
</section>
</section>
</section>
<section class="appendix" id="attributes-for-scheduled-content"><!--annex D --><h1>Mapping attributes for Scheduled Content</h1>
<section id="annex-d-1"><h2>Mapping SDP attributes from DVB SD&amp;S information</h2>
<table class="mapping">
<tr><th>IP SDP parameters for each media stream</th><th>Corresponding DVB SD&amp;S element in [[!TS102034]] section 5.2.6.2 tables 4, 5 and 8.</th></tr>
<tr><td colspan=2><b>Scheduled Content Stream</b></td></tr>
<tr><td>Connection Data<br />c=&lt;network type&gt; &lt;address type&gt; &lt;connection address&gt;</td><td></td></tr>
<tr><td>&lt;network type&gt;</td><td>Not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;address type&gt;</td><td>Not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;connection address&gt;</td><td>IPMulticastAddress@Address</td></tr>
<tr><td>Media Announcements for content delivery<br />m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt &gt;</td><td></td></tr>
<tr><td>&lt;media&gt;</td><td>"video"  (also present in SD&amp;S)</td></tr>
<tr><td>&lt;port&gt;</td><td>IPMulticastAddress@Port</td></tr>
<tr><td rowspan=3>&lt;proto&gt;</td><td>“RTP/AVP” if IPMulticastAddress@Streaming=“rtp” or if IPMulticastAddress@Streaming is not present</td></tr>
<tr><td>“RTP/AVPF” if (IPMulticastAddress@Streaming=”rtp” or if IPMulticastAddress@Streaming is not present) and OITF wants to make use of FCC and/or RET service offer. (Note 1)</td></tr>
<tr><td>“MP2T/H2221/UDP”  or  “RAW/RAW/UDP” if IPMulticastAddress@Streaming=“udp”</td></tr>
<tr><td>&lt;fmt&gt;</td><td><p>When MPEG2-Transport Stream [[!MPEG2TS]] is used, &lt;fmt&gt; SHALL be “33” as specified in RFC 3551 [[!RFC3551]].</p>
<p>When OPTIONAL Timestamped-TS defined by [[!DLNA]] is used, the RTP/AVP dynamic payload type SHALL be used and &lt;encoding name&gt; of "a=rtpmap" line SHALL be "vnd.dlna.mpeg-tts" as specified in [[!DLNA]].</p>
<p>Example<pre>
    m=video 49232 RTP/AVP 98
    a=rtpmap:98 vnd.dlna.mpeg-tts/27000000</pre></td></tr>
<tr><td>Bandwidth <br />b=AS:&lt;bandwidth&gt;</td><td><p>MaxBitrate </p>
<p>Note 1: the “MaxBitrate” sttribute in SD&amp;S is calculated according to the TIAS bandwidth modifier defined in RFC 3890 [[!RFC3890]], but expressed in kbps. The OITF SHOULD do the necessary conversion to express the bandwidth in the SDP as “b=AS:&lt;bandwidth&gt;”.</p>
<p>Note 2: If the OITF wants to make use of FCC/RET service, the &lt;bandwidth&gt; for the FCC/RET enabled multicast content service is to be retrieved from the SIP OPTIONS response message.</p></td></tr>
<tr><td>BCServiceId</td><td><p>TextualIdentifier@ServiceName“:”TextualIdentifier@DomainName</p>
<p>Note that the TextualIdentifier@DomainName is an OPTIONAL attribute; therefore when not present, it is copied from the OfferingBase@DomainName</p></td></tr>
<tr><td>BCPackageId</td><td>Package@Id</td></tr>
<tr><td colspan=2><b>FEC stream</b><br />Note that the multicast address and source address of the FEC stream can be the same as the multicact content stream.</td></tr>
<tr><td>Media Announcements for FEC delivery<br />m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt&gt;</td><td>Note:  the FEC delivery can only be associated to a RTP delivered content. </td></tr>
<tr><td>&lt;media&gt;</td><td>“application”, not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;port&gt;</td><td>IPMulticastAddress.FECBaseLayer@Port</td></tr>
<tr><td>&lt;proto&gt;</td><td>RTP/AVP</td></tr>
<tr><td>&lt;fmt&gt;</td><td>Dynamic payload type</td></tr>
<tr><td>a=rtpmap:&lt;fmt&gt; &lt;encoding_name/clock_rate&gt;</td><td>&lt;encoding_name/clock_rate&gt; referring to the DVB-IP AL-FEC Base layer and is equal to:<br />“vnd.dvb.iptv.alfec-base/90000”</td></tr>
<tr><td>Connection Data at media level<br />c=&lt;network type&gt; &lt;address type&gt; &lt;connection address&gt;</td><td></td></tr>
<tr><td>&lt;network type&gt;</td><td>Not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;address type&gt;</td><td>Not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;connection address&gt;</td><td>IPMulticastAddress.FECBaseLayer@Address</td></tr>
<tr><td colspan=2><b>Network Generated Notification stream and Emergency Notification stream</b><br />Note that the multicast address and source address of the notification stream can be the same as the multicact content stream.</td></tr>
<tr><td>Connection Data at media level<br />c=&lt;network type&gt; &lt;address type&gt; &lt;connection address&gt;</td><td></td></tr>
<tr><td>&lt;network type&gt;</td><td>Not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;address type&gt;</td><td>Not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;connection address&gt;</td><td>IPMulticastAddress@Address</td></tr>
<tr><td>Media Announcements for content delivery<br />m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt &gt;</td><td></td></tr>
<tr><td>&lt;media&gt;</td><td>"application"  (also present in SD&amp;S)</td></tr>
<tr><td>&lt;port&gt;</td><td>IPMulticastAddress@Port</td></tr>
<tr><td>&lt;proto&gt;</td><td>“FLUTE/UDP”</td></tr>
<tr><td>&lt;fmt&gt;</td><td>0</td></tr>
<tr><td>BCServiceId</td><td>TextualIdentifier@ServiceName“:”TextualIdentifier@DomainName<p>Note that the TextualIdentifier@DomainName is an OPTIONAL attribute; therefore when not present, it is copied from the OfferingBase@DomainName</p></td></tr>
<tr><td>BCPackageId  </td><td>Package@Id</td></tr>
<tr><td colspan=2><b>IP multicast RET stream</b><br />Note that the multicast address and source address of the multicast RET stream can be the same as the multicast content stream.</td></tr>
<tr><td>Media Announcements for multicast RET delivery<br />m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt &gt;</td><td>Note: The multicast RET delivery can only be associated to RTP delivered content</td></tr>
<tr><td>&lt;media&gt;</td><td>"application", not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;port&gt;</td><td>MulticastRET@DestinationPort</td></tr>
<tr><td>&lt;proto&gt;</td><td>“RTP/AVP”</td></tr>
<tr><td>&lt;fmt&gt;</td><td>MulticastRET@RTPPayloadTypeNumber</td></tr>
<tr><td>a=rtpmap:&lt;fmt&gt; &lt;encoding_name/clock_rate&gt;</td><td>&lt;encoding_name/clock_rate&gt; is equal to:<br />“rtx/90000” [[!RFC4588]] (not signalled in SD&amp;S)</td></tr>
<tr><td>Connection Data at media level<br />c=&lt;network type&gt; &lt;address type&gt; &lt;connection address&gt;</td><td></td></tr>
<tr><td>&lt;network type&gt;</td><td>Not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;address type&gt;</td><td>Not retrieved from SD&amp;S</td></tr>
<tr><td>&lt;connection address&gt;</td><td>MulticastRET@GroupAddress</td></tr>
</table>
<p>Note: RTP/AVPF [[!RFC4588]] is the protocol identifier by which an RTP agent can indicate it supports the extended RTP profile for RTCP-based feedback. It is REQUIRED for FCC/RET services.</p>
</section>
<section id="annex-d-2"><h2>Service Package SDP attributes</h2>
<p>The format of the a=bc_service_package attribute is the following:</p>
<pre class="abnf">
a= bc_service_package : &lt;BCPackageId&gt; [mult_list] [bc_tv_service_id_list]
where
  &lt;mult_list&gt; ::= mult_list:&lt;source_unit&gt;{“|”&lt;source_unit&gt;}
  &lt;source_unit&gt; ::= [src_list:”(“&lt;src-list&gt;"),"]&lt;multicast_address&gt;{(“,”|”-“)&lt;multicast_address&gt;}
  &lt;src-list&gt; ::= &lt;source_address&gt;{(“,”|”-“)&lt;source_address&gt;}
  &lt;source_address&gt; ::= &lt;IP_address&gt;
  &lt;multicast_address&gt; ::= &lt;IP_address&gt;
  &lt;bc_tv_service_id_list&gt;::=&lt;BCServiceId&gt; {“,”&lt;BCServiceId&gt;}
  &lt;BCServiceId&gt; is the string defined above.
  &lt;BCPackageId&gt; is the service package ID string defined above.
</pre>
<p>(BNF notation). As seen in this notation the multi_list parameter can contain one or more source_unit parameters with multicast addresses that can be separated with either ‘,’ or ‘-’.</p>
<p>When they are separated with ‘-’ it means that it is a range of addresses. In addition there can OPTIONALly be a list of source addresses within the source unit parameter which is applicable for all the multicast addresses within the source unit parameter.</p>
</section>
</section>
<section class="appendix" id="protocol-names"><!--annex E --><h1>&lt;protocol&gt; names</h1>
<section id="e1"><h2>Definition of &lt;protocol&gt; names</h2>
<p>Following table shows the names (labels) of &lt;protocol&gt; which SHALL be a combination of signalling protocols and media transport protocols on UNI. </p>
<table id="t148" class="simple">
<caption>Table ####: Definition of &lt;protocol&gt; names</caption>
<tr><th>Service</th><th>Signalling protocol</th><th>Media Transport protocol</th><th>Name of &lt;protocol&gt;</th></tr>
<tr><td rowspan=4>Multicast content streaming</td><td rowspan=2>SIP + IGMP</td><td>RTP</td><td>“sip-igmp-rtp-udp”</td></tr>
<tr><td>direct-UDP</td><td>“sip-igmp-udp”</td></tr>
<tr><td>IGMP</td><td>RTP</td><td>“igmp-rtp-udp”</td></tr>
<tr><td>N/A</td><td>HTTP Adaptive Streaming</td><td>“dash”</td></tr>
<tr><td rowspan=6>Unicast content streaming</td><td rowspan=2>SIP + RTSP</td><td>RTP</td><td>“sip-rtsp-rtp-udp”</td></tr>
<tr><td>direct-UDP</td><td>“sip-rtsp-udp”</td></tr>
<tr><td>RTSP</td><td>RTP</td><td>“rtsp-rtp-udp”</td></tr>
<tr><td>N/A</td><td>HTTP</td><td>“http-get”</td></tr>
<tr><td>N/A</td><td>HTTP Adaptive Streaming</td><td>“has”</td></tr>
<tr><td>N/A</td><td>HTTP Adaptive Streaming</td><td>“dash”</td></tr>
<tr><td>Content download</td><td>N/A</td><td>HTTP</td><td>“http-get”</td></tr>
</table>
<p>Note: SIP based signalling protocols can only be used in managed network relying on IMS.</p>
</section>
</section>



<section class="appendix" id="system-infrastructure"><!--annex F --><h1>System Infrastructure</h1>
<section id="annex-f-1"><h2>OITF Start up High-Level Procedures</h2>
<section id="annex-f-1-1"><h3>OITF with Native HNI-IGI Support</h3>
<p>Figure <a href="#oitf-startup-with-hni-igi" class="figureRef">12</a> shows the high-level procedural flow for OITF starts up i.e. up to the point where all OITF functions are available. The following is a description of the steps:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The local device start up procedure (which is implementation dependent).</td></tr>
<tr><td class="label">Step 2:</td><td>The OITF SHALL discover the IG through a UPnP procedure (section <a href="#s10-1-1-1" class="sectionRef">10.1.1.1</a>, “<a href="#s10-1-1-1" class="sectionTitleRef"></a>”).</td></tr>
<tr><td class="label">Step 3:</td><td>The OITF SHALL use the DHCP option 124/125 to query the DHCP server to obtain the SP Discovery entry point (see section <a href="#s12-1-1-1-3" class="sectionRef">12.1.1.1.3</a>, “<a href="#s12-1-1-1-3" class="sectionTitleRef"></a>”.) If the deployment includes an IG, the DHCP server SHOULD<sup>1</sup>  be configured to return the IG address in the DHCP option 125, either as a FQDN or as an IP address.  In other words, in such a deployment the IG acts as the SP Discovery entry point (see Annex <a href="#annex-f-4" class="sectionRef">F.4</a>, “<a href="#annex-f-4" class="sectionTitleRef"></a>” for how an IG acts in this role).
<p class="footnote"><sup>1</sup>The DHCP server MAY, for example, return the FQDN or IP address of the SP Discovery FE in the network instead.</p></td></tr>
<tr><td class="label">Step 4:</td><td>The OITF SHALL retrieve the list of subscription identities (IMPUs) (section <a href="#s5-4-6-3" class="sectionRef">5.4.6.3</a>, “<a href="#s5-4-6-3" class="sectionTitleRef"></a>.”)</td></tr>
<tr><td class="label">Step 5:</td><td>The OITF SHALL registers the user identity with the IG (section <a href="#s5-4-6-1" class="sectionRef">5.4.6.1</a>, “<a href="#s5-4-6-1" class="sectionTitleRef"></a>.”)</td></tr>
<tr><td class="label">Step 6:</td><td>If the IG supports GBA, the OITF SHALL perform GBA authentication (section <a href="#s5-4-6-2-1" class="sectionRef">5.4.6.2.1</a>, “<a href="#s5-4-6-2-1" class="sectionTitleRef"></a>.”)</td></tr>
<tr><td class="label">Step 7:</td><td>The OITF SHALL perform service provider discovery (section <a href="#s5-4-1" class="sectionRef">5.4.1</a>, “<a href="#s5-4-1" class="sectionTitleRef"></a>.”) The service provider information MAY be returned directly by the IG.</td></tr>
<tr><td class="label">Step 8:</td><td>The OITF (or the DAE application, whichever applies) SHALL prompt the user to choose an SP. For any device, the timing and method of presentation as well as the relative positioning of the different SPs to the user is out of scope of the IPTV Solution specifications.</td></tr>
<tr><td class="label">Step 9:</td><td>The OITF (or the retrieved DAE application, whichever applies) SHALL perform service discovery (see section <a href="#s5-4-2" class="sectionRef">5.4.2</a>, “<a href="#s5-4-2" class="sectionTitleRef"></a>”.)</td></tr>
</table>
<figure id="oitf-startup-with-hni-igi">
<figcaption>Figure ####: High level Start up procedural flow for an OITF with native HNI-IGI support</figcaption>
<img alt="FIGURE 12" src="images/HighLevelOITFStartupWithHNIIGI.png" />
</figure>
</section>
<section id="annex-f-1-2"><h3>OITF with Non-Native HNI-IGI Support</h3>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The local device start up procedure (which is implementation dependent).</td></tr>
<tr><td class="label">Step 2:</td><td>The OITF SHALL use the DHCP option 124/125 to query the DHCP server to obtain the SP Discovery entry point (see section <a href="#s12-1-1-1-3" class="sectionRef">12.1.1.1.3</a>, “<a href="#s12-1-1-1-3" class="sectionTitleRef"></a>”.) If the deployment includes an IG, the DHCP server SHOULD<sup>2</sup>  be configured to return the IG address in the DHCP option 125, either as a FQDN or as an IP address.  In other words, in such a deployment the IG acts as the SP Discovery entry point (see Annex <a href="#annex-f-4" class="sectionRef">F.4</a>, “<a href="#annex-f-4" class="sectionTitleRef"></a>” for how an IG acts in this role).
<p class="footnote"><sup>2</sup>The DHCP server MAY, e.g., return the FQDN or IP address of the SP Discovery FE in the network instead.</p></td></tr>
<tr><td class="label">Step 3:</td><td>The OITF that has received the SP Discovery entry point via DHCP option 125 SHALL retrieve the Service Provider information by querying this entry point (see section <a href="#s5-4-1-2" class="sectionRef">5.4.1.2</a>, “<a href="#s5-4-1-2" class="sectionTitleRef"></a>.”) For any device, the time at which to trigger the query for Service Provider Discovery information is out of scope of the IPTV Solution specifications.</td></tr>
<tr><td class="label">Step 4:</td><td>The OITF (or the DAE application, whichever applies) SHALL prompt the user to choose an SP. For any device, the timing and method of presentation as well as the relative positioning of the different SPs to the user is out of scope of the IPTV Solution specifications.</td></tr>
<tr><td class="label">Step 5:</td><td>The OITF SHALL retrieve the list of user identities from the IG using the DAE application retrieved in step 4 (see section <a href="#s5-4-6-3" class="sectionRef">5.4.6.3</a>, “<a href="#s5-4-6-3" class="sectionRef"></a>”.)</td></tr>
<tr><td class="label">Step 6:</td><td>The OITF SHALL register a user identity with the service platform provider, using a DAE application retrieved in step 4 (see section <a href="#s5-4-6-1" class="sectionRef">5.4.6.1</a>, “<a href="#s5-4-6-1" class="sectionTitleRef"></a>”.)</td></tr>
<tr><td class="label">Step 7:</td><td>The OITF (or the retrieved DAE application, whichever applies) SHALL perform service discovery (see section <a href="#s5-4-2" class="sectionRef">5.4.2</a>, “<a href="#s5-4-2" class="sectionTitleRef"></a>”.)</td></tr>
</table>
<figure id="oitf-startup-without-hni-igi">
<figcaption>Figure ####: High-level start-up procedural flow for an OITF without native HNI-IGI support</figcaption>
<img alt="FIGURE 13" src="images/HighLevelOITFStartupWithoutHNIIGI.png" />
</figure>
</section>
<section id="annex-f-1-3"><h3>Integrated OITF/IG with no HNI-IGI Support</h3>
<p>Figure <a href="#oitf-ig-startup" class="figureRef">14</a> shows the high-level procedural flow for an integrated OITF/IG device with no HNI-IGI support . The following is a description of the steps:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The local device start up procedure (which is implementation dependent).</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL register the default user identity (section <a href="#s5-4-6-1" class="sectionRef">5.4.6.1</a>, “<a href="#s5-4-6-1" class="sectionTitleRef"></a>.”). </td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL perform GBA authentication if it supports the procedure (section <a href="#s5-4-6-2-1" class="sectionRef">5.4.6.2.1</a>, “<a href="#s5-4-6-2-1" class="sectionTitleRef"></a>.”)</td></tr>
<tr><td class="label">Step 4a:</td><td>The IG SHALL perform service provider discovery (section <a href="#s5-4-1" class="sectionRef">5.4.1</a>, “<a href="#s5-4-1" class="sectionTitleRef"></a>.”). </td></tr>
<tr><td class="label">Step 4b:</td><td>The OITF (or the DAE application, whichever applies) SHALL prompt the user to choose an SP. For any device, the timing and method of presentation as well as the relative positioning of the different SPs to the user is out of scope of the IPTV Solution specifications.</td></tr>
<tr><td class="label">Step 5:</td><td>The OITF (or the retrieved DAE application, whichever applies) SHALL perform service discovery (see section <a href="#s5-4-2" class="sectionRef">5.4.2</a>, “<a href="#s5-4-2" class="sectionTitleRef"></a>”.)</td></tr>
</table>
<figure id="oitf-ig-startup">
<figcaption>Figure ####: High-level start-up procedural flow for an integrated OITF/IG</figcaption>
<img alt="FIGURE 14" src="images/OITF-IGstartup.png" />
</figure>
</section>
</section>
<section id="annex-f-2"><h2>High-Level Procedure for an OITF Graceful Shut Down in network relying on IMS</h2>
<p>Figure <a href="#oitf-ims-shutdown" class="figureRef">15</a> shows a high-level procedural flow when an OITF is shut down, i.e. the OITF functionality is made completely inactive. The following steps are performed:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF gracefully terminates any ongoing IPTV session. (See appropriate IPTV Service Termination sections)</td></tr>
<tr><td class="label">Step 2:</td><td>The OITF de-registers the logged-in users (See section <a href="#s5-4-6-1-2" class="sectionRef">5.4.6.1.2</a>, “<a href="#s5-4-6-1-2" class="sectionTitleRef"></a>.”)</td></tr>
<tr><td class="label">Step 3:</td><td>The IG terminates all activities for communication services for the de-registered identity that are associated with the OITF contact point (IP address) (See section <a href="#s6-1-4" class="sectionRef">6.1.4</a>, “<a href="#s6-1-4" class="sectionTitleRef"></a>.”)</td></tr>
<tr><td class="label">Step 4:</td><td>The IG de-registers the logged in user from the network. (See section <a href="#s6-1-3-2-2" class="sectionRef">6.1.3.2.2</a>, “<a href="#s6-1-3-2-2" class="sectionTitleRef"></a>.”) If this is the last OITF to shut down and if this is a default identity, then the IG MUST deregister the old contact point with the network and re-register the IG as the new contact point. If this is a user identity being deregistered, then the IG MUST deregister this identity and register a default identity with the IG as the contact point.</td></tr>
<tr><td class="label">Step 5:</td><td>The OITF performs local shut down procedure.</td></tr>
</table>
<figure id="oitf-ims-shutdown">
<figcaption>Figure ####: High level Shut-down procedural flow for an OITF</figcaption>
<img alt="FIGURE 15" src="images/OITF-IMS-Shutdown.png" />
</figure>
</section>
<section id="annex-f-3"><h2>OITF Restart high level procedures for an IG integrating WAN GW</h2>
<p>This section details how stale SIP state can be detected in an IG integrating the GW, i.e. IG-GW, when an OITF restarts. This procedure is valid for both native and non-native HNI-IGI interfaces.</p>
<p>Figure <a href="#oitf-startup-with-ig-gw" class="figureRef">16</a> depicts how the IG-GW is able to establish a mapping between the SIP state (SIP dialog, IMPU and IP address) and the network state (IP address and deviceID).</p>
<p>The ability of the IG-GW to detect stale SIP state upon restart is based on the fact that when an OITF restarts, it re-initiates the DHCP server discovery (sends a DHCPDISCOVER message) and IP address request (DHCPREQUEST) procedures.  This is an indication that the OITF has re-started.  This is depicted in Figure <a href="#oitf-restart-with-ig-gw" class="figureRef">17</a>.</p>
<figure id="oitf-startup-with-ig-gw">
<figcaption>Figure ####: Overview of OITF Startup</figcaption>
<img alt="FIGURE 16" src="images/OITFwithIG-GWstartup.png" style="width:90%" />
</figure>
<figure id="oitf-restart-with-ig-gw">
<figcaption>Figure ####: Overview of OITF Restart</figcaption>
<img alt="FIGURE 17" src="images/OITFwithIG-GWrestart.png" style="width:90%" />
</figure>
</section>
<section id="annex-f-4"><h2>IG Startup and Shutdown procedures</h2>
<section id="annex-f-4-1"><h3>IG Startup procedures</h3>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>IG power up initialization procedures (this is implementation dependent).</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL retrieve or receive user identities associated with the IMS subscription and other configuration information from the network (see section <a href="#s5-4-5-1-3" class="sectionRef">5.4.5.1.3</a>, “<a href="#s5-4-5-1-3" class="sectionTitleRef"></a>”)</td></tr>
<tr><td class="label">Step 3:</td><td>The IG SHALL register the default identity associated with the IMS subscription with the service platform (IMS) provider (see user registration section <a href="#s6-1-3-2" class="sectionRef">6.1.3.2</a>)</td></tr>
<tr><td class="label">Step 4:</td><td>The IG SHALL perform the SP Discovery procedure (see section <a href="#s6-1-3-1" class="sectionRef">6.1.3.1</a> for details).  The IG SHALL store the SP Discovery information in the format (see [[.OIPF_META2]]) it was received.</td></tr>
</table>
<p>At this point, the IG has completed its startup procedures and is ready to accept requests from the OITF and/or network entities.</p>
<p>The IG SHALL drop any messages received from the network related to the default user until such time that it detects that a default user has registered at an OITF.</p>
</section>
<section id="annex-f-4-2"><h3>IG Shutdown procedures</h3>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The IG terminates all activities for communication services.</td></tr>
<tr><td class="label">Step 2:</td><td>The IG SHALL terminate all other SIP sessions.</td></tr>
<tr><td class="label">Step 3:</td><td>IG SHALL de-register all users bound to OITFs.</td></tr>
<tr><td class="label">Step 4:</td><td>The IG SHALL de-register any IG-initiated registration (if applicable).</td></tr>
<tr><td class="label">Step 5:</td><td>The IG performs its local shutdown procedure (implementation dependent)</td></tr>
</table>
</section>
</section>
<section id="annex-f-5"><h2>WAN Gateway Functions</h2>
<p>The WAN Gateway SHALL support multiple in-home devices for the consumer network, which SHALL be able to join the same multicast streams.</p>
<p>It SHOULD support IGMP snooping on all LAN side interfaces and forward inbound multicast packets to those physical interfaces which are connected to devices that have joined the specific multicast group.</p>
<p>The WAN Gateway SHALL support full IGMP v3 ([[!RFC3376]]).</p>
<p>It SHALL implement an IGMP proxy mechanism ([[!RFC4605]]).</p>
</section>
<section id="annex-f-6"><h2>NAT Traversal</h2>
<p>The reason why IPTV will not function by default behind a NAT is that many of the communication parameters in SIP and in RTSP are transported within the SDP message; these parameters include the IP and port numbers used for signalling and media. A device behind a NAT does not know how it will be seen from the Network domain; it only knows its own IP address and the ports on the server where the application runs.</p>
<p>Once communication with a server starts, the NAT device translates the private IP and port combination of the device connected on the private NAT interface to a temporary mapping of a public IP and port on the interface connected to the public network.</p>
<p>When the Consumer Network uses a private IP addressing schema (e.g. RFC 1918 [[!ADDR]]) and the NAT device is port and/or address restricted, Consumer Network devices that receive incoming signalling (such as session setup, notification message, etc...) SHALL implement a mechanism to maintain open and active the necessary pin holes on the NAT device.</p>
<section id="annex-f-6-1"><h3>NAT Traversal for SIP based services</h3>
<p>The two main NAT traversal scenarios are summarised below:</p>
<h4>Hosted NAT for SIP over IPSec</h4>
<p>The NAT traversal solution defined for this scenario requires the following steps:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>Verify that the client (e.g. SIP UA) is behind a NAT device. In the IMS/3GPP scenario, this is achieved by using a plain text SIP message (the first SIP REGISTER). Note that within standard RFC IPSec the first step is performed directly within IKE (Internet Key Exchange), but within the IMS environment the authentication and key agreement phase is performed by using the AKA algorithm.</td></tr>
<tr><td class="label">Step 2:</td><td>The SIP UA establish the IPSec tunnel with the P-CSCF using the IETF IPSec NAT traversal solution that is based on UDP encapsulation;</td></tr>
<tr><td class="label">Step 3:</td><td>The UA maintains the pin holes open in the NAT device with UDP keep alive messages;</td></tr>
<tr><td class="label">Step 4:</td><td>All SIP message are sent over the IPSec tunnel (in both direction).</td></tr>
</table>
<figure><img src="images/HostedNATforSIPoverIPSEC.png" style="text-align: center; width:80%" alt="HostedNATforSIPoverIPSEC.png"/></figure>
<p>As there is  a permanent communication path opened between the consumer device and the P-CSCF, it is always possible to send SIP messages between the entities involved in the communication (also when the SIP message request is originated from the network).</p>
<h4>Hosted NAT for SIP plain text</h4>
<p>The NAT traversal problem for SIP signalling can be solved by simply implementing keep alive messaging.</p>
<p>When it receives the first message, the P-CSCF can check the presence of a NAT device by comparing the address and port contained in the “Via” header to the actual IP and port combination in the received IP message.</p>
<p>Once registered with the SIP Registrar, the SIP UA MUST maintain the communication channel open by sending successive keep-alive packets before the binding expires in the NAT device.</p>
<p>The keep alive messages CAN either be SIP REGISTER or SIP OPTION sent by the client device.</p>
<figure><img src="images/HostedNATforSIPplaintext.png" style="text-align: center; width:80%" alt="HostedNATforSIPplaintext.png"/></figure>
<p>As there is a permanent communication path opened between the consumer device and the P-CSCF, it is always possible to send SIP messages between the entities involved in the communication (also when the SIP message request is originated from the network).</p>
<p>It is REQUIRED to use symmetric signalling, this means that the proxy MUST send and receive data on the same port number.</p>
</section>
<section id="annex-f-6-2"><h3>NAT Traversal and keep-alive messages for unicast content streaming services</h3>
<p>The NAT traversal problem for the media parameters transported within the SDP signalling can be solved by implementing a symmetric-RTP mechanism, as per RFC 4961 [[!RFC4961]]:
<p>When the OITF activates a unicast content streaming service it SHALL start to send keep-alive messages that consist of empty RTP packets with a payload type of 20 to the appropriate destination address and port, which depend on the scenario of the deployment and the model.
<p>In addition to the NAT traversal problem, there is a NAT binding keep-alive problem.  In general, it is not possible to determine or modify a retail NAT’s binding lifetime.  Therefore, in order to keep the NAT bindings open, it is necessary to send keep-alives frequently.  The REQUIRED frequency of the keep-alive messages is governed by a keep-alive timer.  The value of the keep-alive timer SHALL be a random number between 24 and 29 seconds, if not configured.  This timer MAY be configurable as described in RFC 4787 [[!RFC4787]]. The empty RTP packet with a payload type of 20 is defined in TS 24.229 and endorsed in [[!TS124503]].
<p>These empty RTP packets with payload type 20 fulfill the following functions:</p><ul>
<li>The packets are used by the network for the discovery of the public client IP address and port (actually, the address and port of the WAN gateway) to use for the delivery of the RTP stream, and
<li>The packets are also used to keep the necessary pin holes on the NAT device open and active for the duration of the incoming RTP streaming.
</ul>
<p>This solution applies for all cases with the following difference:</p><ul class="nobullet">
<li><b>IG and WAN GW in different physical devices</b><br />The functional entity that changes the destination address to the address and port discovered by the keep alive messages is the BGF (this is a component of the Transport Process Function defined in ES 282 003 [[!ES282003]]), under the control of the P-CSCF (this is a component of the ASM defined in [[.OIPF_ARCH2]]).
<li><b>IG and WAN GW in one physical device</b><br />In this scenario the IG+WAN GW device SHALL catch and suppress the keep-alive messages.
<li><b>WAN GW in one physical device (without IG)</b><br />The functional entity that changes the destination address to the address and port discovered by inspecting the keep-alive messages is the CDF, under the control of the CC. The keep-alive message, reaching the CDF, provides the client’s IP address and port to use for the delivery of the RTP stream.
</ul>
<p>Section <a href="#s7-1-1-1" class="sectionRef">7.1.1.1</a>, “<a href="#s7-1-1-1" class="sectionTitleRef"></a>”, gives some recommendations for selecting a mechanism for keeping the RTSP session “alive.” In order to minimize OITF uplink traffic, the NAT binding keep-alives SHOULD be re-used as RTSP session keep-alive messages whenever possible. Note that it might be necessary for the OITF to send both NAT binding keep-alive messages and RTSP session keep-alives, for example, when the server cannot bind the RTP and RTSP sessions.</p>
<p>When the MPEG2TS is encapsulated in UDP (direct UDP), in order to keep the NAT bindings open the keep-alive SHALL be a UDP packet with the body of the packet filled with the value 20. The sender and destination IP addresses and ports SHALL follow the same rules as RTP keep-alives.</p>
<p>Annex <a href="#system-infrastructure-mechanisms" class="sectionRef">G</a> gives more detail and describes the informational flow for these cases.</p>
</section>
</section>
</section>
<section class="appendix" id="system-infrastructure-mechanisms"><!--annex G --><h1>System Infrastructure Mechanisms (informative)</h1>
<section id="annex-g-1"><h2>NAT-T Informational flows for IPTV Services with SIP session management</h2>
<p>The WAN Gateway itself can perform simple Network Address Translation (NAT) at the network and transport layer, but it is not able to modify the addresses embedded in the encapsulated signalling message. In order for the SIP services to work with NAT in this specification there are two possible alternatives that take into account the different deployment scenario defined in the architecture specification [[.OIPF_ARCH2]]:</p><ol>
<li>If the WAN Gateway and the IG are deployed together in a physical device the NAT-T can be solved with an embedded SIP application-level gateway (SIP-ALG). In this scenario the SIP signalling is generated from this device using the public address and the control of the incoming media streams can be performed internally by the device.
<li>For other deployment scenarios, the NAT-T can be solved in the network with a SIP application-level gateway (SIP ALG) in the P-CSCF that coordinate the work of the BGF; this solution is commonly defined Hosted-NAT
</ol>
<p>The main advantages for the Hosted-NAT architectures are:</p><ul>
<li>Minimal impact on the user device and the WAN gateway;
<li>Security protocols supported (e.g. IPSec)
<li>Main components already defined by TISPAN and 3GPP
</ul>
<p>Since the Hosted-NAT solution is already used for other IMS services (e.g. voice call), it can be reused for the managed IPTV scenario in a general deployment option.</p>
<section id="annex-g-1-1"><h3>IG and WAN GW in one physical device</h3>
<p>This section defines the NAT Traversal mechanism when the IG and WAN Gateway are deployed in the same device. This is considered to be a common scenario for managed networks relying on IMS. An embedded NAT-T solution and implemented internally in this device is considered an efficient mechanism.</p>
<figure><img src="images/NAT-T_IGandWANinSameDevice.png" alt="NAT-T_IGandWANinSameDevice.png"/></figure>
<p>The following informational flow describes the interaction between the functional entities for unicast content streaming services in this scenario, for simplicity the S-CSCF is not shown:</p>
<figure><img src="images/NAT-T_IGandWANinSameDevice-sequence.png" alt="NAT-T_IGandWANinSameDevice-sequence.png"/></figure>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF sends a HTTP request for the desired unicast content streaming service to the IG (collocated with the WAN Gateway).</td></tr>
<tr><td class="label">Step 2:</td><td>The IG translates the request to a SIP INVITE with appropriate SDP description of the media request. The private address of the OITF is replaced with its public address.</td></tr>
<tr><td class="label">Step 3:</td><td>The P-CSCF (on Gq’) requests to the BGF to open the pin hole for the ingress RTSP and eventually RTP media streams.</td></tr>
<tr><td class="label">Step 4:</td><td>The INVITE is forwarded to the IPTV Control.</td></tr>
<tr><td class="label">Step 5:</td><td>The INVITE is forwarded to the Cluster Delivery Network Controller (and Cluster Controller).</td></tr>
<tr><td class="label">Steps 6-7:</td><td>The 200 OK message is sent back to the P-CSCF.</td></tr>
<tr><td class="label">Step 8:</td><td>The P-CSCF on Gq’ updates the allocation on the BGF for the RTSP and RTP media streams (egress traffic).</td></tr>
<tr><td class="label">Step 9:</td><td>The 200 OK message is sent back to the IG+WAN GW.</td></tr>
<tr><td class="label">Step 10:</td><td>The information carried with the 200 OK is sent to the OITF (inside the HTTP replay message).</td></tr>
<tr><td class="label">Step 11:</td><td>The OITF send a RTSP PLAY command to receive the media stream to the Content Delivery Function</td></tr>
<tr><td class="label">Step 12:</td><td>The OITF starts sending keep alive messages that consist of empty RTP packet with a payload type of 20 to the destination address and port contained in the 200 OK.</td></tr>
<tr><td colspan=2>Note: In this scenario the IG+WAN GW device SHALL catch and suppress the keep alive messages, because the co located ALG is aware of the NAT traversal mechanism, and SHAL be configured to suppress the keep alive messages</td></tr>
<tr><td class="label">Step 13:</td><td>The CDN starts to send the media stream to the IG+WAN GW (by using the IP/Port received in the SDP packet as modified by the IG in step 2;</td></tr>
<tr><td class="label">Step 14:</td><td>The NAT device delivers the stream to the OITF by using its internal NAT table;</td></tr>
</table>
</section>
<section id="annex-g-1-2"><h3>IG and WAN GW in different physical devices</h3>
<p>In this scenario, the WAN GW is the NAT device and the solution is based on the 3GPP TS 33.203 [[!3G-SEC]] IMS access NAT-T model.</p>
<figure><img src="images/NAT-T_IGandWANinDifferentDevices.png" style="width:90%;"  alt="NAT-T_IGandWANinDifferentDevices.png"/></figure>
<p>It is REQUIRED to maintain a permanent communication path opened between the IG and the P-CSCF. This can be achieved using the hosted NAT solution described in Annex <a href="#annex-f-6-1" class="sectionRef">F.6.1</a>. The following informational flow describes the interaction between the functional entities for unicast content streaming services and explains the need for the RTP keep-alive messages; for simplicity the S-CSCF is not shown:</p>
<figure><img src="images/NAT-T_IGandWANinDifferentDevices-sequence.png" style="width:90%;" alt="NAT-T_IGandWANinDifferentDevices-sequence.png"/></figure>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF sends a HTTP request for a unicast content streaming service to the IG.</td></tr>
<tr><td class="label">Step 2:</td><td>The IG translates the request to a SIP INVITE with appropriate SDP description of the media requested.</td></tr>
<tr><td class="label">Step 3:</td><td>The P-CSCF over the Gq’ interface requests the allocation of address ports on the BGF for the RTP media streams; this information is also used to update the IP and port address in the SDP message that describes the RTP stream.</td></tr>
<tr><td class="label">Step 4:</td><td>The INVITE with SDP updated is sent to the IPTV Control FE.</td></tr>
<tr><td class="label">Step 5:</td><td>The INVITE is forwarded to the Cluster Delivery Network Controller (and the Cluster Controller).</td></tr>
<tr><td class="label">Steps 6-7:</td><td>The 200 OK message is sent back to the P-CSCF.</td></tr>
<tr><td class="label">Step 8:</td><td>The SDP in the 200 OK answer is updated with the BGF address and port reserved for this media stream in the step 3.</td></tr>
<tr><td class="label">Step 9:</td><td>The information from the 200 OK is sent to the OITF.</td></tr>
<tr><td class="label">Step 10:</td><td>The OITF sends a RTSP PLAY command to receive the media stream from the Content Delivery Function.</td></tr>
<tr><td class="label">Step 11:</td><td>The OITF starts sending keep alive messages that consists of empty RTP packet with a payload type of 20 to the destination address and port contained in the 200 OK.</td></tr>
<tr><td class="label">Step 12:</td><td>The CDN starts to send the media stream to the BGF (by using the IP/Port received in the SDP packet).</td></tr>
<tr><td class="label">Step 13:</td><td>The BGF changes the destination address to the address and port discovered by the keep alive messages.</td></tr>
<tr><td class="label">Step 14:</td><td>The NAT device delivers the stream to the OITF by using its internal NAT table.</td></tr>
</table>
<p>Note: The transport for RTSP is TCP only with either persistent or transient connection.</p>
</section>
</section>
<section id="annex-g-2"><h2>NAT-T Informational flows for IPTV Services</h2>
<section id="annex-g-2-1"><h3>Symmetric-RTP</h3>
<p>The Symmetric-RTP mechanism can also enable the NAT Traversal of RTP stream if the CDF  for unicast content streaming service supports the detection of the external port number to send RTP stream towards the OITF. This solution will work even if multiple NAT devices exist between the CDF and the OITF.</p>
<p>The following flow describes the main steps involved in the Symmetric-RTP mechanism:</p>
<figure><img src="images/Symmetric-RTP.png" style="width:90%;" alt="Symmetric-RTP.png"/></figure>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF sends an RTSP SETUP request to the CC (Cluster Controller). The CC detects the client’s external IP address by the source IP address in the IP header.</td></tr>
<tr><td class="label">Step 2:</td><td>The CC forwards the information to the CDF. The CDF performs the same processing as the CC in step 1 to detect the presence of NAT. (The IP address declared in the SDP does not match the OITF address declared in the transport header of the RTSP SETUP message).</td></tr>
<tr><td class="label">Step 3:</td><td>The CDF returns the server IP address and port number of the RTP stream.</td></tr>
<tr><td class="label">Step 4:</td><td>The CC returns the response for SETUP request to OITF which contains the server IP address and port number of CDF.</td></tr>
<tr><td class="label">Step 5:</td><td>The OITF sends the keep-alive messages that consist of empty RTP packet with a payload type of 20 to the CDF. The keep-alive message punches a hole in the NAT device and then, reaching the CDF, provides the client’s IP address and port to use for sending the RTP stream. The address latching is performed by the CDF if and only if the device is behind NAT as discovered during step 2.</td></tr>
<tr><td class="label">Step 6:</td><td>The OITF issues an RTSP PLAY request.</td></tr>
<tr><td class="label">Step 7:</td><td>The RTP packets can now be delivered from the CDF to the OITF.</td></tr>
</table>
</section>
</section>
<section id="annex-g-3"><h2>Port mapping and NAT traversal for FCC/RET for multicast content services</h2>
<p>The port mapping procedure defined in [[!PORTMAP]] provides a means by which the OITF can signal to the FCC/RET server the port on which the FCC/RET server SHOULD transmit the FCC/RET RTP packets. However, the FCC/RET RTP packets transmitted by the FCC/RET server MAY not be able to reach the OITF when located behind a NAT.  This is because the  RAMS-R and NACK RTCP messages requesting the FCC/RET RTP packets, are sent by the OITF to the feedback target receive port on the FCC/RET server which is in general different from the port on which the FCC/RET RTP packets are sourced. I.e. the 4-tuple (UDP source and destination ports and IP source and destination addresses) of the FCC/RET request messages will not match with the 4-tuple of the FCC/RET packets, and hence MAY be blocked by a NAT positioned between the FCC/RET server and the OITF. </p>
<p>It MUST be noted that the main difference with previous sections in this Annex addressing NAT traversal for unicast content streams, is that there are no dedicated SIP and/or RTSP interactions between the OITF and the network,  prior to the unicast (FCC/RET) RTP packet transmission.</p>
<p>The way NAT traversal is addressed for FCC/RET is dependent upon whether cookie signalling is used or not.</p>
<section id="annex-g-3-1"><h3>Cookie Signalling</h3>
<p>In the port mapping process defined in [[!PORTMAP]] and referred to in Annex <a href="#fcc-and-ret" class="sectionRef">M</a>, “<a href="#fcc-and-ret" class="sectionTitleRef"></a>” the FCC/RET-enabled OITF sends a port mapping (request) RTCP message to the retransmission source entity RTP/RTCP receive port of the FCC/RET server (this is a single port as the FCC/RET server is REQUIRED to support RTP/RTCP port multiplexing for the unicast RTP FCC/RET session) prior to any RAMS (FCC) or NACK message exchange. The source port of this port mapping (request) message indicates to the FCC/RET server the (public) port on which the OITF wants to receive the FCC/RET packets. This information is encapsulated in a unique cookie that is generated by the FCC/RET server and which is transferred to the OITF along with the port mapping (response) message. This cookie is then sent by the OITF along with an  FCC/RET request  (RAMS-R or NACK FB RTCP message) to the Feedback Target entity of the FCC/RET server and hence provides  the information <i>in-band</i> to the FCC/RET server on which port the FCC/RET RTP packets MUST be sent. </p>
<p>For FCC services, the RTCP port mapping request message will “prime” the NAT between the OITF and the FCC server for the short-lived and contiguous unicast flow of the FCC RTP/RTCP packets transmitted by the FCC server to the OITF. No keep-alive mechanism is REQUIRED for the NAT binding. </p>
<p>To keep the NAT binding open for RET services, similar to the symmetric RTP/UDP concept detailed in the previous sections of this annex, the OITF SHALL send “keep alive” messages to the retransmission source entity RTP/RTCP receive port of the RET server  (which is different from the feedback target RTCP port of the FCC/RET server!).  These “keep alive” messages can be empty RTP packets with payload type 20 and need to be sent with a frequency governed by an OITF keep-alive timer that SHALL be a random number between 24 and 29 seconds (as specified in Annex <a href="#annex-f-6-2" class="sectionRef">F.6.2</a>, “<a href="#annex-f-6-2" class="sectionTitleRef"></a>”).  </p>
<p>Note: the initial RTCP port mapping request message can be considered the 1st “keep alive” packet</p>
<p>The process is depicted in Figure <a href="#port-mapping-for-ret-sequence" class="figureRef">18</a> in the context of RET service.</p>
<figure id="port-mapping-for-ret-sequence">
<figcaption>Figure ####: Port mapping process and keep-alive packets for RET</figcaption>
<img alt="FIGURE 18" src="images/PortMappingForRET.png" />
</figure>
<p>Figure <a href="#napt-traversal-for-fcc-ret-with-cookie" class="figureRef"></a> shows the relevant ports used for  the unicast FCC/RET RTP and RTCP packet flows when the cookie signaling method is used.</p>
<figure id="napt-traversal-for-fcc-ret-with-cookie">
<figcaption>Figure ####: NAPT traversal for FCC/RET with cookie signalling</figcaption>
<img alt="FIGURE 19" src="images/NAPTtraversalForFCCRETwithCookie.png" />
</figure>
<p>The OITF issues the RTCP port mapping message on Port P1 and are destined to port P2 of the retransmission server (RS) entity of the FCC/RET server.  The NAPT will map the port P1 to Port P1 prime. The RS entity responds with a port mapping response message including the cookie using the same ports. </p>
<p>The RTCP messages sent by the OITF to the feedback target (FT) entity of the FCC/RET server (RAMS-R, NACK, RR, Bye combined with the Session Description Protocol Security Descriptions for Media Streams (SDES)) are sourced on port P3 and destined to port P4 (when passing the NAPT, the port P3 is mapped to a port P3 prime). NACKs or RAMS-R MUST be accompanied with the cookie. The cookie indicates to the FCC/RET server that the response to the NACK or RAMS-R MUST be sent to destination port P1 prime. </p>
<p>The RTP packets and associated RTCP packets (SR and RAMS-I combined with SDES) transmitted by the RS entity of the FCC/RET server to the OITF are sourced on port P2 and destined to port P1 prime. The NAPT will map this to the port P1 when forwarding the packet to the OITF.</p>
<p>In the case of RET services, the OITF sends a RTP keep-alive on source port P1 and destination port P2 to assure the NAT traversal of the RET packet(s). These RTP keep–alive messages can be ignored by the RET server.</p>
<p>The OITF sends RTCP packets (RR, RAMS-T, Bye combined with SDES) to the RS entity of the FCC/RET server with destination port P2 and with P1 as source port.</p>
<p>P4 and P2 are determined by SD&amp;S, whereas the OITF determines the port P3 and P1.</p>
</section>
<section id="annex-g-3-2"><h3>Without Cookie Signalling</h3>
<p>When the FCC/RET-enabled OITF is instructed to not use port mapping messages, i.e. no cookie signalling (see Annex <a href="#fcc-and-ret" class="sectionRef">M</a>), the NAT traversal will be guaranteed because with this method the source port of the RAMS-R or NACK RTCP FB message indicates to the FCC/RET server the OITF receive port for FCC/RET RTP/RTCP packets and the FCC/RET server also assures that the source port of the FCC/RET packets matches the FCC/RET server FT receive port for the RTCP RAMS-R/ NACK messages.  No keep-alive messages from the OITF are REQUIRED.</p>
<figure id="napt-traversal-for-fcc-ret-without-cookie">
<figcaption>Figure ####: NAPT traversal for FCC/RET without cookie signalling</figcaption>
<img alt="FIGURE 20" src="images/NAPTtraversalForFCCRETwithoutCookie.png" />
</figure>
<p>Figure <a href="#napt-traversal-for-fcc-ret-without-cookie" class="figureRef">20</a> shows the relevant ports used for the unicast FCC/RET RTP and RTCP packet flows in the non-cookie signaling method.</p>
<p>The RTCP messages sent by the OITF to the FT entity of the FCC/RET server (RAMS-R, NACK, RR, Bye combined with SDES) are sourced on port P3 and destined to port P4, but when passing the NAPT, the port P3 is mapped to a port P3 prime.</p>
<p>The RTP packets and associated RTCP packets (SR and RAMS-I combined with SDES) transmitted by the RS entity of the FCC/RET server to the OITF are sourced on port P4 and destined to port P3 prime. The NAPT will map this to the port P3 when FW-ing the packet to the OITF.
<p>The OITF sends RTCP packets (RR, RAMS-T, Bye combined with SDES) to the RS entity of the FCC/RET server with destination port P2 and with P1 as source port.</p>
<p>P4 and P2 are determined by SD&amp;S, whereas the OITF determines the port P3 and P1.</p>
</section>
<section id="annex-g-3-3"><h3>Correlation of RTCP messages sent to the RS and FT entity</h3>
<p>In both the cookie and non-cookie signaling method, the RTCP messages sent by the OITF to the FT entity on Port P4 and to the RS entity on Port P2 are correlated by the FCC/RET server and linked to the same OITF by means of inspecting the SSRC identifier present in any RTCP packet and  the unique OITF C-NAME present together with the SSRC in accompanying SDES RTCP packets.</p> 
<p>Each OITF has two SSRC identifiers that are associated with its unique C-NAME: one SSRC identifier used in the IP multicast RTP session (where the RTCP messages using that SSRC are directed to the FT entity of the FCC/RET server) and one SSRC identifier in the unicast session (where the RTCP messages using that SSRC are directed to the RS entity of the FCC/RET server). Those two SSRC-IDs MAY or MAY not have the same value, and hence the OITF CNAME SHALL be used by the FCC/RET server for RTCP message correlation purposes.</p>
</section>
</section>

</section>
<section class="appendix" id="presence-xml-schema"><!--annex H --><h1>Presence XML Schema</h1>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:service:oitfpresence:2011"
  xmlns:tns="urn:oipf:service:oitfpresence:2011"
  xmlns:ct="urn:oipf:base:CommonTypes:2011"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified" attributeFormDefault="unqualified"
  version="0.1"&gt;
  &lt;xs:import namespace="urn:oipf:base:CommonTypes:2011" 
    schemaLocation="base-CommonTypes.xsd" /&gt;
  &lt;xs:element name="BroadcastTVService"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence maxOccurs="unbounded"&gt;
        &lt;xs:element name="BroadcastTV" type="tns:BroadcastTVPresenceType" /&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  &lt;xs:complexType name="BroadcastTVPresenceType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="currentChannel" type="xs:string" /&gt;
      &lt;xs:element name="currentProgram" type="xs:ct:ProgramIdType" /&gt;
      &lt;xs:element name="serviceID" type="xs:string" /&gt;
      &lt;xs:any namespace="##other" processContents="lax"
        minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
    &lt;xs:attribute name="Technology" type="tns:BroadcastTechnologyType" /&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="BroadcastTechnologyType"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:enumeration value="DVB-T" /&gt;
      &lt;xs:enumeration value="DVB-H" /&gt;
      &lt;xs:enumeration value="DVB-S" /&gt;
      &lt;xs:enumeration value="DVB-C" /&gt;
      &lt;xs:enumeration value="DVB-T2" /&gt;
      &lt;xs:enumeration value="DVB-S2" /&gt;
      &lt;xs:enumeration value="DVB-C2" /&gt;
      &lt;xs:enumeration value="ISDB-C" /&gt;
      &lt;xs:enumeration value="ISDB-S" /&gt;
      &lt;xs:enumeration value="ISDB-T" /&gt;
      &lt;xs:enumeration value="ATSC-T" /&gt;
      &lt;xs:enumeration value="ANALOG" /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;
</pre>
</section>
<section class="appendix" id="protocol-procedure-section-structure"><!--annex I --><h1>Protocol Procedure Section Structure (informative)</h1>
<p>Each of the protocol sections of this document specifies the protocol procedures for a specific protocol (e.g. SIP, HTTP etc.). The sections have the following section and subsection structure.</p>
<figure>
<img src="images/PROT-Annex-I-Figure-1.png" style="width:60%" alt="PROT-Annex-I-Figure-1.png"/>
</figure>
<p>This approach of structuring by protocol in the same way as the IMS IPTV Protocols specification developed in TISPAN SHOULD ensure that it is straightforward to investigate alignments with TISPAN. The structure chosen for this specification differs slightly from the TISPAN document structure, with the aim of helping the understanding of the end-to-end design, as it lends itself to the use of sequence charts to visualize the flow of a protocol through multiple components.</p>
<p>The actual TISPAN IMS IPTV Stage 3 specification structure is as follows:</p>
<figure>
<img src="images/PROT-Annex-I-Figure-2.png" style="width:60%" alt="PROT-Annex-I-Figure-2.png"/>
</figure>
</section>
<section class="appendix" id="specific-tr-135-and-106-objects"><!--annex J --><h1>OITF-specific TR-135 and TR-106 Remote Management Objects</h1>
<p>A specific data model for the Remote Management of a retail OITF device has been defined. The data model has been obtained from TR-135 and TR-106 with a selection of a reduced set of parameters with the same semantics (with a few exceptions) and the same types.</p>
<section id="annex-j-1"><h2>OITF-specific TR-135 Remote Management Object</h2>
The following table, obtained from "Table 1/TR-135 – Parameter list for an STB CPE device" in TR-135 [[!TR135]], is the specific data model to manage an OITF.
<table id="t143" class="simple">
<caption>Table ####: Parameter list for an OITF using TR-135</caption>
<tr><th>Parameter</th><th>R/W</th><th>Description</th></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.</b></td><td><b>The overall capabilities of the OITF. This is a constant read-only object, meaning that only a firmware update will cause these values to be altered</b></td></tr>
<tr><td>MaxActiveAVStreams</td><td>R</td><td>max no of simultaneous AV streams active</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.PVR.</b></td><td><b>PVR Capability</b></td></tr>
<tr><td>MaxIOStreams</td><td>R</td><td>(0,1); 0 means no PVR function, 1 mean PVR function</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.AudioDecoder.</b></td><td><b>Audio decoder capabilities</b></td></tr>
<tr><td>AudioStandards</td><td>R</td><td>Comma-separated list of audio standards supported by this OITF</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.VideoDecoder.</b></td><td><b>Video decoder capabilities</b></td></tr>
<tr><td>VideoStandards</td><td>R</td><td>Comma-separated list of video standards supported by this OITF</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.VideoDecoder.MPEG4Part10.</b></td><td><b>Object describing the set of supported profiles and levels for this OITF. It also describes the set of audio standards supported when MPEG4 Part 10 is used as the video standard.</b></td></tr>
<tr><td>AudioStandards</td><td>R</td><td>Comma-separated list of supported Audio Standards supported by the Player when associated with MPEG4 Part 10 video. Each item is taken from the list defined by .Capabilities.AudioDecoder.AudioStandards</td></tr>
<tr><td>ProfileLevelNumberOfEntries</td><td>R</td><td>Number of instances of ProfileLevel</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.VideoDecoder.MPEG4Part10.ProfileLevel.{i}.</b></td><td><b>Table to describe the set of profiles and levels combinations supported by the OITF when MPEG4 Part 10 is used as video standard. Each entry in this table refers to a distinct combination of profile and level. The table MUST include a distinct entry for each supported combination of these parameters.</b></td></tr>
<tr><td>Profile</td><td>R</td><td>Comma-separated list of supported MPEG4 Part 10 profiles. Each item is an enumeration of:<ol class="manual">
<li>“BASELINE”
<li>“MAIN”
<li>“EXTENDED”
<li>“HIGH”
<li>“HIGH 10”
<li>“HIGH 4:2:2”
<li>“HIGH 4:4:4”</ol></td></tr>
<tr><td>Level</td><td>R</td><td>Comma-separated list of supported MPEG4 Part 10 Levels. Each item is an enumeration of:<ol class="manual">
<li>“1”
<li>“1b”
<li>“1.1”
<li>“1.2”
<li>“1.3”
<li>“2”
<li>“2.1”
<li>“2.2”
<li>“3”
<li>“3.1”
<li>“3.2”
<li>“4”
<li>“4.1”
<li>“4.2”
<li>“5”
<li>“5.1”</ol></td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.DRM.</b></td><td><b>This object describes the characteristics of the Conditional Access and/or Digital Rights Management of the OITF.</b></td></tr>
<tr><td>DRMSystems</td><td>R</td><td>Comma-separated list of unique identifiers of OIPF supported Content Protection systems
Each item is an enumeration:<ol class="manual">
<li>“urn:dvb”casystemid:19188”
<li>“OIPF-DTCP-IP”
<li>“OIPF-CI+”
<li>“urn:dvb:casystemid:456 OIPF-CI+”
<li>“urn:dvb:casystemid:12345 OIPF-DCTP-IP"</ol></td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.ServiceMonitoring.</b></td><td><b>This object describes the capabilities of the ServiceMonitoring object.</b></td></tr>
<tr><td>MaxActiveMainStreams</td><td>R</td><td>Maximum number of AV Main streams for which the STB can simultaneously collect statistics.</td></tr>
<tr><td>MinSampleInterval</td><td>R</td><td>Minimum sample interval in seconds that the STB MUST be able to support.</td></tr>
<tr><td>MaxReportSamples</td><td>R</td><td>Maximum number of samples of each statistic that the STB is able to store and report.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.FrontEnd.</b></td><td><b>Front-end capabilities.</b></td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.FrontEnd.DVBT.</b></td><td><b>Capabilities of the DVB-T receiver.</b></td></tr>
<tr><td>MaxActiveDVBTStreams</td><td>R</td><td>Maximum number of simultaneous active AV streams supported by the DVB-T FrontEnd.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Capabilities.FrontEnd.IP.</b></td><td><b>IP Front-End capabilities.</b></td></tr>
<tr><td>MaxDejitteringBufferSize</td><td>R</td><td>Describes the maximum de-jittering buffer size, in bytes, supported by the OITF.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.</b></td><td><b>Details of OITF logical or physical internal components.</b></td></tr>
<tr><td>FrontEndNumberOfEntries</td><td>R</td><td>Number of FrontEnd instances.</td></tr>
<tr><td>AudioDecoderNumberOfEntries</td><td>R</td><td>Number of AudioDecoder instances.</td></tr>
<tr><td>VideoDecoderNumberOfEntries</td><td>R</td><td>Number of VideoDecoder instances.</td></tr>
<tr><td>DRMNumberOfEntries</td><td>R</td><td>Number of DRM instances.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.FrontEnd.{i}.</b></td><td></td></tr>
<tr><td>Name</td><td>R</td><td></td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.FrontEnd.{i}.DVBT.</b></td><td><b>DVB-T front-end details.</b></td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.FrontEnd.{i}.DVBT.Modulation.</b></td><td><b>DVB-T modulation details.</b></td></tr>
<tr><td>SNR</td><td>R</td><td>This parameter is normally the Signal/Noise ratio in the carrier band, measured in dB. In the context of OITF, this parameter (0 to 10) gives a signal quality value from 0 (no signal), 1 (weak signal), 5 (medium signal) to 10 strong signal, when information is available from the chipset</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.FrontEnd.{i}.IP.</b></td><td><b>IP front-end details.</b></td></tr>
<tr><td>InboundNumberOfEntries</td><td>R</td><td>Number of Inbound instances.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.FrontEnd.{i}.IP.RTCP.</b></td><td><b>Parameters related to RTCP receiver report generation</b></td></tr>
<tr><td>Enable</td><td>W</td><td>Enables or disables RTCP receiver report generation. If the OITF does not implement RTCP, then the OITF SHALL send error code 9001, “Request denied (no reason specified)” when the server tries to enable RTCP feedback.</td></tr>
<tr><td>Status</td><td>R</td><td>The status of RTCP receiver report generation. Enumeration of:<ol class="manual">
<li>“Disabled”
<li>“Enabled”
<li>“Error” (OPTIONAL)</ol>
The “Error” value MAY be used by the CPE to indicate a locally defined error condition.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.FrontEnd.{i}.IP.Inbound.{i}.</b></td><td><b>Inbound IP streams currently entering the OITF via this front-end.</b></td></tr>
<tr><td>SourceAddress</td><td>R</td><td>IP address of the source of the current stream content.</td></tr>
<tr><td>SourcePort</td><td>R</td><td>TCP or UDP port number of the source of the current stream content, or 0 if the content is not being delivered via IP or if not applicable.</td></tr>
<tr><td>URI</td><td>R</td><td>RFC 3986 URI that indicates the current source (possibly including Multicast group and port, if relevant) of the stream content, or an empty string if the source is not known or cannot be represented as a URI.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.AudioDecoder.{i}.</b></td><td><b>Audio decoder instance table. It contains data representing the current status of the Audio decoder.</b></td></tr>
<tr><td>Status</td><td>R</td><td>The status of this audio decoder. Enumeration of:<ol class="manual">
<li>“Disabled”
<li>“Enabled”
<li>“Error” (OPTIONAL)</ol>
The “Error” value MAY be used by the CPE to indicate a locally defined error condition.</td></tr>
<tr><td>Name</td><td>R</td><td>Human-readable name associated with this audio decoder.</td></tr>
<tr><td>AudioStandard</td><td>R</td><td>Audio standard currently being processed by this audio decoder, or an empty string if no audio standard is currently being processed.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.VideoDecoder.{i}.</b></td><td><b>Video decoder instance table. It contains data representing the current status of the video decoder.</b></td></tr>
<tr><td>Status</td><td>R</td><td>The status of this video decoder. Enumeration of:<ol class="manual">
<li>“Disabled”
<li>“Enabled”
<li>“Error” (OPTIONAL)</ol>
The “Error” value MAY be used by the CPE to indicate a locally defined error condition.</td></tr>
<tr><td>Name</td><td>R</td><td>Human-readable name associated with this video decoder.</td></tr>
<tr><td>MPEG4Part10</td><td>R</td><td>Path name of the MPEG4 Part 10 profile and level object instance.</td></tr>
<tr><td>ContentAspectRatio</td><td>R</td><td>Indicates the native aspect ratio of the content available at this decoder. Enumeration of:<ol class="manual">
<li>“4:3”
<li>“16:9”</ol></td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.Components.DRM.{i}.</b></td><td><b>This object describes the characteristics of the Digital Rights Management</b></td></tr>
<tr><td>Status</td><td>R</td><td>The status of this DRM system. Enumeration of:<ol class="manual">
<li>“Disabled”
<li>“Enabled”
<li>“Error” (OPTIONAL)</ol>
The “Error” value MAY be used by the CPE to indicate a locally defined error condition.</td></tr>
<tr><td>Name</td><td>R</td><td>Indicates a unique identifier for this DRM system. This name MUST appear in the .Capabilities.DRM.DRMSystems list.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.AVStreams.</b></td><td><b>AV Streams object. If more than one AV stream can be active at a time, it MAY contain several AVStream instances.</b></td></tr>
<tr><td>ActiveAVStreams</td><td>R</td><td>Number of AV streams currently active.</td></tr>
<tr><td>AVStreamNumberOfEntries</td><td>R</td><td>Number of AVStream instances.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.AVStreams.AVStream.{i}.</b></td><td><b>Details of each AVStream. AV streams are created statically. Each AV stream corresponds to a valid {FrontEnd, Audio- Decoder, VideoDecoder} instance combination.</b></td></tr>
<tr><td>Status</td><td>R</td><td>The status of this AV stream. Enumeration of:<ol class="manual">
<li>“Disabled”
<li>“Enabled”
<li>“Error_PVRWriteFailure”
<li>“Error_PVRReadFailure”
<li>“Error” Unspecified error (OPTIONAL)</ol>
<p>An AV stream is disabled if any of the referenced objects are disabled.</p>
<p>If an AV stream is disabled then the values of other AV stream parameters are not significant.</p>
The “Error” value MAY be used by the CPE to indicate a locally defined error condition.</td></tr>
<tr><td>Name</td><td>R</td><td>Human-readable name associated with this stream.</td></tr>
<tr><td>FrontEnd</td><td>R</td><td>Path name of the input FrontEnd object instance associated with this AV stream.</td></tr>
<tr><td>AudioDecoder</td><td>R</td><td>Path name of the Audio Decoder object instance associated with this AV stream.</td></tr>
<tr><td>VideoDecoder</td><td>R</td><td>Path name of the Video Decoder object instance associated with this AV stream.</td></tr>
<tr><td>Inbound</td><td>R</td><td>Path name of the inbound IP stream object instance associated with the FrontEnd for this AV stream.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.</b></td><td><b>Contains statistics relating to the QoS / QoE of Main AV streams. Note that OITF devices do not support the collection of statistics while in STANDBY mode.</b></td></tr>
<tr><td>SampleEnable</td><td>W</td><td>Enables or disables collection of Sample statistics.</td></tr>
<tr><td>SampleState</td><td>R</td><td>PIndicates availability of Sample statistics. Enumeration of:<ol class="manual">
<li>"Disabled" Collection is disabled
<li>"Enabled" Collection is enabled
<li>"Trigger" Collection is enabled and the ACS SHOULD now fetch the collected data</ol>
<p>The transition from Enabled &rarr; Trigger &rarr; Enabled MUST be instantaneous and so will result in only a single value change for notification purposes.</p></td></tr>
<tr><td>SampleInterval</td><td>W</td><td>The sample interval in seconds.</td></tr>
<tr><td>ReportSamples</td><td>W</td><td>The number of samples that the OITF can store and report for each statistic.</td></tr>
<tr><td>TimeReference</td><td>W</td><td>An absolute time reference in UTC to determine when sample intervals will complete.</td></tr>
<tr><td>ReportStartTime</td><td>R</td><td>The absolute time at which the sample interval for the first stored sample (for each statistic) started.</td></tr>
<tr><td>ReportEndTime</td><td>R</td><td>The absolute time at which the sample interval for the last stored sample (for each statistic) ended.</td></tr>
<tr><td>MainStreamNumberOfEntries</td><td>R</td><td>Number of MainStream instances.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.MainStream.{i}.</b></td><td><b>List of Main AV stream objects. Each instance is associated with a specified service type and will collect statistics only for the main stream that matches that service type.</b></td></tr>
<tr><td>Enable</td><td>W</td><td>Enables or disables collection of Total and Sample statistics for this object instance.</td></tr>
<tr><td>Status</td><td>R</td><td>Total and Sample statistics collection status for this object instance. Enumeration of:<ol class="manual">
<li>“Disabled”
<li>“Enabled”
<li>“Error” (OPTIONAL)</ol>
The “Error” value MAY be used by the CPE to indicate a locally defined error condition.</td></tr>
<tr><td>ServiceType</td><td>W</td><td>Service type associated with this main stream instance, or an empty string if this instance is disabled. ServiceType is taken from the list:<ol class="manual">
<li>“IPTV”
<li>“VoD”
<li>“IP”
<li>“CAB”
<li>“DTT”
<li>“SAT”
<li>“PVR”</ol></td></tr>
<tr><td>AVStream</td><td>R</td><td>Path name of the Main AV stream object instance currently associated with this ServiceMonitoring main stream instance.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.MainStream.{i}.Total.</b></td><td><b>Total statistics since this ServiceMonitoring main stream instance was last enabled or Total statistics were last reset.</b></td></tr>
<tr><td>Reset</td><td>W</td><td>When set to true, resets Total statistics for this ServiceMonitoring main stream instance.
<p>Setting it to false has no effect. The value is not saved in device state and is always false when read.</p></td></tr>
<tr><td>ResetTime</td><td>R</td><td>Number of seconds since the Total statistics were last enabled or reset for this ServiceMonitoring main stream instance.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.MainStream.{i}.Total.DejitteringStats.</b></td><td><b>Total de-jittering statistics for this ServiceMonitoring main stream instance.</b></td></tr>
<tr><td>Overruns</td><td>R</td><td>Total number of times the receive jitter buffer has overrun for this AV stream.</td></tr>
<tr><td>Underruns</td><td>R</td><td>Total number of times the receive jitter buffer has underrun for this AV stream.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.MainStream.{i}.Total.RTPStats.</b></td><td><b>Total RTP statistics for this ServiceMonitoring main stream instance.</b></td></tr>
<tr><td>PacketsReceivedBeforeEC</td><td>R</td><td>Total number of RTP packets received for this AV stream.
<p>These statistics are collected before any EC, if available, is applied.</p></td></tr>
<tr><td>PacketsLostBeforeEC</td><td>R</td><td>Total number of RTP packets lost for this stream.
<p>These statistics are collected before any EC, if available, is applied.</p></td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.MainStream.{i}.Total.MPEG2TSStats.</b></td><td><b>Total MPEG2-TS statistics for this ServiceMonitoring main stream instance.</b></td></tr>
<tr><td>TSPacketsReceived</td><td>R</td><td>Total number of MPEG2-TS packets received for this AV stream.</td></tr>
<tr><td>PacketDiscontinuityCounter</td><td>R</td><td>Total number of MPEG2-TS Discontinuity errors that have been captured for this AV stream. This parameter accumulates all of the discontinuities observed for all currently monitored PIDs.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.MainStream.{i}.Total.VideoDecoderStats.</b></td><td><b>Total video decoder application layer statistics for this ServiceMonitoring main stream instance.</b></td></tr>
<tr><td>ILostFrames</td><td>R</td><td>The number of I frames that could not be reproduced by the OITF for this AV stream.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.MainStream.{i}.Sample.RTPStats.</b></td><td><b>RTP Sample statistics for this Service- Monitoring main stream instance.</b></td></tr>
<tr><td>SampleSeconds</td><td>R</td><td>Comma-separated list; each entry is the number of seconds during which RTP data was collected for this AV stream during the sample interval.</td></tr>
<tr><td>PacketsExpected</td><td>R</td><td>Comma-separated list; each entry is the total number of RTP packets expected for this AV stream during the sample interval</td></tr>
<tr><td>PacketsLostBeforeEC</td><td>R</td><td>Comma-separated list; each entry is the total number of RTP packets lost for this AV stream during the sample interval.</td></tr>
<tr><td>PacketsReceivedBeforeEC</td><td>R</td><td>Total number of RTP packets received for this AV stream.
<p>These statistics are collected before any EC, if available, is applied.</p></td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.MainStream.{i}.Sample.MPEG2TSStats.</b></td><td><b>MPEG2-TS Sample statistics for this Service-Monitoring main stream instance.</b></td></tr>
<tr><td>SampleSeconds</td><td>R</td><td>Comma-separated list; each entry is the number of seconds during which MPEG2-TS data was collected for this AV stream during the sample interval.</td></tr>
<tr><td>TSPacketsReceived</td><td>R</td><td>Comma-separated list; each entry is the total number of MPEG2-TS packets received for this AV stream during the sample interval.</td></tr>
<tr><td>PacketDiscontinuityCounter</td><td>R</td><td>Comma-separated list; each entry is the total number of MPEG2-TS Discontinuity errors that were captured for this AV stream during the sample interval.</td></tr>
<tr><td colspan="2" class="nobreak"><b>.STBService.{i}.ServiceMonitoring.MainStream.{i}.Sample.DejitteringStats.</b></td><td><b>De-jittering Sample statistics for this ServiceMonitoring main stream instance.</b></td></tr>
<tr><td>SampleSeconds</td><td>R</td><td>Comma-separated list; each entry is the number of seconds during which de-jittering data was collected for this AV stream during the sample interval.</td></tr>
<tr><td>Overruns</td><td>R</td><td>Comma-separated list; each entry is the total number of times the receive jitter buffer has overrun for this AV stream during the sample interval.</td></tr>
<tr><td>Underruns</td><td>R</td><td>Comma-separated list; each entry is the total number of times the receive jitter buffer has underrun for this AV stream during the sample interval.</td></tr>
</table>
</section>

<section id="annex-j-2"><h2>OITF-specific TR-106 Remote Management Object</h2>
<p>The following table, obtained from “Table 3 – Common Object definitions for Device:1” in TR-106 Amendment 1, “Data Model Template for TR-069-Enabled Devices” [[!TR106]], is the specific data model to manage an OITF.</p>
<p>Note that:</p><ul>
<li>For Device.DeviceInfo, the 3 parameters ManufacturerOUI, ProductClass and Serial Number have slightly different semantic meanings in the context of OIPF and are obtained from the deviceID identifier (refer to section <a href="#s6-1-3-2-1" class="sectionRef">6.1.3.2.1</a>, “<a href="#s6-1-3-2-1" class="sectionTitleRef"></a>”):<ol class="manual">
<li>ManufacturerOUI = HEX(first 3 bytes of SHA-1(X))
<li>ProductClass = "OIPF"
<li>SerialNumber = HEX(remaining bytes, from 4th on, of SHA-1(X)) where X = (MAC address as bytes) + (domain name in ASCII characters).</ol>
<li>All Device.LAN parameters are read-only</ul>
<table id="t144" class="simple">
<caption>Table ####: Parameter list for an OITF using TR-106</caption>
<tr><th>Parameter</th><th>R/W</th><th>Description</th></tr>
<tr><td colspan="2" class="nobreak"><b>Device.</b></td><td><b></b></td></tr>
<tr><td>DeviceSummary</td><td>R</td><td>The DeviceSummary parameter is defined to provide an explicit summary of the top-level data model of the device, including version and profile information.</td></tr>
<tr><td colspan="2" class="nobreak"><b>Device.DeviceInfo.</b></td><td><b>General information about the device, including its identity and version information.</b></td></tr>
<tr><td>Manufacturer</td><td>R</td><td>The manufacturer of the CPE (human readable string).</td></tr>
<tr><td>ManufacturerOUI</td><td>R</td><td>In the context of OIPF, this parameter is the hexadecimal value of the first 3 bytes of SHA-1(X).</td></tr>
<tr><td>ModelName</td><td>R</td><td>Model name of the CPE (human readable string).</td></tr>
<tr><td>Description</td><td>R</td><td>A full description of the CPE device (human readable string).</td></tr>
<tr><td>ProductClass</td><td>R</td><td>In the context of OIPF, this parameter is always "OIPF".</td></tr>
<tr><td>SerialNumber</td><td>R</td><td>In the context of OIPF, this parameter is the hexadecimal value of the remaining bytes (from 4th on) of SHA-1(X).</td></tr>
<tr><td>SoftwareVersion</td><td>R</td><td>A string identifying the software version currently installed in the CPE.</td></tr>
<tr><td colspan="2" class="nobreak"><b>Device.ManagementServer.</b></td><td><b>This object contains parameters relating to the CPE’s association with an ACS.</b></td></tr>
<tr><td>URL</td><td>W</td><td>URL for the CPE to connect to the ACS using the CPE WAN Management Protocol. This parameter MUST be in the form of a valid HTTP or HTTPS URL. The “host” portion of this URL is used by the CPE for validating the ACS certificate when using SSL or TLS. Note that on a factory reset of the CPE, the value of this parameter might be reset to its factory value. If an ACS modifies the value of this parameter, it SHOULD be prepared to accommodate the situation that the original value is restored as the result of a factory reset.</td></tr>
<tr><td>Username</td><td>W</td><td>Username used to authenticate the CPE when making a connection to the ACS using the CPE WAN Management Protocol. This username is used only for HTTP-based authentication of the CPE. Note that on a factory reset of the CPE, the value of this parameter might be reset to its factory value. If an ACS modifies the value of this parameter, it SHOULD be prepared to accommodate the situation that the original value is restored as the result of a factory reset.</td></tr>
<tr><td>Password</td><td>W</td><td>Password used to authenticate the CPE when making a connection to the ACS using the CPE WAN Management Protocol. This password is used only for HTTP-based authentication of the CPE. When read, this parameter returns an empty string, regardless of the actual value. Note that on a factory reset of the CPE, the value of this parameter might be reset to its factory value. If an ACS modifies the value of this parameter, it SHOULD be prepared to accommodate the situation that the original value is restored as the result of a factory reset.</td></tr>
<tr><td>PeriodicInformEnable</td><td>W</td><td>Whether or not the CPE MUST periodically send CPE information to the ACS using the Inform method call.</td></tr>
<tr><td>PeriodicInformInterval</td><td>W</td><td>The duration in seconds of the interval for which the CPE MUST attempt to connect with the ACS and call the Inform method if PeriodicInformEnable is true.</td></tr>
<tr><td>PeriodicInformTime</td><td>W</td><td>An absolute time reference in UTC to determine when the CPE SHOULD initiate the Inform method calls. Each Inform call MUST occur at this reference time plus or minus an integer multiple of the {{param|PeriodicInformInterval}}.
<p>A zero dateTime value (0000-00-00T00:00:00) indicates that no particular time reference is specified. That is, the CPE MAY locally choose the time reference, REQUIRED only to adhere to the specified.</p></td></tr>
<tr><td>ParameterKey</td><td>R</td><td>ParameterKey provides the ACS a reliable and extensible means to track changes made by the ACS. The value of ParameterKey MUST be equal to the value of the ParameterKey argument from the most recent successful SetParameterValues, AddObject, or DeleteObject method call from the ACS.</td></tr>
<tr><td>ConnectionRequestURL</td><td>R</td><td>HTTP URL for an ACS to make a Connection Request notification to the CPE.</td></tr>
<tr><td>ConnectionRequestUsername</td><td>W</td><td>Username used to authenticate an ACS making a Connection Request to the CPE.</td></tr>
<tr><td>ConnectionRequestPassword</td><td>W</td><td>Password used to authenticate an ACS making a Connection Request to the CPE. When read, this parameter returns an empty string, regardless of the actual value.</td></tr>
<tr><td colspan="2" class="nobreak"><b>Device.GatewayInfo.</b></td><td><b>This object contains information associated with a connected Internet Gateway Device.</b></td></tr>
<tr><td>ManufacturerOUI</td><td>R</td><td>Organizationally unique identifier of the associated Internet Gateway Device. An empty string indicates that there is no associated Internet Gateway Device that has been detected.</td></tr>
<tr><td>ProductClass</td><td>R</td><td>Identifier of the product class of the associated Internet Gateway Device. An empty string indicates either that there is no associated Internet Gateway Device that has been detected, or the Internet Gateway Device does not support the use of the product-class parameter.</td></tr>
<tr><td>SerialNumber</td><td>R</td><td>Serial number of the associated Internet Gateway Device. An empty string indicates that there is no associated Internet Gateway Device that has been detected.</td></tr>
<tr><td colspan="2" class="nobreak"><b>Device.LAN.</b></td><td><b>This object contains parameters relating to IPbased LAN connectivity of a device.</b></td></tr>
<tr><td>AddressingType</td><td>R</td><td>The method used to assign an address to this interface. Enumeration of:<ol class="manual">
<li>“DHCP”
<li>“Static”</ol></td></tr>
<tr><td>IPAddress</td><td>R</td><td>The current IP address assigned to this interface.</td></tr>
<tr><td>SubnetMask</td><td>R</td><td>The current subnet mask.</td></tr>
<tr><td>DefaultGateway</td><td>R</td><td>The IP address of the current default gateway for this interface.</td></tr>
<tr><td>DNSServers</td><td>R</td><td>Comma-separated list of IP address of the DNS servers for this interface.</td></tr>
</table>
</section>
</section>

<section class="appendix" id="new-event-package-format"><!--annex K --><h1>New Event package for SIP SUBSCRIBE /NOTIFY (informative)</h1>
<p>Event: oipf-spdlist;DomainName=“koreatelecom.co.kr”.</p>
<p>The newly created event name SHALL be “oipf-spdlist”</p>
<ul>
<li>Also, the <i>DomainName</i> parameter can have either “<i>ALL</i>” or a certain service provider’s domain name. If the value of <i>DomainName</i> parameter SHALL be <i>ALL</i>, IPTV SP Discovery FE SHOULD return all SP discovery information of all service providers. However, if the <i>DomainName</i> value SHALL be a specific domain address, the SP Discovery FE SHOULD return the request specific SP discovery information.
</ul>
<p>Extending the existing Accept-Encoding:</p>
<ul>
<li>The value of “Accept-Encoding” can be either “gzip” or “xml-oipf-bim”. When OITF requests with “xml-oipf-bim”, the SP Discovery FE SHOULD return the SP Discovery XML document which SHALL be encoded with BiM.</ul>
<p>New Event package for SIP NOTIFY request</p><ul>
<li>The Event header of the SIP NOTIFY request SHALL be set with “oipf-spdlist”.
<li>Event: oipf-spdlist;
<li>The Content-Encoding SHALL be either “gzip” or “xml-oipf-bim”.
<li>The “effective-by” parameter for the event header SHALL be set to 0.
<li>The Content-Type SHALL be “application/vnd.oipf.spdlist+xml”.
</ul>
</section>

<section class="appendix" id="overview-of-notification-services"><!--annex L --><h1>Overview of Notification Services in OIPF R2 (informative)</h1>
<figure id="f21">
<figcaption>Figure ####:Overview of notification services</figcaption>
<img alt="FIGURE 21" src="images/OverviewOfNotificationServices.png" style="width:70%"/>
</figure>
<p>Several notification mechanisms are defined for different purpose. The above picture gives an overview of them.</p><ul>
<li>Network generated notification: defined in present document. In this mechanism, notification is transmitted via multicast session and therefore particularly suitable for service provider to provide notification services to a number of users in the same time. The typical service is notification associated with a multicast scheduled content service.
<li>Emergency notification: defined in present document. Similar with network generated notification mechanism, the notification is also transmitted via multicast session. This mechanism is used for service provider to provide emergency notification services. User notification: defined in present document. In this mechanism, notification is subscription based and is transmitted via SIP and proxied by IG. The typical case is for service provider to provide the reminder service about program starts.
<li>CEA based notification (In-session & 3rd party): defined in <a href="volume5.html#CEA2014-notifications" class="extRef">section 5.3.1</a> in [[.OIPF_DAE2]] based on [[!CEA-2014-A]]. In this mechanism, notification can be transmitted either via multicast session within home network or via HTTP Polling (within or outside home network).
<li>IMS event notification (In-session & 3rd party): defined in <a href="volume5.html#IMS-notifications" class="extRef">section 5.3.2</a> in [[.OIPF_DAE2]]. In this mechanism, notification can be transmitted either via SIP and proxied by IG. The typical case is providing Call-ID, Messaging, Chatting service.
</ul>
<p>Following is the protocol and delivery manner for various notification mechanisms:</p>
<table id="t145" class="simple">
<caption>Table ####: Summary of notification mechanisms</caption>
<tr><th></th><th>Unicast/Multicast</th><th>Protocol</th></tr>
<tr><td>NG Notification</td><td>Multicast</td><td>FLUTE</td></tr>
<tr><td>Emergency Notification</td><td>Multicast</td><td>FLUTE</td></tr>
<tr><td>User Notification</td><td>Unicast</td><td>SIP + HTTP</td></tr>
<tr><td>CEA-based Notification</td><td>Multicast*/Unicast</td><td>HTTP/UDP</td></tr>
<tr><td>IMS event Notification</td><td>Unicast</td><td>SIP + HTTP</td></tr>
<tr><td colspan="3">* Here multicast is only applicable within the home network domain.</td></tr>
</table>
</section>
<section class="appendix" id="fcc-and-ret"><!--annex M --><h1>Fast Channel Change and Retransmission (FCC/RET)</h1>
<section id="annex-m-1"><h2>Application Layer Retransmission (RET)</h2>
<p>Retransmission service is based on a server-based technique to prevent visual and audio distortions for IPTV end users, caused by the loss of packets that MAY occur in the service provider network or home network. </p>
<p>RET MAY be applied to both multicact and unicast content services carried over RTP.</p>
<section id="annex-m-1-1"><h3>Unicast RET for multicast content service</h3>
<p>The OITF interacts with a RET server to make use of the unicast RET service for multicast content service. This RET server  receives and caches the IP multicast streams transporting the content services for a limited time, and  acts simultaneously as </p><ul>
<li>the unicast  feedback target (FT) entity for the RTP IP unicast session transporting the content service, where the OITF sends its RTCP messages  -including the Retransmission requests – in unicast to this FT. 
<li>retransmission source (RS) transmitting RET packets from its cache in a dedicated unicast RTP session. 
</ul>
<p>It MUST be noted that when a multicast content service is both RET-enabled and FCC-enabled, the RET server and FCC server SHALL be one and the same.</p>
<p>The following steps take place for the unicast RET service when a packet loss event occurs in the network impacting the OITF:</p>
<table class="sequence">
<tr><td class="label">Step 1:</td><td>The OITF detects one or several missing RTP packets based on RTP sequence number tracking.</td></tr>
<tr><td class="label">Step 2:</td><td>The OITF requests the retransmission of any missing packets with a RTCP FB NACK message to the FT entity of the RET server.</td></tr>
<tr><td class="label">Step 3:</td><td>The retransmission source entity of the RET server sends the missing packet(s) as RTP retransmission packet(s), formatted as defined in [[!RFC4588]].</td></tr>
</table>
<p>The received retransmitted packet(s) is/are put in the original sequence slot in the OITF buffer, ready to be decoded.<p>
<ul>
<li>Cookie signalling
<ol type="a">
<li>The OITF sends a port mapping RTCP (request) message to the RET server. The source port of this message indicates to the RET server the OITF receive port to be used for RET RTP packets.
<li>The FCC/RET server responds with a RTCP port mapping (response) message containing a cookie, which SHALL be sent by the OITF in a dedicated RTCP message together with any subsequent NACK RTCP message requesting RET.
</ol>
<p>The RET server processes the cookie received with every RTCP NACK from the OITF, and this way knows the port for the subsequent RET packet to be sent to that OITF.</p>
<p>This RTCP port mapping message exchange needs to take place prior to the requesting and delivery of RET packets, and SHALL be performed each time the OITF connects to a new IP multicast content service where the cookie remains valid until the OITF disconnects from the IP multicast stream. If an OITF makes use of both the RET and FCC services for the multicast content service, there is a single port mapping message exchange process, as FCC and RET packets are transmitted in the same RTP session.  Hence the same cookie is transmitted along with the FCC request and RET request (NACK) RTCP messages.</p>
<li>Without cookie signalling
<p>With this method the source port of the NACK RTCP message indicates to the RET server the OITF receive port for RET RTP packets.  The RET server SHALL also assure that the source port of the RET packet matches the RET server receive port for the RTCP NACK messages.</p>
</ul>
<p>Note 1: A RET-enabled OITF SHALL support RTP/RTCP muxing, i.e. the OITF SHALL be able to receive the RTP and RTCP packets in the unicast RET session on the same receive port, regardless if method a or b is used by the OITF.</p>
<p>Note 2: For a RET-enabled multicast content service where no cookie signaling is used, the unicast RET packets will traverse any NAT between OITF and RET server because the NAT is primed by the RTCP FB NACK message. Hence, the OITF does not need to send RTP Keep-alive messages When the cookie signaling method is used, the OITF SHALL need to send RTP keep-alives to guarantee the NAT traversal (see Annex <a href="#annex-g-3" class="sectionRef">G.3</a>, “<a href="#annex-g-3" class="sectionTitleRef"></a>”) for the RET packets.</p>
<p>SD&amp;S signals whether the port mapping messaging process (cookie signaling method) MUST be performed or not by the OITF for the RET/FCC-enabled multicact content service. The cookie signaling method SHALL be supported by the OITF.</p>
<p>Figure <a href="#call-flow-multicast-service-unicast-ret" class="figureRef">22</a> shows schematically the steps involved when an OITF makes use of the unicast RET service for multicact content service. Steps a and b are only present when the OITF uses the cookie signalling method.</p>
<figure id="call-flow-multicast-service-unicast-ret">
<figcaption>Figure ####: Call flow for multicast content service with unicast retransmission service</figcaption>
<img alt="FIGURE 22" src="images/MulticastContentServiceWithUnicastRestransmission.png" />
</figure>

<p>Note: For multicast content services, RET MAY also be offered as a multicast service (See Annex <a href="#annex-m-1-3" class="sectionRef">M.1.3</a>, “<a href="#annex-m-1-3" class="sectionTitleRef"></a>”.).</p>
</section>
<section id="annex-m-1-2"><h3>Unicast RET for unicast content service</h3>
<p>The same steps 1, 2 and 3 take place as described for the unicast RET-enabled multicst content service (see Annex <a href="#annex-m-1-1" class="sectionRef">M.1.1</a>, “<a href="#annex-m-1-1" class="sectionTitleRef"></a>”), but the server is the RET-server function that is embedded in the unicast media streaming server.</p>
</section>
<section id="annex-m-1-3"><h3>Multicast RET for multicast content service</h3>
<p>Multicast RET for multicast content service enables scalable packet loss recovery for packet loss events in the multicast stream taking place deep in the network. Multicast RET service SHALL be supported by the OITF when the OITF supports Unicast RET service for multicact content service. </p>
<p>Similar to unicast RET, the IPTV service provider needs to assure there is extra bandwidth available –as compared to a multicact content service without RET- for this RET service. The extra bandwidth budget can be shared among unicast and multicast RET for multicact content service.</p>
<p>When multicact RET service is offered, along with the joining the IP Multicast on which the content service is transported, an OITF supporting RET SHALL also join the IP multicact RET sourced by the RET server, on which the OITF MAY receive RTCP FB NACKs and RET packets, triggered by packet loss events deep in the network.</p>
<p>A distinction can be made whether the packet loss event takes place upstream of the RET server or downstream of the RET server. Figure <a href="#packet-loss-location-relative-to-ret-server" class="figureRef">23</a> shows a topology example illustrating where packet losses in the IP multicact content service tree MAY occur relative to the RET server and to the OITFs serviced by this RET server.</p>
<figure id="packet-loss-location-relative-to-ret-server">
<figcaption>Figure ####: Example showing location of packet loss deep in the network relative to the RET server</figcaption>
<img alt="FIGURE 23" src="images/LocationOfPacketLossRelativeToRETServer.png" />
</figure>
<section id="annex-m-1-3-1"><h4>Packet loss event upstream of the RET server</h4>
<p>The packet loss events indicated as “1” and ‘2” in Figure <a href="#packet-loss-location-relative-to-ret-server" class="figureRef">23</a> are examples of packet loss events upstream of the RET server.
<p>The RET server is able to detect such packet loss event as there are missing packets in the IP multicast streams received by the RET server. Upon such packet loss detection, the RET server transmits a RTCP FB NACK on the IP multicast RET towards the RET-enabled OITFs.</p>
<p>Those OITFs that  were  instructed with SD&amp;S to wait a random or fixed period before sending a (unicast) RTCP FB NACK upon packet loss detection (i.e. non-immediate reporters), SHALL abstain from sending a unicast RTCP FB NACK when receiving the RTCP FB NACK in the IP multicast RET within this waiting period. This mechanism allows to prevention or mitigation of NACK storms. </p>
<p>Note: DVB SD&amp;S contains attributes for multicast RET by which it can signal to OITFs the duration of the waiting period, if any, and this waiting period can be different per OITF.</p>
<p>When the RET server is capable of recovering the missing packet(s), these are sent as retransmission packet(s) over the RET Multicast. How the RET server performs packet loss recovery for upstream packer loss is not addressed in this specification.</p>
<p>Note that the RET server in general can not distinguish between packet loss event 1 and packet loss event 2. therefore sending IP multicast RET packets is only effective when the packet loss event took place on a branch of the content IP multicast tree that also feeds the branches to which the OITFs serviced by this RET server are connected (packet loss event 1 in the figure). This means that in the case of packet loss event 2, the multicast RET packets are transmitted unnecessarily to the OITFs. The OITF SHALL discard RET packets when the corresponding original RTP packets have been received in the IP multicast content stream.</p>
<figure id="packet-loss-upstream-ret-server">
<figcaption>Figure ####: Multicast RET protocol interaction for packet loss upstream of RET server</figcaption>
<img alt="FIGURE 24" src="images/MulticastPacketLossUpstreamOfRetServer.png" />
</figure>
</section>
<section id="annex-m-1-3-2"><h4>Packet loss event downstream of the RET server</h4>
<p>The packet loss event “3” in Figure <a href="#packet-loss-location-relative-to-ret-server" class="figureRef">23</a> is illustrative for a packet loss event downstream of the RET server and impacting several OITFs.</p>
<p>When there is a packet loss event on the IP multicast content service tree branch downstream of the RET server, impacting a large subset of OITFs, the RET server MAY indirectly detect this by receiving a large amount of RET requests from OITFs for the same missing packet(s). Those will be OITFs configured with SD&amp;S as immediate reporters (no waiting period) </p>
<p>The RET server MAY then resend the packet(s) reported as missing RET packet(s) over the IP multicast RET.</p>
<p>A RET-enabled OITF that was impacted by the packet loss AND receives the IP multicast RET packet(s) during its reporting waiting period SHALL NOT send a unicast RTCP FB NACK.</p>
<figure id="packet-loss-downstream-ret-server">
<figcaption>Figure ####: Multicast RET protocol interaction for packet loss downstream of RET server, with the OITF acting as immediate reporter</figcaption>
<img alt="FIGURE 25" src="images/MulticastPacketLossDownstreamOfRetServer.png" />
</figure>
<p>The RET server MAY be provisioned to NOT service unicast retransmission requests from non-immediate reporting OITFs for packet losses that have been addressed by the RET server by means of sending an RTCP FB NACK or the retransmission packet over multicast RET. However, as packet loss events in the multicast RET MAY trigger such unicast retransmission requests, this is a service provider-dependent decision and capabilities of the RET server in terms of keeping track of each OITF's requesting behaviour and/or redundancy measures in the multicast RET will steer that decision.</p>
</section>
</section>
</section>
<section id="annex-m-2"><h2>Fast Channel Change (FCC)</h2>
<p>The FCC solution is an OPTIONAL add-on service to the multicast content service (Scheduled Content Service), based on a server-based technique allowing minimization of the time between the request from a user for a new channel and the instant when the new channel starts displaying.</p>
<p>FCC is defined only for combination with multicast content service carried over RTP.</p>
<p>The FCC-enabled OITF interacts with a FCC server that receives and caches the IP multicast content streams for a limited time, and acts simultaneously as</p> <ul>
<li>the unicast  feedback target (FT) entity for the RTP IP multicast session transporting the content service, where the OITF sends its RTCP messages, including the FCC requests, in unicast to this FT entity. 
<li>a burst source transmitting the FCC packets from its cache in a dedicated unicast RTP session. 
</ul>
<p>When a multicast content service is both RET and FCC-enabled, the RET server and FCC server SHALL be one and the same.</p>
<p>When an end-user zaps to a channel that is FCC–enabled, and the OITF supports FCC, the following steps take place: </p>
<table class="sequence">
<tr><td class="label">Step 0:</td><td>The OITF leaves the “previous” IP multicast stream of the content service that MAY still be received when an end-user zaps (away) to the new FCC-enabled multicast content service.</td></tr>
<tr><td class="label">Step 1:</td><td>The FCC client of the OITF requests a fast channel change by sending a RTCP RAMS-R Feedback (FB) message to the FT entity of the FCC server.  When the OITF performed the port mapping message exchange process, it also transmits the previously assigned cookie.</td></tr>
<tr><td class="label">Step 2:</td><td>The FCC/RET server responds with a RTCP RAMS-I FB message indicating that it accepts or does not accept the FCC request. This message also contains metadata that describes the data burst when the FCC server accepted the FCC request.</td></tr>
<tr><td class="label">Step 3:</td><td>The burst source entity of the FCC server starts sending RTP data (unicast stream) to the OITF from its cache and formatted as defined in [[!RFC4588]]. The FCC server sends the unicast data to the client in general at a higher bitrate than the nominal bitrate of the incoming multicast stream. Video display at the client starts as soon as sufficient data is received in the buffer.</td></tr>
<tr><td class="label">Step 4:</td><td>As the FCC/RET server sends the last data from the buffered IP multicast content, the burst source entity signals the OITF by means of RTCP RAMS-I that  it has to join the multicast stream (this message is OPTIONAL as the FCC server MAY have been forward looking and include this information in the RAMS I message of step 2). </td></tr>
<tr><td class="label">Step 5:</td><td>The OITF SHALL send an IGMP/MLP join message to the TPF to receive the IP multicast stream (as defined in section <a href="#s8-1-1" class="sectionRef">8.1.1</a>, “<a href="#s8-1-1" class="sectionTitleRef"></a>”).</td></tr>
<tr><td class="label">Step 6:</td><td>The OITF receives the IP multicast stream.</td></tr>
<tr><td class="label">Step 7:</td><td>When OITF receives the first multicast packet, it sends an RTCP RAMS-T FB  message to the burst source entity of the FCC server with the RTP sequence number of that packet such that the FCC server knows when to stop forwarding the incoming multicast data in the unicast FCC RTP session.</td></tr>
<tr><td colspan=2>When the end-user selects a new channel, the following steps take place:</td></tr>
<tr><td class="label">Step 8:</td><td>The OITF issues an IGMP/MLP leave for the “old” channel (in line with the multicast content service specification) once it has executed step 5.</td></tr>
<tr><td class="label">Step 9:</td><td>The OITF sends an RTCP Bye message to the burst source entity of the FCC server to indicate it is leaving the unicast RTP session. The OITF also sends a (unicast) Bye message to the FT entity of the FCC serverto indicate it is leaving the “old” IP Multicast RTP session once it has executed step 5.  </td></tr>
</table>
<p>Then the FCC procedure for an FCC-enabled channel starts again with steps 1, 2, etc.</p>
<p>The FCC server will send the unicast RTP FCC packets to the OITF that issued the FCC request, but it needs to determine on which UDP port the OITF expects the unicast RTP FCC packets.  There are two methods by which the OITF indicates to the FCC server its receive port for the unicast stream of RTP FCC packets:</p><ul>
<li>Cookie signaling
<p>This method is defined in [[!PORTMAP]] and the procedure is as follows:</p><ol type="a"> 
<li>The OITF sends a port mapping RTCP (request) message to the burst source entity of the FCC server. The source port of this message indicates to the FCC server the OITF receive port for FCC RTP packets 
<li>The burst source entity of the FCC server responds with a port mapping response RTCP message containing a cookie, which SHALL be sent by the OITF in a dedicated RTCP message together with the RAMS-R RTCP message to the FT entity of the FCC server when requesting the FCC service.
</ol>
<p>The FCC server processes the cookie received with the RTCP RAMS-R from the OITF, and this way, it knows the port for the subsequent FCC RTP packet flow to be transmitted to that OITF. </p>
<p>This RTCP port mapping message exchange SHALL take place prior to sending the RAMS-R message, and SHALL be performed by the OITF each time the end-user zaps to a new channel that is FCC-enabled when cookie signaling MUST be used. </p>
<p>If an OITF makes use of both the RET and FCC services for the multicast content service, there is a single port mapping message exchange process, as FCC and RET packets are transmitted in the same RTP session by the FCC/RET server. Hence the same cookie is transmitted along with the RTCP FCC request and RET request (NACK) RTCP messages, where the cookie remains valid until the OITF disconnects from the IP multicast stream.</p>
<li>Without cookie signaling
<p>With this method the source port of the RAMS-R RTCP FB message indicates to the FCC server the OITF receive port for FCC RTP packets. The FCC server SHALL also assure that the source port of the FCC packets matches the FCC server receive port for the RTCP RAMS-R messages.</p>
</ul>
<p>Note 1: A FCC-enabled OITF SHALL support RTP/RTCP muxing, i.e. the OITF SHALL be able to receive the RTP and RTCP packets in the unicast FCC session on the same receive port.</p>
<p>Note 2: The unicast FCC packet flow will traverse any NAT between OITF and FCC server because the NAT is primed by either the RTCP port mapping request message (cookie signaling approach) or by the RTCP RAMS-R message (without cookie signaling). See Annex <a href="#annex-g-3" class="sectionRef">G.3</a>, “<a href="#annex-g-3" class="sectionTitleRef"></a>”.</p>
<p>SD&amp;S signals whether the port mapping messaging process (cookie signaling method) MUST be used or not by the OITF for the RET/FCC-enabled multicast content service. The cookie signaling method SHALL be supported by the OITF.</p>
<p>Figure <a href="#fast-channel-change-service" class="figureRef"></a> shows schematically the steps involved when an OITF makes use of the FCC service for multicact content service. Steps a and b are only present when the cookie signalling method is used.</p>
<figure id="fast-channel-change-service">
<figcaption>Figure ####: Call flow for Fast Channel Change Service</figcaption>
<img alt="FIGURE 26" src="images/FastChannelChangeCallFlow.png" />
</figure>
<p>Note: The RTCP FCC control messages are defined in Unicast-Based Rapid Acquisition of Multicast RTP Sessions [[!RAMS]].</p>
</section>
</section>
<section class="appendix" id="ig-handling-of-impus-with-gruu"><!--annex N --><h1>IG handling of IMPUs in association with GRUU (informative)</h1>
<p>3GPP has mandated the usage of GRUU for certain features such as session transfer. Support for GRUU has impacts on the OITF and the IG.</p>
<p>The OITF impacts involve requesting a GRUU from the network.</p>
<p>Support in the IG is more complex due to the fact how GRUU works.  The following is a brief description of rationale for the impacts in the IG.</p>
<p>The URI in the contact header used for registering a user is made up of user@host, where user is the username or IMPU and the host is the IP address of the IG. </p>
<p>According to [[!RFC5627]], a GRUU returned from the network to an OITF requesting a GRUU, includes the sip instance feature tag for the OITF. That GRUU can be later used to address that specific user on the specific device (OITF).  Since the same user registered from multiple OITF devices will have a distinct sip instance per OITF, the GRUU allocated by the network to each user on each OITF is different. As such, a request can be explicitly targeted to a specific user on a specific device.</p>
<p>However, using GRUU requires some special handling in the IG. The problem arises from how GRUU is processed by the network; a GRUU deployed to address a user in an incoming request is dereferenced by the network to the user contact registered for the specific user before the request is delivered to the user. Typically if there is no IG, each contact will have a distinct IP address, hence there is no ambiguity. However given that users in a residential LAN are behind the same IG, hence they the same IP address is used in all the contacts.  As such if the same user is registered from multiple devices, the same contact will be used, even though the GRUU is different, but because the network dereferences the GRUU to the user contact,  there is no way for the IG  of selecting the right user. For an incoming request.</p>
<p>To remedy this, the IG MUST allocate for every user a distinctive virtual user name that can be placed in the user portion for the user@host portion when it registers the user with the IMS network. When an incoming request arrives to the IG, the IG will be able to identify the right target device and consequently the correct OITF. The IG maintains a binding between the real username submitted by the OITF and the allocated virtual name used by the IG for registration purpose for the entire time the user is registered.</p>
</section>
<section class="appendix" id="fdt-schema-extensions"><!--annex O --><h1>FDT Schema Extensions</h1>
<p>This section describes the FDT schema extensions:</p>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:iptv:fdt:2010"
    xmlns:fl="http://www.example.com/flute"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:import namespace="http://www.example.com/flute"
   schemaLocation="imports/Flute_FDT.xsd"/&gt;
  &lt;xs:element name="FDT-Instance"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:complexContent&gt;
        &lt;xs:extension base="fl:CommonFDTAttributes"&gt;
          &lt;xs:sequence&gt;
            &lt;xs:element name="File" maxOccurs="unbounded"&gt;
              &lt;xs:complexType&gt;
                &lt;xs:complexContent&gt;
                  &lt;xs:extension base="fl:FileCommonFDTAttributes"&gt;
                    &lt;xs:attribute name="Tag" type="xs:string" use="optional"/&gt;
                    &lt;xs:attribute name="Priority" type="xs:int" use="optional"/&gt;
                  &lt;/xs:extension&gt;
                &lt;/xs:complexContent&gt;
              &lt;/xs:complexType&gt;
            &lt;/xs:element&gt;
          &lt;/xs:sequence&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:complexContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;
</pre>
</section>
<section class="appendix" id="ig-service-awareness"><!--annex P --><h1>IG Service Awareness</h1>
<p>In its role as a B2BUA facing the OITF on one hand and the IMS network on the other hand, and for the IG to insert the appropriate SIP headers reflecting the service desired by the OITF,  the IG must be able to detect from the incoming request the service desired by the OITF. </p>
<p>Following the detection of the requested service, the IG SHALL than insert the additional SIP headers with the appropriate values.  For some of the requested services, such as multimedia telephony, and some IPTV related services, the additional information is defined in the appropriate specification defining those services.</p>
<p>For other services, the IG can be configured for any additional information needed if the services require that. Some services may not require any additional SIP headers to be inserted by the IG.</p>   
<section id="annex-p-1"><h2>IG Algorithm for service awareness</h2>
<p>The IG SHALL support the following algorithm to allow it to determine the service desired by an OITF, and subsequently the additional SIP headers. This algorithm applies only to OITF-initiated sessions:</p>
<ul>
<li>If the Request URI in the incoming INVIIE is the well known PSI for a content service, then the service desired by the OITF is a content service. Furthermore, if the content session is associated with a session transfer than the IG executes the procedure defined in section <a href="#s6-2-2-9-1-2" class="sectionRef">6.2.2.9.1.2</a> “<a href="#s6-2-2-9-1-2" class="sectionTitleRef"></a>”. The algorithm terminates 
<li>If the Request URI in the incoming INVITE includes the PSI of a service configured in the IG, then the desired service is identified and the algorithm terminates
<li>If the Accept header in the incoming SIP INVITE is set to message/cpim, then the service desired by the OITF is IM chat, and the algorithm terminates. Note in this case the IG SHALL also ensure that the SDP include the key words “msrp” associated with the session chatting using MSRP 
<li>The IG examines the SDP according to the following:<ul>
<li>If the SDP includes  one audio m-line only, then the service desired by the OITF is multimedia telephony (MMTEL) and the algorithm terminates
<li>If the SDP includes one audio m-line and one or more video m-lines, then the service desired by the OITF is multimedia telephony (MMTEL) and the algorithm terminates 
<li>If the SDP includes attributes configured in the IG, and that can be matched against the configured service and the algorithm terminates.  
<li>The IG cannot determine the service, it shall proxy the information as received from the OITF without any additional SIP headers.
</ul></ul>
</section>
</section>
<section class="appendix" id="content-reporting-info-package"><!--annex Q --><h1>Definition of Content-Reporting Info Package</h1>
<p>This annex defines an Info Package [[!INFO-PKG]] for sending information on content streamed by an end-user on a device using SIP INFO requests</p>
<h4>Content-Reporting Info Package</h4>
<section id="annex-q-1"><h2>Overall General</h2>
<p>This subclause contains the information required for the IANA registration of an Info Package.</p>
</section>
<section id="annex-q-2"><h2>Overall Description</h2>
<p>When an end-user is streaming content from a device such as an OITF, there is a desire to report the content streamed by the end-user to a central server, such an IPTV Control Functional Entity. This permits services, such as parental control, to be offered to users with the proper authority, and which allows intervention by those users to stop the streamed content, if desired, or take other appropriate actions. Reporting the streamed content does not require user intervention. It is performed autonomously by applications executing on the reporting device if configured to do so. The streamed content can be either a scheduled content or Content on demand, but can be extended to other types of content as well.</p>
<p>The Content-Reporting Info Package is used to transport the necessary information regarding the content streamed by a user. The Content-Reporting Info Package is used to transfer a single content streamed by a user at any time. As such, only one content is transported in a single SIP INFO request.</p>
<p>The Content-Reporting Info Package is defined for any multimedia application that includes content streaming. Any application, where sending information regarding content streamed by a user using the SIP INFO method is required, can use the Content-Reporting Info Package.</p>
</section>
<section id="annex-q-3"><h2>Applicability</h2>
<p>The Info Package mechanism for transporting information about streamed content has been chosen since this is a service that some networks may offer, and as such it is optional. Also networks that offer the service may want to selectively activate the service for some subscribers and not for others. Finally, due to the nature of some multimedia applications, the network needs to be able to selectively stop and /or resume the reporting of the streamed content from a device depending on policies in the network. This is due to the fact that for some multimedia applications, a large number of messages reporting streamed content may be sent simultaneously to the server leading to load problems.</p>
<p>Finally, the mechanism also allows information about streamed content to be sent inside an existing dialog, using the same signalling path as other SIP messages within the dialog, rather than having to establish a separate dialog.</p>
</section>
<section id="annex-q-4"><h2>Info Package Name</h2>The name of the Info Package is: Content-Reporting</section>
<section id="annex-q-5"><h2>Info Package Parameters</h2>No parameters are defined for the Content-Reporting Info Package.</section>
<section id="annex-q-6"><h2>SIP Option Tags</h2>No SIP option tags are defined for the Content-Reporting Info Package.</section>
<section id="annex-q-7"><h2>INFO Message Body Parts</h2>
<section id="annex-q-7-1"><h3>General</h3>Information on streamed content on a device is sent as part of the message body of the SIP INFO request. This subclause defines the information and syntax associated with the message body part used for transporting the information.</section>
<section id="annex-q-7-2"><h3>SIP Content-Type header field value</h3>The value of the SIP Content-Type header field associated with the Content-Reporting Info Package message body is: application/3gpp-ims-pss-mbms-command+xml”</section>
<section id="annex-q-7-3"><h3>SIP Content-Disposition header field value</h3>The value of the SIP Content-Disposition header field associated with the Content-Reporting Info Package message body is: Info-Package.</section>
<section id="annex-q-7-4"><h3>Message body syntax</h3>The syntax of the Content-Reporting Info Package message body is based on the rules defined in section <a href="#s5-3-1-1-6-1" class="sectionRef">5.3.1.1.6.1</a></section>
</section>
<section id="annex-q-8"><h2>Info Package Usage Restrictions</h2>No usage restrictions are defined for the Content-Reporting Info Package.</section>
<section id="annex-q-9"><h2>Rate of INFO Requests</h2>
<p>No maximum rate or minimum rate is defined for sending INFO requests associated with the Content-Reporting Info Package.</p>
<p>When Content-Reporting requests are generated by devices, the package does not provide a feedback mechanism to indicate to the sender that the rate of Content-Reporting generation is too slow or fast. However applications in the network can order a device to stop reporting completely or resume reporting at any time if they so desire.</p>
</section>
<section id="annex-q-10"><h2>Info Package Security Considerations</h2>
<p>No additional security mechanism is defined for the Content-Reporting Info Package.</p>
<p>The security of the Content-Reporting Info Package is based on the generic security mechanism provided for the underlying SIP signalling.</p>
</section>
<section id="annex-q-11"><h2>Implementation Details and Examples</h2><p>None</p></section>
</section>
<section class="appendix" id="digital-media-purchase-info-package"><!--annex R --><h1>Definition of Digital-Media-Purchase Info Package</h1>
<p>This annex defines an Info Package [[!INFO-PKG]] for sending information on content streamed by an end-user on a device using SIP INFO requests</p>
<h4>Digital-Media-Purchase Info Package</h4>
<section id="annex-r-1"><h2>Overall General</h2>
<p>This subclause contains the information required for the IANA registration of an Info Package.</p>
</section>
<section id="annex-r-2"><h2>Overall Description</h2>
<p>Digital purchases are triggered by end users, while watching streamed content. These purchases are associated with advertisements made available to end-users while watching streamed content.</p>
<p>The Digital-Media-Purchase Info Package is used to transport the necessary information regarding the digital content purchased by the end-user. The Digital-Media-Purchase Info Package is used to transfer purchase information regarding a single digital content. As such, purchase information related to only one digital content is transported in a single SIP INFO request.</p>
<p>The Digital-Media-Purchase Info Package is defined for any multimedia application that includes content streaming with advertisement for purchasing digital content. Any application, where sending information regarding digital content purchased bye an end-user using the SIP INFO method is required, can use the Digital-Media-Purchase Info Package.</p>
</section>
<section id="annex-r-3"><h2>Applicability</h2>
<p>The Info Package mechanism for transporting information about purchased digital content by an end user has been chosen since this is a service that some networks may offer, and as such it is optional. Also networks that offer the service may want to selectively activate the service for some subscribers and not for others.</p>
<p>Finally, the mechanism also allows information about purchased digital content to be sent inside an existing dialog, using the same signalling path as other SIP messages within the dialog, rather than having to establish a separate dialog.</p>
</section>
<section id="annex-r-4"><h2>Info Package Name</h2>The name of the Info Package is: Digital-Media-Purchase</section>
<section id="annex-r-5"><h2>Info Package Parameters</h2>No parameters are defined for the Digital-Media-Purchase Info Package.</section>
<section id="annex-r-6"><h2>SIP Option Tags</h2>No SIP option tags are defined for the Digital-Media-Purchase Info Package.</section>
<section id="annex-r-7"><h2>INFO Message Body Parts</h2>
<section id="annex-r-7-1"><h3>General</h3>Information on charges related to digital content purchased by an end-user is sent as part of the message body of the SIP INFO request. This subclause defines the information and syntax associated with the message body part used for transporting the information.</section>
<section id="annex-r-7-2"><h3>SIP Content-Type header field value</h3>The value of the SIP Content-Type header field associated with the Digital-Media-Purchase Info Package message body is: application/vnd.oipf.purchase+xml”</section>
<section id="annex-r-7-3"><h3>SIP Content-Disposition header field value</h3>The value of the SIP Content-Disposition header field associated with the Digital-Media-Purchase Info Package message body is: Info-Package.</section>
<section id="annex-r-7-4"><h3>Message body syntax</h3>The syntax of the Digital-Media-Purchase Info Package message body is based on the rules defined in section <a href="#s5-3-5-8" class="sectionRef">5.3.5.8</a>, “<a href="#s5-3-5-8" class="sectionTitleRef"></a>”</section>
</section>
<section id="annex-r-8"><h2>Info Package Usage Restrictions</h2>No usage restrictions are defined for the Digital-Media-Purchase Info Package.</section>
<section id="annex-r-9"><h2>Rate of INFO Requests</h2>
<p>No maximum rate or minimum rate is defined for sending INFO requests associated with the Digital-Media-Purchase Info Package.</p>
<p>When Digital-Purchase requests are generated by end-user devices, the package does not provide a feedback mechanism to indicate to the sender that the rate of Digital-Purchase generation is too slow or fast. However applications in the network can stop and/or resume purchases related to digital content at any time.</p>
</section>
<section id="annex-r-10"><h2>Info Package Security Considerations</h2>
<p>No additional security mechanism is defined for the Digital-Media-Purchase Info Package.</p>
<p>The security of the Digital-Media-Purchase Info Package is based on the generic security mechanism provided for the underlying SIP signalling.</p>
</section>
<section id="annex-r-11"><h2>Implementation Details and Examples</h2><p>None</p></section>
</section>
<section class="appendix" id="parental-control-watched-content-info-package"><!--annex S --><h1>Definition of Parental-Control-Watched-Content Info Package</h1>

<p>This annex defines an Info Package [[!INFO-PKG]] for sending information on parental control watched content using SIP INFO requests</p>
<h4>Digital-Media-Purchase Info Package</h4>
<section id="annex-s-1"><h2>Overall General</h2><p>This subclause contains the information required for the IANA registration of an Info Package.</p></section>
<section id="annex-s-2"><h2>Overall Description</h2>
<p>An IPTV end user having the parental control authority over another user can initiate subscription to acquire information related to the watched content by the user under his parental control.</p>
<p>The Parental-Control-Watched-Content Info Package is used to transport the necessary information regarding the parental control watched content in a single SIP INFO request.</p>
<p>The Parental-Control-Watched-Content Info Package is defined for any multimedia application that includes parental control watched content. Any application, where sending parental control watched content using the SIP INFO method is required, can use the Parental-Control-Watched-Content Info Package.</p>
</section>
<section id="annex-s-3"><h2>Applicability</h2>
<p>The Info Package mechanism for transporting information about parental control watched content has been chosen since this is a service that some networks may offer, and as such it is optional. Also networks that offer the service may want to selectively activate the service for some subscribers and not for others.</p>
<p>Finally, the mechanism also allows information about parental control watched content to be sent inside an existing dialog, using the same signalling path as other SIP messages within the dialog, rather than having to establish a separate dialog.</p>
</section>
<section id="annex-s-4"><h2>Info Package Name</h2>The name of the Info Package is: Parental-Control-Watched-Content</section>
<section id="annex-s-5"><h2>Info Package Parameters</h2>No parameters are defined for the Parental-Control-Watched-Content Info Package.</section>
<section id="annex-s-6"><h2>SIP Option Tags</h2>No SIP option tags are defined for the Parental-Control-Watched-Content Info Package.</section>
<section id="annex-s-7"><h2>INFO Message Body Parts</h2>
<section id="annex-s-7-1"><h3>General</h3>Information on parental control watched content is sent as part of the message body of the SIP INFO request. This subclause defines the information and syntax associated with the message body part used for transporting the information.</section>
<section id="annex-s-7-2"><h3>SIP Content-Type header field value</h3>The value of the SIP Content-Type header field associated with the Parental-Control-Watched-Content Info Package message body is: application/vnd.oipf.parental-control+xml.</section>
<section id="annex-s-7-3"><h3>SIP Content-Disposition header field value</h3>The value of the SIP Content-Disposition header field associated with the Parental-Control-Watched-Content Info Package message body is: Info-Package.</section>
<section id="annex-s-7-4"><h3>Message body syntax</h3>The syntax of the Parental-Control-Watched-Content Info Package message body is based on the rules defined in section <a href="#s5-3-7-1-4" class="sectionRef">5.3.7.1.4</a>, “<a href="#s5-3-7-1-4" class="sectionTitleRef"></a>”.</section>
</section>
<section id="annex-s-8"><h2>Info Package Usage Restrictions</h2>No usage restrictions are defined for the Parental-Control-Watched-Content Info Package.</section>
<section id="annex-s-9"><h2>Rate of INFO Requests</h2>
<p>No maximum rate or minimum rate is defined for sending INFO requests associated with the Parental-Control-Watched-Content Info Package.</p>
<p>When Parental-Control-Watched-Content requests are generated by end-user devices, the package does not provide a feedback mechanism to indicate to the sender that the rate of Parental-Control-Watched-Content generation is too slow or fast. However applications in the network can stop and/or resume purchases related to digital content at any time.</p>
</section>
<section id="annex-s-10"><h2>Info Package Security Considerations</h2>
<p>No additional security mechanism is defined for the Parental-Control-Watched-Content Info Package.</p>
<p>The security of the Parental-Control-Watched-Content Info Package is based on the generic security mechanism provided for the underlying SIP signalling.</p>
</section>
<section id="annex-s-11"><h2>Implementation Details and Examples</h2><p>None</p></section>
</section>
<section class="appendix" id="common-types"><!--annex T --><h1>Common Types</h1>
<section id="annex-t-1"><h2>Schema</h2>
<p>The following XML schema defines common types used in this specification</p>
<pre class="xml-schema">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema targetNamespace="urn:oipf:base:CommonTypes:2011"
  xmlns:xs="http://www.w3.org/2001/XMLSchema" 
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;

  &lt;xs:complexType name="ProgramIdType"&gt;
    &lt;xs:simpleContent&gt;
      &lt;xs:extension base="xs:anyURI"&gt;
        &lt;xs:attribute name="ProgramType" type="xs:string" use="required" /&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="UserIdType"&gt;
    &lt;xs:restriction base="xs:string"/&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;
</pre>
</section>
<section id="annex-t-2"><h2>Defintions</h2>
<section id="annex-t-2-1"><h3>ProgramIdType</h3>
<p>This datatype is used to define elements which convey the identifier of a program. The ProgramType attribute SHALL be either “SC” for a program delivered as part of the Scheduled Content service, or “COD” for a program delivered as part of the Content On Demand service.</p>
</section>
<section id="annex-t-2-2"><h3>UserIdType</h3>
<p>This datatype is used to define elements which convey the identity of a user. Additional syntax, formatting or restriction of the information  carried may be defined in this specification.</p>
</section>
</section>
</section>

<section class="appendix" id="flute-fdt-extension-schema"><!--annex U --><h1>Schema Extension for FLUTE FDT</h1>
<section id="annex-u-1"><h2>Namespace</h2>
<p>The namespace for Open IPTV Forum is “urn:oipf:protocol:fluteFDT:2009”.</p>
<pre class="xml-schema">
&lt;schema xmlns:tns="urn:oipf:protocol:fluteFDT:2009" xmlns="http://www.w3.org/2001/XMLSchema"
  xmlns:fl="http://www.example.com/flute" targetNamespace="urn:oipf:protocol:fluteFDT:2009"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
&lt;!-- schema filename is  protocol-fluteFDT.xsd --&gt;
</pre>
</section>
<section id="annex-u-2"><h2>Import Namespace and schema</h2>
<pre class="xml-schema">
&lt;import namespace="http://www.example.com/flute"
  schemaLocation="imports/Flute_FDT.xsd"/&gt;
</pre>
</section>
<section id="annex-u-3"><h2>Extension of FDT Attributes</h2>
<p>When FLUTE is used for delivery of objects via multicast the FDT-Instance XML structure is extended using the extension mechanism defined in [[!FLUTE]].</p>
<p>The following attributes are added to the FDT-Instance element, after the standard attributes.</p>
<pre class="xml-schema">
&lt;complexType name="OIPFCommonFDTAttributes"&gt;
  &lt;complexContent&gt;
    &lt;extension base="fl:CommonFDTAttributes"&gt;
      &lt;attribute name="Tags" type="string" use="required"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            This string value contains multiple tags, delimited with a 
            semicolon (";"),  that describe the File
            e.g. "Tag1;Tag2;Tag Three;"
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="Priority" type="positiveInteger" use="optional"
          default="10"/&gt;
    &lt;/extension&gt;
  &lt;/complexContent&gt;
&lt;/complexType&gt;
</pre>
</section>
</section>

</body>
</html>